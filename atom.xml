<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å‘¨å°é±¼ã®CODE_HOME</title>
  <icon>https://www.gravatar.com/avatar/38c59bd5f54d16c1c7442728954b212c</icon>
  <subtitle>æŠ€æœ¯å®… iOSå¼€å‘ JAVAå¼€å‘ èŒå¦¹å­</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://zhoulingyu.com/"/>
  <updated>2018-07-10T03:07:31.628Z</updated>
  <id>http://zhoulingyu.com/</id>
  
  <author>
    <name>å‘¨å°é±¼</name>
    <email>coderfish@163.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>è®°ä¸€æ¬¡åˆ åº“åˆ°æ•°æ®æ¢å¤</title>
    <link href="http://zhoulingyu.com/2018/07/09/data-restoration/"/>
    <id>http://zhoulingyu.com/2018/07/09/data-restoration/</id>
    <published>2018-07-09T15:17:11.000Z</published>
    <updated>2018-07-10T03:07:31.628Z</updated>
    
    <content type="html"><![CDATA[<h1 id="è®°ä¸€æ¬¡åˆ åº“åˆ°æ•°æ®æ¢å¤"><a href="#è®°ä¸€æ¬¡åˆ åº“åˆ°æ•°æ®æ¢å¤" class="headerlink" title="è®°ä¸€æ¬¡åˆ åº“åˆ°æ•°æ®æ¢å¤"></a>è®°ä¸€æ¬¡åˆ åº“åˆ°æ•°æ®æ¢å¤</h1><p>ç†Ÿæ‚‰çš„æœ‹å‹å¯èƒ½çŸ¥é“ï¼Œè¿›å…¥æ¶æ„ç»„åï¼Œä»Šå¹´ä¸€ç›´åœ¨ä¸ºå›¢é˜Ÿåšå„ç§å¼€å‘è¾…åŠ©å·¥å…·ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€ä¸ªæœåŠ¡å™¨ã€‚</p><p>æœ€è¿‘è¿™ä¸ªæœåŠ¡å™¨ä¹Ÿä¸Šçº¿æœ‰ä¸‰æœˆå¤šäº†ï¼Œä¹Ÿä¸æ–­æ”¶é›†äº†å¾ˆå¤šæ•°æ®ï¼ŒåŒ…æ‹¬ç”¨æˆ·çš„å„ç§è¡Œä¸ºæ“ä½œã€API è°ƒç”¨æ•°æ®ç­‰ç­‰ã€‚</p><p>åœ¨æœ€è¿‘çš„ä¸€æ¬¡å‡çº§ä¸­ï¼Œæˆ‘è°ƒæ•´äº†æºç çš„ç›®å½•ç»“æ„ï¼Œè„‘å­ä¸€æŠ½åˆ é™¤äº†æ•°æ®åº“ã€‚</p><a id="more"></a><p>äºæ˜¯å°±å¼€å§‹ä¸ºæœŸä¸€å¤©çš„æ•°æ®æ¢å¤è¿‡ç¨‹ï¼Œæœ€åçš„ç»“æœæ˜¯å¾ˆæ‚²å‰§ï¼Œå¥½åœ¨å½±å“ä¸å¤§ï¼Œå¯ä»¥æ”¾åˆ°åé¢è®²ã€‚</p><h2 id="æ–‡ä»¶æ‰¾å›"><a href="#æ–‡ä»¶æ‰¾å›" class="headerlink" title="æ–‡ä»¶æ‰¾å›"></a>æ–‡ä»¶æ‰¾å›</h2><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œå› ä¸ºæ˜¯å°å¾®æœåŠ¡ï¼Œé‡‡ç”¨çš„æ˜¯æœ€ç®€å•çš„ SQLite æ•°æ®åº“ã€‚SQLite åŒºåˆ†å…¶ä»–çš„æ•°æ®åº“çš„æ˜æ˜¾åœ°æ–¹æ˜¯ï¼Œå®ƒåªæä¾›æœ€åŸºæœ¬çš„æ•°æ®æœåŠ¡ï¼Œä½†å¹¶ä¸å¯ç”¨ç«¯å£ç›‘å¬ï¼Œå¯ä»¥ç®€å•çš„è®¤ä¸ºè¿™å°±æ˜¯ä¸ªæ–‡ä»¶ï¼Œå¦‚æœåˆ é™¤äº†ï¼Œå°±å’Œæ™®é€šæ–‡ä»¶ä»ç³»ç»Ÿä¸­æ¶ˆå¤±æ˜¯ä¸€æ ·çš„ã€‚æ‰€ä»¥é€šå¸¸å¦‚æœä½¿ç”¨ SQLite ä¿å­˜æ•°æ®éœ€è¦è‡ªè¡Œå®šæœŸå¤‡ä»½ã€‚</p><p>æ‰€ä»¥è¿™æ¬¡çš„åšæ–‡è™½ç„¶å«ã€åˆ åº“ã€ï¼Œä½†å®é™…ä¸Šå¯ä»¥ç®€å•çš„ç†è§£æˆ<strong>æ–‡ä»¶æ‰¾å›</strong>ã€‚</p><h2 id="rm-rf"><a href="#rm-rf" class="headerlink" title="rm -rf"></a>rm -rf</h2><p>æˆ‘åœ¨è¯¯åˆ æ—¶ï¼Œæ˜¯ä½¿ç”¨ rm -rf å‘½ä»¤ï¼Œè¿™å½“ç„¶æ˜¯ä¸ªè€³ç†Ÿèƒ½è¯¦çš„æ¶åè¿œæ‰¬çš„å‘½ä»¤ï¼ˆä»¥è‡³äºæˆ‘å½“æ—¶è¯·æ•™åç«¯å¤§ä½¬çš„æ—¶å€™ï¼Œåç«¯å¤§ä½¬çš„ååº”æ˜¯ã€å“¦ï¼Œä½ ä¹Ÿç»ˆäºåˆ ä¸€æ¬¡åº“å•¦ã€ï¼‰</p><p>rm æ˜¯ linux ç³»ç»Ÿçš„ç”¨äºã€åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ã€çš„å‘½ä»¤</p><p><code>-f</code> æ ‡è¯†è¡¨ç¤º forceï¼Œå³ï¼š</p><blockquote><p>åœ¨é™¤å»æœ‰å†™ä¿æŠ¤çš„æ–‡ä»¶å‰ä¸æç¤ºã€‚</p></blockquote><p><code>-r</code> æ ‡è¯†è¡¨ç¤ºï¼š</p><blockquote><p>å½“ File å‚æ•°ä¸ºç›®å½•æ—¶å…è®¸å¾ªç¯çš„åˆ é™¤ç›®å½•åŠå…¶å†…å®¹</p></blockquote><p><strong>FYI</strong>: <a href="https://www.ibm.com/support/knowledgecenter/zh/ssw_aix_71/com.ibm.aix.cmds4/rm.htm" target="_blank" rel="noopener">æ›´å¤šå‚è€ƒ</a></p><h2 id="extundelete-ä¸ç£ç›˜å­˜å‚¨"><a href="#extundelete-ä¸ç£ç›˜å­˜å‚¨" class="headerlink" title="extundelete ä¸ç£ç›˜å­˜å‚¨"></a>extundelete ä¸ç£ç›˜å­˜å‚¨</h2><p><a href="http://extundelete.sourceforge.net/" target="_blank" rel="noopener">extundelete</a> æ˜¯ linux ç³»ç»Ÿä¸‹ä¸€ä¸ªæœ‰åŠ›çš„æ•°æ®æ¢å¤å·¥å…·ã€‚extundeleteä½¿ç”¨å­˜å‚¨åœ¨åˆ†åŒºæ—¥å¿—ä¸­çš„ä¿¡æ¯æ¥å°è¯•æ¢å¤å·²ä»åˆ†åŒºä¸­åˆ é™¤çš„æ–‡ä»¶ã€‚</p><p>æˆ‘ä»¬ç¨å¾®å¤ä¹ ä¸€ä¸‹è®¡ç®—æœºåŸºç¡€çŸ¥è¯†ï¼š</p><h3 id="ç¡¬ç›˜"><a href="#ç¡¬ç›˜" class="headerlink" title="ç¡¬ç›˜"></a>ç¡¬ç›˜</h3><p>ç¡¬ç›˜æ˜¯ä¸€ç§é‡‡ç”¨ç£ä»‹è´¨çš„æ•°æ®å­˜å‚¨è®¾å¤‡ï¼Œæ•°æ®ã€ç‰©ç†æ„ä¹‰ä¸Šçš„ã€å­˜å‚¨åœ¨è‹¥å¹²ä¸ªç£ç›˜ç‰‡ä¸Šã€‚åœ¨ç£ç›˜ç‰‡çš„æ¯ä¸€é¢ä¸Šï¼Œä»¥è½¬åŠ¨è½´ä¸ºè½´å¿ƒã€ä»¥ä¸€å®šçš„ç£å¯†åº¦ä¸ºé—´éš”çš„è‹¥å¹²ä¸ªåŒå¿ƒåœ†å°±è¢«åˆ’åˆ†æˆç£é“ï¼ˆtrackï¼‰ï¼Œæ¯ä¸ªç£é“åˆè¢«åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªæ‰‡åŒºï¼ˆsectorï¼‰ã€‚</p><h3 id="ä¸»å¼•å¯¼æ‰‡åŒºå’Œåˆ†åŒºè¡¨"><a href="#ä¸»å¼•å¯¼æ‰‡åŒºå’Œåˆ†åŒºè¡¨" class="headerlink" title="ä¸»å¼•å¯¼æ‰‡åŒºå’Œåˆ†åŒºè¡¨"></a>ä¸»å¼•å¯¼æ‰‡åŒºå’Œåˆ†åŒºè¡¨</h3><p>ç¡¬ç›˜çš„0ç£é“0æŸ±é¢1æ‰‡åŒºæ˜¯ä¸»å¼•å¯¼æ‰‡åŒºä½ï¼ŒåŒ…æ‹¬ç¡¬ç›˜ä¸»å¼•å¯¼è®°å½•MBRï¼ˆMain Boot Recordï¼‰å’Œ<strong>åˆ†åŒºè¡¨</strong>DPTï¼ˆDisk Partition Tableï¼‰ã€‚<strong>æ“ä½œç³»ç»Ÿé€šè¿‡åˆ†åŒºè¡¨æŠŠç¡¬ç›˜åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªåˆ†åŒºï¼Œç„¶åå†åœ¨æ¯ä¸ªåˆ†åŒºé‡Œé¢åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿï¼Œå†™å…¥æ•°æ®æ–‡ä»¶ã€‚</strong></p><h3 id="åˆ†åŒºæ—¥å¿—"><a href="#åˆ†åŒºæ—¥å¿—" class="headerlink" title="åˆ†åŒºæ—¥å¿—"></a>åˆ†åŒºæ—¥å¿—</h3><p>åˆ†åŒºæ—¥å¿—ç³»ç»Ÿæ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œç”¨äºä¿®å¤ç”±äºè®¡ç®—æœºå…³é—­ä¸å½“è€Œå¯¼è‡´çš„ä»»ä½•ä¸ä¸€è‡´ã€‚è¿™ç§å…³é—­é€šå¸¸æ˜¯ç”±äºç”µæºä¸­æ–­æˆ–è½¯ä»¶é—®é¢˜é€ æˆçš„ã€‚å³è®°å½•äº†åˆ†åŒºçš„æ•°æ®è¯»å†™æ“ä½œã€‚</p><p>é€šè¿‡è¿™äº›æ—¥å¿—ï¼Œå¯ä»¥çŸ¥é“åˆ†åŒºä¸­çš„å†å²æ“ä½œã€‚</p><h3 id="æ•°æ®å­˜å‚¨"><a href="#æ•°æ®å­˜å‚¨" class="headerlink" title="æ•°æ®å­˜å‚¨"></a>æ•°æ®å­˜å‚¨</h3><p>å…·ä½“çš„æ•°æ®å­˜å‚¨åŸç†å†…å®¹æ¯”è¾ƒå¤šï¼Œè¿™é‡Œä¸åšèµ˜è¿°ã€‚ä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘åœ¨æ­¤ç†è§£ä¸ºï¼š</p><blockquote><p>æ“ä½œç³»ç»Ÿä¸­çš„æ–‡ä»¶åœ¨ç¡¬ç›˜çš„è¡¨ç°å½¢å¼æ˜¯åœ¨ç¡¬ç›˜ä¸€ç‰‡æ•°æ®åŒºåŸŸè®°å½•äºŒè¿›åˆ¶ä¿¡æ¯ï¼Œå¹¶ç”±æ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘è¯¥ç‰©ç†åœ°å€<br>è€Œæ“ä½œç³»ç»Ÿçº§åˆ«çš„ã€åˆ é™¤æ–‡ä»¶ã€ï¼Œå³åˆ é™¤è¿™ä¸ªã€æŒ‡é’ˆã€<br>åŸæ¥çš„ç‰©ç†åœ°å€å†…æ²¡æœ‰ã€æŒ‡é’ˆã€æŒ‡å‘åï¼Œç›¸å½“äºè¢«é‡Šæ”¾ï¼Œå½“æ“ä½œç³»ç»Ÿéœ€è¦æ—¶ï¼Œå¯ä»¥è¢«å¤å†™ä¸Šæ–°çš„æ•°æ®ã€‚</p></blockquote><p>ç”±æ­¤è§‚å¾—ï¼Œextundelete é€šè¿‡æŸ¥é˜…åˆ†åŒºæ—¥å¿—ï¼Œæ‰¾åˆ°è¢«åˆ é™¤çš„æŒ‡é’ˆï¼Œå‘Šè¯‰ç”¨æˆ·ï¼Œå¯ä»¥å°è¯•æ¢å¤å“ªäº›æ•°æ®ã€‚</p><p>ä½†ç”±äºæ“ä½œç³»ç»Ÿéšæ—¶å¯ä»¥å¤å†™ç©ºä½™ç£ç›˜ï¼Œæ‰€ä»¥å¦‚æœè¦æ¢å¤çš„ç‰©ç†åœ°å€å·²ç»è¢«æ”¹å†™ï¼Œæ•°æ®å°†æ— æ³•æ‰¾å›ã€‚</p><h3 id="DEMO"><a href="#DEMO" class="headerlink" title="DEMO"></a>DEMO</h3><p>ä¸ºäº†è„±æ•ï¼Œæˆ‘ä½¿ç”¨æˆ‘è‡ªå·±çš„æœåŠ¡å™¨ï¼Œå…·ä½“è®°å½•ä¸€ä¸‹æ–‡ä»¶æ¢å¤çš„è¿‡ç¨‹ã€‚</p><h4 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h4><ul><li>CentOS 7.4 64ä½</li><li>æ–‡ä»¶ç›®å½•: /root/Sparrow/db.sqlite3</li></ul><h4 id="åˆ é™¤æ–‡ä»¶"><a href="#åˆ é™¤æ–‡ä»¶" class="headerlink" title="åˆ é™¤æ–‡ä»¶"></a>åˆ é™¤æ–‡ä»¶</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> rm -rf db.sqlite3</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…-extundelete"><a href="#å®‰è£…-extundelete" class="headerlink" title="å®‰è£… extundelete"></a>å®‰è£… extundelete</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> yum install extundelete -y</span><br></pre></td></tr></table></figure><h4 id="æŒ‚è½½ç£ç›˜"><a href="#æŒ‚è½½ç£ç›˜" class="headerlink" title="æŒ‚è½½ç£ç›˜"></a>æŒ‚è½½ç£ç›˜</h4><p>é¦–å…ˆæˆ‘ä»¬å»æŸ¥è¯¢è¿™ä¸ªæ–‡ä»¶æˆ–ä¸Šçº§æ–‡ä»¶å¤¹æ‰€å¤„çš„ç£ç›˜</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> df /root/Sparrow/</span><br><span class="line">æ–‡ä»¶ç³»ç»Ÿ          1K-å—    å·²ç”¨     å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹</span><br><span class="line">/dev/vda1      41151808 2614640 36423736    7% /</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°åé¦–è¦çš„æ˜¯æŒ‚è½½ç£ç›˜ï¼Œ<strong>æŒ‚è½½åç£ç›˜å°†ä¸ä¼šè¢«ç»§ç»­å†™å…¥ï¼Œä¿æŠ¤ç°åœº</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount /dev/vda1</span><br></pre></td></tr></table></figure><p><code>/dev/vda1</code> å°±æ˜¯æ–‡ä»¶æ‰€åœ¨çš„ç£ç›˜ã€‚</p><p>ä¸æŒ‚è½½ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¿™æ ·ä¼šå¯¼è‡´ç£ç›˜å¯èƒ½ä¼šè¢«å…¶ä»–çš„è¿›ç¨‹å†™å…¥æ•°æ®ï¼Œä»è€ŒæŠ¹æ‰åŸæ¥çš„æ•°æ®ï¼Œæ‰€ä»¥æˆ‘æœ€åæ²¡æœ‰æ‰¾å›æ–‡ä»¶å°±æ˜¯å› ä¸ºæ²¡æœ‰åŠæ—¶æŒ‚è½½ã€‚</p><h4 id="inode"><a href="#inode" class="headerlink" title="inode"></a>inode</h4><p>inode æ˜¯ linux ç³»ç»Ÿä¸‹æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹çš„æ ‡è¯†ã€‚é€šè¿‡ <code>ls â€“id</code> å°±å¯ä»¥çœ‹åˆ°ã€‚</p><p>è¯»å–æ ¹ç›®å½•çš„ inode å€¼ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> ls -id /</span><br><span class="line">2 /</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬çŸ¥é“ç£ç›˜æ ¹ç›®å½•çš„ inode æ˜¯ 2ã€‚</p><h4 id="extundelete-æŸ¥è¯¢å¯æ¢å¤çš„æ•°æ®ä¿¡æ¯"><a href="#extundelete-æŸ¥è¯¢å¯æ¢å¤çš„æ•°æ®ä¿¡æ¯" class="headerlink" title="extundelete æŸ¥è¯¢å¯æ¢å¤çš„æ•°æ®ä¿¡æ¯"></a>extundelete æŸ¥è¯¢å¯æ¢å¤çš„æ•°æ®ä¿¡æ¯</h4><p>å…ˆæŸ¥è¯¢ç£ç›˜æ ¹ç›®å½•ä¸‹çš„å¯æ¢å¤ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> extundelete /dev/vda1 --inode 2</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæ—¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‚è½½ç£ç›˜ï¼Œä¼šæç¤ºã€‚</p><p>å¾—åˆ°ç»“æœï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_data-restoration-01.png" alt=""></p><p>é‡ç‚¹ç›˜çº¢åœˆå†…ï¼Œçœ‹åˆ° <code>root</code> çš„ inode æ˜¯ 131073ï¼Œç»§ç»­æŸ¥è¯¢ <code>/dev</code> çš„ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> extundelete /dev/vda1 --inode 131073</span><br></pre></td></tr></table></figure><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_data-restoration-02.png" alt=""></p><p>çœ‹åˆ° <code>/Sparrow</code>  æ˜¯ 262194ï¼Œç»§ç»­æŸ¥è¯¢ <code>/dev</code> çš„ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> extundelete /dev/vda1 --inode 262194</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆæ‰¾åˆ°äº†åˆ é™¤ä¿¡æ¯ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_data-restoration-03.png" alt=""></p><p>å¯ä»¥çœ‹åˆ° db.sqlite3 è¢«æ ‡è¯†ä¸º <code>Deleted</code>ã€‚</p><h4 id="extundelete-æ¢å¤æ•°æ®"><a href="#extundelete-æ¢å¤æ•°æ®" class="headerlink" title="extundelete æ¢å¤æ•°æ®"></a>extundelete æ¢å¤æ•°æ®</h4><p>æ‰§è¡Œ â€“restore-directory æ¢å¤æŒ‡å®šç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> extundelete /dev/vda1 --restore-directory /root/Sparrow/db.sqlite3</span><br></pre></td></tr></table></figure><p>æˆ–æ‰§è¡Œ â€“restore-all æ¢å¤æ‰€æœ‰å¯æ¢å¤çš„æ•°æ®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> extundelete /dev/vda1 --restore-all</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æŸåï¼Œä¼šåœ¨å½“å‰è·¯å¾„ä¸‹ï¼Œç”Ÿæˆä¸€ä¸ª <code>RECOVERED_FILES</code> æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰æ‰€æœ‰è¢«æ¢å¤çš„æ–‡ä»¶ã€‚</p><p>å¦‚æœç£ç›˜å·²ç»è¢«è¯»å†™ï¼Œæ— æ³•æ¢å¤ï¼Œä¼šæç¤ºç±»ä¼¼ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Loading filesystem metadata ... 320 groups loaded.</span><br><span class="line">Loading journal descriptors ... 27896 descriptors loaded.</span><br><span class="line">Searching for recoverable inodes in directory /root/Sparrow/db.sqlite3 ...</span><br><span class="line">120 recoverable inodes found.</span><br><span class="line">Looking through the directory structure for deleted files ...</span><br><span class="line">120 recoverable inodes still lost.</span><br><span class="line">No files were undeleted.</span><br></pre></td></tr></table></figure><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>è¿™ä¸€æ¬¡çš„ã€åˆ åº“ã€äº‹ä»¶ï¼Œç»™æˆ‘äº†ä¸€ä¸ªå¾ˆå¥½çš„æ•™è®­ã€‚æœåŠ¡å™¨çš„æ•°æ®ä¸€å®šè¦åŠæ—¶å¤‡ä»½æˆ–åšå¥½å®¹ç¾ï¼Œé˜²æ­¢ä¸¢å¤±ã€‚åŒæ—¶ï¼Œè¿™æ¬¡ä¹Ÿå€Ÿæ­¤æœºä¼šè¿›è¡Œå­¦ä¹ äº†æ–‡ä»¶æ¢å¤ã€‚</p><p>å½“ç„¶ï¼Œå¸Œæœ›å¤§å®¶éƒ½ä¸ä¼šå‡ºç°æˆ‘è¿™æ ·çš„æ‚²å‰§ ğŸ˜‚ã€‚</p><hr><p>æœ‰ä»€ä¹ˆé—®é¢˜éƒ½å¯ä»¥åœ¨åšæ–‡åé¢ç•™è¨€ï¼Œæˆ–è€…å¾®åšä¸Šç§ä¿¡æˆ‘ï¼Œæˆ–è€…é‚®ä»¶æˆ‘ <a href="mailto:&#x63;&#x6f;&#x64;&#101;&#114;&#x66;&#105;&#115;&#104;&#x40;&#49;&#x36;&#x33;&#x2e;&#99;&#111;&#109;" target="_blank" rel="noopener">&#x63;&#x6f;&#x64;&#101;&#114;&#x66;&#105;&#115;&#104;&#x40;&#49;&#x36;&#x33;&#x2e;&#99;&#111;&#109;</a>ã€‚</p><p>åšä¸»æ˜¯ iOS å¦¹å­ä¸€æšã€‚</p><p>å¸Œæœ›å¤§å®¶ä¸€èµ·è¿›æ­¥ã€‚</p><p>æˆ‘çš„å¾®åšï¼š<a href="http://weibo.com/coderfish/" target="_blank" rel="noopener">å‘¨å°é±¼</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;è®°ä¸€æ¬¡åˆ åº“åˆ°æ•°æ®æ¢å¤&quot;&gt;&lt;a href=&quot;#è®°ä¸€æ¬¡åˆ åº“åˆ°æ•°æ®æ¢å¤&quot; class=&quot;headerlink&quot; title=&quot;è®°ä¸€æ¬¡åˆ åº“åˆ°æ•°æ®æ¢å¤&quot;&gt;&lt;/a&gt;è®°ä¸€æ¬¡åˆ åº“åˆ°æ•°æ®æ¢å¤&lt;/h1&gt;&lt;p&gt;ç†Ÿæ‚‰çš„æœ‹å‹å¯èƒ½çŸ¥é“ï¼Œè¿›å…¥æ¶æ„ç»„åï¼Œä»Šå¹´ä¸€ç›´åœ¨ä¸ºå›¢é˜Ÿåšå„ç§å¼€å‘è¾…åŠ©å·¥å…·ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€ä¸ªæœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;p&gt;æœ€è¿‘è¿™ä¸ªæœåŠ¡å™¨ä¹Ÿä¸Šçº¿æœ‰ä¸‰æœˆå¤šäº†ï¼Œä¹Ÿä¸æ–­æ”¶é›†äº†å¾ˆå¤šæ•°æ®ï¼ŒåŒ…æ‹¬ç”¨æˆ·çš„å„ç§è¡Œä¸ºæ“ä½œã€API è°ƒç”¨æ•°æ®ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æœ€è¿‘çš„ä¸€æ¬¡å‡çº§ä¸­ï¼Œæˆ‘è°ƒæ•´äº†æºç çš„ç›®å½•ç»“æ„ï¼Œè„‘å­ä¸€æŠ½åˆ é™¤äº†æ•°æ®åº“ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Other" scheme="http://zhoulingyu.com/categories/Other/"/>
    
    
      <category term="åç«¯" scheme="http://zhoulingyu.com/tags/%E5%90%8E%E7%AB%AF/"/>
    
      <category term="linux" scheme="http://zhoulingyu.com/tags/linux/"/>
    
      <category term="æ•°æ®åº“" scheme="http://zhoulingyu.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>iOS æµé‡ç›‘æ§åˆ†æ</title>
    <link href="http://zhoulingyu.com/2018/05/30/ios-network-traffic/"/>
    <id>http://zhoulingyu.com/2018/05/30/ios-network-traffic/</id>
    <published>2018-05-30T14:02:16.000Z</published>
    <updated>2018-07-10T03:07:31.628Z</updated>
    
    <content type="html"><![CDATA[<p>ç”±äºéª‘æ‰‹ä¸èƒ½éšæ—¶å¤„åœ¨æœ‰ WIFI çš„çŠ¶æ€ï¼Œæµé‡å˜æˆäº†å¾ˆæ•æ„Ÿçš„é—®é¢˜ï¼Œä¸ºäº†ç²¾ç¡®åˆ°æ¯ä¸ª API çš„æµé‡ï¼Œè¿›è¡Œé’ˆå¯¹æ€§çš„ä¼˜åŒ–ï¼Œå¼€å§‹åœ¨æˆ‘ä»¬çš„ APM ä¸­æ·»åŠ æµé‡ç›‘æ§åŠŸèƒ½ã€‚</p><p>æœ¬æ–‡å°†è®°å½•è‡ªå·±åšæµé‡ç›‘æ§æ–¹é¢çš„æ€»ç»“ã€‚å…¶ä¸­åŒ…æ‹¬äº†éå¸¸å¤šçš„<strong>è¸©å‘ç»éªŒ</strong>ï¼Œå’Œç°æœ‰ä¸€äº›<strong>æ–¹æ¡ˆçš„ç¼ºé™·åˆ†æ</strong>ï¼Œå¯¹æˆ‘æ¥è¯´æ˜¯ä¸€ä¸ªéå¸¸æœ‰æ„ä¹‰çš„è¿‡ç¨‹ã€‚</p><blockquote><p>å¹²è´§é¢„è­¦ğŸ¤£è¯·åšå¥½è¯»å¤§é‡ä»£ç çš„å‡†å¤‡ğŸ˜‚ğŸ˜‚ğŸ˜‚</p></blockquote><a id="more"></a><h1 id="ä¸€ã€èµ„æ–™æ”¶é›†"><a href="#ä¸€ã€èµ„æ–™æ”¶é›†" class="headerlink" title="ä¸€ã€èµ„æ–™æ”¶é›†"></a>ä¸€ã€èµ„æ–™æ”¶é›†</h1><p>å°±ç›®å‰æ¥è¯´ï¼Œå„å®¶å¤§å‚åŸºæœ¬éƒ½æœ‰è‡ªå·±çš„ APMï¼ˆåŒ…æ‹¬æˆ‘ä»¬å…¬å¸å…¶å®ä¹‹å‰ä¹Ÿæœ‰ä¸€å¥— APMï¼Œä½†æ˜¯ç”±äºå„ä¸ªäº‹ä¸šéƒ¨çš„éœ€æ±‚ä¸åŒï¼Œå°šä¸èƒ½å®Œå…¨æ»¡è¶³ç‰©æµå¹³å°çš„éœ€è¦ï¼‰ä½†å„å®¶å¤§å‚ç›®å‰å¼€æºçš„ APM é¡¹ç›®å´ä¸å¤šï¼Œå½“ç„¶ä¹Ÿå¯èƒ½æ˜¯ç”±äºå„å®¶çš„ä¸šåŠ¡åœºæ™¯å·®å¼‚æ¯”è¾ƒå¤§ä¸”å¯¹æ•°æ®çš„åç»­å¤„ç†ä¸åŒã€‚</p><p>æ‰€ä»¥æœ¬æ¬¡åœ¨æŸ¥é˜…èµ„æ–™é˜¶æ®µï¼Œæ²¡æœ‰å¤ªå¤šçš„æºç å¯é€‰å‚è€ƒï¼Œä½†æœ‰ä¸å°‘æ–‡ç« ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€äº›æœ¬æ¬¡å¼€å‘è¿‡ç¨‹ä¸­å‚è€ƒçš„æ–‡ç« å’Œå¼€æºåº“ï¼š</p><ol><li><a href="https://github.com/aozhimin/iOS-Monitor-Platform" target="_blank" rel="noopener">iOS-Monitor-Platform</a></li><li><a href="https://github.com/zixun/GodEye" target="_blank" rel="noopener">GodEye</a></li><li><a href="https://github.com/zixun/NetworkEye" target="_blank" rel="noopener">NetworkEye</a></li><li><a href="https://tech.meituan.com/hertz.html" target="_blank" rel="noopener">ç§»åŠ¨ç«¯æ€§èƒ½ç›‘æ§æ–¹æ¡ˆHertz</a></li><li><a href="http://liujinlongxa.com/2016/12/20/%E4%BD%BF%E7%94%A8NSURLProtocol%E6%B3%A8%E6%84%8F%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/" target="_blank" rel="noopener">ä½¿ç”¨NSURLProtocolæ³¨æ„çš„ä¸€äº›é—®é¢˜</a></li><li><a href="https://github.com/Draveness/analyze/blob/master/contents/OHHTTPStubs/iOS%20%E5%BC%80%E5%8F%91%E4%B8%AD%E4%BD%BF%E7%94%A8%20NSURLProtocol%20%E6%8B%A6%E6%88%AA%20HTTP%20%E8%AF%B7%E6%B1%82.md" target="_blank" rel="noopener">iOS å¼€å‘ä¸­ä½¿ç”¨ NSURLProtocol æ‹¦æˆª HTTP è¯·æ±‚</a></li><li><a href="https://www.jianshu.com/p/49e7282e888d" target="_blank" rel="noopener">è·å–NSURLResponseçš„HTTPVersion</a></li></ol><p>ä½†ä»¥ä¸Šè¿™äº›èµ„æ–™å¯¹æˆ‘ä»¬çš„éœ€æ±‚éƒ½æœ‰ä¸è¶³ä¹‹å¤„ï¼š</p><p><strong>1. Request å’Œ Response è®°åœ¨åŒä¸€æ¡è®°å½•</strong></p><p>åœ¨å®é™…çš„ç½‘ç»œè¯·æ±‚ä¸­ Request å’Œ Response ä¸ä¸€å®šæ˜¯æˆå¯¹çš„ï¼Œå¦‚æœç½‘ç»œæ–­å¼€ã€æˆ–è€…çªç„¶å…³é—­è¿›ç¨‹ï¼Œéƒ½ä¼šå¯¼è‡´ä¸æˆå¯¹ç°è±¡ï¼Œå¦‚æœå°† Request å’Œ Response è®°å½•åœ¨åŒä¸€æ¡æ•°æ®ï¼Œå°†ä¼šå¯¹ç»Ÿè®¡é€ æˆåå·®</p><p><strong>2. ä¸Šè¡Œæµé‡è®°å½•ä¸ç²¾å‡†</strong></p><p>ä¸»è¦çš„åŸå› æœ‰ä¸‰å¤§ç±»ï¼š</p><ol><li><strong>ç›´æ¥å¿½ç•¥äº† Header å’Œ Line éƒ¨åˆ†</strong></li><li><strong>å¿½ç•¥äº† Cookie éƒ¨åˆ†</strong>ï¼Œå®é™…ä¸Šï¼Œè‡ƒè‚¿çš„ Cookie ä¹Ÿæ˜¯æ¶ˆè€—æµé‡çš„ä¸€éƒ¨åˆ†</li><li>body éƒ¨åˆ†çš„å­—èŠ‚å¤§å°è®¡ç®—ç›´æ¥ä½¿ç”¨äº† <code>HTTPBody.length</code> ä¸å¤Ÿå‡†ç¡®</li></ol><p><strong>3. ä¸‹è¡Œæµé‡è®°å½•ä¸ç²¾å‡†</strong></p><p>ä¸»è¦åŸå› æœ‰ï¼š</p><ol><li><strong>ç›´æ¥å¿½ç•¥äº† Header å’Œ Status-Line éƒ¨åˆ†</strong></li><li>body éƒ¨åˆ†çš„å­—èŠ‚å¤§å°è®¡ç®—ç›´æ¥ä½¿ç”¨äº† <code>expectedContentLength</code> ä¸å¤Ÿå‡†ç¡®</li><li><strong>å¿½ç•¥äº† gzip å‹ç¼©</strong>ï¼Œåœ¨å®é™…ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œå¾€å¾€éƒ½ä½¿ç”¨äº† gzip æ¥è¿›è¡Œæ•°æ®å‹ç¼©ï¼Œè€Œç³»ç»Ÿæä¾›çš„ä¸€äº›ç›‘å¬æ–¹æ³•ï¼Œè¿”å›çš„ NSData å®é™…æ˜¯è§£å‹è¿‡çš„ï¼Œå¦‚æœç›´æ¥ç»Ÿè®¡å­—èŠ‚æ•°ä¼šé€ æˆå¤§é‡åå·®</li></ol><p>åæ–‡å°†è¯¦ç»†è®²è¿°ã€‚</p><h1 id="äºŒã€éœ€æ±‚"><a href="#äºŒã€éœ€æ±‚" class="headerlink" title="äºŒã€éœ€æ±‚"></a>äºŒã€éœ€æ±‚</h1><p>å…ˆç®€å•ç½—åˆ—æˆ‘ä»¬çš„éœ€æ±‚ï¼š</p><ol><li>Request åŸºæœ¬ä¿¡æ¯è®°å½•</li><li>ä¸Šè¡Œæµé‡</li><li>Reponse åŸºæœ¬ä¿¡æ¯è®°å½•</li><li>ä¸‹è¡Œæµé‡</li><li>æ•°æ®å½’ç±»ï¼šæŒ‰ç…§ host å’Œ path å½’ç±»ï¼Œä¸€æ¡è®°å½•è®°è½½æ”¹ host/path çš„ <strong>Request è®°å½•æ•°</strong>ï¼Œ<strong>Response è®°å½•æ•°</strong>ï¼Œ<strong>Reqeust æ€»æµé‡ï¼ˆä¸Šè¡Œæµé‡ï¼‰</strong>ï¼Œ<strong>Reponse æ€»æµé‡ï¼ˆä¸‹è¡Œæµé‡ï¼‰</strong></li></ol><p><strong>æˆ‘ä»¬çš„ä¾§é‡ç‚¹æ˜¯æµé‡ç»Ÿè®¡ï¼Œä¸ºäº†æ–¹ä¾¿åˆ†æ APP ä½¿ç”¨ä¸­å“ªäº› API æ¶ˆè€—æµé‡å¤šã€‚æ‰€ä»¥å¯¹ä¸Šè¡Œã€ä¸‹è¡Œæµé‡éƒ½éœ€è¦å°½é‡å‡†ç¡®è®°å½•ã€‚</strong></p><p>æœ€ç»ˆçš„æ•°æ®åº“è¡¨å±•ç¤ºï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_ios-network-traffic-01.png" alt=""></p><p>type å­—æ®µè¡¨ç¤ºçš„æ˜¯ã€è¯¥æ¡è®°å½•æ˜¯ Request è¿˜æ˜¯ Responseã€ï¼Œå‡ ä¸ª length åˆ†åˆ«è®°å½•äº†æµé‡çš„å„ä¸ªç»†èŠ‚ï¼ŒåŒ…æ‹¬ï¼šæ€»å­—èŠ‚æ•°ã€Line å­—èŠ‚æ•°ã€Header å­—èŠ‚æ•°ã€Body å­—èŠ‚æ•°ã€‚</p><p>æœ€åçš„ç•Œé¢å±•ç¤ºç±»ä¼¼äºï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_ios-network-traffic-02.png-w375" alt=""></p><h1 id="ä¸‰ã€åˆ†æç°æœ‰èµ„æ–™"><a href="#ä¸‰ã€åˆ†æç°æœ‰èµ„æ–™" class="headerlink" title="ä¸‰ã€åˆ†æç°æœ‰èµ„æ–™"></a>ä¸‰ã€åˆ†æç°æœ‰èµ„æ–™</h1><p>ç°åœ¨åˆ†æä¸€ä¸‹ä¸Šé¢æ”¶é›†åˆ°çš„èµ„æ–™æœ‰å“ªäº›ä¸è¶³ä¹‹å¤„ã€‚</p><p><a href="https://github.com/zixun/GodEye" target="_blank" rel="noopener"><strong>GodEye</strong></a> | <a href="https://github.com/zixun/NetworkEye" target="_blank" rel="noopener"><strong>NetworkEye</strong></a>ï¼š</p><p>NetworkEye æ˜¯ GodEye çš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥å•ç‹¬æ‹†å‡ºæ¥ä½¿ç”¨çš„ç½‘ç»œç›‘æ§åº“ã€‚</p><p>æŸ¥é˜…ä¸¤è€…çš„æºç åå‘ç°ï¼ŒNetworkEye</p><ol><li>ä»…ä»…è®°å½•äº† Reponse çš„æµé‡</li><li>é€šè¿‡ expectedContentLength è®°å½•æ˜¯ä¸å‡†ç¡®çš„ï¼ˆåé¢å°†ä¼šè¯´åˆ°ï¼‰</li><li>ä»…ä»…è®°å½•äº†æ€»å’Œï¼Œè¿™å¯¹æˆ‘ä»¬æ¥è¯´æ˜¯æ— æ„ä¹‰çš„ï¼Œä¸èƒ½åˆ†æå‡ºå“ªæ¡ API æµé‡ä½¿ç”¨å¤š</li></ol><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_ios-network-traffic-03.png" alt=""></p><p><a href="https://tech.meituan.com/hertz.html" target="_blank" rel="noopener"><strong>ç§»åŠ¨ç«¯æ€§èƒ½ç›‘æ§æ–¹æ¡ˆHertz</strong></a>ï¼š</p><p>ç¾å›¢çš„æ–‡ç« ä¸­å±•ç¤ºå‡ ä¸ªä»£ç ç‰‡æ®µï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)connectionDidFinishLoading:(<span class="built_in">NSURLConnection</span> *)connection</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.client URLProtocolDidFinishLoading:<span class="keyword">self</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">self</span>.data = <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">if</span> (connection.originalRequest) &#123;</span><br><span class="line">        WMNetworkUsageDataInfo *info = [[WMNetworkUsageDataInfo alloc] init];</span><br><span class="line">        <span class="keyword">self</span>.connectionEndTime = [[<span class="built_in">NSDate</span> date] timeIntervalSince1970];</span><br><span class="line">        info.responseSize = <span class="keyword">self</span>.responseDataLength;</span><br><span class="line">        info.requestSize = connection.originalRequest.HTTPBody.length;</span><br><span class="line">        info.contentType = [WMNetworkUsageURLProtocol getContentTypeByURL:connection.originalRequest.URL andMIMEType:<span class="keyword">self</span>.MIMEType];</span><br><span class="line">    [[WMNetworkMeter sharedInstance] setLastDataInfo:info];</span><br><span class="line">    [[WMNetworkUsageManager sharedManager] recordNetworkUsageDataInfo:info];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>connectionDidFinishLoading</code> ä¸­è®°å½•äº†æ•´ä¸ªç½‘ç»œè¯·æ±‚ç»“æŸçš„æ—¶é—´ã€ response æ•°æ®å¤§å°ã€request æ•°æ®å¤§å°ä»¥åŠä¸€äº›å…¶ä»–æ•°æ®ã€‚</p><p>æ€»ä½“æ¥è¯´æ˜¯æ¯”è¾ƒè¯¦ç»†çš„ï¼Œä½†æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰ç»™å‡º <code>self.responseDataLength</code> çš„å…·ä½“é€»è¾‘ï¼Œå¦å¤– <code>connection.originalRequest.HTTPBody.length</code> ä»…ä»…æ˜¯ Request body çš„å¤§å°ã€‚</p><p><a href="https://github.com/aozhimin/iOS-Monitor-Platform" target="_blank" rel="noopener"><strong>iOS-Monitor-Platform</strong></a>ï¼š</p><p>è¿™ç¯‡æ–‡ç« æ¯”è¾ƒè¯¦ç»†çš„ä»‹ç»äº†æ•´ä¸ª APM åˆ¶ä½œçš„è¿‡ç¨‹ï¼Œè´´å‡ºäº†å¾ˆå¤šä»£ç æ®µï¼Œåº”è¯¥è¯´éå¸¸è¯¦ç»†ä¹Ÿæå…·å‚è€ƒä»·å€¼ã€‚</p><p>åœ¨æµé‡éƒ¨åˆ†ï¼Œä¹Ÿåˆ†åˆ«é’ˆå¯¹äº†ä¸Šè¡Œæµé‡ã€ä¸‹è¡Œæµé‡è¿›è¡Œäº†åŒºåˆ†ï¼Œä½†å…¶ä¸­ï¼š</p><ol><li>æ²¡æœ‰å¤„ç† gzip å‹ç¼©æƒ…å†µ</li><li>å¯¹ Header è®¡ç®—å¤§å°çš„æ–¹å¼æ˜¯ Dictionary è½¬ NSDataï¼Œç„¶è€Œå®é™…ä¸Šå¤´éƒ¨å¹¶ä¸æ˜¯ Json æ ¼å¼ï¼ˆè¿™å—æˆ‘è§‰å¾—å¾ˆè¿·ï¼Œå› ä¸ºä½œè€…ç‰¹æ„å±•ç¤ºäº† HTTP æŠ¥æ–‡ç»„æˆï¼‰</li></ol><h1 id="å››ã€åŠ¨æ‰‹è‡ªå·±åš"><a href="#å››ã€åŠ¨æ‰‹è‡ªå·±åš" class="headerlink" title="å››ã€åŠ¨æ‰‹è‡ªå·±åš"></a>å››ã€åŠ¨æ‰‹è‡ªå·±åš</h1><h2 id="HTTP-æŠ¥æ–‡"><a href="#HTTP-æŠ¥æ–‡" class="headerlink" title="HTTP æŠ¥æ–‡"></a>HTTP æŠ¥æ–‡</h2><p>ä¸ºäº†æ›´å¥½çš„è®©å¤§å®¶äº†è§£ HTTP æµé‡è®¡ç®—çš„ä¸€äº›å…³é”®ä¿¡æ¯ï¼Œé¦–å…ˆè¦äº†è§£ HTTP æŠ¥æ–‡çš„ç»„æˆã€‚</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_ios-network-traffic-04.png" alt=""></p><p>å†æ¥éšä¾¿æŠ“ä¸ªåŒ…å…·ä½“çœ‹çœ‹ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_ios-network-traffic-05.png" alt=""></p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_ios-network-traffic-06.png" alt=""></p><h2 id="iOS-ä¸‹çš„ç½‘ç»œç›‘æ§"><a href="#iOS-ä¸‹çš„ç½‘ç»œç›‘æ§" class="headerlink" title="iOS ä¸‹çš„ç½‘ç»œç›‘æ§"></a>iOS ä¸‹çš„ç½‘ç»œç›‘æ§</h2><p>è¿™å—æˆ‘é‡‡ç”¨çš„å¤§å®¶è€³ç†Ÿèƒ½è¯¦çš„ <code>NSURLProtocol</code>ï¼Œ<code>NSURLProtocol</code> æ–¹å¼é™¤äº†é€šè¿‡ CFNetwork å‘å‡ºçš„ç½‘ç»œè¯·æ±‚ï¼Œå…¨éƒ¨éƒ½å¯ä»¥æ‹¦æˆªåˆ°ã€‚</p><p><a href="https://developer.apple.com/documentation/foundation/nsurlprotocol?language=occ" target="_blank" rel="noopener">Apple æ–‡æ¡£</a>ä¸­å¯¹ <code>NSURLProtocol</code> æœ‰éå¸¸è¯¦ç»†çš„æè¿°å’Œä½¿ç”¨ä»‹ç»</p><blockquote><p>An abstract class that handles the loading of protocol-specific URL data.</p></blockquote><p>å¦‚æœæƒ³æ›´è¯¦ç»†çš„äº†è§£ <code>NSURLProtocol</code>ï¼Œä¹Ÿå¯ä»¥çœ‹å¤§ä½çš„<a href="https://github.com/Draveness/analyze/blob/master/contents/OHHTTPStubs/iOS%20%E5%BC%80%E5%8F%91%E4%B8%AD%E4%BD%BF%E7%94%A8%20NSURLProtocol%20%E6%8B%A6%E6%88%AA%20HTTP%20%E8%AF%B7%E6%B1%82.md" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a></p><blockquote><p>åœ¨æ¯ä¸€ä¸ª HTTP è¯·æ±‚å¼€å§‹æ—¶ï¼ŒURL åŠ è½½ç³»ç»Ÿåˆ›å»ºä¸€ä¸ªåˆé€‚çš„ <code>NSURLProtocol</code> å¯¹è±¡å¤„ç†å¯¹åº”çš„ URL è¯·æ±‚ï¼Œè€Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å†™ä¸€ä¸ªç»§æ‰¿è‡ª <code>NSURLProtocol</code> çš„ç±»ï¼Œå¹¶é€šè¿‡ <code>- registerClass:</code> æ–¹æ³•æ³¨å†Œæˆ‘ä»¬çš„åè®®ç±»ï¼Œç„¶å URL åŠ è½½ç³»ç»Ÿå°±ä¼šåœ¨è¯·æ±‚å‘å‡ºæ—¶ä½¿ç”¨æˆ‘ä»¬åˆ›å»ºçš„åè®®å¯¹è±¡å¯¹è¯¥è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚</p></blockquote><p><code>NSURLProtocol</code> æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œéœ€è¦åšçš„ç¬¬ä¸€æ­¥å°±æ˜¯é›†æˆå®ƒï¼Œå®Œæˆæˆ‘ä»¬çš„è‡ªå®šä¹‰è®¾ç½®ã€‚</p><p>åˆ›å»ºè‡ªå·±çš„ <code>DMURLProtocol</code>ï¼Œä¸ºå®ƒæ·»åŠ å‡ ä¸ªå±æ€§å¹¶å®ç°ç›¸å…³æ¥å£ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">DMURLProtocol</span>() &lt;<span class="title">NSURLConnectionDelegate</span>, <span class="title">NSURLConnectionDataDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSURLConnection</span> *connection;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSURLRequest</span> *dm_request;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSURLResponse</span> *dm_response;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableData</span> *dm_data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p><code>canInitWithRequest</code> &amp; <code>canonicalRequestForRequest</code>ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> DMHTTP = <span class="string">@"LPDHTTP"</span>;</span><br></pre></td></tr></table></figure><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">BOOL</span>)canInitWithRequest:(<span class="built_in">NSURLRequest</span> *)request &#123;</span><br><span class="line">    <span class="keyword">if</span> (![request.URL.scheme isEqualToString:<span class="string">@"http"</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ‹¦æˆªè¿‡çš„ä¸å†æ‹¦æˆª</span></span><br><span class="line">    <span class="keyword">if</span> ([<span class="built_in">NSURLProtocol</span> propertyForKey:LPDHTTP inRequest:request] ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">NSURLRequest</span> *)canonicalRequestForRequest:(<span class="built_in">NSURLRequest</span> *)request &#123;</span><br><span class="line">    <span class="built_in">NSMutableURLRequest</span> *mutableReqeust = [request mutableCopy];</span><br><span class="line">    [<span class="built_in">NSURLProtocol</span> setProperty:@YES</span><br><span class="line">                        forKey:DMHTTP</span><br><span class="line">                     inRequest:mutableReqeust];</span><br><span class="line">    <span class="keyword">return</span> [mutableReqeust <span class="keyword">copy</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>startLoading</code>ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)startLoading &#123;</span><br><span class="line">    <span class="built_in">NSURLRequest</span> *request = [[<span class="keyword">self</span> <span class="keyword">class</span>] canonicalRequestForRequest:<span class="keyword">self</span>.request];</span><br><span class="line">    <span class="keyword">self</span>.connection = [[<span class="built_in">NSURLConnection</span> alloc] initWithRequest:request delegate:<span class="keyword">self</span> startImmediately:<span class="literal">YES</span>];</span><br><span class="line">    <span class="keyword">self</span>.dm_request = <span class="keyword">self</span>.request;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> <code>didReceiveResponse</code>ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)connection:(<span class="built_in">NSURLConnection</span> *)connection didReceiveResponse:(<span class="built_in">NSURLResponse</span> *)response &#123;</span><br><span class="line">    [[<span class="keyword">self</span> client] URLProtocol:<span class="keyword">self</span> didReceiveResponse:response cacheStoragePolicy:<span class="built_in">NSURLCacheStorageAllowed</span>];</span><br><span class="line">    <span class="keyword">self</span>.dm_response = response;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> <code>didReceiveData</code>ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)connection:(<span class="built_in">NSURLConnection</span> *)connection didReceiveData:(<span class="built_in">NSData</span> *)data &#123;</span><br><span class="line">    [<span class="keyword">self</span>.client URLProtocol:<span class="keyword">self</span> didLoadData:data];</span><br><span class="line">    [<span class="keyword">self</span>.dm_data appendData:data];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šéƒ¨åˆ†æ˜¯ä¸ºäº†åœ¨å•æ¬¡ HTTP è¯·æ±‚ä¸­è®°å½•å„ä¸ªæ‰€éœ€è¦å±æ€§ã€‚</p><h3 id="è®°å½•-Response-ä¿¡æ¯"><a href="#è®°å½•-Response-ä¿¡æ¯" class="headerlink" title="è®°å½• Response ä¿¡æ¯"></a>è®°å½• Response ä¿¡æ¯</h3><p>å‰é¢çš„ä»£ç å®ç°äº†åœ¨ç½‘ç»œè¯·æ±‚è¿‡ç¨‹ä¸­ä¸º <code>dm_response</code> å’Œ <code>dm_data</code> èµ‹å€¼ï¼Œé‚£ä¹ˆåœ¨ <code>stopLoading</code> æ–¹æ³•ä¸­ï¼Œå°±å¯ä»¥åˆ†æ <code>dm_response</code> å’Œ <code>dm_data</code> å¯¹è±¡ï¼Œè·å–ä¸‹è¡Œæµé‡ç­‰ç›¸å…³ä¿¡æ¯ã€‚</p><blockquote><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œå¦‚æœéœ€è¦è·å¾—éå¸¸ç²¾å‡†çš„æµé‡ï¼Œä¸€èˆ¬æ¥è¯´åªæœ‰é€šè¿‡ Socket å±‚è·å–æ˜¯æœ€å‡†ç¡®çš„ï¼Œå› ä¸ºå¯ä»¥è·å–åŒ…æ‹¬æ¡æ‰‹ã€æŒ¥æ‰‹çš„æ•°æ®å¤§å°ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯ä¸ºäº†åˆ†æ App çš„è€—æµé‡ APIï¼Œæ‰€ä»¥ä»…ä»åº”ç”¨å±‚å»åˆ†æä¹ŸåŸºæœ¬æ»¡è¶³äº†æˆ‘ä»¬çš„éœ€è¦ã€‚</p></blockquote><p>ä¸Šæ–‡ä¸­è¯´åˆ°äº†æŠ¥æ–‡çš„ç»„æˆï¼Œé‚£ä¹ˆæŒ‰ç…§æŠ¥æ–‡æ‰€éœ€è¦çš„å†…å®¹è·å–ã€‚</p><h4 id="Status-Line"><a href="#Status-Line" class="headerlink" title="Status Line"></a>Status Line</h4><p>éå¸¸é—æ†¾çš„æ˜¯ <code>NSURLResponse</code> æ²¡æœ‰æ¥å£èƒ½ç›´æ¥è·å–æŠ¥æ–‡ä¸­çš„ Status Lineï¼Œç”šè‡³è¿ HTTP Version ç­‰ç»„æˆ Status Line å†…å®¹çš„æ¥å£ä¹Ÿæ²¡æœ‰ã€‚</p><p>æœ€åï¼Œæˆ‘é€šè¿‡è½¬æ¢åˆ° CFNetwork ç›¸å…³ç±»ï¼Œæ‰æ‹¿åˆ°äº† Status Line çš„æ•°æ®ï¼Œè¿™å…¶ä¸­å¯èƒ½æ¶‰åŠåˆ°äº†è¯»å–ç§æœ‰ API</p><p>è¿™é‡Œæˆ‘ä¸º <code>NSURLResponse</code> æ·»åŠ äº†ä¸€ä¸ªæ‰©å±•ï¼š<code>NSURLResponse+DoggerMonitor</code>ï¼Œå¹¶ä¸ºå…¶æ·»åŠ  <code>statusLineFromCF</code> æ–¹æ³•</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">CFHTTPMessageRef</span> (*DMURLResponseGetHTTPResponse)(<span class="built_in">CFURLRef</span> response);</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)statusLineFromCF &#123;</span><br><span class="line">    <span class="built_in">NSURLResponse</span> *response = <span class="keyword">self</span>;</span><br><span class="line">    <span class="built_in">NSString</span> *statusLine = <span class="string">@""</span>;</span><br><span class="line">    <span class="comment">// è·å–CFURLResponseGetHTTPResponseçš„å‡½æ•°å®ç°</span></span><br><span class="line">    <span class="built_in">NSString</span> *funName = <span class="string">@"CFURLResponseGetHTTPResponse"</span>;</span><br><span class="line">    DMURLResponseGetHTTPResponse originURLResponseGetHTTPResponse =</span><br><span class="line">    dlsym(RTLD_DEFAULT, [funName UTF8String]);</span><br><span class="line"></span><br><span class="line">    SEL theSelector = <span class="built_in">NSSelectorFromString</span>(<span class="string">@"_CFURLResponse"</span>);</span><br><span class="line">    <span class="keyword">if</span> ([response respondsToSelector:theSelector] &amp;&amp;</span><br><span class="line">        <span class="literal">NULL</span> != originURLResponseGetHTTPResponse) &#123;</span><br><span class="line">        <span class="comment">// è·å–NSURLResponseçš„_CFURLResponse</span></span><br><span class="line">        <span class="built_in">CFTypeRef</span> cfResponse = <span class="built_in">CFBridgingRetain</span>([response performSelector:theSelector]);</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">NULL</span> != cfResponse) &#123;</span><br><span class="line">            <span class="comment">// å°†CFURLResponseRefè½¬åŒ–ä¸ºCFHTTPMessageRef</span></span><br><span class="line">            <span class="built_in">CFHTTPMessageRef</span> messageRef = originURLResponseGetHTTPResponse(cfResponse);</span><br><span class="line">            statusLine = (__bridge_transfer <span class="built_in">NSString</span> *)<span class="built_in">CFHTTPMessageCopyResponseStatusLine</span>(messageRef);</span><br><span class="line">            <span class="built_in">CFRelease</span>(cfResponse);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> statusLine;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è°ƒç”¨ç§æœ‰ API <code>_CFURLResponse</code> è·å¾— <code>CFTypeRef</code> å†è½¬æ¢æˆ <code>CFHTTPMessageRef</code>ï¼Œè·å– Status Lineã€‚</p><p>å†å°†å…¶è½¬æ¢æˆ NSData è®¡ç®—å­—èŠ‚å¤§å°ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSUInteger</span>)dm_getLineLength &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *lineStr = <span class="string">@""</span>;</span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span> isKindOfClass:[<span class="built_in">NSHTTPURLResponse</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="built_in">NSHTTPURLResponse</span> *httpResponse = (<span class="built_in">NSHTTPURLResponse</span> *)<span class="keyword">self</span>;</span><br><span class="line">        lineStr = [<span class="keyword">self</span> statusLineFromCF];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSData</span> *lineData = [lineStr dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">    <span class="keyword">return</span> lineData.length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h4><p>é€šè¿‡ <code>httpResponse.allHeaderFields</code> æ‹¿åˆ° Header å­—å…¸ï¼Œå†æ‹¼æ¥æˆæŠ¥æ–‡çš„ key: value æ ¼å¼ï¼Œè½¬æ¢æˆ NSData è®¡ç®—å¤§å°ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSUInteger</span>)dm_getHeadersLength &#123;</span><br><span class="line">    <span class="built_in">NSUInteger</span> headersLength = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span> isKindOfClass:[<span class="built_in">NSHTTPURLResponse</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="built_in">NSHTTPURLResponse</span> *httpResponse = (<span class="built_in">NSHTTPURLResponse</span> *)<span class="keyword">self</span>;</span><br><span class="line">        <span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="built_in">NSString</span> *&gt; *headerFields = httpResponse.allHeaderFields;</span><br><span class="line">        <span class="built_in">NSString</span> *headerStr = <span class="string">@""</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSString</span> *key <span class="keyword">in</span> headerFields.allKeys) &#123;</span><br><span class="line">            headerStr = [headerStr stringByAppendingString:key];</span><br><span class="line">            headerStr = [headerStr stringByAppendingString:<span class="string">@": "</span>];</span><br><span class="line">            <span class="keyword">if</span> ([headerFields objectForKey:key]) &#123;</span><br><span class="line">                headerStr = [headerStr stringByAppendingString:headerFields[key]];</span><br><span class="line">            &#125;</span><br><span class="line">            headerStr = [headerStr stringByAppendingString:<span class="string">@"\n"</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">NSData</span> *headerData = [headerStr dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">        headersLength = headerData.length;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> headersLength;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Body"><a href="#Body" class="headerlink" title="Body"></a>Body</h4><p>å¯¹äº Body çš„è®¡ç®—ï¼Œä¸Šæ–‡çœ‹åˆ°æœ‰äº›æ–‡ç« é‡Œé‡‡ç”¨çš„ <code>expectedContentLength</code> æˆ–è€…å» <code>NSURLResponse</code> å¯¹è±¡çš„ <code>allHeaderFields</code> ä¸­è·å– <code>Content-Length</code> å€¼ï¼Œå…¶å®éƒ½ä¸å¤Ÿå‡†ç¡®ã€‚</p><p>é¦–å…ˆ API æ–‡æ¡£ä¸­å¯¹ <code>expectedContentLength</code> ä¹Ÿæœ‰ä»‹ç»æ˜¯ä¸å‡†ç¡®çš„ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_ios-network-traffic-07.png" alt=""></p><p>å…¶æ¬¡ï¼ŒHTTP 1.1 æ ‡å‡†é‡Œä¹Ÿæœ‰ä»‹ç» <code>Content-Length</code> å­—æ®µä¸ä¸€å®šæ˜¯æ¯ä¸ª Response éƒ½å¸¦æœ‰çš„ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œ<strong><code>Content-Length</code> åªæ˜¯è¡¨ç¤º Body éƒ¨åˆ†çš„å¤§å°</strong>ã€‚</p><p>æˆ‘çš„æ–¹å¼æ˜¯ï¼Œåœ¨å‰é¢ä»£ç ä¸­æœ‰å†™åˆ°ï¼Œåœ¨ <code>didReceiveData</code> ä¸­å¯¹ <code>dm_data</code> è¿›è¡Œäº†èµ‹å€¼</p><p> <code>didReceiveData</code>ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)connection:(<span class="built_in">NSURLConnection</span> *)connection didReceiveData:(<span class="built_in">NSData</span> *)data &#123;</span><br><span class="line">    [<span class="keyword">self</span>.client URLProtocol:<span class="keyword">self</span> didLoadData:data];</span><br><span class="line">    [<span class="keyword">self</span>.dm_data appendData:data];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆåœ¨ <code>stopLoading</code> æ–¹æ³•ä¸­ï¼Œå°±å¯ä»¥æ‹¿åˆ°æœ¬æ¬¡ç½‘ç»œè¯·æ±‚æ¥æ”¶åˆ°çš„æ•°æ®ã€‚</p><p>ä½†éœ€è¦æ³¨æ„å¯¹ gzip æƒ…å†µè¿›è¡ŒåŒºåˆ«åˆ†æã€‚æˆ‘ä»¬çŸ¥é“ HTTP è¯·æ±‚ä¸­ï¼Œå®¢æˆ·ç«¯åœ¨å‘é€è¯·æ±‚çš„æ—¶å€™ä¼šå¸¦ä¸Š <strong><code>Accept-Encoding</code>ï¼Œè¿™ä¸ªå­—æ®µçš„å€¼å°†ä¼šå‘ŠçŸ¥æœåŠ¡å™¨å®¢æˆ·ç«¯èƒ½å¤Ÿç†è§£çš„å†…å®¹å‹ç¼©ç®—æ³•</strong>ã€‚è€ŒæœåŠ¡å™¨è¿›è¡Œç›¸åº”æ—¶ï¼Œä¼šåœ¨ Response ä¸­æ·»åŠ  <strong><code>Content-Encoding</code> å‘ŠçŸ¥å®¢æˆ·ç«¯é€‰ä¸­çš„å‹ç¼©ç®—æ³•</strong>ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨ <code>stopLoading</code> ä¸­è·å– <code>Content-Encoding</code>ï¼Œå¦‚æœä½¿ç”¨äº† gzipï¼Œåˆ™æ¨¡æ‹Ÿä¸€æ¬¡ gzip å‹ç¼©ï¼Œå†è®¡ç®—å­—èŠ‚å¤§å°ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)stopLoading &#123;</span><br><span class="line">    [<span class="keyword">self</span>.connection cancel];</span><br><span class="line"></span><br><span class="line">    DMNetworkTrafficLog *model = [[DMNetworkTrafficLog alloc] init];</span><br><span class="line">    model.path = <span class="keyword">self</span>.request.URL.path;</span><br><span class="line">    model.host = <span class="keyword">self</span>.request.URL.host;</span><br><span class="line">    model.type = DMNetworkTrafficDataTypeResponse;</span><br><span class="line">    model.lineLength = [<span class="keyword">self</span>.dm_response dm_getLineLength];</span><br><span class="line">    model.headerLength = [<span class="keyword">self</span>.dm_response dm_getHeadersLength];</span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.dm_response isKindOfClass:[<span class="built_in">NSHTTPURLResponse</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="built_in">NSHTTPURLResponse</span> *httpResponse = (<span class="built_in">NSHTTPURLResponse</span> *)<span class="keyword">self</span>.dm_response;</span><br><span class="line">        <span class="built_in">NSData</span> *data = <span class="keyword">self</span>.dm_data;</span><br><span class="line">        <span class="keyword">if</span> ([[httpResponse.allHeaderFields objectForKey:<span class="string">@"Content-Encoding"</span>] isEqualToString:<span class="string">@"gzip"</span>]) &#123;</span><br><span class="line">            <span class="comment">// æ¨¡æ‹Ÿå‹ç¼©</span></span><br><span class="line">            data = [<span class="keyword">self</span>.dm_data gzippedData];</span><br><span class="line">        &#125;</span><br><span class="line">        model.bodyLength = data.length;</span><br><span class="line">    &#125;</span><br><span class="line">    model.length = model.lineLength + model.headerLength + model.bodyLength;</span><br><span class="line">    [model settingOccurTime];</span><br><span class="line">    [[DMDataManager defaultDB] addNetworkTrafficLog:model];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ <code>gzippedData</code> å‚è€ƒ<a href="https://github.com/nicklockwood/GZIP" target="_blank" rel="noopener">è¿™ä¸ªåº“çš„å†…å®¹</a></p><p><code>[[DMDataManager defaultDB] addNetworkTrafficLog:model];</code> æ˜¯è°ƒç”¨æŒä¹…åŒ–å±‚çš„ä»£ç å°†æ•°æ®è½åº“ã€‚</p><h3 id="è®°å½•-Resquest-ä¿¡æ¯"><a href="#è®°å½•-Resquest-ä¿¡æ¯" class="headerlink" title="è®°å½• Resquest ä¿¡æ¯"></a>è®°å½• Resquest ä¿¡æ¯</h3><h4 id="Line"><a href="#Line" class="headerlink" title="Line"></a>Line</h4><p>å¾ˆé—æ†¾ï¼Œå¯¹äº<code>NSURLRequest</code> æˆ‘æ²¡æœ‰åƒ <code>NSURLReponse</code> ä¸€æ ·å¹¸è¿çš„æ‰¾åˆ°ç§æœ‰æ¥å£å°†å…¶è½¬æ¢æˆ CFNetwork ç›¸å…³æ•°æ®ï¼Œä½†æ˜¯æˆ‘ä»¬å¾ˆæ¸…æ¥š HTTP è¯·æ±‚æŠ¥æ–‡ Line éƒ¨åˆ†çš„ç»„æˆï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œè·å–ä¸€ä¸ªç»éªŒ Lineã€‚</p><p>åŒæ ·ä¸º <code>NSURLReques</code> æ·»åŠ ä¸€ä¸ªæ‰©å±•ï¼š<code>NSURLRequest+DoggerMonitor</code></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSUInteger</span>)dgm_getLineLength &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *lineStr = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@ %@ %@\n"</span>, <span class="keyword">self</span>.HTTPMethod, <span class="keyword">self</span>.URL.path, <span class="string">@"HTTP/1.1"</span>];</span><br><span class="line">    <span class="built_in">NSData</span> *lineData = [lineStr dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">    <span class="keyword">return</span> lineData.length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Header-1"><a href="#Header-1" class="headerlink" title="Header"></a>Header</h4><p><strong>Header è¿™é‡Œæœ‰ä¸€ä¸ªéå¸¸å¤§çš„å‘</strong>ã€‚</p><p><code>request.allHTTPHeaderFields</code> æ‹¿åˆ°çš„å¤´éƒ¨æ•°æ®æ˜¯æœ‰å¾ˆå¤šç¼ºå¤±çš„ï¼Œè¿™å—è·Ÿä¸šå†…æœ‹å‹äº¤æµçš„æ—¶å€™ï¼Œå‘ç°å¾ˆå¤šäººéƒ½æ²¡æœ‰ç•™æ„åˆ°è¿™ä¸ªé—®é¢˜ã€‚</p><p>ç¼ºå¤±çš„éƒ¨åˆ†ä¸ä»…ä»…æ˜¯ä¸Šé¢ä¸€ç¯‡æ–‡ç« ä¸­è¯´åˆ°çš„ Cookieã€‚</p><p>å¦‚æœé€šè¿‡ Charles æŠ“åŒ…ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œä¼šç¼ºå¤±åŒ…æ‹¬ä½†ä¸ä»…é™äºä»¥ä¸‹å­—æ®µï¼š</p><ol><li>Accept</li><li>Connection</li><li>Host</li></ol><p>è¿™ä¸ªé—®é¢˜éå¸¸çš„è¿·ï¼ŒåŒæ—¶ç”±äºæ— æ³•è½¬æ¢åˆ° CFNetwork å±‚ï¼Œæ‰€ä»¥ä¸€ç›´æ‹¿ä¸åˆ°å‡†ç¡®çš„ Header æ•°æ®ã€‚</p><p>æœ€åï¼Œæˆ‘åœ¨ so ä¸Šä¹Ÿæ‰¾åˆ°äº†ä¸¤ä¸ªç›¸å…³é—®é¢˜ï¼Œä¾›å¤§å®¶å‚è€ƒ</p><p><a href="https://stackoverflow.com/questions/5695914/nsurlrequest-where-an-app-can-find-the-default-headers-for-http-request" target="_blank" rel="noopener">NSUrlRequest: where an app can find the default headers for HTTP request?</a></p><p><a href="https://stackoverflow.com/questions/21694886/nsmutableurlrequest-cant-access-all-request-headers-sent-out-from-within-my-iph" target="_blank" rel="noopener">NSMutableURLRequest, cant access all request headers sent out from within my iPhone program</a></p><p>ä¸¤ä¸ªé—®é¢˜çš„å›ç­”åŸºæœ¬è¡¨æ˜äº†ï¼Œå¦‚æœä½ æ˜¯é€šè¿‡ CFNetwork æ¥å‘èµ·è¯·æ±‚çš„ï¼Œæ‰å¯ä»¥æ‹¿åˆ°å®Œæ•´çš„ Header æ•°æ®ã€‚</p><p>æ‰€ä»¥è¿™å—åªèƒ½æ‹¿åˆ°å¤§éƒ¨åˆ†çš„ Headerï¼Œä½†æ˜¯åŸºæœ¬ä¸Šç¼ºå¤±çš„éƒ½å›ºå®šæ˜¯é‚£å‡ ä¸ªå­—æ®µï¼Œå¯¹æˆ‘ä»¬æµé‡ç»Ÿè®¡çš„ç²¾ç¡®åº¦å½±å“ä¸æ˜¯å¾ˆå¤§ã€‚</p><p>é‚£ä¹ˆä¸»è¦å°±é’ˆå¯¹ cookie éƒ¨åˆ†è¿›è¡Œè¡¥å…¨ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSUInteger</span>)dgm_getHeadersLengthWithCookie &#123;</span><br><span class="line">    <span class="built_in">NSUInteger</span> headersLength = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="built_in">NSString</span> *&gt; *headerFields = <span class="keyword">self</span>.allHTTPHeaderFields;</span><br><span class="line">    <span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="built_in">NSString</span> *&gt; *cookiesHeader = [<span class="keyword">self</span> dgm_getCookies];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ·»åŠ  cookie ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">if</span> (cookiesHeader.count) &#123;</span><br><span class="line">        <span class="built_in">NSMutableDictionary</span> *headerFieldsWithCookies = [<span class="built_in">NSMutableDictionary</span> dictionaryWithDictionary:headerFields];</span><br><span class="line">        [headerFieldsWithCookies addEntriesFromDictionary:cookiesHeader];</span><br><span class="line">        headerFields = [headerFieldsWithCookies <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, headerFields);</span><br><span class="line">    <span class="built_in">NSString</span> *headerStr = <span class="string">@""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSString</span> *key <span class="keyword">in</span> headerFields.allKeys) &#123;</span><br><span class="line">        headerStr = [headerStr stringByAppendingString:key];</span><br><span class="line">        headerStr = [headerStr stringByAppendingString:<span class="string">@": "</span>];</span><br><span class="line">        <span class="keyword">if</span> ([headerFields objectForKey:key]) &#123;</span><br><span class="line">            headerStr = [headerStr stringByAppendingString:headerFields[key]];</span><br><span class="line">        &#125;</span><br><span class="line">        headerStr = [headerStr stringByAppendingString:<span class="string">@"\n"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSData</span> *headerData = [headerStr dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">    headersLength = headerData.length;</span><br><span class="line">    <span class="keyword">return</span> headersLength;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="built_in">NSString</span> *&gt; *)dgm_getCookies &#123;</span><br><span class="line">    <span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="built_in">NSString</span> *&gt; *cookiesHeader;</span><br><span class="line">    <span class="built_in">NSHTTPCookieStorage</span> *cookieStorage = [<span class="built_in">NSHTTPCookieStorage</span> sharedHTTPCookieStorage];</span><br><span class="line">    <span class="built_in">NSArray</span>&lt;<span class="built_in">NSHTTPCookie</span> *&gt; *cookies = [cookieStorage cookiesForURL:<span class="keyword">self</span>.URL];</span><br><span class="line">    <span class="keyword">if</span> (cookies.count) &#123;</span><br><span class="line">        cookiesHeader = [<span class="built_in">NSHTTPCookie</span> requestHeaderFieldsWithCookies:cookies];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cookiesHeader;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="body"><a href="#body" class="headerlink" title="body"></a>body</h4><p><strong>æœ€åæ˜¯ body éƒ¨åˆ†ï¼Œè¿™é‡Œä¹Ÿæœ‰ä¸ªå‘ã€‚é€šè¿‡ <code>NSURLConnection</code> å‘å‡ºçš„ç½‘ç»œè¯·æ±‚ <code>resquest.HTTPBody</code> æ‹¿åˆ°çš„æ˜¯ nilã€‚</strong></p><p>éœ€è¦è½¬è€Œé€šè¿‡ <code>HTTPBodyStream</code> è¯»å– stream æ¥è·å– request çš„ Body å¤§å°ã€‚</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSUInteger</span>)dgm_getBodyLength &#123;</span><br><span class="line">    <span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="built_in">NSString</span> *&gt; *headerFields = <span class="keyword">self</span>.allHTTPHeaderFields;</span><br><span class="line">    <span class="built_in">NSUInteger</span> bodyLength = [<span class="keyword">self</span>.HTTPBody length];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ([headerFields objectForKey:<span class="string">@"Content-Encoding"</span>]) &#123;</span><br><span class="line">        <span class="built_in">NSData</span> *bodyData;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.HTTPBody == <span class="literal">nil</span>) &#123;</span><br><span class="line">            uint8_t d[<span class="number">1024</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">            <span class="built_in">NSInputStream</span> *stream = <span class="keyword">self</span>.HTTPBodyStream;</span><br><span class="line">            <span class="built_in">NSMutableData</span> *data = [[<span class="built_in">NSMutableData</span> alloc] init];</span><br><span class="line">            [stream open];</span><br><span class="line">            <span class="keyword">while</span> ([stream hasBytesAvailable]) &#123;</span><br><span class="line">                <span class="built_in">NSInteger</span> len = [stream read:d maxLength:<span class="number">1024</span>];</span><br><span class="line">                <span class="keyword">if</span> (len &gt; <span class="number">0</span> &amp;&amp; stream.streamError == <span class="literal">nil</span>) &#123;</span><br><span class="line">                    [data appendBytes:(<span class="keyword">void</span> *)d length:len];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            bodyData = [data <span class="keyword">copy</span>];</span><br><span class="line">            [stream close];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            bodyData = <span class="keyword">self</span>.HTTPBody;</span><br><span class="line">        &#125;</span><br><span class="line">        bodyLength = [[bodyData gzippedData] length];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> bodyLength;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è½åº“"><a href="#è½åº“" class="headerlink" title="è½åº“"></a>è½åº“</h4><p>æœ€ååœ¨ <code>DMURLProtocol</code> çš„ <code>- (nullable NSURLRequest *)connection:(NSURLConnection *)connection willSendRequest:(NSURLRequest *)request redirectResponse:(nullable NSURLResponse *)response;</code> æ–¹æ³•ä¸­å¯¹ resquest è°ƒç”¨æŠ¥æ–‡å„ä¸ªéƒ¨åˆ†å¤§å°æ–¹æ³•åè½åº“ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="built_in">NSURLRequest</span> *)connection:(<span class="built_in">NSURLConnection</span> *)connection willSendRequest:(<span class="built_in">NSURLRequest</span> *)request redirectResponse:(<span class="built_in">NSURLResponse</span> *)response &#123;</span><br><span class="line">    <span class="keyword">if</span> (response != <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.dm_response = response;</span><br><span class="line">        [<span class="keyword">self</span>.client URLProtocol:<span class="keyword">self</span> wasRedirectedToRequest:request redirectResponse:response];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    DMNetworkTrafficLog *model = [[DMNetworkTrafficLog alloc] init];</span><br><span class="line">    model.path = request.URL.path;</span><br><span class="line">    model.host = request.URL.host;</span><br><span class="line">    model.type = DMNetworkTrafficDataTypeRequest;</span><br><span class="line">    model.lineLength = [connection.currentRequest dgm_getLineLength];</span><br><span class="line">    model.headerLength = [connection.currentRequest dgm_getHeadersLengthWithCookie];</span><br><span class="line">    model.bodyLength = [connection.currentRequest dgm_getBodyLength];</span><br><span class="line">    model.length = model.lineLength + model.headerLength + model.bodyLength;</span><br><span class="line">    [model settingOccurTime];</span><br><span class="line">    [[DMDataManager defaultDB] addNetworkTrafficLog:model];</span><br><span class="line">    <span class="keyword">return</span> request;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é’ˆå¯¹-NSURLSession-çš„å¤„ç†"><a href="#é’ˆå¯¹-NSURLSession-çš„å¤„ç†" class="headerlink" title="é’ˆå¯¹ NSURLSession çš„å¤„ç†"></a>é’ˆå¯¹ NSURLSession çš„å¤„ç†</h3><p>ç›´æ¥ä½¿ç”¨ <code>DMURLProtocol</code> å¹¶ <code>registerClass</code> å¹¶ä¸èƒ½å®Œæ•´çš„æ‹¦æˆªæ‰€æœ‰ç½‘ç»œè¯·æ±‚ï¼Œå› ä¸ºé€šè¿‡ <code>NSURLSession</code> çš„ <code>sharedSession</code> å‘å‡ºçš„è¯·æ±‚æ˜¯æ— æ³•è¢« <code>NSURLProtocol</code> ä»£ç†çš„ã€‚</p><p>æˆ‘ä»¬éœ€è¦è®© <code>[NSURLSessionConfiguration defaultSessionConfiguration].protocolClasses</code> çš„å±æ€§ä¸­ä¹Ÿè®¾ç½®æˆ‘ä»¬çš„ <code>DMURLProtocol</code>ï¼Œè¿™é‡Œé€šè¿‡ swizzleï¼Œç½®æ¢ <code>protocalClasses</code> çš„ get æ–¹æ³•ï¼š</p><p>ç¼–å†™ä¸€ä¸ª <code>DMURLSessionConfiguration</code></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">DMURLSessionConfiguration</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) <span class="built_in">BOOL</span> isSwizzle;</span><br><span class="line">+ (DMURLSessionConfiguration *)defaultConfiguration;</span><br><span class="line">- (<span class="keyword">void</span>)load;</span><br><span class="line">- (<span class="keyword">void</span>)unload;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"DMURLSessionConfiguration.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"DMURLProtocol.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"DMNetworkTrafficManager.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DMURLSessionConfiguration</span></span></span><br><span class="line"></span><br><span class="line">+ (DMURLSessionConfiguration *)defaultConfiguration &#123;</span><br><span class="line">    <span class="keyword">static</span> DMURLSessionConfiguration *staticConfiguration;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">        staticConfiguration=[[DMURLSessionConfiguration alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> staticConfiguration;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.isSwizzle = <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)load &#123;</span><br><span class="line">    <span class="keyword">self</span>.isSwizzle = <span class="literal">YES</span>;</span><br><span class="line">    Class cls = <span class="built_in">NSClassFromString</span>(<span class="string">@"__NSCFURLSessionConfiguration"</span>) ?: <span class="built_in">NSClassFromString</span>(<span class="string">@"NSURLSessionConfiguration"</span>);</span><br><span class="line">    [<span class="keyword">self</span> swizzleSelector:<span class="keyword">@selector</span>(protocolClasses) fromClass:cls toClass:[<span class="keyword">self</span> <span class="keyword">class</span>]];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)unload &#123;</span><br><span class="line">    <span class="keyword">self</span>.isSwizzle=<span class="literal">NO</span>;</span><br><span class="line">    Class cls = <span class="built_in">NSClassFromString</span>(<span class="string">@"__NSCFURLSessionConfiguration"</span>) ?: <span class="built_in">NSClassFromString</span>(<span class="string">@"NSURLSessionConfiguration"</span>);</span><br><span class="line">    [<span class="keyword">self</span> swizzleSelector:<span class="keyword">@selector</span>(protocolClasses) fromClass:cls toClass:[<span class="keyword">self</span> <span class="keyword">class</span>]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)swizzleSelector:(SEL)selector fromClass:(Class)original toClass:(Class)stub &#123;</span><br><span class="line">    Method originalMethod = class_getInstanceMethod(original, selector);</span><br><span class="line">    Method stubMethod = class_getInstanceMethod(stub, selector);</span><br><span class="line">    <span class="keyword">if</span> (!originalMethod || !stubMethod) &#123;</span><br><span class="line">        [<span class="built_in">NSException</span> raise:<span class="built_in">NSInternalInconsistencyException</span> format:<span class="string">@"Couldn't load NEURLSessionConfiguration."</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    method_exchangeImplementations(originalMethod, stubMethod);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSArray</span> *)protocolClasses &#123;</span><br><span class="line">    <span class="comment">// DMNetworkTrafficManager ä¸­çš„ protocolClasses å¯ä»¥ç»™ä½¿ç”¨è€…è®¾ç½®è‡ªå®šä¹‰çš„ protocolClasses</span></span><br><span class="line">    <span class="keyword">return</span> [DMNetworkTrafficManager manager].protocolClasses;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬å†™å¥½äº†æ–¹æ³•ç½®æ¢ï¼Œåœ¨æ‰§è¡Œè¿‡è¯¥ç±»å•ä¾‹çš„ <code>load</code> æ–¹æ³•åï¼Œ<code>[NSURLSessionConfiguration defaultSessionConfiguration].protocolClasses</code> æ‹¿åˆ°çš„å°†ä¼šæ˜¯æˆ‘ä»¬è®¾ç½®å¥½çš„ <code>protocolClasses</code>ã€‚</p><p>å¦‚æ­¤ï¼Œæˆ‘ä»¬å†ä¸º <code>DMURLProtocol</code> æ·»åŠ  <code>start</code> å’Œ <code>stop</code> æ–¹æ³•ï¼Œç”¨äºå¯åŠ¨ç½‘ç»œç›‘æ§å’Œåœæ­¢ç½‘ç»œç›‘æ§ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">void</span>)start &#123;</span><br><span class="line">    DMURLSessionConfiguration *sessionConfiguration = [DMURLSessionConfiguration defaultConfiguration];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">id</span> protocolClass <span class="keyword">in</span> [DMNetworkTrafficManager manager].protocolClasses) &#123;</span><br><span class="line">        [<span class="built_in">NSURLProtocol</span> registerClass:protocolClass];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (![sessionConfiguration isSwizzle]) &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®äº¤æ¢</span></span><br><span class="line">        [sessionConfiguration load];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)end &#123;</span><br><span class="line">    DMURLSessionConfiguration *sessionConfiguration = [DMURLSessionConfiguration defaultConfiguration];</span><br><span class="line">    [<span class="built_in">NSURLProtocol</span> unregisterClass:[DMURLProtocol <span class="keyword">class</span>]];</span><br><span class="line">    <span class="keyword">if</span> ([sessionConfiguration isSwizzle]) &#123;</span><br><span class="line">        <span class="comment">// å–æ¶ˆäº¤æ¢</span></span><br><span class="line">        [sessionConfiguration unload];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°æ­¤ï¼ŒåŸºæœ¬å®Œæˆäº†æ•´ä¸ªç½‘ç»œæµé‡ç›‘æ§ã€‚</p><p>å†æä¾›ä¸€ä¸ª Manger æ–¹ä¾¿ä½¿ç”¨è€…è°ƒç”¨ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">DMNetworkLog</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">DMNetworkTrafficManager</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** æ‰€æœ‰ NSURLProtocol å¯¹å¤–è®¾ç½®æ¥å£ï¼Œå¯ä»¥é˜²æ­¢å…¶ä»–å¤–æ¥ç›‘æ§ NSURLProtocol */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *protocolClasses;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/** å•ä¾‹ */</span></span><br><span class="line">+ (DMNetworkTrafficManager *)manager;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** é€šè¿‡ protocolClasses å¯åŠ¨æµé‡ç›‘æ§æ¨¡å— */</span></span><br><span class="line">+ (<span class="keyword">void</span>)startWithProtocolClasses:(<span class="built_in">NSArray</span> *)protocolClasses;</span><br><span class="line"><span class="comment">/** ä»…ä»¥ DMURLProtocol å¯åŠ¨æµé‡ç›‘æ§æ¨¡å— */</span></span><br><span class="line">+ (<span class="keyword">void</span>)start;</span><br><span class="line"><span class="comment">/** åœæ­¢æµé‡ç›‘æ§ */</span></span><br><span class="line">+ (<span class="keyword">void</span>)end;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"DMNetworkTrafficManager.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"DMURLProtocol.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">DMNetworkTrafficManager</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DMNetworkTrafficManager</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - Public</span></span><br><span class="line"></span><br><span class="line">+ (DMNetworkTrafficManager *)manager &#123;</span><br><span class="line">    <span class="keyword">static</span> DMNetworkTrafficManager *manager;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">        manager=[[DMNetworkTrafficManager alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> manager;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)startWithProtocolClasses:(<span class="built_in">NSArray</span> *)protocolClasses &#123;</span><br><span class="line">    [<span class="keyword">self</span> manager].protocolClasses = protocolClasses;</span><br><span class="line">    [DMURLProtocol start];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)start &#123;</span><br><span class="line">    [<span class="keyword">self</span> manager].protocolClasses = @[[DMURLProtocol <span class="keyword">class</span>]];</span><br><span class="line">    [DMURLProtocol start];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)end &#123;</span><br><span class="line">    [DMURLProtocol end];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><h1 id="äº”ã€ä»£ç "><a href="#äº”ã€ä»£ç " class="headerlink" title="äº”ã€ä»£ç "></a>äº”ã€ä»£ç </h1><p>æœ¬æ–‡ä¸­è´´å‡ºäº†æ¯”è¾ƒå¤šçš„ä»£ç ï¼Œä¸ºäº†ä¾¿äºå¤§å®¶æ•´ä½“è§‚çœ‹ï¼Œå¯ä»¥åˆ° <a href="https://github.com/summertian4/iOS-ObjectiveC/tree/master/NetworkTraffic" target="_blank" rel="noopener">è¿™é‡Œ</a> æ¥é˜…è¯»ã€‚</p><p>ç”±äºå…¶ä¸­åŒ…å«äº†ä¸€äº›æ•°æ®æ“ä½œçš„å†…å®¹ä¸éœ€è¦å…³å¿ƒï¼Œæ‰€ä»¥æˆ‘ç›´æ¥çœç•¥äº†ï¼Œè™½ç„¶æ²¡æœ‰ Demoï¼Œä½†æˆ‘ç›¸ä¿¡å¤§å®¶éƒ½æ˜¯èƒ½ç†è§£æ•´ä¸ªç›‘æ§ç»“æ„çš„ã€‚</p><h1 id="å…­ã€Other"><a href="#å…­ã€Other" class="headerlink" title="å…­ã€Other"></a>å…­ã€Other</h1><p>å¦‚æœä½ çš„ APP ä» iOS 9 æ”¯æŒï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://developer.apple.com/documentation/networkextension" target="_blank" rel="noopener">NetworkExtension</a>ï¼Œé€šè¿‡ NetworkExtension å¯ä»¥é€šè¿‡ VPN çš„å½¢å¼æ¥ç®¡æ•´ä¸ªç½‘ç»œè¯·æ±‚ï¼Œçœæ‰äº†ä¸Šé¢æ‰€æœ‰çš„çƒ¦æ¼ã€‚</p><hr><p>æœ‰ä»€ä¹ˆé—®é¢˜éƒ½å¯ä»¥åœ¨åšæ–‡åé¢ç•™è¨€ï¼Œæˆ–è€…å¾®åšä¸Šç§ä¿¡æˆ‘ï¼Œæˆ–è€…é‚®ä»¶æˆ‘ <a href="mailto:&#99;&#x6f;&#100;&#x65;&#114;&#x66;&#x69;&#115;&#104;&#x40;&#x31;&#54;&#51;&#46;&#99;&#111;&#109;" target="_blank" rel="noopener">&#99;&#x6f;&#100;&#x65;&#114;&#x66;&#x69;&#115;&#104;&#x40;&#x31;&#54;&#51;&#46;&#99;&#111;&#109;</a>ã€‚</p><p>åšä¸»æ˜¯ iOS å¦¹å­ä¸€æšã€‚</p><p>å¸Œæœ›å¤§å®¶ä¸€èµ·è¿›æ­¥ã€‚</p><p>æˆ‘çš„å¾®åšï¼š<a href="http://weibo.com/coderfish/" target="_blank" rel="noopener">å‘¨å°é±¼</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç”±äºéª‘æ‰‹ä¸èƒ½éšæ—¶å¤„åœ¨æœ‰ WIFI çš„çŠ¶æ€ï¼Œæµé‡å˜æˆäº†å¾ˆæ•æ„Ÿçš„é—®é¢˜ï¼Œä¸ºäº†ç²¾ç¡®åˆ°æ¯ä¸ª API çš„æµé‡ï¼Œè¿›è¡Œé’ˆå¯¹æ€§çš„ä¼˜åŒ–ï¼Œå¼€å§‹åœ¨æˆ‘ä»¬çš„ APM ä¸­æ·»åŠ æµé‡ç›‘æ§åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡å°†è®°å½•è‡ªå·±åšæµé‡ç›‘æ§æ–¹é¢çš„æ€»ç»“ã€‚å…¶ä¸­åŒ…æ‹¬äº†éå¸¸å¤šçš„&lt;strong&gt;è¸©å‘ç»éªŒ&lt;/strong&gt;ï¼Œå’Œç°æœ‰ä¸€äº›&lt;strong&gt;æ–¹æ¡ˆçš„ç¼ºé™·åˆ†æ&lt;/strong&gt;ï¼Œå¯¹æˆ‘æ¥è¯´æ˜¯ä¸€ä¸ªéå¸¸æœ‰æ„ä¹‰çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¹²è´§é¢„è­¦ğŸ¤£è¯·åšå¥½è¯»å¤§é‡ä»£ç çš„å‡†å¤‡ğŸ˜‚ğŸ˜‚ğŸ˜‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://zhoulingyu.com/categories/iOS/"/>
    
      <category term="iOSè¿›é˜¶" scheme="http://zhoulingyu.com/categories/iOS/iOS%E8%BF%9B%E9%98%B6/"/>
    
    
      <category term="iOS" scheme="http://zhoulingyu.com/tags/iOS/"/>
    
      <category term="æµé‡ç›‘æ§" scheme="http://zhoulingyu.com/tags/%E6%B5%81%E9%87%8F%E7%9B%91%E6%8E%A7/"/>
    
      <category term="APM" scheme="http://zhoulingyu.com/tags/APM/"/>
    
  </entry>
  
  <entry>
    <title>Pythonâ€”â€”å¥‡æ€ªçš„æ‰«ç ç™»å½•</title>
    <link href="http://zhoulingyu.com/2018/05/20/python-scan-code-login/"/>
    <id>http://zhoulingyu.com/2018/05/20/python-scan-code-login/</id>
    <published>2018-05-20T13:50:46.000Z</published>
    <updated>2018-07-10T03:07:31.628Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Pythonâ€”â€”å¥‡æ€ªçš„æ‰«ç ç™»å½•"><a href="#Pythonâ€”â€”å¥‡æ€ªçš„æ‰«ç ç™»å½•" class="headerlink" title="Pythonâ€”â€”å¥‡æ€ªçš„æ‰«ç ç™»å½•"></a>Pythonâ€”â€”å¥‡æ€ªçš„æ‰«ç ç™»å½•</h1><p>æœ€è¿‘åœ¨åš Sparrowï¼ˆè¿˜åœ¨å†…æµ‹çš„ä¸€ä¸ªæ•²å¥½ç”¨ Mock ç³»ç»ŸğŸ˜ï¼‰çš„æ—¶å€™é‡åˆ°äº†ä¸€ä¸ªéœ€æ±‚ã€‚Sparrow æœåŠ¡å™¨æ˜¯ä½¿ç”¨ Django 2.0 ç¼–å†™çš„äº§å“ï¼Œæ‰€ä»¥<strong>æœ¬æ–‡æ‰€æœ‰çš„ä»£ç èƒŒæ™¯å‡ä¸º Django 2.0 ç¯å¢ƒå’Œ Python 3.6.3 è¯­è¨€ï¼Œæ•´ä½“æ˜¯ Vue + Django + SQLiteã€‚</strong></p><p>Sparrow çš„æ“ä½œä¸€èˆ¬éƒ½æ˜¯åœ¨ç½‘é¡µä¸Šæ“ä½œï¼Œè€Œæ‰‹æœºå®¢æˆ·ç«¯å¾€å¾€æ˜¯ç”¨æ¥åŒæ­¥ä¸€äº›ç®€å•æ•°æ®çš„ã€‚é‚£ä¹ˆè¿™é‡Œé‡åˆ°ä¸€ä¸ªå’Œå¹³å¸¸ APP ä¸åŒçš„ä½¿ç”¨åœºæ™¯ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªäº§å“çš„æ“ä½œå¤§å¤šæ˜¯åœ¨æ‰‹æœºä¸Šï¼Œé‚£ä¹ˆ PC å®¢æˆ·ç«¯å’Œç½‘é¡µç‰ˆå°±å¯ä»¥é€šè¿‡å·²ç»ç™»å½•çš„ç§»åŠ¨ç«¯ APP æ‰«ç ç™»å½•ã€‚</p><p>è€Œç°åœ¨çš„æƒ…å†µæ˜¯ï¼ŒSparrow çš„ä½¿ç”¨å¤§å¤šåœ¨ç½‘é¡µç‰ˆï¼Œé‚£ä¹ˆï¼Œæˆ‘éœ€è¦çš„å°±æ˜¯ï¼Œè®©ç§»åŠ¨ APP ç”¨æˆ·åœ¨ç½‘é¡µç‰ˆå·²ç»ç™»å½•çš„æƒ…å†µä¸‹å…å»è¾“å…¥ç”¨æˆ·åã€å¯†ç çš„ç™»å½•æ“ä½œï¼Œè®©ç§»åŠ¨ APP ç”¨æˆ·æ‰«æç½‘é¡µäºŒç»´ç ï¼Œå®Œæˆç§»åŠ¨ APP çš„ç™»å½•ã€‚</p><a id="more"></a><h2 id="å¤§è‡´çš„-Use-Case"><a href="#å¤§è‡´çš„-Use-Case" class="headerlink" title="å¤§è‡´çš„ Use Case"></a>å¤§è‡´çš„ Use Case</h2><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_python-scan-code-login-03.png" alt=""></p><p>##è®¾è®¡æ€è·¯</p><h3 id="æ‰«ç ç™»å½•-URL"><a href="#æ‰«ç ç™»å½•-URL" class="headerlink" title="æ‰«ç ç™»å½• URL"></a>æ‰«ç ç™»å½• URL</h3><p>é¦–å…ˆèƒ½æƒ³åˆ°çš„æ˜¯ï¼ŒæœåŠ¡å™¨è¦æä¾›ç»™ç§»åŠ¨ APP å¯ä»¥è®¿é—®çš„ URLï¼ˆå±•ç°æˆäºŒç»´ç ç»™ APP æ‰«æï¼‰ï¼Œè¿™ä¸ª URL éœ€è¦åŒ…æ‹¬</p><ol><li>user çš„å”¯ä¸€æ ‡å¿—ç¬¦</li><li>éªŒè¯ç </li></ol><p>é‚£ä¹ˆå…¶ URL çš„å¤§è‡´æ¨¡æ ·å°±æ˜¯ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frontend/account/quick_login?user_id=&lt;user_id&gt;&amp;verification_code=&lt;verification_code&gt;</span><br></pre></td></tr></table></figure><h3 id="éªŒè¯ç "><a href="#éªŒè¯ç " class="headerlink" title="éªŒè¯ç "></a>éªŒè¯ç </h3><p>éªŒè¯ç æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Ÿ</p><p>åŸå› æ˜¯è¿™æ ·çš„ï¼Œå¦‚æœæ‰«ç ç™»å½•çš„ URL æ°¸ä¹…æœ‰æ•ˆï¼Œæ˜¾ç„¶æ˜¯ä¸åˆç†çš„ï¼Œè¿™æ„å‘³ç€åªè¦å¾—åˆ°äº†è¿™ä¸ª URLï¼Œä»»ä½•äººéƒ½å¯ä»¥é€šè¿‡è¿™ä¸ª URL éšæ—¶ç™»å½•è¯¥ç”¨æˆ·çš„è´¦å·ï¼Œæ‰€ä»¥éœ€è¦æœ‰éªŒè¯ç ã€‚</p><p>åŒæ—¶ï¼Œ<strong>éªŒè¯ç éœ€è¦é™„å¸¦ç”Ÿæˆæ—¶é—´</strong>ï¼Œä»¥æ­¤æ¥è¾¾<strong>åˆ°éªŒè¯ç ä¸€åˆ†é’Ÿæœ‰æ•ˆ</strong>çš„ Featureã€‚ä¸ºæ­¤ï¼Œè®¾è®¡ä¸€ä¸ªå¤–é”®ä¸º user çš„ Modelï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuickLoginRecord</span><span class="params">(models.Model, Dictable)</span>:</span></span><br><span class="line">    user = models.ForeignKey(User, on_delete=models.SET_NULL, null=<span class="keyword">True</span>)</span><br><span class="line">    create_time = models.DateTimeField(auto_now_add=<span class="keyword">True</span>)</span><br><span class="line">    update_time = models.DateTimeField(auto_now=<span class="keyword">True</span>)</span><br><span class="line">    verification_code = models.CharField(max_length=<span class="number">32</span>, null=<span class="keyword">True</span>, default=<span class="string">''</span>)</span><br></pre></td></tr></table></figure><p>é€šè¿‡ Django ç”Ÿæˆçš„å¯¹åº”æ•°æ®åº“ä¸ºï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_python-scan-code-login-01.png" alt=""></p><p>ä»€ä¹ˆæ—¶å€™ç”ŸæˆéªŒè¯ç ï¼Œé‚£å½“ç„¶æ˜¯ç”ŸæˆäºŒç»´ç çš„æ—¶å€™ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ª URL ä¸æ˜¯ç»™ç§»åŠ¨ç«¯è¯·æ±‚çš„ï¼Œè€Œæ˜¯ç»™å‰ç«¯æ¥è¯·æ±‚çš„ï¼Œå‰ç«¯åœ¨å·²ç™»å½•çš„æƒ…å†µä¸‹ï¼Œè®¿é—®è¯¥ URL å¯ä»¥ç›´æ¥ä¼ é€’ user ä¿¡æ¯ï¼Œåç«¯é€šè¿‡æ‹¿åˆ° user ä¿¡æ¯ï¼Œç”Ÿæˆä¸€æ¡ QuickLoginRecord è®°å½•ã€‚</p><p>å‰ç«¯è®¿é—®å¹¶æ‹¿åˆ°éªŒè¯ç çš„ URL çš„å¤§è‡´æ¨¡æ ·æ˜¯ï¼š</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frontend/account/request_quick_login</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæ•´ä¸ªæµç¨‹å°±æ˜¯ï¼ˆçœç•¥äº†ç»†èŠ‚å¤„ç†ï¼‰ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_python-scan-code-login-04.png-w375" alt=""></p><h2 id="åç«¯ä»£ç "><a href="#åç«¯ä»£ç " class="headerlink" title="åç«¯ä»£ç "></a>åç«¯ä»£ç </h2><h3 id="url-py"><a href="#url-py" class="headerlink" title="url.py"></a>url.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">// Â·Â·Â·</span><br><span class="line">path(<span class="string">'frontend/account/quick_login'</span>, AccountAction.quick_login),</span><br><span class="line">    path(<span class="string">'frontend/account/request_quick_login'</span>, AccountAction.request_quick_login),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="models-py"><a href="#models-py" class="headerlink" title="models.py"></a>models.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuickLoginRecord</span><span class="params">(models.Model, Dictable)</span>:</span></span><br><span class="line">    user = models.ForeignKey(User, on_delete=models.SET_NULL, null=<span class="keyword">True</span>)</span><br><span class="line">    create_time = models.DateTimeField(auto_now_add=<span class="keyword">True</span>)</span><br><span class="line">    update_time = models.DateTimeField(auto_now=<span class="keyword">True</span>)</span><br><span class="line">    verification_code = models.CharField(max_length=<span class="number">32</span>, null=<span class="keyword">True</span>, default=<span class="string">''</span>)</span><br></pre></td></tr></table></figure><h3 id="account-action-py"><a href="#account-action-py" class="headerlink" title="account_action.py"></a>account_action.py</h3><p>è¿™é‡Œä»£ç ä¸æƒ³çœ‹çš„è¯ï¼Œå¤§æ¦‚æè¿°ä¸€ä¸‹è¿‡ç¨‹ï¼š</p><h4 id="def-request-quick-login-request-HttpRequest"><a href="#def-request-quick-login-request-HttpRequest" class="headerlink" title="def request_quick_login(request: HttpRequest)"></a>def request_quick_login(request: HttpRequest)</h4><ol><li>è§„å®š HTTPMethod å¿…é¡»ä¸º GET è®¿é—®</li><li>è·å– request ä¸­çš„ user_id å‚æ•°</li><li>é€šè¿‡ user_id æŸ¥è¯¢ QuickLoginRecord è®°å½•</li><li>å¦‚æœæœªæŸ¥è¯¢åˆ°ç»“æœï¼Œæ–°å»ºä¸€ä¸ª QuickLoginRecord è®°å½•ï¼Œè®¾ç½® user å…³è”ã€verification_codeï¼ˆcreate_time å’Œ update_time åœ¨ QuickLoginRecordDao ä¸­è‡ªåŠ¨è®¾ç½®ï¼‰</li><li>å¦‚æœæŸ¥è¯¢åˆ°ç»“æœï¼Œæ›´æ–° verification_code å­—æ®µï¼ˆ update_time åœ¨ QuickLoginRecordDao ä¸­è‡ªåŠ¨è®¾ç½®ï¼‰</li><li>è¿”å› Success</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@track(AccountRequestQuickLogin)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">request_quick_login</span><span class="params">(request: HttpRequest)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method != CommonData.Method.GET.value:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(Response.methodInvalidResponse().toJson(), content_type=<span class="string">'application/json'</span>)</span><br><span class="line">    user = request.user</span><br><span class="line">    r = QuickLoginRecordDao.get_record_with_user_id(user.id)</span><br><span class="line">    <span class="keyword">if</span> r <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        r.verification_code = str(uuid.uuid1())</span><br><span class="line">        QuickLoginRecordDao.update_record(r)</span><br><span class="line">        response = Response(Success, <span class="string">'Success'</span>, &#123;<span class="string">'verification_code'</span>: r.verification_code&#125;)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(response.toJson(), content_type=<span class="string">'application/json'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        record = QuickLoginRecord()</span><br><span class="line">        record.user = user</span><br><span class="line">        record.verification_code = str(uuid.uuid1())</span><br><span class="line">        QuickLoginRecordDao.add_record(record)</span><br><span class="line">        response = Response(Success, <span class="string">'Success'</span>, &#123;<span class="string">'verification_code'</span>: record.verification_code&#125;)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(response.toJson(), content_type=<span class="string">'application/json'</span>)</span><br></pre></td></tr></table></figure><h4 id="def-quick-login-request-HttpRequest"><a href="#def-quick-login-request-HttpRequest" class="headerlink" title="def quick_login(request: HttpRequest):"></a>def quick_login(request: HttpRequest):</h4><ol><li>è§„å®š HTTPMethod å¿…é¡»ä¸º GET è®¿é—®</li><li>æ‹¿åˆ° reqeust ä¸­çš„ user_id</li><li>æ‹¿åˆ° reqeust ä¸­çš„ verification_code</li><li>é€šè¿‡ verification_code è·å– QuickLoginRecord è®°å½•</li><li>å¦‚æœè®°å½•ä¸å­˜åœ¨åˆ™è¡¨ç¤ºéªŒè¯ç ä¸å­˜åœ¨æˆ–è¿‡æœŸ</li><li>å¦‚æœå­˜åœ¨ï¼Œæ¯”è¾ƒ update_time å­—æ®µï¼Œåˆ¤æ–­æ˜¯å¦å·²ç»è¶…è¿‡ 60 ç§’</li><li>è¶…è¿‡ 60 ç§’è¿”å›ã€éªŒè¯ç è¿‡æœŸã€</li><li>æœªè¶…è¿‡ 60 ç§’ï¼Œè®©ç”¨æˆ·ç™»å½•</li><li>è¿”å› Success</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@track(AccountQuickLogin)</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">quick_login</span><span class="params">(request: HttpRequest)</span>:</span></span><br><span class="line">       <span class="keyword">if</span> request.method != CommonData.Method.GET.value:</span><br><span class="line">           <span class="keyword">return</span> HttpResponse(Response.methodInvalidResponse().toJson(), content_type=<span class="string">'application/json'</span>)</span><br><span class="line">       user_id = request.GET.get(<span class="string">'user_id'</span>)</span><br><span class="line">       verification_code = request.GET.get(<span class="string">'verification_code'</span>)</span><br><span class="line"></span><br><span class="line">       record = QuickLoginRecordDao.get_record_with_verification_code(verification_code)</span><br><span class="line">       <span class="keyword">if</span> record <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">           response = Response(QuickLoginFailed, <span class="string">'éªŒè¯ç ä¸å­˜åœ¨æˆ–å·²è¿‡æœŸ'</span>, &#123;&#125;)</span><br><span class="line">           <span class="keyword">return</span> HttpResponse(response.toJson(), content_type=<span class="string">'application/json'</span>)</span><br><span class="line"></span><br><span class="line">       now = datetime.now(timezone.utc)</span><br><span class="line">       offset = (now - record.update_time).seconds</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> offset &gt; <span class="number">60</span>:</span><br><span class="line">           response = Response(QuickLoginFailed, <span class="string">'éªŒè¯ç å·²è¿‡æœŸ'</span>, &#123;&#125;)</span><br><span class="line">           <span class="keyword">return</span> HttpResponse(response.toJson(), content_type=<span class="string">'application/json'</span>)</span><br><span class="line"></span><br><span class="line">       user = AccountDao.get_user_with_id(user_id)</span><br><span class="line">       <span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">           response = Response(QuickLoginFailed, <span class="string">'ç”¨æˆ·ä¸å­˜åœ¨'</span>, &#123;&#125;)</span><br><span class="line">           <span class="keyword">return</span> HttpResponse(response.toJson(), content_type=<span class="string">'application/json'</span>)</span><br><span class="line">       user.backend = <span class="string">'django.contrib.auth.backends.ModelBackend'</span></span><br><span class="line">       print(<span class="string">'ç”¨æˆ· '</span> + user.username + <span class="string">' å°è¯•ç™»å½•'</span>)</span><br><span class="line">       auth.login(request, user)</span><br><span class="line">       accountInfo = User.objects.get(id=user.id)</span><br><span class="line">       response = Response(Success, <span class="string">'Success'</span>, &#123;<span class="string">'id'</span>: accountInfo.id,</span><br><span class="line">                                                <span class="string">'username'</span>: accountInfo.username,</span><br><span class="line">                                                <span class="string">'email'</span>: accountInfo.email&#125;)</span><br><span class="line">       <span class="keyword">return</span> HttpResponse(response.toJson(), content_type=<span class="string">'application/json'</span>)</span><br></pre></td></tr></table></figure><h4 id="quick-login-record-dao-py"><a href="#quick-login-record-dao-py" class="headerlink" title="quick_login_record_dao.py"></a>quick_login_record_dao.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuickLoginRecordDao</span>:</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_record</span><span class="params">(record)</span>:</span></span><br><span class="line">        record.save()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_record_with_user_id</span><span class="params">(user_id)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            record = QuickLoginRecord.objects.get(user_id=user_id)</span><br><span class="line">            <span class="keyword">return</span> record</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update_record</span><span class="params">(record)</span>:</span></span><br><span class="line">        result = QuickLoginRecord.objects.filter(id=record.id).update(</span><br><span class="line">            verification_code=record.verification_code,</span><br><span class="line">            update_time=datetime.datetime.now())</span><br><span class="line">        <span class="keyword">if</span> result &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_record_with_verification_code</span><span class="params">(code)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            record = QuickLoginRecord.objects.get(verification_code=code)</span><br><span class="line">            <span class="keyword">return</span> record</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">None</span></span><br></pre></td></tr></table></figure><h2 id="å‰ç«¯ä»£ç "><a href="#å‰ç«¯ä»£ç " class="headerlink" title="å‰ç«¯ä»£ç "></a>å‰ç«¯ä»£ç </h2><p>å‰ç«¯çš„æ•ˆæœæ˜¯è¿™æ ·çš„ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_python-scan-code-login-02.gif" alt=""></p><p>åœ¨å·²ç™»å½•çš„çŠ¶æ€ä¸‹ï¼Œç‚¹å‡»å³ä¸Šè§’çš„ã€å®¢æˆ·ç«¯æ‰«ç ç™»å½•ã€æŒ‰é’®ï¼Œå¼¹å‡ºäºŒç»´ç ã€‚</p><p>åŠ¨æ•ˆã€æ¨¡æ€çª—ä»€ä¹ˆçš„å°±ä¸è¿‡å¤šå±•ç¤ºä»£ç äº†ï¼Œåªå…³æ³¨ä¸»æµç¨‹çš„ä»£ç ï¼š</p><h3 id="å¯¼èˆªæ æŒ‰é’®"><a href="#å¯¼èˆªæ æŒ‰é’®" class="headerlink" title="å¯¼èˆªæ æŒ‰é’®"></a>å¯¼èˆªæ æŒ‰é’®</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"nav-item"</span> <span class="attr">v-if</span>=<span class="string">"account.status"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"button is-primary"</span> <span class="attr">type</span>=<span class="string">"submit"</span> @<span class="attr">click</span>=<span class="string">"openModalImage"</span>&gt;</span>å®¢æˆ·ç«¯æ‰«ç ç™»å½•<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="openModalImage-å‡½æ•°"><a href="#openModalImage-å‡½æ•°" class="headerlink" title="openModalImage å‡½æ•°"></a>openModalImage å‡½æ•°</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">openModalImage () &#123;</span><br><span class="line">  <span class="keyword">const</span> imageModal = openImageModal()</span><br><span class="line">  imageModal.loading = <span class="literal">true</span></span><br><span class="line">  <span class="keyword">var</span> baseUrl = <span class="built_in">window</span>.location.protocol + <span class="string">'//'</span> + <span class="built_in">window</span>.location.host</span><br><span class="line">  request(<span class="string">'/frontend/account/request_quick_login'</span>, &#123;</span><br><span class="line">    method: <span class="string">'get'</span></span><br><span class="line">  &#125;).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> verificationCode = response.data.verification_code</span><br><span class="line">    <span class="keyword">var</span> url = baseUrl + <span class="string">'/frontend/account/quick_login'</span> + <span class="string">'?'</span> +</span><br><span class="line">      <span class="string">'verification_code='</span> + verificationCode + <span class="string">'&amp;'</span> +</span><br><span class="line">    <span class="string">'user_id='</span> + <span class="keyword">this</span>.accountInfo.id</span><br><span class="line"></span><br><span class="line">    QRCode.toDataURL(url)</span><br><span class="line">      .then(<span class="function"><span class="params">url</span> =&gt;</span> &#123;</span><br><span class="line">        imageModal.imgUrl = url</span><br><span class="line">        imageModal.loading = <span class="literal">false</span></span><br><span class="line">        imageModal.$children[<span class="number">0</span>].active()</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(err)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    notification.toast(&#123;</span><br><span class="line">      message: response.message,</span><br><span class="line">      type: <span class="string">'danger'</span>,</span><br><span class="line">      duration: <span class="number">2000</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="iOSä»£ç "><a href="#iOSä»£ç " class="headerlink" title="iOSä»£ç "></a>iOSä»£ç </h2><p>iOS ä»£ç å°±ä¸å±•ç¤ºäº†ï¼Œå°±æ˜¯æ‰«ç è®¿é—®äºŒç»´ç é‡Œçš„ URLï¼Œå†åŠ ä¸Šä¸€äº›éæ³• URL çš„åˆ¤æ–­å³å¯ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿‡å®Œæ•´ä¸ªæµç¨‹åï¼Œå¯ä»¥æ„Ÿè§‰åˆ°ï¼Œç±»ä¼¼äºæ”¯ä»˜å®çš„æ‰«ç æ”¯ä»˜ã€‚ç»™å‡ºä¸€ä¸ªå®šæ—¶åˆ·æ–°çš„äºŒç»´ç ï¼Œä¾›ç»™å®¢æˆ·ç«¯è¿›è¡Œæ‰«ç ç™»å½•ã€‚</p><p>å½“ç„¶ï¼Œè¿˜æœ‰å¯ä»¥å®Œå–„çš„åœ°æ–¹ï¼Œæ¯”å¦‚å‰æ®µåœ¨æ‰“å¼€äº†äºŒç»´ç æ¨¡æ€çª—æ—¶ï¼Œæ¯ 60 ç§’è¿›è¡Œä¸€æ¬¡å®šæ—¶åˆ·æ–°ã€‚</p><hr><p>æœ‰ä»€ä¹ˆé—®é¢˜éƒ½å¯ä»¥åœ¨åšæ–‡åé¢ç•™è¨€ï¼Œæˆ–è€…å¾®åšä¸Šç§ä¿¡æˆ‘ï¼Œæˆ–è€…é‚®ä»¶æˆ‘ <a href="mailto:&#99;&#x6f;&#100;&#101;&#x72;&#x66;&#x69;&#115;&#x68;&#x40;&#49;&#54;&#51;&#46;&#x63;&#x6f;&#109;" target="_blank" rel="noopener">&#99;&#x6f;&#100;&#101;&#x72;&#x66;&#x69;&#115;&#x68;&#x40;&#49;&#54;&#51;&#46;&#x63;&#x6f;&#109;</a>ã€‚</p><p>åšä¸»æ˜¯ iOS å¦¹å­ä¸€æšã€‚</p><p>å¸Œæœ›å¤§å®¶ä¸€èµ·è¿›æ­¥ã€‚</p><p>æˆ‘çš„å¾®åšï¼š<a href="http://weibo.com/coderfish/" target="_blank" rel="noopener">å°é±¼å‘¨å‡Œå®‡</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Pythonâ€”â€”å¥‡æ€ªçš„æ‰«ç ç™»å½•&quot;&gt;&lt;a href=&quot;#Pythonâ€”â€”å¥‡æ€ªçš„æ‰«ç ç™»å½•&quot; class=&quot;headerlink&quot; title=&quot;Pythonâ€”â€”å¥‡æ€ªçš„æ‰«ç ç™»å½•&quot;&gt;&lt;/a&gt;Pythonâ€”â€”å¥‡æ€ªçš„æ‰«ç ç™»å½•&lt;/h1&gt;&lt;p&gt;æœ€è¿‘åœ¨åš Sparrowï¼ˆè¿˜åœ¨å†…æµ‹çš„ä¸€ä¸ªæ•²å¥½ç”¨ Mock ç³»ç»ŸğŸ˜ï¼‰çš„æ—¶å€™é‡åˆ°äº†ä¸€ä¸ªéœ€æ±‚ã€‚Sparrow æœåŠ¡å™¨æ˜¯ä½¿ç”¨ Django 2.0 ç¼–å†™çš„äº§å“ï¼Œæ‰€ä»¥&lt;strong&gt;æœ¬æ–‡æ‰€æœ‰çš„ä»£ç èƒŒæ™¯å‡ä¸º Django 2.0 ç¯å¢ƒå’Œ Python 3.6.3 è¯­è¨€ï¼Œæ•´ä½“æ˜¯ Vue + Django + SQLiteã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Sparrow çš„æ“ä½œä¸€èˆ¬éƒ½æ˜¯åœ¨ç½‘é¡µä¸Šæ“ä½œï¼Œè€Œæ‰‹æœºå®¢æˆ·ç«¯å¾€å¾€æ˜¯ç”¨æ¥åŒæ­¥ä¸€äº›ç®€å•æ•°æ®çš„ã€‚é‚£ä¹ˆè¿™é‡Œé‡åˆ°ä¸€ä¸ªå’Œå¹³å¸¸ APP ä¸åŒçš„ä½¿ç”¨åœºæ™¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªäº§å“çš„æ“ä½œå¤§å¤šæ˜¯åœ¨æ‰‹æœºä¸Šï¼Œé‚£ä¹ˆ PC å®¢æˆ·ç«¯å’Œç½‘é¡µç‰ˆå°±å¯ä»¥é€šè¿‡å·²ç»ç™»å½•çš„ç§»åŠ¨ç«¯ APP æ‰«ç ç™»å½•ã€‚&lt;/p&gt;
&lt;p&gt;è€Œç°åœ¨çš„æƒ…å†µæ˜¯ï¼ŒSparrow çš„ä½¿ç”¨å¤§å¤šåœ¨ç½‘é¡µç‰ˆï¼Œé‚£ä¹ˆï¼Œæˆ‘éœ€è¦çš„å°±æ˜¯ï¼Œè®©ç§»åŠ¨ APP ç”¨æˆ·åœ¨ç½‘é¡µç‰ˆå·²ç»ç™»å½•çš„æƒ…å†µä¸‹å…å»è¾“å…¥ç”¨æˆ·åã€å¯†ç çš„ç™»å½•æ“ä½œï¼Œè®©ç§»åŠ¨ APP ç”¨æˆ·æ‰«æç½‘é¡µäºŒç»´ç ï¼Œå®Œæˆç§»åŠ¨ APP çš„ç™»å½•ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Python" scheme="http://zhoulingyu.com/categories/Python/"/>
    
    
      <category term="Python" scheme="http://zhoulingyu.com/tags/Python/"/>
    
      <category term="Django" scheme="http://zhoulingyu.com/tags/Django/"/>
    
  </entry>
  
  <entry>
    <title>å…³äº Pod åº“çš„èµ„æºå¼•ç”¨ resource_bundles or resources</title>
    <link href="http://zhoulingyu.com/2018/02/02/pod-resource-reference/"/>
    <id>http://zhoulingyu.com/2018/02/02/pod-resource-reference/</id>
    <published>2018-02-02T18:29:09.000Z</published>
    <updated>2018-07-10T03:07:31.628Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-èµ„æºæ–‡ä»¶å¼•ç”¨çš„æ–¹å¼"><a href="#1-èµ„æºæ–‡ä»¶å¼•ç”¨çš„æ–¹å¼" class="headerlink" title="1. èµ„æºæ–‡ä»¶å¼•ç”¨çš„æ–¹å¼"></a>1. èµ„æºæ–‡ä»¶å¼•ç”¨çš„æ–¹å¼</h1><p>åœ¨ç¬¬ä¸€èŠ‚ï¼Œå…ˆæ¥ä»‹ç»ä¸€ä¸‹ CocoaPods ä¸¤ç§èµ„æºæ–‡ä»¶å¼•ç”¨çš„æ–¹å¼â€”â€”<code>resource_bundles</code> &amp; <code>resources</code></p><h2 id="1-1-resource-bundles"><a href="#1-1-resource-bundles" class="headerlink" title="1.1 resource_bundles"></a>1.1 resource_bundles</h2><p><code>resource_bundles</code> å…è®¸å®šä¹‰å½“å‰ Pod åº“çš„èµ„æºåŒ…çš„<strong>åç§°å’Œæ–‡ä»¶</strong>ã€‚ç”¨ hash çš„å½¢å¼æ¥å£°æ˜ï¼Œkey æ˜¯ bundle çš„åç§°ï¼Œvalue æ˜¯éœ€è¦åŒ…æ‹¬çš„æ–‡ä»¶çš„é€šé… patternsã€‚</p><blockquote><p>We strongly recommend library developers to adopt resource bundles as there can be name collisions using the resources attribute.</p></blockquote><p>CocoaPods å®˜æ–¹å¼ºçƒˆæ¨èä½¿ç”¨ <code>resource_bundles</code>ï¼Œå› ä¸ºç”¨ key-value å¯ä»¥é¿å…ç›¸åŒåç§°èµ„æºçš„åç§°å†²çªã€‚</p><p>åŒæ—¶å»ºè®® bundle çš„åç§°è‡³å°‘åº”è¯¥åŒ…æ‹¬ Pod åº“çš„åç§°ï¼Œå¯ä»¥å°½é‡å‡å°‘åŒåå†²çª</p><p>Examples:</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spec.ios.resource_bundle = &#123; <span class="string">'MapBox'</span> =&gt; <span class="string">'MapView/Map/Resources/*.png'</span> &#125;</span><br></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spec.resource_bundles = &#123;</span><br><span class="line">    <span class="string">'MapBox'</span> =&gt; [<span class="string">'MapView/Map/Resources/*.png'</span>],</span><br><span class="line">    <span class="string">'OtherResources'</span> =&gt; [<span class="string">'MapView/Map/OtherResources/*.png'</span>]</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="1-2-resources"><a href="#1-2-resources" class="headerlink" title="1.2 resources"></a>1.2 resources</h2><p>ä½¿ç”¨ <code>resources</code> æ¥æŒ‡å®šèµ„æºï¼Œè¢«æŒ‡å®šçš„èµ„æºåªä¼šç®€å•çš„è¢« copy åˆ°ç›®æ ‡å·¥ç¨‹ä¸­ï¼ˆä¸»å·¥ç¨‹ï¼‰ã€‚</p><blockquote><p>We strongly recommend library developers to adopt resource bundles as there can be name collisions using the resources attribute. Moreover, resources specified with this attribute are copied directly to the client target and therefore they are not optimised by Xcode.</p></blockquote><p>å®˜æ–¹è®¤ä¸ºç”¨ <code>resources</code> æ˜¯æ— æ³•é¿å…åŒåèµ„æºæ–‡ä»¶çš„å†²çªçš„ï¼ŒåŒæ—¶ï¼ŒXcode ä¹Ÿä¸ä¼šå¯¹è¿™äº›èµ„æºåšä¼˜åŒ–ã€‚</p><p>Examples:</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spec.resource = <span class="string">'Resources/HockeySDK.bundle'</span></span><br></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spec.resources = [<span class="string">'Images/*.png'</span>, <span class="string">'Sounds/*'</span>]</span><br></pre></td></tr></table></figure><blockquote><p><strong>FYIï¼š</strong><br><a href="https://guides.cocoapods.org/syntax/podspec.html" target="_blank" rel="noopener">Podspec Syntax Reference v1.4.0</a></p></blockquote><h1 id="2-å›¾ç‰‡èµ„æºçš„ç®¡ç†"><a href="#2-å›¾ç‰‡èµ„æºçš„ç®¡ç†" class="headerlink" title="2. å›¾ç‰‡èµ„æºçš„ç®¡ç†"></a>2. å›¾ç‰‡èµ„æºçš„ç®¡ç†</h1><p>æˆ‘ä»¬ç†ŸçŸ¥å¹³å¸¸ç”¨çš„ @2x @3x å›¾ç‰‡æ˜¯ä¸ºäº†ç¼©å°ç”¨æˆ·æœ€ç»ˆä¸‹è½½æ—¶åŒ…çš„å¤§å°ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šå°†å›¾ç‰‡æ”¾åœ¨ <code>.xcassets</code> æ–‡ä»¶ä¸­ç®¡ç†ï¼Œæ–°å»ºçš„é¡¹ç›®ä¹Ÿé»˜è®¤åˆ›å»ºï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_pod-resource-reference-01.png" alt=""></p><p>ä½¿ç”¨ <code>.xcassets</code> ä¸ä»…å¯ä»¥æ–¹ä¾¿åœ¨ Xcode æŸ¥çœ‹å’Œæ‹–å…¥å›¾ç‰‡ï¼ŒåŒæ—¶ <code>.xcassets</code> æœ€ç»ˆä¼šæ‰“åŒ…ç”Ÿæˆä¸º<br> <code>Assets.car</code> æ–‡ä»¶ã€‚å¯¹äº <code>Assets.car</code> æ–‡ä»¶ï¼Œ<a href="https://help.apple.com/xcode/mac/current/#/devbbdc5ce4f" target="_blank" rel="noopener">App Slicing</a> ä¼šä¸ºåˆ‡å‰²ç•™ä¸‹ç¬¦åˆç›®æ ‡è®¾å¤‡åˆ†è¾¨ç‡çš„å›¾ç‰‡ï¼Œå¯ä»¥ç¼©å°ç”¨æˆ·æœ€ç»ˆä¸‹è½½çš„åŒ…çš„å¤§å°ã€‚</p><blockquote><p><strong>FYIï¼š</strong><br><a href="https://developer.apple.com/library/content/documentation/Xcode/Reference/xcode_ref-Asset_Catalog_Format/FolderStructure.html#//apple_ref/doc/uid/TP40015170-CH33-SW1" target="_blank" rel="noopener">Xcode Ref Asset Catalog Format</a><br><a href="https://help.apple.com/xcode/mac/current/#/devbbdc5ce4f" target="_blank" rel="noopener">App thinning overview (iOS, tvOS, watchOS)</a></p></blockquote><p>å®é™…ä¸Šï¼Œå¯¹äº Pods åº“çš„èµ„æºï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨ <code>.xcassets</code> ç®¡ç†ã€‚</p><h1 id="3-å®é™…éªŒè¯"><a href="#3-å®é™…éªŒè¯" class="headerlink" title="3. å®é™…éªŒè¯"></a>3. å®é™…éªŒè¯</h1><blockquote><p>ä¸å…³æ³¨çš„å¯ä»¥ç›´æ¥è·³åˆ°ä¸‹é¢ã€ç»“è®ºã€</p></blockquote><p>å®˜æ–‡ä¸­æ¨èäº† <code>resource_bundles</code> å…¶ç†ç”±ä¸»è¦æ˜¯ã€å¯ä»¥è§£å†³åŒåå†²çªã€å’Œã€Xcodeä¸º bundle æä¾›çš„ä¸€äº›ä¼˜åŒ–ã€ã€‚</p><p>æˆ‘çŸ¥é“å¾ˆå¤šäººçœ‹è¿‡ <a href="http://blog.xianqu.org/2015/08/pod-resources/" target="_blank" rel="noopener">è¿™ç¯‡</a> æ–‡ç« ï¼Œé‡Œé¢æåˆ° resource_bundles ä¸èƒ½ä½¿ç”¨ .xcassetsã€‚</p><p>é‚£ä¹ˆåˆ°åº•æ˜¯ä¸æ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬éœ€è¦äº²è‡ªåŠ¨æ‰‹éªŒè¯ï¼Œçœ‹çœ‹ä¸¤ç§å¼•ç”¨æ–¹å¼ï¼ŒCocoaPods åˆ°åº•ä¸ºæˆ‘ä»¬åšäº†ä»€ä¹ˆã€‚</p><p>æˆ‘ä»¬å°†åœ¨ã€å®é™…éªŒè¯ã€ä¸€èŠ‚éªŒè¯ï¼š</p><ol><li><code>resource_bundles</code> æ˜¯å¦èƒ½ä½¿ç”¨ *.xcassets æŒ‡å®šèµ„æºå¹¶æ­£ç¡®æ‰“åŒ…</li><li>åŒåå†²çªæ˜¯æ€æ ·çš„</li></ol><h2 id="3-1-resource-bundles-æ˜¯å¦èƒ½ä½¿ç”¨-xcassets-æŒ‡å®šèµ„æºå¹¶æ­£ç¡®æ‰“åŒ…"><a href="#3-1-resource-bundles-æ˜¯å¦èƒ½ä½¿ç”¨-xcassets-æŒ‡å®šèµ„æºå¹¶æ­£ç¡®æ‰“åŒ…" class="headerlink" title="3.1 resource_bundles æ˜¯å¦èƒ½ä½¿ç”¨ *.xcassets æŒ‡å®šèµ„æºå¹¶æ­£ç¡®æ‰“åŒ…"></a>3.1 resource_bundles æ˜¯å¦èƒ½ä½¿ç”¨ *.xcassets æŒ‡å®šèµ„æºå¹¶æ­£ç¡®æ‰“åŒ…</h2><p>å†™ä¸¤ä¸ª Demo Podï¼ŒåŒæ—¶åˆ›å»ºå¥½å¯¹åº”çš„ Example æµ‹è¯•å·¥ç¨‹ã€‚</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_pod-resource-reference-02.png" alt=""></p><p>å¯¹ä¸¤ä¸ª Pod åˆ†åˆ«ä½¿ç”¨ä¸åŒçš„æ–¹å¼æŒ‡å®šèµ„æºã€‚</p><p>ç¬¬ä¸€ä¸ª Demo Podï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_pod-resource-reference-04.png" alt=""></p><p>ç¬¬äºŒä¸ª Demo Podï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_pod-resource-reference-03.png" alt=""></p><p>åˆ†åˆ«ç”¨äº† <code>resource_bundles</code> å’Œ <code>resources</code> ä¸¤ç§æ–¹å¼å¼•ç”¨ã€‚</p><p><code>pod install</code> åï¼Œè§‚å¯Ÿç»“æœã€‚</p><h3 id="3-1-1-ä½¿ç”¨-resources"><a href="#3-1-1-ä½¿ç”¨-resources" class="headerlink" title="3.1.1 ä½¿ç”¨ resources"></a>3.1.1 ä½¿ç”¨ resources</h3><p><code>pod install</code> å¹¶ç¼–è¯‘ Example å·¥ç¨‹åï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å¼€æœ€åç”Ÿæˆçš„ Product æ–‡ä»¶ä¸‹çš„å†…å®¹ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_pod-resource-reference-06.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°åªæœ‰ ä¸€äº› <code>.a</code> æ–‡ä»¶ï¼Œ<code>.a</code> æ–‡ä»¶æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ã€‚åˆæ¬¡ä¹‹å¤–åªæœ‰ <code>SubModule-Example.app</code>ï¼Œæ‰“å¼€åŒ…å†…å®¹ï¼Œå¯ä»¥çœ‹åˆ°åªæœ‰ä¸€ä¸ª <code>Assets.car</code>ã€‚</p><p>è¿™è¯´æ˜ï¼Œä½¿ç”¨ <code>resources</code> ä¹‹ååªä¼šç®€å•çš„å°†èµ„æºæ–‡ä»¶ copy åˆ°ç›®æ ‡å·¥ç¨‹ï¼ˆExample å·¥ç¨‹ï¼‰ï¼Œæœ€åå’Œç›®æ ‡å·¥ç¨‹çš„å›¾ç‰‡æ–‡ä»¶ä»¥åŠå…¶ä»–åŒæ ·ä½¿ç”¨ <code>resources</code> çš„ Pod çš„å›¾ç‰‡æ–‡ä»¶ï¼Œç»Ÿä¸€ä¸€èµ·æ‰“åŒ…ä¸ºäº†ä¸€ä¸ª <code>Assets.car</code>ã€‚</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_pod-resource-reference-07.png" alt=""></p><p>å†ä¸º Pod å†™ä¸€ä¸ª VC æ¥å®éªŒè¯»å–å›¾ç‰‡ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_pod-resource-reference-08.png" alt=""></p><p>è¯»å–å›¾ç‰‡çš„æ–¹å¼å’Œå¹³å¸¸ä½¿ç”¨çš„æ–¹å¼ä¸åŒï¼Œè¦å…ˆè·å– Bundleï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"some-image"</span></span><br><span class="line">                                inBundle:[<span class="built_in">NSBundle</span> bundleForClass:[<span class="keyword">self</span> <span class="keyword">class</span>]]</span><br><span class="line">           compatibleWithTraitCollection:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure><p>åœ¨ Example çš„ <code>ViewController</code> å†™ä¸€ä¸‹è·³è½¬ <code>SubModule/SMViewController</code>ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_pod-resource-reference-09.png" alt=""></p><p>è¿è¡Œä¹‹åï¼Œçœ‹ä¸€ä¸‹ï¼Œèƒ½æ­£å¸¸è®¿é—®å›¾ç‰‡ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_pod-resource-reference-10.png" alt=""></p><h3 id="3-1-2-ä½¿ç”¨-resource-bundles"><a href="#3-1-2-ä½¿ç”¨-resource-bundles" class="headerlink" title="3.1.2 ä½¿ç”¨ resource_bundles"></a>3.1.2 ä½¿ç”¨ <code>resource_bundles</code></h3><p><code>pod install</code> å¹¶ç¼–è¯‘ Example å·¥ç¨‹åï¼ŒåŒæ ·æ‰¾åˆ° Product æ–‡ä»¶ä¸‹çš„å†…å®¹ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_pod-resource-reference-11.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°æœ€ç»ˆç”Ÿæˆäº†ä¸€ä¸ª <code>SubModule_Use_Bundle.bundle</code>ï¼Œæ‰“å¼€çœ‹å†…éƒ¨ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_pod-resource-reference-12.png" alt=""></p><p>å‘ç°åŒ…å«äº†ä¸€ä¸ª <code>Assets.car</code></p><p>å†ä¸º Pod å†™ä¸€ä¸ª VC æ¥å®éªŒè¯»å–å›¾ç‰‡ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_pod-resource-reference-13.png" alt=""></p><p>ç”±äºè¿˜éœ€è¦å¸¦ä¸Š .bundle æ–‡ä»¶çš„è·¯å¾„ï¼Œè·å–çš„æ–¹å¼åˆä¸åŒï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *bundlePath = [[<span class="built_in">NSBundle</span> bundleForClass:[<span class="keyword">self</span> <span class="keyword">class</span>]].resourcePath</span><br><span class="line">                            stringByAppendingPathComponent:<span class="string">@"/SubModule_Use_Bundle.bundle"</span>];</span><br><span class="line"><span class="built_in">NSBundle</span> *resource_bundle = [<span class="built_in">NSBundle</span> bundleWithPath:bundlePath];</span><br><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"some-image"</span></span><br><span class="line">                                inBundle:resource_bundle</span><br><span class="line">           compatibleWithTraitCollection:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure><p>åœ¨ Example çš„ <code>ViewController</code> å†™ä¸€ä¸‹è·³è½¬ <code>SubModule/SMViewController</code>ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_pod-resource-reference-14.png" alt=""></p><p>è¿è¡Œä¹‹åï¼Œçœ‹ä¸€ä¸‹ï¼Œä¹Ÿèƒ½æ­£å¸¸è®¿é—®å›¾ç‰‡ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_pod-resource-reference-15.png" alt=""></p><h3 id="3-1-3-resources-å’Œ-resource-bundles-å¯¹äº-xcassets-çš„æ”¯æŒ"><a href="#3-1-3-resources-å’Œ-resource-bundles-å¯¹äº-xcassets-çš„æ”¯æŒ" class="headerlink" title="3.1.3 resources å’Œ resource_bundles å¯¹äº .xcassets çš„æ”¯æŒ"></a>3.1.3 resources å’Œ resource_bundles å¯¹äº .xcassets çš„æ”¯æŒ</h3><p>ä» 3.1 å’Œ 3.2 å¯ä»¥çœ‹å‡º resources å’Œ resource_bundles éƒ½å¯ä»¥å¾ˆå¥½çš„æ”¯æŒ .xcassets çš„å¼•ç”¨ã€‚</p><p>æ‰€ä»¥ï¼Œ<a href="http://blog.xianqu.org/2015/08/pod-resources/" target="_blank" rel="noopener">è¿™ç¯‡</a> æ–‡ç« ï¼Œé‡Œé¢æåˆ° resource_bundles ä¸èƒ½ä½¿ç”¨ .xcassets å¹¶ä¸å­˜åœ¨ã€‚åº”è¯¥è¯´è¿™ç¯‡æ–‡ç« å·²ç»æ¯”è¾ƒè€äº†ï¼Œ<strong>CocoaPods éšç€ä¸æ–­çš„æ›´æ–°ï¼Œ<code>resource_bundles</code> å·²ç»å¯ä»¥å¾ˆå¥½çš„æ”¯æŒ <code>.xcassets</code> äº†ã€‚</strong></p><h2 id="3-2-åŒåèµ„æºçš„å†²çªé—®é¢˜"><a href="#3-2-åŒåèµ„æºçš„å†²çªé—®é¢˜" class="headerlink" title="3.2 åŒåèµ„æºçš„å†²çªé—®é¢˜"></a>3.2 åŒåèµ„æºçš„å†²çªé—®é¢˜</h2><p>ä»ä¸Šé¢çš„åˆ†æå¯ä»¥çœ‹å‡ºï¼š</p><p>ä½¿ç”¨ <code>resources</code> ä¹‹ååªä¼šç®€å•çš„å°†èµ„æºæ–‡ä»¶ copy åˆ°ç›®æ ‡å·¥ç¨‹ï¼ˆExample å·¥ç¨‹ï¼‰ï¼Œæœ€åå’Œç›®æ ‡å·¥ç¨‹çš„å›¾ç‰‡æ–‡ä»¶ä»¥åŠå…¶ä»–åŒæ ·ä½¿ç”¨ <code>resources</code> çš„ Pod çš„å›¾ç‰‡æ–‡ä»¶ï¼Œç»Ÿä¸€ä¸€èµ·æ‰“åŒ…ä¸ºäº†ä¸€ä¸ª <code>Assets.car</code>ã€‚</p><p>ä½¿ç”¨ <code>resource_bundles</code> ä¹‹åä¼šä¸ºä¸ºæŒ‡å®šçš„èµ„æºæ‰“ä¸€ä¸ª <code>.bundle</code>ï¼Œ<code>.bundle</code>åŒ…å«ä¸€ä¸ª <code>Assets.car</code>ï¼Œè·å–å›¾ç‰‡çš„æ—¶å€™è¦ä¸¥æ ¼æŒ‡å®š <code>.bundle</code> çš„ä½ç½®ï¼Œå¾ˆå¥½çš„éš”ç¦»äº†å„ä¸ªåº“æˆ–è€…ä¸€ä¸ªåº“ä¸‹çš„èµ„æºåŒ…ã€‚</p><p>æ˜¾ç„¶ï¼Œä½¿ç”¨ <code>resources</code>ï¼Œå¦‚æœå‡ºç°åŒåçš„å›¾ç‰‡ï¼Œæ˜¾ç„¶æ˜¯ä¼šå‡ºç°å†²çªçš„ï¼ŒåŒæ ·ä½¿ç”¨ <code>some-image</code> åç§°çš„ä¸¤ä¸ªå›¾ç‰‡èµ„æºï¼Œä¸ä¸€å®šèƒ½æ­£ç¡®è°ƒç”¨åˆ°ã€‚</p><h4 id="3-2-1-ç®€å•éªŒè¯-resources-é‡åé—®é¢˜"><a href="#3-2-1-ç®€å•éªŒè¯-resources-é‡åé—®é¢˜" class="headerlink" title="3.2.1 ç®€å•éªŒè¯ resources é‡åé—®é¢˜"></a>3.2.1 ç®€å•éªŒè¯ resources é‡åé—®é¢˜</h4><p>ç»™ Example æ–‡ä»¶æ·»åŠ ä¸€ä¸ªåŒæ ·å« <code>some-image</code> çš„å›¾ç‰‡ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_pod-resource-reference-16.png" alt=""></p><p>OKï¼Œç°åœ¨çš„æƒ…å†µæ˜¯ Example å·¥ç¨‹è‡ªå·±æœ‰ä¸€ä¸ª <code>some-image</code> å›¾ç‰‡èµ„æºï¼ŒSubModule è¿™ä¸ª Pod åº“ä¹Ÿæœ‰ä¸€ä¸ª <code>some-image</code> å›¾ç‰‡èµ„æºã€‚</p><p>è¿˜æ˜¯ä¹‹å‰çš„æ˜¾ç¤ºå›¾ç‰‡çš„ä»£ç ï¼Œå†è¿è¡Œä¸€ä¸‹ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_pod-resource-reference-17.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå›¾ç‰‡æ˜¾ç„¶æ˜¯ç”¨é”™äº†ï¼Œæ˜¾ç¤ºäº† Example å·¥ç¨‹è‡ªå·±çš„ <code>some-image</code></p><p>è¿™å°±æ˜¯ resources çš„é‡åèµ„æºé—®é¢˜ã€‚</p><p>è€Œä½¿ç”¨ <code>resource_bundles</code> åˆ™å¯ä»¥å¾ˆå¥½çš„é¿å¼€è¿™ä¸ªé—®é¢˜ã€‚</p><h1 id="4-æ€»ç»“"><a href="#4-æ€»ç»“" class="headerlink" title="4. æ€»ç»“"></a>4. æ€»ç»“</h1><p><strong>resource_bundles ä¼˜ç‚¹ï¼š</strong></p><ol><li>å¯ä»¥ä½¿ç”¨ <code>.xcassets</code> æŒ‡å®šèµ„æºæ–‡ä»¶</li><li>å¯ä»¥é¿å…æ¯ä¸ªåº“å’Œä¸»å·¥ç¨‹ä¹‹é—´çš„åŒåèµ„æºå†²çª</li></ol><p><strong>resource_bundles ç¼ºç‚¹ï¼š</strong></p><ol><li>è·å–å›¾ç‰‡æ—¶å¯èƒ½éœ€è¦ä½¿ç”¨ç¡¬ç¼–ç çš„å½¢å¼æ¥è·å–ï¼š<code>[[NSBundle bundleForClass:[self class]].resourcePath stringByAppendingPathComponent:@&quot;/SubModule_Use_Bundle.bundle&quot;]</code></li></ol><p><strong>resources ä¼˜ç‚¹ï¼š</strong></p><ol><li>å¯ä»¥ä½¿ç”¨ <code>.xcassets</code> æŒ‡å®šèµ„æºæ–‡ä»¶</li></ol><p><strong>resources ç¼ºç‚¹ï¼š</strong></p><ol><li>ä¼šå¯¼è‡´æ¯ä¸ªåº“å’Œä¸»å·¥ç¨‹ä¹‹é—´çš„åŒåèµ„æºå†²çª</li><li>ä¸éœ€è¦ç”¨ç¡¬ç¼–ç æ–¹å¼è·å–å›¾ç‰‡ï¼š<code>[NSBundle bundleForClass:[self class]] compatibleWithTraitCollection:nil];</code></li></ol><p>Soï¼Œä¸€èˆ¬æ¥è¯´ä½¿ç”¨ <code>resource_bundles</code> ä¼šæ›´å¥½ï¼Œä¸è¿‡å…³äºç¡¬ç¼–ç ï¼Œè¿˜å¯ä»¥å†æ‰¾æ‰¾åˆ«çš„æ–¹å¼å»é¿å…ã€‚</p><h1 id="5-Demo"><a href="#5-Demo" class="headerlink" title="5. Demo"></a>5. Demo</h1><p>æœ¬æ–‡æ‰€æœ‰çš„ Demo ä»£ç éƒ½åœ¨ <a href="https://github.com/summertian4/iOS-ObjectiveC/tree/master/Pod-Resource-Reference" target="_blank" rel="noopener">è¿™é‡Œ</a></p><hr><p>æœ‰ä»€ä¹ˆé—®é¢˜éƒ½å¯ä»¥åœ¨åšæ–‡åé¢ç•™è¨€ï¼Œæˆ–è€…å¾®åšä¸Šç§ä¿¡æˆ‘ï¼Œæˆ–è€…é‚®ä»¶æˆ‘ <a href="mailto:&#99;&#x6f;&#100;&#101;&#x72;&#x66;&#x69;&#115;&#104;&#x40;&#x31;&#54;&#51;&#46;&#x63;&#x6f;&#109;" target="_blank" rel="noopener">&#99;&#x6f;&#100;&#101;&#x72;&#x66;&#x69;&#115;&#104;&#x40;&#x31;&#54;&#51;&#46;&#x63;&#x6f;&#109;</a>ã€‚</p><p>åšä¸»æ˜¯ iOS å¦¹å­ä¸€æšã€‚</p><p>å¸Œæœ›å¤§å®¶ä¸€èµ·è¿›æ­¥ã€‚</p><p>æˆ‘çš„å¾®åšï¼š<a href="http://weibo.com/coderfish/" target="_blank" rel="noopener">å°é±¼å‘¨å‡Œå®‡</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;1-èµ„æºæ–‡ä»¶å¼•ç”¨çš„æ–¹å¼&quot;&gt;&lt;a href=&quot;#1-èµ„æºæ–‡ä»¶å¼•ç”¨çš„æ–¹å¼&quot; class=&quot;headerlink&quot; title=&quot;1. èµ„æºæ–‡ä»¶å¼•ç”¨çš„æ–¹å¼&quot;&gt;&lt;/a&gt;1. èµ„æºæ–‡ä»¶å¼•ç”¨çš„æ–¹å¼&lt;/h1&gt;&lt;p&gt;åœ¨ç¬¬ä¸€èŠ‚ï¼Œå…ˆæ¥ä»‹ç»ä¸€ä¸‹ CocoaPods ä¸¤ç§èµ„æºæ–‡ä»¶å¼•ç”¨çš„æ–¹å¼â€”â€”&lt;code&gt;resource_bundles&lt;/code&gt; &amp;amp; &lt;code&gt;resources&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;1-1-resource-bundles&quot;&gt;&lt;a href=&quot;#1-1-resource-bundles&quot; class=&quot;headerlink&quot; title=&quot;1.1 resource_bundles&quot;&gt;&lt;/a&gt;1.1 resource_bundles&lt;/h2&gt;&lt;p&gt;&lt;code&gt;resource_bundles&lt;/code&gt; å…è®¸å®šä¹‰å½“å‰ Pod åº“çš„èµ„æºåŒ…çš„&lt;strong&gt;åç§°å’Œæ–‡ä»¶&lt;/strong&gt;ã€‚ç”¨ hash çš„å½¢å¼æ¥å£°æ˜ï¼Œkey æ˜¯ bundle çš„åç§°ï¼Œvalue æ˜¯éœ€è¦åŒ…æ‹¬çš„æ–‡ä»¶çš„é€šé… patternsã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;We strongly recommend library developers to adopt resource bundles as there can be name collisions using the resources attribute.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;CocoaPods å®˜æ–¹å¼ºçƒˆæ¨èä½¿ç”¨ &lt;code&gt;resource_bundles&lt;/code&gt;ï¼Œå› ä¸ºç”¨ key-value å¯ä»¥é¿å…ç›¸åŒåç§°èµ„æºçš„åç§°å†²çªã€‚&lt;/p&gt;
&lt;p&gt;åŒæ—¶å»ºè®® bundle çš„åç§°è‡³å°‘åº”è¯¥åŒ…æ‹¬ Pod åº“çš„åç§°ï¼Œå¯ä»¥å°½é‡å‡å°‘åŒåå†²çª&lt;/p&gt;
&lt;p&gt;Examples:&lt;/p&gt;
&lt;figure class=&quot;highlight ruby&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;spec.ios.resource_bundle = &amp;#123; &lt;span class=&quot;string&quot;&gt;&#39;MapBox&#39;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;string&quot;&gt;&#39;MapView/Map/Resources/*.png&#39;&lt;/span&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight ruby&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;spec.resource_bundles = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&#39;MapBox&#39;&lt;/span&gt; =&amp;gt; [&lt;span class=&quot;string&quot;&gt;&#39;MapView/Map/Resources/*.png&#39;&lt;/span&gt;],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&#39;OtherResources&#39;&lt;/span&gt; =&amp;gt; [&lt;span class=&quot;string&quot;&gt;&#39;MapView/Map/OtherResources/*.png&#39;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ä¸€å‘¨é˜…è¯»åˆ—è¡¨-2018</title>
    <link href="http://zhoulingyu.com/2018/01/08/%E4%B8%80%E5%91%A8%E9%98%85%E8%AF%BB%E5%88%97%E8%A1%A8-2018/"/>
    <id>http://zhoulingyu.com/2018/01/08/ä¸€å‘¨é˜…è¯»åˆ—è¡¨-2018/</id>
    <published>2018-01-08T18:36:00.000Z</published>
    <updated>2018-07-10T03:07:31.632Z</updated>
    
    <content type="html"><![CDATA[<h1 id="2018-å¹´-1-æœˆ-1-æ—¥"><a href="#2018-å¹´-1-æœˆ-1-æ—¥" class="headerlink" title="2018 å¹´ 1 æœˆ 1 æ—¥ +"></a>2018 å¹´ 1 æœˆ 1 æ—¥ +</h1><p><a href="https://mp.weixin.qq.com/s/SqEHBOZUZ6UzFhrccLm39A" target="_blank" rel="noopener">ç†è§£æ¯”ç‰¹å¸(BitCoin)èƒŒåçš„åŒºå—é“¾æŠ€æœ¯ï¼Œè¿™ä¸€ç¯‡æ–‡ç« å°±å¤Ÿäº†</a></p><p><a href="http://xiangwangfeng.com/2018/01/08/WCDB-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" target="_blank" rel="noopener">WCDB æºç è§£æ</a></p><p><del><a href="https://www.jianshu.com/p/01126437e8a4" target="_blank" rel="noopener">Djangoæƒé™æœºåˆ¶çš„å®ç°</a></del></p><p><del><a href="https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/0014319106919344c4ef8b1e04c48778bb45796e0335839000" target="_blank" rel="noopener">ä½¿ç”¨å…ƒç±»</a></del></p><p><del><a href="https://blog.seedlab.io/understanding-responder-chain/" target="_blank" rel="noopener">Understanding Responder Chain</a></del></p><p><del><a href="https://cloud.tencent.com/developer/article/1006222" target="_blank" rel="noopener">iOS ç”µé‡æµ‹è¯•å®è·µ</a></del></p><p><del><a href="https://github.com/aozhimin/iOS-Monitor-Platform#power-consumption" target="_blank" rel="noopener">iOS æ€§èƒ½ç›‘æ§ SDK â€”â€” Wedjatï¼ˆåç‹„ç‰¹ï¼‰å¼€å‘è¿‡ç¨‹çš„è°ƒç ”å’Œæ•´ç†</a></del></p><p><del><a href="http://liujinlongxa.com/2016/12/20/%E4%BD%BF%E7%94%A8NSURLProtocol%E6%B3%A8%E6%84%8F%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/" target="_blank" rel="noopener">ä½¿ç”¨NSURLProtocolæ—¶è¦æ³¨æ„çš„ä¸€äº›é—®é¢˜</a></del></p><h1 id="2018-å¹´-6-æœˆ-1-æ—¥"><a href="#2018-å¹´-6-æœˆ-1-æ—¥" class="headerlink" title="2018 å¹´ 6 æœˆ 1 æ—¥ +"></a>2018 å¹´ 6 æœˆ 1 æ—¥ +</h1><p><a href="https://github.com/youngwind/blog/issues/108" target="_blank" rel="noopener">å›¾è§£ HTTPSï¼šCharles æ•è· HTTPS çš„åŸç†</a></p><p><a href="http://blog.joyingx.me/2015/05/03/NSMutableArray%20%E5%8E%9F%E7%90%86%E6%8F%AD%E9%9C%B2/" target="_blank" rel="noopener">NSMutableArrayåŸç†æ­éœ²</a></p><p><a href="http://gilnuy.github.io/2016/12/20/%E6%8E%A2%E7%A9%B6NSMutableDictinory%E5%92%8CNSMutableArray%E7%9A%84%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" target="_blank" rel="noopener">æ¢ç©¶NSMutableArrayçš„å®ç°åŸç†</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;2018-å¹´-1-æœˆ-1-æ—¥&quot;&gt;&lt;a href=&quot;#2018-å¹´-1-æœˆ-1-æ—¥&quot; class=&quot;headerlink&quot; title=&quot;2018 å¹´ 1 æœˆ 1 æ—¥ +&quot;&gt;&lt;/a&gt;2018 å¹´ 1 æœˆ 1 æ—¥ +&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://m
      
    
    </summary>
    
      <category term="Other" scheme="http://zhoulingyu.com/categories/Other/"/>
    
      <category term="é˜…è¯»åˆ—è¡¨" scheme="http://zhoulingyu.com/categories/Other/%E9%98%85%E8%AF%BB%E5%88%97%E8%A1%A8/"/>
    
    
      <category term="Other" scheme="http://zhoulingyu.com/tags/Other/"/>
    
      <category term="ReadList" scheme="http://zhoulingyu.com/tags/ReadList/"/>
    
  </entry>
  
  <entry>
    <title>iOS çµæ´»çš„ æ¨¡å—åŒ–/ç»„ä»¶åŒ– å·¥å…·ä¸è§„èŒƒ Lotusoot è§£è¯´</title>
    <link href="http://zhoulingyu.com/2017/11/29/iOS-modularized-tool-Lotusoot/"/>
    <id>http://zhoulingyu.com/2017/11/29/iOS-modularized-tool-Lotusoot/</id>
    <published>2017-11-29T10:40:41.000Z</published>
    <updated>2018-07-10T03:07:31.628Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å¼€ç¯‡"><a href="#å¼€ç¯‡" class="headerlink" title="å¼€ç¯‡"></a>å¼€ç¯‡</h1><p>ä¸Šä¸€ç¯‡<a href="http://zhoulingyu.com/2017/11/24/iOS-Modularization/">ã€ŠiOS æ··ç¼– æ¨¡å—åŒ–/ç»„ä»¶åŒ– ç»éªŒæŒ‡åŒ—ã€‹</a>ä¸­ä»‹ç»åˆ°çš„ <a href="https://github.com/Vegetarians/Lotusoot" target="_blank" rel="noopener">Lotusoot</a> ï¼Œå°†åœ¨æœ¬ç¯‡ä¸­åšä¸€ä¸ªæ›´ä¸ºè¯¦ç»†çš„ä»‹ç»ã€‚</p><p>æœ€åˆ <a href="https://github.com/Vegetarians/Lotusoot" target="_blank" rel="noopener">Lotusoot</a> ç®€ç§°ä¸ºã€æ··ç¼–è·¯ç”±ã€ï¼Œä½†æ˜¯éšååè€Œæ›²è§£äº†å®ƒçš„åŠŸèƒ½ï¼Œå…¶çœŸæ­£çš„å®šä½æ˜¯ã€æ¨¡å—åŒ–å·¥å…·å’Œè§„èŒƒã€ã€‚</p><p> <a href="https://github.com/Vegetarians/Lotusoot" target="_blank" rel="noopener">Lotusoot</a> å¯ä»¥åšåˆ°ï¼š</p><ol><li>æ¨¡å—é—´ã€æ¨¡å—å†…æœåŠ¡è°ƒç”¨</li><li>Swiftã€OCã€æˆ–è€…ä¸¤è€…æ··ç¼–é¡¹ç›®å‡å¯ä½¿ç”¨</li><li>çŸ­é“¾æ³¨å†Œã€è·¯ç”±è°ƒç”¨</li><li>è„šæœ¬è‡ªåŠ¨æ³¨å†ŒæœåŠ¡/è·¯ç”±è¡¨</li></ol><blockquote><p>æ³¨ï¼šè¿™é‡Œçš„æ¨¡å—åŒ–ï¼Œä¹Ÿå°±æ˜¯å¤§å®¶è¯´çš„ã€ç»„ä»¶åŒ–ã€ï¼Œä¸æ˜¯åœ¨ä¸»å·¥ç¨‹ç”¨æ–‡ä»¶å¤¹åˆ†æ¨¡å—ï¼Œè€Œæ˜¯æŒ‡å°†ç‹¬ç«‹æ¨¡å—æŠ½è°ƒæˆ CocoaPods åº“ã€æˆ–è€…å…¶ä»–å½¢å¼çš„åº“æ–‡ä»¶ï¼Œæˆä¸ºä¸€ä¸ªç‹¬ç«‹å·¥ç¨‹ã€‚<br>ä¸‹æ–‡ä¸­çš„æ¨¡å—å°±ä»£è¡¨ä¸€ä¸ª CocoaPods åº“</p></blockquote><a id="more"></a><h1 id="æ¨¡å—åŒ–è§£è€¦â€”â€”è·¯ç”±-or-æœåŠ¡è°ƒç”¨ï¼Ÿ"><a href="#æ¨¡å—åŒ–è§£è€¦â€”â€”è·¯ç”±-or-æœåŠ¡è°ƒç”¨ï¼Ÿ" class="headerlink" title="æ¨¡å—åŒ–è§£è€¦â€”â€”è·¯ç”± or æœåŠ¡è°ƒç”¨ï¼Ÿ"></a>æ¨¡å—åŒ–è§£è€¦â€”â€”è·¯ç”± or æœåŠ¡è°ƒç”¨ï¼Ÿ</h1><p>å…³äºæ¨¡å—åŒ–ï¼Œå¤§å¤šæ•°äººçš„ç¬¬ä¸€ååº”æ˜¯åˆ¶ä½œè·¯ç”±ã€æ³¨å†ŒçŸ­é“¾ã€è°ƒç”¨çŸ­é“¾ï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼æ¥å»è€¦ï¼Œæ¥å®ç°æ¨¡å—é—´çš„é¡µé¢è·³è½¬ã€æœåŠ¡è°ƒç”¨ã€‚ç±»ä¼¼ <a href="https://github.com/meili/MGJRouter" target="_blank" rel="noopener">MGJRouter</a> ä¸€ç±»çš„åº“å°±æ˜¯åŸºäºè¿™æ ·çš„æ€æƒ³ã€‚</p><p>ä½†æˆ‘ä¹Ÿéå¸¸è®¤å¯ <a href="https://casatwy.com/" target="_blank" rel="noopener">casa</a> åœ¨åé©³ä½¿ç”¨ URL ä½œä¸ºæ¨¡å—åŒ–æ ¸å¿ƒçš„ç†ç”±ã€‚å³ï¼šã€çŸ­é“¾çš„å®è´¨è¿˜æ˜¯é€šè¿‡ URL æ¥è°ƒç”¨æœåŠ¡æˆ–è€…æ‰“å¼€é¡µé¢ï¼Œåè€Œä¸å¦‚å­—ç¬¦ä¸²ç›´æ¥ï¼Œåè€Œå¢åŠ äº† URL æœ¬èº«çš„ç»´æŠ¤æˆæœ¬ã€ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬åº”å½“å›å½’æ¨¡å—åŒ–çš„æœ¬è´¨ã€‚æˆ‘ä»¬æ¨¡å—åŒ–çš„æœ€åˆçš„ç›®çš„å¾€å¾€æ˜¯ä¸ºäº†ï¼š</p><ol><li>ä»£ç æ‹†åˆ†ï¼Œå°†<strong>å…³è”æ€§å¼ºçš„åŸºç¡€æœåŠ¡ä»£ç </strong>æˆ–è€…<strong>ä¸šåŠ¡ä»£ç </strong>æŠ½è°ƒåœ¨ä¸€èµ·ï¼Œå•ç‹¬å°ç‰ˆï¼Œç‹¬ç«‹å¼€å‘</li><li>é˜²æ­¢ä¸»å·¥ç¨‹è¶Šæ¥è¶Šå¤§ï¼Œå˜å¾—è‡ƒè‚¿</li></ol><p>ç›¸å¯¹åº”çš„ï¼Œæ¨¡å—åŒ–éœ€è¦çš„åŠŸèƒ½æ˜¯ï¼š</p><ol><li>æä¾›å¤šä¸ªåº“ä¹‹é—´çš„æœåŠ¡è°ƒç”¨</li><li>ä¿æŒåº“ä¸åº“ä¹‹é—´çš„ç‹¬ç«‹ã€éå¼ºä¾èµ–</li></ol><p>æ‰€ä»¥ï¼Œæ€»çš„æ¥è¯´ï¼Œæ¨¡å—åŒ–çš„é‡ç‚¹è¿˜æ˜¯å¦‚ä½•<strong>å»é™¤å¤šä¸ªæ¨¡å—ä¹‹é—´çš„è€¦åˆï¼Œè®©æ¯ä¸ªæ¨¡å—åœ¨ä¸å¼ºä¾èµ–çš„æƒ…å†µä¸‹å¯ä»¥è°ƒç”¨å…¶ä»–æ¨¡å—çš„æœåŠ¡</strong>ã€‚</p><p><strong>URL çŸ­é“¾ã€ç”šè‡³æ˜¯è·¯ç”±ã€éƒ½ä¸æ˜¯æ¨¡å—åŒ–é‡ç‚¹ä¹‹å¤„ã€‚</strong>è·¯ç”±åªè¦ä½ æƒ³ï¼Œéƒ½å¯ä»¥é€šè¿‡æœåŠ¡æ³¨å†Œå®ç°ã€‚</p><blockquote><p>æ³¨ï¼šã€ä¸å¼ºä¾èµ–ã€æŒ‡çš„æ˜¯ï¼Œæ¨¡å—A è°ƒç”¨ æ¨¡å—B ä¸éœ€è¦åœ¨ Pod ä¾èµ–ä¸­å†™å‡ºå¯¹ B çš„ä¾èµ–ï¼Œæˆ–è€…ç®€å•çš„è®¤ä¸ºï¼Œæ¨¡å—A çš„ä»£ç ä¸­ä¸å‡ºç° <code>import B</code>ã€‚</p></blockquote><h1 id="å…¬å…±æ¨¡å—å’Œä¾èµ–å…³ç³»"><a href="#å…¬å…±æ¨¡å—å’Œä¾èµ–å…³ç³»" class="headerlink" title="å…¬å…±æ¨¡å—å’Œä¾èµ–å…³ç³»"></a>å…¬å…±æ¨¡å—å’Œä¾èµ–å…³ç³»</h1><p>Lotusoot æ˜¯è¿™æ ·è§£è€¦çš„ï¼š</p><h2 id="1-Lotus"><a href="#1-Lotus" class="headerlink" title="1. Lotus"></a>1. Lotus</h2><p>åˆ›å»ºä¸€ä¸ª PublicModuleï¼Œå…¶ä¸­å­˜æ”¾å„ä¸ªæ¨¡å—çš„ Lotusï¼ŒLotus å…¶å®å°±æ˜¯åè®®ï¼Œå®šä¹‰äº†æ¯ä¸ªæ¨¡å—å¯ä»¥æä¾›çš„æœåŠ¡ï¼ˆå³å¯ä»¥è°ƒç”¨çš„æ–¹æ³•ï¼‰ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">AccountLotus</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">login</span><span class="params">(username: String, password: String, complete: <span class="params">(Error?)</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">register</span><span class="params">(username: String, password: String, complete: <span class="params">(Error?)</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">email</span><span class="params">(username: String)</span></span> -&gt; <span class="type">String</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">showLoginVC</span><span class="params">(username: String, password: String)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-Lotusoot"><a href="#2-Lotusoot" class="headerlink" title="2. Lotusoot"></a>2. Lotusoot</h2><p>åœ¨å„ä¸ªæ¨¡å—ä¸­ï¼Œå®ç° PublicModule ä¸­å¯¹åº”çš„ Lotusï¼Œå³å…·ä½“çš„æœåŠ¡ç±»ï¼Œç§°ä¸º Lotusootã€‚<br>Lotusoot ä¸­å…·ä½“å®ç°äº†æœåŠ¡çš„é€»è¾‘ï¼Œå¹¶åœ¨ <strong>æ³¨è§£</strong> ä¸­è¡¨æ˜äº†æ¨¡å—çš„ <code>å‘½åç©ºé—´-@NameSpace</code>ã€<code>Lotusoot-@Lotusoot</code>ã€<code>Lotus-@Lotus</code>ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @NameSpace(TestAccountModule)</span></span><br><span class="line"><span class="comment">// @Lotusoot(AccountLotusoot)</span></span><br><span class="line"><span class="comment">// @Lotus(AccountLotus)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountLotusoot</span>: <span class="title">NSObject</span>, <span class="title">AccountLotus</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">email</span><span class="params">(username: String)</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">OtherService</span>.email(username: <span class="string">"zhoulingyu"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">login</span><span class="params">(username: String, password: String, complete: <span class="params">(Error?)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        <span class="type">LoginService</span>.login(username: username, password: password, complete: complete)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">register</span><span class="params">(username: String, password: String, complete: <span class="params">(Error?)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        <span class="type">RegisterService</span>.register(username: username, password: password, complete: complete)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">showLoginVC</span><span class="params">(username: String, password: String)</span></span> &#123;</span><br><span class="line">        <span class="comment">// å¯ä»¥ç”¨ä½ ä»¬å–œæ¬¢çš„éè€¦åˆæ–¹å¼å¤„ç†è·³è½¬</span></span><br><span class="line">        <span class="comment">// æˆ–è€…ä¼ å…¥ rootvc</span></span><br><span class="line">        <span class="comment">// æ›´å¥½çš„æ–¹å¼æ˜¯è‡ªå·±çš„éè€¦åˆ UI è·³è½¬å¤„ç†æ¨¡å—</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"show login view controller"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨è§£æ˜¯éå¿…é¡»çš„ï¼Œæ³¨è§£æ˜¯ä¸ºäº† <code>Lotusoot.py</code> å¯ä»¥æ‰«æ Lotusoot è‡ªåŠ¨æ³¨å†Œï¼Œåé¢ä¸€èŠ‚å°†ä¼šè¯´åˆ°ã€‚å¦‚æœä½ ä¸æƒ³ä½¿ç”¨è‡ªåŠ¨æ³¨å†Œï¼Œä¹Ÿå¯ä»¥é€‰æ‹©æ‰‹åŠ¨æ³¨å†Œã€‚</p><blockquote><p>æ³¨ï¼šè¿™é‡Œåšä¸€ç‚¹è§£é‡Šï¼Œã€åè®®-æœåŠ¡ç±»ã€å³ã€Lotus-Lotusootã€çš„å‘½åç”±æ¥çº¯å±å–ä¸ªèŒï¼Œå› ä¸ºï¼Œåè®®æ˜¯æš´éœ²å¤–éƒ¨çš„ï¼Œæ‰€ä»¥å«è²èŠ±ï¼Œè€Œå…·ä½“å®ç°çš„æœåŠ¡ç±»è‡ªç„¶å°±æ˜¯è²è—•ï¼ˆLoutsootï¼‰äº†ã€‚</p></blockquote><h2 id="3-è‡ªåŠ¨æ³¨å†Œ-or-æ‰‹åŠ¨æ³¨å†Œ"><a href="#3-è‡ªåŠ¨æ³¨å†Œ-or-æ‰‹åŠ¨æ³¨å†Œ" class="headerlink" title="3. è‡ªåŠ¨æ³¨å†Œ or æ‰‹åŠ¨æ³¨å†Œ"></a>3. è‡ªåŠ¨æ³¨å†Œ or æ‰‹åŠ¨æ³¨å†Œ</h2><p>å¦‚æœä½¿ç”¨äº†æ³¨è§£ï¼Œå¯ä»¥è‡ªåŠ¨æ³¨å†Œæ‰€æœ‰æœåŠ¡ï¼Œåªéœ€è¦ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="type">LotusootCoordinator</span>.registerAll()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå…ˆæ‰‹åŠ¨æ³¨å†Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[LotusootCoordinator registerWithLotusoot:[AppDelegateLotusoot new] lotusName:<span class="string">@"AppDelegateLotus"</span>];</span><br><span class="line">    [LotusootCoordinator registerWithLotusoot:[MainLotusoot new] lotusName:<span class="string">@"MainLotus"</span>];</span><br></pre></td></tr></table></figure><p>ä¸è¿‡æ‰‹åŠ¨æ³¨å†Œå°±æ˜¯å»äº†ä½¿ç”¨ Lotusoot çš„æ„ä¹‰äº†ï¼Œæ‰€ä»¥åœ¨æ— æ³•æ»¡è¶³æ¡ä»¶æ—¶å†ä½¿ç”¨æ‰‹åŠ¨æ³¨å†Œï¼ˆæ¯”å¦‚ç›®å‰ 0.0.2 ç‰ˆæœ¬çš„ Lotusootï¼Œä¸»å·¥ç¨‹å¦‚æœæœ‰å¤š Targetï¼Œæ˜¯æ— æ³•åŠ¨æ€è·å– Target åï¼Œå¯¼è‡´æ— æ³•æ­£ç¡®è·å–å‘½åç©ºé—´ï¼Œåå°„åˆ°ç±»ï¼Œå½“ç„¶é™¤å·¥ç¨‹ï¼Œå„ä¸ªæ¨¡å—ç”±äºä½¿ç”¨ CocoaPos ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚ä¸‹ä¸€ä¸ªç‰ˆæœ¬ Lotusoot å°†ä¼šé‡ç‚¹è§£å†³è¿™ä¸ªé—®é¢˜ï¼‰</p><h2 id="4-å…³ç³»å›¾"><a href="#4-å…³ç³»å›¾" class="headerlink" title="4. å…³ç³»å›¾"></a>4. å…³ç³»å›¾</h2><p>é€šè¿‡ Lotusoot æ­å»ºçš„å·¥ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS-modularized-tool-Lotusoot-003.png" alt=""></p><p>æ‰€æœ‰æ¨¡å—åªéœ€è¦ä¾èµ– PublicModuleï¼Œé€šè¿‡ PublicMoudle ä¸‹çš„ Lotusoot å³å¯è°ƒç”¨å…¶ä»–æ¨¡å—çš„æœåŠ¡ã€‚å®ä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> loginLotus = s(<span class="type">LoginLotus</span>.<span class="keyword">self</span>) </span><br><span class="line"><span class="keyword">let</span> loginModule: <span class="type">LoginLotus</span> = <span class="type">LotusootCoordinator</span>.lotusoot(lotus: loginLotus) <span class="keyword">as</span>! <span class="type">LoginLotus</span></span><br><span class="line">loginModule.login(username: <span class="string">"test"</span>, password: <span class="string">"test"</span>, complete:<span class="literal">nil</span>)</span><br></pre></td></tr></table></figure><p>OC ä¸­ä½¿ç”¨ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">id</span>&lt;LoginLotus&gt; loginModule = [LotusootCoordinator lotusootWithLotus:<span class="string">@"LoginLotus"</span>];</span><br><span class="line">[loginModule login:<span class="string">@"test"</span> password:<span class="string">@"test"</span> complete:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure><h1 id="Lotusoot-æ˜¯å¦‚ä½•å®ç°è‡ªåŠ¨æ³¨å†ŒæœåŠ¡çš„ï¼Ÿåœ¨ä»€ä¹ˆæ—¶æœºï¼Ÿ"><a href="#Lotusoot-æ˜¯å¦‚ä½•å®ç°è‡ªåŠ¨æ³¨å†ŒæœåŠ¡çš„ï¼Ÿåœ¨ä»€ä¹ˆæ—¶æœºï¼Ÿ" class="headerlink" title="Lotusoot æ˜¯å¦‚ä½•å®ç°è‡ªåŠ¨æ³¨å†ŒæœåŠ¡çš„ï¼Ÿåœ¨ä»€ä¹ˆæ—¶æœºï¼Ÿ"></a>Lotusoot æ˜¯å¦‚ä½•å®ç°è‡ªåŠ¨æ³¨å†ŒæœåŠ¡çš„ï¼Ÿåœ¨ä»€ä¹ˆæ—¶æœºï¼Ÿ</h1><p>è¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯åœ¨ç¼–å†™ Lotusoot æœ€åˆé‡ç‚¹è€ƒè™‘çš„é—®é¢˜ã€‚åŸå› æ˜¯ Swift æ²¡æœ‰ <code>+(void)load</code>ã€‚</p><p>å¤§æ¦‚æ˜¯æ¯ä¸ªç”¨ Swift å¼€å‘æ¨¡å—è·¯ç”±å’Œè§£è€¦å·¥å…·çš„äººéƒ½çº ç»“è¿‡çš„é—®é¢˜ã€‚</p><h2 id="1-OC-ä¸­å¸¸è§çš„è§£å†³æ–¹æ¡ˆ"><a href="#1-OC-ä¸­å¸¸è§çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="1. OC ä¸­å¸¸è§çš„è§£å†³æ–¹æ¡ˆ"></a>1. OC ä¸­å¸¸è§çš„è§£å†³æ–¹æ¡ˆ</h2><p>å…ˆè¯´è¯´é€šå¸¸ OC çš„è·¯ç”±æˆ–è€…è§£è€¦ï¼Œéƒ½æ˜¯åœ¨ <code>+(void)load</code> æ³¨å†Œç±»æœåŠ¡çš„ï¼Œå¤§è‡´çš„åšæ³•ç±»ä¼¼äºï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">void</span>)load &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        [[Router shared] map:<span class="string">@"LoginViewController"</span> toController:[<span class="keyword">self</span> <span class="keyword">class</span>]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">void</span>)load &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        [[ServiceManager shared] <span class="keyword">register</span>:<span class="string">@"LoginService"</span> toService:[<span class="keyword">self</span> <span class="keyword">class</span>]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œå³ä½¿æ˜¯åœ¨æ¯ä¸ªæ¨¡å—å†…ï¼Œä¹Ÿå¯ä»¥æ­£å¸¸æ³¨å†Œè‡ªå·±çš„æœåŠ¡ã€‚è€Œä¸»å·¥ç¨‹å’Œå…¶ä»–æ¨¡å—è°ƒç”¨åªéœ€è¦é€šè¿‡å­—ç¬¦ä¸²è°ƒç”¨å³å¯ã€‚</p><h2 id="2-Swift-ä¸­çš„ç—›ç‚¹"><a href="#2-Swift-ä¸­çš„ç—›ç‚¹" class="headerlink" title="2. Swift ä¸­çš„ç—›ç‚¹"></a>2. Swift ä¸­çš„ç—›ç‚¹</h2><p>ç”±äº Swift æ˜¯æ²¡æœ‰ <code>+(void)load</code> çš„ï¼Œä¹Ÿæ²¡æœ‰å…¶ä»–å¯é çš„æ–¹æ³•å¯ä»¥æ›¿ä»£ï¼Œé‚£ä¹ˆåŠ¿å¿…éœ€è¦åœ¨ä¸»å·¥ç¨‹ä¸­åŠ å…¥æ³¨å†Œè·¯ç”±è¿™ä¸€æ­¥éª¤ï¼Œé€šå¸¸å¯ä»¥æ”¾åœ¨ <code>didFinishLaunchingWithOptions</code>ï¼Œå› ä¸ºä¸»æ¨¡å—å¯ä»¥è°ƒåˆ°æ‰€æœ‰æ¨¡å—çš„ç±»ã€‚é‚£ä¹ˆéšä¹‹è€Œæ¥çš„é—®é¢˜å°±æ˜¯ï¼Œä½ å¯èƒ½ä¼šå‡ºç°è¿™æ ·å¸¸å¸¸çš„ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ServiceManager</span>().register(<span class="string">"LoginService"</span>, toService:<span class="type">LoginService</span>.<span class="keyword">self</span>)</span><br><span class="line"><span class="type">ServiceManager</span>().register(<span class="string">"UserCenterService"</span>, toService:<span class="type">UserCenterService</span>.<span class="keyword">self</span>)</span><br><span class="line"><span class="type">ServiceManager</span>().register(<span class="string">"HistoryService"</span>, toService:<span class="type">HistoryService</span>.<span class="keyword">self</span>)</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>å¯èƒ½ä¼šæœ‰ä¸€å¼ é•¿é•¿çš„åˆ—è¡¨ï¼Œè€Œä¸”ç”±äºæœåŠ¡éƒ½åˆ†æ•£åœ¨å„ä¸ªæ¨¡å—ï¼Œä½†æ˜¯å´é›†ä¸­åœ¨ä¸»æ¨¡å—ï¼Œå¾€å¾€éš¾ä»¥çœ‹åˆ°è·¯ç”±è¡¨å’ŒæœåŠ¡ç±»çš„å…³è”ï¼Œè¡¨å¾ä¸å¤Ÿæ˜æ˜¾ã€å…³ç³»ä¸å¤Ÿå¼ºçƒˆã€‚</p><h2 id="3-Lotusoot-çš„è§£å†³æ–¹æ¡ˆ"><a href="#3-Lotusoot-çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="3. Lotusoot çš„è§£å†³æ–¹æ¡ˆ"></a>3. Lotusoot çš„è§£å†³æ–¹æ¡ˆ</h2><p>æœ‰ä»€ä¹ˆæ›´å¥½çš„åŠæ³•æ³¨å†Œï¼Ÿ<a href="http://www.jianshu.com/u/2d46948e84e3" target="_blank" rel="noopener">mmoaay</a> ç»™äº†æˆ‘ä¸€ä¸ªç°å¸¸æ£’çš„å»ºè®®ï¼Œå‚è€ƒ <a href="https://github.com/mac-cain13/R.swift" target="_blank" rel="noopener">R.swift</a> çš„åšæ³•ï¼Œé€šè¿‡è„šæœ¬ï¼Œæ¥å®Œæˆè‡ªåŠ¨æ³¨å†Œã€‚</p><blockquote><p><a href="https://github.com/mac-cain13/R.swift" target="_blank" rel="noopener">R.swift</a> çš„æä¾›çš„åŠŸèƒ½æ˜¯ï¼Œå¯ä»¥è®©ä½¿ç”¨çš„ iOSer å¯ä»¥åƒå¼€å‘ Android çš„ä¸€æ ·è°ƒç”¨å›¾ç‰‡ã€å­—ç¬¦ä¸²ã€éŸ³é¢‘ç­‰ç­‰èµ„æºæ–‡ä»¶ã€‚åœ¨ Project ä¸­æ’å…¥ Run Scriptï¼Œè¿™ä¸ªè„šæœ¬å¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µæ‰«ææ•´ä¸ªå·¥ç¨‹ï¼Œåˆ—ç®—æ‰€æœ‰çš„èµ„æºæ–‡ä»¶ï¼Œæœ€åç”Ÿæˆä¸€ä¸ª <code>R.generated.swift</code> æ–‡ä»¶ï¼Œå°±åƒè¿™ä¸ªæ ·å­ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS-modularized-tool-Lotusoot-001.png" alt=""></p><p>ä½¿ç”¨çš„æ—¶å€™å°±å¯ä»¥ï¼š</p><p><img src="https://github.com/mac-cain13/R.swift/raw/master/Documentation/Images/DemoUseImage.gif" alt=""></p></blockquote><p><strong>åŒæ · Lotusoot é€šè¿‡ä¸€ä¸ª python è„šæœ¬ï¼Œåœ¨ã€Compile Sourceã€ä¹‹å‰æ‰«æå·¥ç¨‹ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œæ‰¾å‡º Lotusoot å’Œ Lotus å¯¹åº”å…³ç³»ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ª <code>Lotusoot.plist</code> æ–‡ä»¶</strong>ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS-modularized-tool-Lotusoot-004.png" alt=""></p><p>å¦‚ä½•è¯†åˆ« Lotusï¼Ÿ</p><p>ç›®å‰ï¼ŒLotusoot ä½¿ç”¨äº†å¾ˆ Low çš„æ–¹å¼ï¼Œåœ¨æ³¨è§£ä¸­è¡¨æ˜äº†æ¨¡å—çš„ <code>å‘½åç©ºé—´-@NameSpace</code>ã€<code>Lotusoot-@Lotusoot</code>ã€<code>Lotus-@Lotus</code>ï¼Œè„šæœ¬å°±å¯ä»¥è¯†åˆ«ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS-modularized-tool-Lotusoot-002.png" alt=""></p><p>æ‰€ä»¥ï¼Œ<code>didFinishLaunchingWithOptions</code> åªéœ€è¦ä¸€å¥ï¼Œå³å¯è‡ªåŠ¨æ³¨å†Œè·¯ç”±ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">LotusootCoordinator</span>.registerAll()</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆä½¿ç”¨è„šæœ¬è§£å†³ï¼Ÿæ˜¯å› ä¸ºåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‰€æœ‰çš„è§£è€¦å·¥å…·æˆ–è€…è·¯ç”±éƒ½æ˜¯é€šè¿‡ç¨‹åºå‘˜æ‰‹åŠ¨å»å†™ä»£ç æ·»åŠ è·¯ç”±ï¼Œä¸ç®¡æ˜¯åœ¨ <code>+ (void)load</code> ä¸­æ³¨å†Œä¹Ÿå¥½ï¼Œåœ¨ç¨‹åºå¯åŠ¨åæ³¨å†Œä¹Ÿå¥½ï¼Œéƒ½æ˜¯æœ‰ç¨‹åºå‘˜æ‰‹åŠ¨ç®¡ç†çš„ã€‚ä½¿ç”¨è„šæœ¬æ˜¯å¸Œæœ›åœ¨ç¼–è¯‘é˜¶æ®µå‰ï¼Œå°±å‡†å¤‡å¥½æ‰€æœ‰çš„ã€åè®®-æœåŠ¡ç±»ã€å¯¹åº”å…³ç³»è¡¨ï¼Œåœ¨ç¨‹åºå¯åŠ¨åé€šè¿‡è¿™å¼ è¡¨è‡ªåŠ¨æ³¨å†Œï¼Œ<strong>å®ç°ç¨‹åºå‘˜ä¸æ‰‹åŠ¨æ³¨å†Œã€å®Œå…¨æ— æ„Ÿ</strong>ã€‚æˆ‘è§‰å¾—è¿™æ‰æ˜¯çœŸæ­£çš„è§£è€¦å·¥å…·åº”å½“å…·å¤‡çš„åŠŸèƒ½ã€‚</p><h1 id="Lotusoot-çš„é‡å¤§ç¼ºç‚¹å’Œä¸‹ä¸€ç‰ˆæœ¬ç›®æ ‡"><a href="#Lotusoot-çš„é‡å¤§ç¼ºç‚¹å’Œä¸‹ä¸€ç‰ˆæœ¬ç›®æ ‡" class="headerlink" title="Lotusoot çš„é‡å¤§ç¼ºç‚¹å’Œä¸‹ä¸€ç‰ˆæœ¬ç›®æ ‡"></a>Lotusoot çš„é‡å¤§ç¼ºç‚¹å’Œä¸‹ä¸€ç‰ˆæœ¬ç›®æ ‡</h1><p>Lotusoot çš„ç¼ºç‚¹æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œè™½ç„¶é€šè¿‡è„šæœ¬å¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µåˆ›å»ºå¥½ã€åè®®-æœåŠ¡ç±»ã€å…³ç³»è¡¨ã€‚ä½† <code>Lotusoot.py</code> è¯†åˆ«ã€åè®®-æœåŠ¡ç±»ã€æ˜¯é€šè¿‡æ³¨è§£æ¥çš„ï¼Œè€Œè¿™é‡Œçš„æ³¨è§£å…¶å®å°±æ˜¯æ³¨é‡Šï¼Œä¸èƒ½ç¼–è¯‘æ£€æµ‹é”™è¯¯ï¼ŒåŠæ—¶è¯¯å†™é”™ä¹Ÿæ— æ³•åŠæ—¶æ£€æŸ¥å‡ºé—®é¢˜ã€‚å¦‚æœè§£å†³äº†è¿™ä¸€ç—›ç‚¹ï¼Œå°±å¯ä»¥ç›¸å¯¹å®Œç¾çš„è§£å†³äº† Swift çš„æ¨¡å—åŒ–æ–¹æ¡ˆã€‚</p><p>ç›®å‰çš„æ€è·¯å¦‚ä¸‹ï¼š</p><p>å°è¯•é€šè¿‡å…¨å±€æ–¹æ³•æˆ–æ˜¯å…¶ä»–è¯­æ³•æ–¹å¼å®ç°çœŸæ­£çš„æ³¨è§£ï¼Œå¯ä»¥åƒ Java ä¸­çš„æ³¨è§£ä¸€æ ·ï¼Œä¸ä»…å¯ä»¥ä½œä¸ºä¸€ç§æ ‡è¯†ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œç¼–è¯‘æ£€æŸ¥ã€‚</p><p>å…¶å® OC ä¸­æ˜¯å¯ä»¥ç›´æ¥ç”¨å®å®šä¹‰åšçš„ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#define <span class="type">Service</span>(_name_) \</span><br><span class="line">+ (void)load &#123; \</span><br><span class="line">    [<span class="keyword">self</span> registerService:_name_]; \</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line">@<span class="type">Service</span>(@<span class="string">"LoginService"</span>)</span><br><span class="line">@implementation <span class="type">LoginService</span></span><br><span class="line">...</span><br><span class="line">@end</span><br></pre></td></tr></table></figure><p>ä½† Lotusoot æ˜¯æä¾›ç»™ Swift å’Œ OC ä»¥åŠæ··ç¼–é¡¹ç›®éƒ½å¯ä»¥ä½¿ç”¨çš„ï¼Œæ‰€ä»¥å®ç°æ–¹æ¡ˆè¿˜éœ€è¦æˆ‘ç»§ç»­æ¢ç´¢ã€‚</p><p>å¦ä¸€ç§æ–¹å¼å¯ä»¥ä½¿ç”¨ LLVM æ˜¯æä¾›äº† @annotation æ“ä½œçš„ï¼Œå¦‚æœé€šè¿‡è¿™ç§æ–¹å¼ç”Ÿæˆ <code>.plist</code> çš„æ³¨å†Œåˆ—è¡¨æ–‡ä»¶åº”è¯¥ä¼šæ”¾åˆ°ç¼–è¯‘ç»“æŸæ—¶ã€‚</p><p>ä»¥ä¸Šï¼Œæ˜¯ä»¥åçš„ä¸€äº›æ„æ€ï¼Œå¸Œæœ›å¯ä»¥å®Œç¾çš„è§£å†³ Swift æ¨¡å—åŒ–æ–¹æ¡ˆã€‚<strong>å¦‚æœä½ æœ‰ä»€ä¹ˆå¥½çš„å»ºè®®ï¼Œéƒ½å¯ä»¥æ¥æ‰¾æˆ‘è®¨è®ºå“¦~~~</strong></p><h1 id="Demo-å’Œ-Github"><a href="#Demo-å’Œ-Github" class="headerlink" title="Demo å’Œ Github"></a>Demo å’Œ Github</h1><p>å¦‚æœæƒ³æ›´æ¸…æ™°çš„æ„Ÿå— Lotusoot å¸¦æ¥çš„æ¨¡å—åŒ–æ”¹é€ ï¼Œè¯·å¿…é¡»ä¸‹è½½ <a href="https://github.com/Vegetarians/Lotusoot/tree/master/Demo" target="_blank" rel="noopener">Demo</a> æ¥çœ‹å“Ÿã€‚</p><p>æ€»é¡¹ç›®çš„åœ°å€åœ¨<a href="https://github.com/Vegetarians/Lotusoot" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚</p><p>éå¸¸æ¬¢è¿ä¸€èµ·è®¨è®ºï¼ˆå–èŒ~~ï¼‰</p><hr><p>æœ‰ä»€ä¹ˆé—®é¢˜éƒ½å¯ä»¥åœ¨åšæ–‡åé¢ç•™è¨€ï¼Œæˆ–è€…å¾®åšä¸Šç§ä¿¡æˆ‘ï¼Œæˆ–è€…é‚®ä»¶æˆ‘ <a href="mailto:&#99;&#111;&#x64;&#x65;&#x72;&#102;&#x69;&#x73;&#104;&#64;&#49;&#54;&#x33;&#x2e;&#99;&#111;&#109;" target="_blank" rel="noopener">&#99;&#111;&#x64;&#x65;&#x72;&#102;&#x69;&#x73;&#104;&#64;&#49;&#54;&#x33;&#x2e;&#99;&#111;&#109;</a>ã€‚</p><p>åšä¸»æ˜¯ iOS å¦¹å­ä¸€æšã€‚</p><p>å¸Œæœ›å¤§å®¶ä¸€èµ·è¿›æ­¥ã€‚</p><p>æˆ‘çš„å¾®åšï¼š<a href="http://weibo.com/coderfish/" target="_blank" rel="noopener">å°é±¼å‘¨å‡Œå®‡</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å¼€ç¯‡&quot;&gt;&lt;a href=&quot;#å¼€ç¯‡&quot; class=&quot;headerlink&quot; title=&quot;å¼€ç¯‡&quot;&gt;&lt;/a&gt;å¼€ç¯‡&lt;/h1&gt;&lt;p&gt;ä¸Šä¸€ç¯‡&lt;a href=&quot;http://zhoulingyu.com/2017/11/24/iOS-Modularization/&quot;&gt;ã€ŠiOS æ··ç¼– æ¨¡å—åŒ–/ç»„ä»¶åŒ– ç»éªŒæŒ‡åŒ—ã€‹&lt;/a&gt;ä¸­ä»‹ç»åˆ°çš„ &lt;a href=&quot;https://github.com/Vegetarians/Lotusoot&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Lotusoot&lt;/a&gt; ï¼Œå°†åœ¨æœ¬ç¯‡ä¸­åšä¸€ä¸ªæ›´ä¸ºè¯¦ç»†çš„ä»‹ç»ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åˆ &lt;a href=&quot;https://github.com/Vegetarians/Lotusoot&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Lotusoot&lt;/a&gt; ç®€ç§°ä¸ºã€æ··ç¼–è·¯ç”±ã€ï¼Œä½†æ˜¯éšååè€Œæ›²è§£äº†å®ƒçš„åŠŸèƒ½ï¼Œå…¶çœŸæ­£çš„å®šä½æ˜¯ã€æ¨¡å—åŒ–å·¥å…·å’Œè§„èŒƒã€ã€‚&lt;/p&gt;
&lt;p&gt; &lt;a href=&quot;https://github.com/Vegetarians/Lotusoot&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Lotusoot&lt;/a&gt; å¯ä»¥åšåˆ°ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ¨¡å—é—´ã€æ¨¡å—å†…æœåŠ¡è°ƒç”¨&lt;/li&gt;
&lt;li&gt;Swiftã€OCã€æˆ–è€…ä¸¤è€…æ··ç¼–é¡¹ç›®å‡å¯ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;çŸ­é“¾æ³¨å†Œã€è·¯ç”±è°ƒç”¨&lt;/li&gt;
&lt;li&gt;è„šæœ¬è‡ªåŠ¨æ³¨å†ŒæœåŠ¡/è·¯ç”±è¡¨&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨ï¼šè¿™é‡Œçš„æ¨¡å—åŒ–ï¼Œä¹Ÿå°±æ˜¯å¤§å®¶è¯´çš„ã€ç»„ä»¶åŒ–ã€ï¼Œä¸æ˜¯åœ¨ä¸»å·¥ç¨‹ç”¨æ–‡ä»¶å¤¹åˆ†æ¨¡å—ï¼Œè€Œæ˜¯æŒ‡å°†ç‹¬ç«‹æ¨¡å—æŠ½è°ƒæˆ CocoaPods åº“ã€æˆ–è€…å…¶ä»–å½¢å¼çš„åº“æ–‡ä»¶ï¼Œæˆä¸ºä¸€ä¸ªç‹¬ç«‹å·¥ç¨‹ã€‚&lt;br&gt;ä¸‹æ–‡ä¸­çš„æ¨¡å—å°±ä»£è¡¨ä¸€ä¸ª CocoaPods åº“&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://zhoulingyu.com/categories/iOS/"/>
    
      <category term="iOSæ¨¡å—åŒ–" scheme="http://zhoulingyu.com/categories/iOS/iOS%E6%A8%A1%E5%9D%97%E5%8C%96/"/>
    
    
      <category term="iOS" scheme="http://zhoulingyu.com/tags/iOS/"/>
    
      <category term="iOSæ¨¡å—åŒ–" scheme="http://zhoulingyu.com/tags/iOS%E6%A8%A1%E5%9D%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>iOS æ··ç¼– æ¨¡å—åŒ–/ç»„ä»¶åŒ– ç»éªŒæŒ‡åŒ—</title>
    <link href="http://zhoulingyu.com/2017/11/24/iOS-Modularization/"/>
    <id>http://zhoulingyu.com/2017/11/24/iOS-Modularization/</id>
    <published>2017-11-24T11:03:52.000Z</published>
    <updated>2018-07-10T03:07:31.628Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-å¼€ç¯‡"><a href="#1-å¼€ç¯‡" class="headerlink" title="1. å¼€ç¯‡"></a>1. å¼€ç¯‡</h1><p>æœ¬æ–‡çš„åˆè¡·ï¼Œæ˜¯ä¸ºäº†ç»™æ­£åœ¨åšæ··ç¼–æˆ–è€…æ¨¡å—åŒ–çš„åŒå­¦ä»¬ä¸€ä¸ªå»ºè®®å’Œå‚è€ƒã€‚</p><p>å› ä¸ºæ¥é¥¿å‚ä»¥ååšçš„é¡¹ç›®æ˜¯å…¨å…¬å¸å”¯ä¸€ä¸€ä¸ª Swift/OC æ··ç¼–çš„ iOS é¡¹ç›®ï¼Œæ‰€ä»¥ä¸€è·¯ä¸Šè¸©å‘æ— æ•°ï¼Œç°åœ¨æŠŠä¸€äº›è¸©å‘çš„è¿‡ç¨‹å’Œç»éªŒæ€»ç»“èµ·æ¥ï¼Œä¾›å¤§å®¶å‚è€ƒã€‚</p><p>ç›¸ä¿¡åœ¨æµè§ˆæœ¬æ–‡åï¼Œä¸€å®šä¼šæœ‰æ‰€æ”¶è·ã€‚</p><p>æˆ‘æ¥çš„æ—¶å€™é¡¹ç›®å·²ç»å¼€å§‹ Swift æ”¹é€ äº†ï¼Œæ…¢æ…¢çš„æŠŠé¡¹ç›® Swift åŒ–ï¼Œæ–°ä»£ç éƒ½æ˜¯ Swift çš„ã€‚</p><p>å…ˆå…¬å¸ƒä¸ƒä¸ªæœˆæˆæœï¼Œä¸‹å›¾æ˜¯æˆ‘ä»¬æœ€ç»ˆçš„é¡¹ç›®ç»“æ„ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS-Modularization-03.png" alt=""></p><p>å¯¹äºæˆ‘ä»¬æ··ç¼–çš„æƒ…å†µï¼Œåœ¨äº”ä¸ªæœˆå‰å¤§å®¶å°±å±•å¼€äº†è®¨è®ºã€‚</p><p>ç»™æˆ‘ä»¬çš„é€‰æ‹©æœ‰ä¸¤ç§ï¼š</p><ol><li>æ…¢æ…¢å°† OC ä»£ç æ›¿æ¢æˆ Swift</li><li>å°½å¿«æ¨¡å—åŒ–ï¼Œåˆ†ç¦»ä¸¤ç§è¯­è¨€ä»£ç </li></ol><p>ä¸€å¼€å§‹æˆ‘ä»¬æ˜¯ä» <code>é€‰æ‹©1</code> å¼€å§‹åšçš„ï¼Œä½†æ˜¯å¾ˆå¿«æˆ‘ä»¬å°±å‘ç°ï¼Œå¯¹äºæˆ‘ä»¬ 74% éƒ½æ˜¯ OC ä»£ç çš„é¡¹ç›®æ¥è¯´ï¼Œå¤ªç—›äº†ï¼Œå¤ªæ¼«é•¿äº†ï¼Œè€Œä¸”æœŸé—´è¿­ä»£çš„è¿‡ç¨‹ä¸­è¿˜åœ¨ä¸æ–­åœ°è¿­ä»£ï¼Œä¸æ–­çš„è€¦åˆã€‚</p><p>æ‰€ä»¥åœ¨ç»è¿‡ä¸€ç•ªåˆ©å®³åˆ†æåæˆ‘ä»¬è¿…é€ŸæŠ•å…¥åˆ°äº† <code>é€‰æ‹©2</code> ä¸­ã€‚ä¸€æ–¹é¢ï¼Œæ¨¡å—åŒ–æœ¬èº«å°±æ˜¯è¶Šæ¥è¶Šè‡ƒè‚¿çš„é¡¹ç›®çš„æœ€ç»ˆå½’å®¿ï¼Œä¸€æ–¹é¢å¯ä»¥æ…¢æ…¢å°†ä¸¤ç§è¯­è¨€å‰¥ç¦»ã€‚</p><a id="more"></a><blockquote><p>æ³¨ï¼šè¿™é‡Œçš„æ¨¡å—åŒ–ï¼Œä¹Ÿå°±æ˜¯å¤§å®¶è¯´çš„ã€ç»„ä»¶åŒ–ã€ï¼Œä¸æ˜¯åœ¨ä¸»å·¥ç¨‹ç”¨æ–‡ä»¶å¤¹åˆ†æ¨¡å—ï¼Œè€Œæ˜¯æŒ‡å°†ç‹¬ç«‹æ¨¡å—æŠ½è°ƒæˆ CocoaPods åº“ã€æˆ–è€…å…¶ä»–å½¢å¼çš„åº“æ–‡ä»¶ï¼Œæˆä¸ºä¸€ä¸ªç‹¬ç«‹å·¥ç¨‹ã€‚</p></blockquote><h1 id="2-æ¨¡å—åˆ’åˆ†"><a href="#2-æ¨¡å—åˆ’åˆ†" class="headerlink" title="2. æ¨¡å—åˆ’åˆ†"></a>2. æ¨¡å—åˆ’åˆ†</h1><p><strong>åˆ€æ€ä¹ˆåˆ‡ï¼Œæ˜¯æ··ç¼–æ¨¡å—åŒ–æœ€é‡è¦çš„ä¸€æ­¥</strong>ï¼Œå®Œå…¨å†³å®šäº†åç»­å·¥ä½œçš„éš¾ä¸å¦ã€‚</p><p>ä¸ç”¨ä»ä¸šåŠ¡æ¨¡å—æ‹†åˆ†ï¼Œç±»ä¼¼ã€å®æ—¶è®¢å•æ¨¡å—ã€ã€ã€å†å²è®¢å•æ¨¡å—ã€ã€ã€ä¸ªäººä¸­å¿ƒã€è¿™æ ·ç›´æ¥æ‹†åˆ†ï¼Œä¿å‡†ä½ åé¢å“­åˆ°æ— æ³•è‡ªå·²ã€‚</p><p>æ­£ç¡®çš„åšæ³•åº”è¯¥ä»åº•å±‚éƒ¨åˆ†å¼€å§‹æŠ½ç¦»ï¼Œé¦–å…ˆèƒ½æƒ³åˆ°çš„åº”è¯¥æ˜¯ã€ç±»æ‰©å±• Extensionã€ã€ã€å·¥å…·ç±»ã€ã€ã€ç½‘ç»œåº“ã€ã€ã€DB ç®¡ç†ã€ï¼ˆå½“ç„¶è¿™ä¸ªæˆ‘ä»¬æ²¡æœ‰ç”¨åˆ°æ¯”è¾ƒé‡çš„ DBï¼‰ã€‚</p><p>å¹³å¸¸æˆ‘ä»¬çœ‹åˆ°ä¸€äº›å¤§å‹åº“ï¼Œæˆ–è€…ä¸€äº›å…¬å¸ä»‹ç»è‡ªå·±äº§å“æ¶æ„æ—¶å€™éƒ½æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿæ˜¯ä¸æ˜¯ä¸‹å±‚æœ‰ OpenGL ES å’Œ Core Graphics æ‰æœ‰ä¸Šå±‚ Core Animationï¼Œå†åˆ° UIKitã€‚ä¸‹å±‚å†³å®šä¸Šå±‚ï¼Œåªæœ‰æŠŠå¤ç”¨ç‡é«˜çš„éƒ¨åˆ†æŠ½å‡ºæ‰èƒ½é€æ­¥æ„å»ºä¸Šå±‚ä¸šåŠ¡ã€‚</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS-Modularization-01.png" alt=""></p><p>æ‰€ä»¥é¦–å…ˆæˆ‘ä»¬åšçš„å°±æ˜¯æŠ½å·¥å…·ç±»å’Œ Extensionï¼Œè¯¸å¦‚ï¼š</p><ol><li>å„ç±» Constants æ–‡ä»¶</li><li><code>NSTimer</code>ã€<code>NSString</code>ã€<code>UILabel</code> ç­‰ç­‰ç±»çš„ Extension</li><li><code>RouterHelper</code>ã€<code>JavascripInterface</code> ç­‰ç­‰ Utils å’Œ Helper</li></ol><p>è¿™ä¸€å—çš„å·¥ä½œï¼Œä¸ä»…ä»…å¯ä»¥æŠ½å‡º OC ä»£ç ï¼Œä¹ŸåŒæ—¶å¯ä»¥æŠ½å‡º Swift çš„ä»£ç ã€‚æˆ‘ä»¬å°† OC éƒ¨åˆ†çš„ä»£ç æ–°å»ºäº†åº“ä¸º <code>LPDBOCFoundationGarbage</code>ï¼ŒSwift éƒ¨åˆ†çš„ä»£ç æ–°å»ºåº“ä¸º <code>LPDBPublicModule</code>ã€‚</p><h2 id="2-1-LPDBOCFoundationGarbage"><a href="#2-1-LPDBOCFoundationGarbage" class="headerlink" title="2.1 LPDBOCFoundationGarbage"></a>2.1 LPDBOCFoundationGarbage</h2><p>å…ˆè¯´ <code>LPDBOCFoundationGarbage</code>ï¼Œå«è¿™ä¸ªåå­—æ˜¾ç„¶ä¸ä»…ä»…ä¼šæ”¾å…¥ä¸Šé¢æ‰€æåˆ°çš„æ–‡ä»¶ã€‚<code>LPDBOCFoundationGarbage</code> è¿˜ä¼š<strong>å¤§é‡æ”¾å…¥é•¿æœŸä¸è·Ÿéšä¸šåŠ¡å˜åŠ¨çš„ OC ä»£ç </strong>ã€‚è¿™æ˜¯å› ä¸ºï¼Œåœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬å‘ç°æ€»æ˜¯ã€ç†æƒ³å¾ˆç¾å¥½ã€ï¼Œè™½ç„¶å¤§å®¶éƒ½æŠ±æœ‰æŠŠæ—§ä»£ç æ•´ç†ä¸€éçš„æ„¿æœ›ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œæˆ‘ä»¬é¡¹ç›®çš„æ—§ä»£ç å·²ç»åˆ°äº†å‰ªä¸æ–­ç†è¿˜ä¹±çš„åœ°æ­¥ï¼Œæ‰€ä»¥æœŸæœ›ä¸€è¾¹æ•´ç†ã€ä¸€è¾¹åˆ†ç¦»çš„æƒ³æ³•åŸºæœ¬æ˜¯ä¸å¯é çš„ã€‚è¿™æ—¶å€™å°±è¦å€Ÿç”¨ <a href="https://github.com/mmoaay" target="_blank" rel="noopener">MM</a> å¤§ä½¬ç»™æˆ‘ä»¬ä¼ æˆçš„ä¸€å¥è¯ã€è®©æ¶å¿ƒçš„ä»£ç æ¶å¿ƒåˆ°ä¸€èµ·ã€ï¼Œ<code>LPDBOCFoundationGarbage</code> æ­£æ˜¯ä¸ºæ­¤è€Œåˆ›å»ºã€‚</p><p><strong>å¤§é‡æ”¾å…¥é•¿æœŸä¸è·Ÿéšä¸šåŠ¡å˜åŠ¨çš„ OC ä»£ç </strong>åŒ…æ‹¬ï¼š</p><ol><li>è‡ªå®šä¹‰çš„ Customer Viewï¼Œè¯¸å¦‚ï¼šRefresh æ§ä»¶ã€Loading æ§ä»¶ã€çº¢ç‚¹æ§ä»¶ç­‰ç­‰</li><li>è‡ªå®šä¹‰çš„å°å‹æ§åˆ¶å™¨ï¼Œè¯¸å¦‚ï¼šTextField å’Œå…¶äº”å…­ä¸ªè¿‡æ»¤å™¨ PhoneNumValidatorã€IDCardValidator ç­‰ç­‰</li><li>ä¸éšä¸šåŠ¡å˜åŠ¨çš„ Controllerï¼Œè¯¸å¦‚ï¼šè‡ªå®šä¹‰çš„ AlertControllerã€è‡ªå®šä¹‰çš„ WebControllerã€è‡ªå®šä¹‰çš„ BaseViewController ç­‰ç­‰</li></ol><p>æœ€åæˆ‘ä»¬çš„ä¸€çº§åˆ—è¡¨çœ‹èµ·æ¥å°±åƒè¿™æ ·ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS-Modularization-04.png-w375" alt=""></p><blockquote><p>å…³äºå‰ç¼€è¯´ä¸¤å¥ã€‚æˆ‘ä»¬æ‰€æœ‰æŠ½å‡ºçš„åº“éƒ½å¸¦æœ‰å‰ç¼€ <code>LPDB</code>ï¼Œä½†æ˜¯é’ˆå¯¹ Swift åº“å’Œ OC åº“ç¨æœ‰åŒºåˆ†çš„æ˜¯ï¼ŒOC åº“å†…çš„æ–‡ä»¶ä¹Ÿéƒ½å¸¦æœ‰å‰ç¼€ï¼Œè€Œ Swift åº“æ˜¯å»æ‰äº†å‰ç¼€ï¼Œè¿™ä¹Ÿç¬¦åˆä¸¤ç§è¯­è¨€çš„è§„èŒƒã€‚</p></blockquote><h2 id="2-2-LPDBPublicModule"><a href="#2-2-LPDBPublicModule" class="headerlink" title="2.2 LPDBPublicModule"></a>2.2 LPDBPublicModule</h2><p><code>LPDBPublicModule</code> æƒ…å†µå¾ˆç®€å•ï¼Œä¸»è¦æ˜¯æ–°ä¸šåŠ¡è¿­ä»£æ—¶å€™äº§ç”Ÿçš„ä¸€äº›å¤ç”¨æ€§é«˜çš„ä»£ç ï¼Œä½†æ˜¯è¿™æ˜¾ç„¶å’Œ OC é‚£ä¸ªåƒåœ¾æ¡¶åº“ä¸ä¸€æ ·ï¼Œè¦å¹²å‡€æ•´æ´çš„å¤šã€‚ä¸»è¦å­˜æ”¾çš„æ˜¯ï¼š</p><ol><li>Swift Extension</li><li><a href="https://github.com/Vegetarians/Lotusoot" target="_blank" rel="noopener">Lotusoot</a> åŠå…¶ä»–å…¬å¼€åè®®</li></ol><blockquote><p><a href="https://github.com/Vegetarians/Lotusoot" target="_blank" rel="noopener">Lotusoot</a> æ˜¯ä¸ªç”±æˆ‘å¼€å‘çš„æ¨¡å—åŒ–å·¥å…·å’Œè§„èŒƒï¼Œä¸€å¼€å§‹æˆ‘å«å®ƒã€è·¯ç”±ã€ï¼Œä½†æ˜¯éšåå‘ç°éƒ¨é—¨è¿™è¾¹å› ä¸ºå«å®ƒã€è·¯ç”±åº“ã€è€Œæ›²è§£äº†å®ƒçš„æ„æ€ï¼Œæ‰€ä»¥åæ¥æˆ‘å°±å«ã€æ¨¡å—åŒ–å·¥å…·ã€äº†ã€‚å…³äº Lotusoot å¯ä»¥æŸ¥çœ‹<a href="http://zhoulingyu.com/2017/11/29/iOS-modularized-tool-Lotusoot/">è¿™ç¯‡</a>ã€‚</p></blockquote><h2 id="2-3-LPDBNetwork"><a href="#2-3-LPDBNetwork" class="headerlink" title="2.3 LPDBNetwork"></a>2.3 LPDBNetwork</h2><p>è¿™å—æ¯‹åº¸ç½®ç–‘ï¼Œä¸ç®¡ä»€ä¹ˆé¡¹ç›®éƒ½åŸºæœ¬æœ‰çš„ä¸€å—ï¼ŒåŸºæœ¬ä¸Šæˆ‘ä»¬é¡¹ç›®ä¸­ç½‘ç»œç›¸å…³çš„æ—§ä»£ç éƒ½æ˜¯ OC çš„ï¼Œå”¯ä¸€æ¯”è¾ƒéº»çƒ¦çš„æ˜¯ï¼Œæˆ‘ä»¬çš„ç½‘ç»œå±‚ï¼Œæ—©æœŸäººå‘˜å†™çš„æ¯”è¾ƒç²—ç³™ï¼Œç”šè‡³å’Œ UI å±‚ä»£ç æœ‰å¾ˆå¤šè€¦åˆï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ä¸­å’Œç½‘ç»œè¯·æ±‚å¤±è´¥æœ‰ä¸€äº› HUD æ˜¾ç¤ºï¼Œè½¬è½¬èŠèŠ±ä»€ä¹ˆçš„ã€‚æ‰€ä»¥å¯¼è‡´åœ¨ä»ä¸»å·¥ç¨‹æŠ½ç¦»çš„æ—¶å€™æœ‰å¾ˆå¤šæ¶å¿ƒçš„åœ°æ–¹ã€‚</p><p><strong>æ‰€ä»¥å¯¹äºè¿™ç§å¼ºè€¦åˆï¼Œæœ€åè§£å†³çš„æ–¹å¼æ˜¯åˆ†æˆäº†ä¸¤éä»£ç æ”¹é€ ï¼Œç¬¬ä¸€éå…ˆé€šè¿‡åå°„å…ˆå°† OC ä»£ç æŠ½å‡ºï¼Œä¿è¯ä»£ç å¯ç”¨ï¼Œé€šè¿‡åŸºç¡€æµ‹è¯•ã€‚ç¬¬äºŒéæ˜¯é€šè¿‡åè®®æ¥ä»£æ›¿åŸå…ˆçš„åå°„ã€‚ç¬¬ä¸‰éæ˜¯ä½¿ç”¨ <a href="https://github.com/Vegetarians/Lotusoot" target="_blank" rel="noopener">Lotusoot</a> å½»åº•è§„èŒƒæœåŠ¡è°ƒç”¨ã€‚åœ¨åé¢ä¸€èŠ‚ã€è¿‡ç¨‹ä¸­çš„ä¸€äº›éš¾ç‚¹æ€»ç»“ã€ä¸­ä¼šä»‹ç»</strong></p><h2 id="2-4-LPDBUIKit"><a href="#2-4-LPDBUIKit" class="headerlink" title="2.4 LPDBUIKit"></a>2.4 LPDBUIKit</h2><p>è¿™å—æ˜¯ Swift çš„ UI åº“ï¼Œä¸€äº›æ¯”è¾ƒå¸¸ç”¨åˆ°çš„æ§ä»¶ç­‰ç­‰ã€‚</p><h2 id="2-5-LPDBEnvironment"><a href="#2-5-LPDBEnvironment" class="headerlink" title="2.5 LPDBEnvironment"></a>2.5 LPDBEnvironment</h2><p>è¿™å—æ˜¯ç”¨äºç¯å¢ƒæ§åˆ¶çš„ï¼Œåˆ‡æ¢è¦è®¿é—®çš„æœåŠ¡å™¨ç¯å¢ƒï¼Œè¿™å—æœ¬èº«å¯ä»¥ä¸æŠ½å‡ºçš„ï¼Œä½†æ˜¯ç”±äºæœ‰å…¶ä»–åŸºç¡€æ¨¡å—ï¼Œæ¯”å¦‚ <code>LPDBNetwork</code> ä¾èµ–ï¼Œè€Œä¸”å…¶ä¸­ç›¸å…³ä»£ç æ¯”è¾ƒå¤šï¼Œç¯å¢ƒç›¸å…³çš„ä»£ç ä¹Ÿæ¯”è¾ƒç‹¬ç«‹ï¼Œæ‰€ä»¥å•ç‹¬æŠ½å‡ºã€‚</p><h1 id="3-ä¸šåŠ¡æ¨¡å—æŠ½ç¦»"><a href="#3-ä¸šåŠ¡æ¨¡å—æŠ½ç¦»" class="headerlink" title="3. ä¸šåŠ¡æ¨¡å—æŠ½ç¦»"></a>3. ä¸šåŠ¡æ¨¡å—æŠ½ç¦»</h1><p>åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œæ¯”è¾ƒåº•å±‚çš„ä»£ç å°±åŸºæœ¬æŠ½å‡ºç»“æŸäº†ï¼Œå‰©ä¸‹çš„å°±å¯ä»¥è¾ƒä¸ºè½»æ¾ä¸€äº›çš„æŠ½å–ä¸šåŠ¡åº“äº†ã€‚</p><p>æŠ½å–ä¸šåŠ¡åº“çš„é‡ç‚¹åœ¨äºï¼š</p><ol><li>æŠ½å–çš„ä¸šåŠ¡åº“ä¸ä¼šç»å¸¸æ”¹åŠ¨ï¼Œä»¥é˜²æ­¢åœ¨æŠ½å–ã€é‡æ„è¿‡ç¨‹ä¸­ç”±äºä¸šåŠ¡éœ€æ±‚å‘ç”Ÿæ›´åŠ¨</li><li>æŠ½å–çš„ä¸šåŠ¡åº“å¯ä»¥é«˜åº¦ç‹¬ç«‹ï¼ŒæŠ½å–ååº”å½“å’Œç§¯æœ¨ä¸€æ ·ï¼Œå¦‚ <code>LPDBLoginModule</code>ï¼ŒæŠ½å–åå¿«é€Ÿè¢«é›†æˆåœ¨ä»»ä½•æ¨¡å—ï¼Œå¹¶èƒ½ä¿è¯ç™»å½•åŠŸèƒ½ï¼Œæ›´å¥½çš„æœåŠ¡å…¶ä»–æ¨¡å—</li></ol><p>æˆ‘ä»¬ç›®å‰æŠ½å‡ºçš„ä¸‰ä¸ªä¸šåŠ¡æ¨¡å—åˆ†åˆ«æ˜¯ï¼š <code>LPDBHistoryModule</code>ã€<code>LPDBUserCenterModule</code>ã€<code>LPDBLoginModule</code>ã€‚</p><h1 id="4-è¿‡ç¨‹ä¸­çš„ä¸€äº›é‡éš¾ç‚¹"><a href="#4-è¿‡ç¨‹ä¸­çš„ä¸€äº›é‡éš¾ç‚¹" class="headerlink" title="4. è¿‡ç¨‹ä¸­çš„ä¸€äº›é‡éš¾ç‚¹"></a>4. è¿‡ç¨‹ä¸­çš„ä¸€äº›é‡éš¾ç‚¹</h1><p>å‰©ä¸‹çš„å°±æ˜¯ï¼Œæ¥è¯´ä¸€ä¸‹åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­çš„ç–‘éš¾é—®é¢˜ã€‚</p><h2 id="4-1-å¤„ç†æ¨¡å—è€¦åˆä»£ç -åå°„è°ƒç”¨"><a href="#4-1-å¤„ç†æ¨¡å—è€¦åˆä»£ç -åå°„è°ƒç”¨" class="headerlink" title="4.1 å¤„ç†æ¨¡å—è€¦åˆä»£ç -åå°„è°ƒç”¨"></a>4.1 å¤„ç†æ¨¡å—è€¦åˆä»£ç -åå°„è°ƒç”¨</h2><p>æŠ½å–ä»£ç ç¬¬ä¸€éä½¿ç”¨åå°„çš„åŸå› ä¸»è¦æ˜¯ï¼Œé€šå¸¸ä½ åœ¨é€’å½’æŸä¸ªæ–‡ä»¶çš„ä¾èµ–çš„æ—¶å€™ï¼Œä¼šé€’å½’å‡ºéå¸¸å¤šçš„ä¸œè¥¿ï¼ˆå°¤å…¶æ˜¯æˆ‘ä»¬çš„èœœæ±æ—§ä»£ç ï¼‰ï¼Œå¾€å¾€å°±æ˜¯ <strong>A-&gt;B-&gt;C-&gt;D-&gt;F</strong>ï¼Œä¸­é—´æœ‰å„ç§ä¾èµ–ï¼Œç”šè‡³åˆ°æœ€åä¸€å±‚çš„æ—¶å€™è¿˜å¼•ç”¨äº† Swift çš„ç±»ã€‚ç›´åˆ°æœ€åä½ çœ‹ <code>#import</code> å°±æƒ³åã€‚ç»™ä¸ªå›¾æ„Ÿå—ä¸€ä¸‹ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS-Modularization-05.png" alt=""></p><p>ä¸ºä»€ä¹ˆæ²¡æœ‰åŠæ³•ä¸€æ­¥åˆ°ä½ï¼Œé€šè¿‡åè®®è§£å†³è€¦åˆï¼Ÿ</p><p>è¿™ä¸»è¦æ˜¯å› ä¸ºå•ä¸ª Pod åº“å¼€å‘æ—¶ä½¿ç”¨å¼€å‘æ¨¡å¼æ˜¯å¾ˆå®¹æ˜“è°ƒè¯•çš„ï¼Œä½†æ˜¯ä¸¤ä¸ª Pod åº“åŒæ—¶åœ¨ä¸å‘ç‰ˆæœ¬çš„æƒ…å†µä¸‹ä½¿ç”¨å¼€å‘æ¨¡å¼æ˜¯æ¯”è¾ƒéš¾å¤„ç†çš„ï¼ˆå¯ä»¥å‚è€ƒ<a href="http://www.pluto-y.com/cocoapod-private-pods-and-module-manager/" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>ä¸­ã€ä½¿ç”¨ç§æœ‰åº“ã€ä¸€èŠ‚ï¼‰ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œåå¤æ“ä½œä¸¤ä¸ªæˆ–è€…ä¸¤ä¸ªä»¥ä¸Šçš„åº“æ˜¯éº»çƒ¦çš„ï¼Œæ‰€ä»¥ä¼˜å…ˆè€ƒè™‘å°†ä»£ç å°½å¿«åˆ†ç¦»å¼€æ¥ï¼Œå¹¶èƒ½é€šè¿‡åŸºæœ¬æµ‹è¯•ï¼Œä¸å½±å“åŠŸèƒ½ã€‚</p><p>æ‰€ä»¥åœ¨è¿™ä¸€éå¤„ç†ç»“æŸåï¼Œå­åº“ä¸­å‡ºç°äº†å¾ˆå¤š <code>NSClassFromString</code> ç­‰ç­‰ã€‚</p><p>ä»¥ <code>LPDBLoginMoudle</code> ä¸ºä¾‹ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *className = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@.`AuthLoginManager"</span>, [<span class="built_in">NSString</span> targetName]];</span><br><span class="line"><span class="keyword">id</span> authLoginManager = <span class="built_in">NSClassFromString</span>(className);</span><br><span class="line"><span class="keyword">if</span> (![authLoginManager conformsToProtocol:<span class="class"><span class="keyword">@protocol</span>(<span class="title">authLoginSuccess</span>)]) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">[authLoginManager authLoginSuccess];</span><br></pre></td></tr></table></figure><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">id</span> delegate = [[<span class="built_in">UIApplication</span> sharedApplication] delegate];</span><br><span class="line">[delegate jumpToShopListVC:shops];</span><br></pre></td></tr></table></figure><h2 id="4-2-å¤„ç†æ¨¡å—è€¦åˆä»£ç -åè®®è°ƒç”¨"><a href="#4-2-å¤„ç†æ¨¡å—è€¦åˆä»£ç -åè®®è°ƒç”¨" class="headerlink" title="4.2 å¤„ç†æ¨¡å—è€¦åˆä»£ç -åè®®è°ƒç”¨"></a>4.2 å¤„ç†æ¨¡å—è€¦åˆä»£ç -åè®®è°ƒç”¨</h2><p>ä¿æŒç¬¬ä¸€éä¸­å……æ»¡ <code>NSClassFromString</code>  æ˜¯ä¸å¯å–çš„ï¼Œå› ä¸ºè¿™ç±»ä»£ç å¾€å¾€å±äºç¡¬ç¼–ç ï¼Œä¸èƒ½åœ¨ç±»åå‡ºç°æ”¹åŠ¨ã€æˆ–è€…æ–¹æ³•åå‡ºç°æ”¹åŠ¨çš„æ—¶å€™åŠæ—¶åœ¨ç¼–è¯‘é˜¶æ®µæŠ›å‡º errorã€‚</p><p>åœ¨è¿™é‡Œå¼•å‡ºä¸€æ®µè®¨è®ºã€‚</p><p>ä¹‹å‰è·Ÿå¤§ç¥ä»¬è®¨è®ºç»„ä»¶åŒ–ï¼ˆæ¨¡å—åŒ–ï¼‰çš„å…·ä½“å®è·µæ—¶å€™ï¼Œè¯´åˆ°äº†ä¸»æµçš„ç»„ä»¶åŒ–å¯èƒ½éƒ½å€Ÿç”¨äº† <code>+ (void)load</code> æ–¹æ³•å’Œ rumtime æ“ä½œæ¥æ³¨å†Œè·¯ç”±å’ŒæœåŠ¡ã€‚è¿™æ—¶å€™ <a href="https://casatwy.com/" target="_blank" rel="noopener">casa</a> å¤§ç¥æå‡ºäº†ä¸€ç§è¯´æ³•ã€ç»„ä»¶åŒ–çš„æ ¹æœ¬ç›®çš„æ˜¯éš”ç¦»ã€éš”ç¦»é—®é¢˜å½±å“åŸŸã€éš”ç¦»ä¸šåŠ¡ã€éš”ç¦»å¼€å‘æ—¶çš„ä¾èµ–ã€‚æ‰€ä»¥è®©ä¸¤ä¸ªæœ¬æ¥æœ‰å…³ç³»çš„äººå˜å¾—æ²¡æœ‰å…³ç³»ï¼Œå°±éœ€è¦ä¸€ä¸ªä¸­é—´äººï¼Œå¦‚æœä¸ç”¨ runtime èƒ½çœæ‰ä¸å°‘äº‹ï¼Œä½†æ˜¯ç”¨ URL æ˜¯ä¸€ä»¶ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¤šä½™çš„äº‹ï¼Œä¸€ä¸ªåŒ…å«äº† target-action çš„å­—ç¬¦ä¸²å°±è¶³å¤Ÿäº†ï¼ŒURL æ˜¯å­—ç¬¦ä¸²çš„æ›´å¤æ‚è¡¨å¾ï¼Œtarget-action çš„æ„ä¹‰ä½“ç°çš„æ›´æ˜æ˜¾ã€‚åŒæ—¶ URL åº”è¯¥ä»…é™äº H5 è°ƒåº¦å’Œè·¨ App çš„ URL Scheme è°ƒåº¦ã€ã€‚</p><blockquote><p>è¿™é‡Œè¦å‘ <a href="https://casatwy.com/" target="_blank" rel="noopener">casa</a> å¤§ç¥éå¸¸éå¸¸éƒ‘é‡çš„é“æ­‰ï¼Œä¸Šé¢ä¸€æ®µï¼ŒåŸæ¥åœ¨ç¬¬ä¸€ç‰ˆçš„æ—¶å€™æ˜¯é¢„ç•™ä¿®æ”¹çš„ç‰‡æ®µï¼Œæœ¬æƒ³å†è¯»ä¸€éå¤§ç¥ <a href="https://casatwy.com/iOS-Modulization.html" target="_blank" rel="noopener">ã€Š [iOSåº”ç”¨æ¶æ„è°ˆ ç»„ä»¶åŒ–æ–¹æ¡ˆ]ã€‹</a> ä»”ç»†ç†è§£ä»¥åå†æ¬¡ä¿®æ”¹è¿™å—ï¼Œæœ¬æ¥æ˜¯æ‚„å’ªå’ªçš„å‘äº†æ–‡ç« ï¼Œæ²¡æƒ³åˆ°è¢«æ¨é€å‡ºå»äº†ï¼Œæœ‰å¼•å¯¼å¤§å®¶æ›²è§£å¤§ç¥çš„æ„¿æ„ã€‚éå¸¸éå¸¸æŠ±æ­‰ï¼ç°åœ¨å·²ç»ä¿®æ”¹ã€‚<br>ä¸‹é¢åœ¨è´´ä¸Šå¤§ä½¬è‡ªå·±å¯¹ URL çš„è§è§£ï¼š</p></blockquote><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS-Modularization-09.png" alt=""></p><p>é‚£ä¸ªæ—¶å€™å¬äº† casa å¤§ç¥çš„è¯´æ³•è§‰å¾—ã€å“ï¼Ÿæœ‰é“ç†ã€ï¼Œä½†æ˜¯åœ¨åæœŸçš„å®è·µä¸­ï¼Œæˆ‘è§‰å¾—å°±æˆ‘ä¸ªäººçš„ä»£ç ä¹ æƒ¯ï¼Œæ˜¯å¸Œæœ›å°½å¯èƒ½çš„å°†é—®é¢˜æš´éœ²åœ¨ç¼–è¯‘é˜¶æ®µï¼Œèƒ½è®©å®ƒæŠ›å‡º error å°±æŠ›å‡º errorï¼Œçºµä½¿ä½¿ç”¨å­—ç¬¦ä¸²å¯ä»¥å®šä¹‰å¸¸é‡ï¼Œä½†ç”±äºå¤§å®¶ä¸æ˜¯ç‹¬ç«‹è´Ÿè´£é¡¹ç›®ï¼Œåœ¨å…¶ä»–äººçœ‹åˆ°ä½ çš„æ–¹æ³•å‚æ•°æ—¶ï¼Œæ¯”å¦‚ï¼š<code>+ (void)callService:(NSString *)sUrl</code> æˆ–è€… <code>+ (void)openURL:(NSString *)url</code> ï¼Œå¯¹æ–¹å‘ç°ä½ çš„å‚æ•°æ˜¯ NSStrringï¼Œå¾ˆæœ‰å¯èƒ½ç›´æ¥å‡ºç°ç¡¬ç¼–ç å­—ç¬¦ä¸²è€Œä¸å»æŸ¥é˜…å¸¸é‡åˆ—è¡¨ï¼Œè¿™æ˜¯ä¹ æƒ¯æ€§ç¼–ç å¾ˆå®¹æ˜“å‡ºç°çš„é—®é¢˜ã€‚ä½†æˆ‘å¯¹ casa ã€URL æ²¡æœ‰ target-action è¡¨å¾æ˜æ˜¾ã€æ˜¯éå¸¸ä»å¯çš„ï¼Œæ‰€ä»¥ Lotusoot çš„é‡ç‚¹åªåœ¨äºè§£è€¦çš„æœåŠ¡è°ƒç”¨ï¼ŒURL åªæ˜¯ä¸ºäº†æ›´å¥½çš„ä¸º H5 é¡µé¢æä¾›å¤–éƒ¨è°ƒç”¨æœåŠ¡ï¼Œåœ¨å·¥ç¨‹å†…éƒ¨å¤§å¯ä½¿ç”¨æ›´åŠ ç®€æ´çš„æ–¹å¼ã€‚</p><p>æœ€åä¸€ç‚¹åŸå› æ˜¯ï¼Œåå°„æˆ–è€…é€šè¿‡ç±»/æ–¹æ³•å­—ç¬¦ä¸²å­—å…¸çš„æ–¹å¼å®åœ¨å¤ª OC äº†ï¼Œä¸ç®¡æ€ä¹ˆæ ·æˆ‘ä»¬æ˜¯ä¸€ä¸ªå°½é‡ Swift åŒ–çš„é¡¹ç›®ï¼Œåº”è¯¥å°½é‡å¸å–å…¶ä¼˜ç‚¹ï¼Œè™½ç„¶æŠ½å‡ºçš„ OC åº“å¯ä»¥ä½¿ç”¨åå°„ï¼Œé‚£ Swift åº“å’‹åŠï¼Ÿç›®å‰ Swift3 ä¸ 4 éƒ½æ²¡æœ‰å¾ˆå¥½çš„æ”¯æŒåå°„ã€‚</p><p>æ‰€ä»¥ï¼Œç¬¬äºŒéå¤„ç†ä½¿ç”¨åè®®æ›¿æ¢åå°„æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ä½†å®è´¨ä¸Šï¼Œå¤„ç†çš„å¹¶ä¸æ˜¯å¾ˆå¥½ã€‚å¤§è‡´å¦‚ä¸‹ï¼ˆæˆ‘ä»¬ä»¥ <code>LPDBLoginModule</code> ä¸ºä¾‹ï¼‰ï¼š</p><h3 id="4-2-1-åœ¨-LPDBLoginModule-æ•´ç†ç”¨åˆ°çš„æœåŠ¡ï¼Œå½’ç±»æ•´ç†"><a href="#4-2-1-åœ¨-LPDBLoginModule-æ•´ç†ç”¨åˆ°çš„æœåŠ¡ï¼Œå½’ç±»æ•´ç†" class="headerlink" title="4.2.1 åœ¨ LPDBLoginModule æ•´ç†ç”¨åˆ°çš„æœåŠ¡ï¼Œå½’ç±»æ•´ç†"></a>4.2.1 åœ¨ LPDBLoginModule æ•´ç†ç”¨åˆ°çš„æœåŠ¡ï¼Œå½’ç±»æ•´ç†</h3><p>å¦‚æˆ‘ä»¬çš„ <code>LPDBLoginModule</code> ç”¨åˆ°äº† AppDelegate ä¸­çš„ä¸€äº›æ–¹æ³•ï¼ŒåŒäº‹ç”¨åˆ°äº† AuthLogin ç›¸å…³ç±»ä¸­çš„ä¸€äº›æ–¹æ³•</p><h3 id="4-2-2-åœ¨-LPDBLoginModule-ä¸­å»ºç«‹ç›¸åº”çš„åè®®"><a href="#4-2-2-åœ¨-LPDBLoginModule-ä¸­å»ºç«‹ç›¸åº”çš„åè®®" class="headerlink" title="4.2.2 åœ¨ LPDBLoginModule ä¸­å»ºç«‹ç›¸åº”çš„åè®®"></a>4.2.2 åœ¨ LPDBLoginModule ä¸­å»ºç«‹ç›¸åº”çš„åè®®</h3><p>å³å»ºç«‹ <code>AuthLoginDelegate.h</code> å’Œ <code>AppDelegateProtocol</code></p><p>å¤§è‡´çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">AppDelegateProtocol</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)jumpToHomeVC;</span><br><span class="line">- (<span class="keyword">void</span>)jumpToShopListVC:(<span class="built_in">NSArray</span> *)shops;</span><br><span class="line">- (<span class="built_in">CLLocationCoordinate2D</span>)getCoordinate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">AuthLoginDelegate</span> &lt;<span class="title">NSObject</span>&gt;[<span class="title">Pods</span>](<span class="title">media</span>/<span class="title">Pods</span>.)</span></span><br><span class="line">+ (<span class="keyword">void</span>)authLoginSuccess;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><h3 id="4-2-3-åœ¨ä¸»å·¥ç¨‹ä¸­å»å®ç°åè®®"><a href="#4-2-3-åœ¨ä¸»å·¥ç¨‹ä¸­å»å®ç°åè®®" class="headerlink" title="4.2.3 åœ¨ä¸»å·¥ç¨‹ä¸­å»å®ç°åè®®"></a>4.2.3 åœ¨ä¸»å·¥ç¨‹ä¸­å»å®ç°åè®®</h3><p>AppDelegateProtocol ç”± AppDelegate æ‰©å±•å®ç°ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> LPDBLoginModule;</span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AppDelegate</span> (<span class="title">Protocol</span>)  &lt;<span class="title">AppDelegateProtocol</span>&gt;</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AppDelegate</span> (<span class="title">Protocol</span>)</span></span><br><span class="line">- (<span class="built_in">CLLocationCoordinate2D</span>)getCoordinate &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)jumpToHomeVC &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)jumpToShopListVC:(<span class="built_in">NSArray</span> *)shops &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p>AuthLoginDelegate ç”± AuthLoginManager(è¿™ä¸ª Manager åœ¨ä¸»å·¥ç¨‹ä¸­æ˜¯ swift ç¼–å†™çš„) å®ç°ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">AuthLoginManager</span>: <span class="title">AuthLoginDelegate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">authLoginSuccess</span><span class="params">()</span></span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-4-åœ¨-LPDBLoginModule-è°ƒç”¨æœåŠ¡"><a href="#4-2-4-åœ¨-LPDBLoginModule-è°ƒç”¨æœåŠ¡" class="headerlink" title="4.2.4 åœ¨ LPDBLoginModule è°ƒç”¨æœåŠ¡"></a>4.2.4 åœ¨ LPDBLoginModule è°ƒç”¨æœåŠ¡</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">id</span> delegate = [[<span class="built_in">UIApplication</span> sharedApplication] delegate];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (![delegate conformsToProtocol:<span class="class"><span class="keyword">@protocol</span>(<span class="title">AppDelegateProtocol</span>)]) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">CLLocationCoordinate2D</span> coordinate = [delegate coordinate];</span><br></pre></td></tr></table></figure><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *className = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@.AuthLoginManager"</span>, [<span class="built_in">NSString</span> targetName]];</span><br><span class="line"><span class="keyword">id</span> authLoginManager = <span class="built_in">NSClassFromString</span>(className);</span><br><span class="line"><span class="keyword">if</span> (![authLoginManager conformsToProtocol:<span class="class"><span class="keyword">@protocol</span>(<span class="title">LPDBAuthLoginDelegate</span>)]) </span>&#123;</span><br><span class="line">     <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">[authLoginManager authLoginSuccess];</span><br><span class="line">[<span class="keyword">self</span> jumpToSelectShopView:shops];</span><br></pre></td></tr></table></figure><p>ç»è¿‡è¿™äº›æ”¹é€ ä¹‹åï¼Œæ¨¡å—é—´çš„çŠ¶æ€å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS-Modularization-06.png" alt=""></p><p>ä½†æ˜¯ï¼Œå¯ä»¥å¾ˆæ˜æ˜¾æ„Ÿå—åˆ°ï¼Œè¿™æ¬¡çš„æ”¹å˜å¹¶ä¸å½»åº•ï¼š</p><ol><li>è¿˜æ˜¯å­˜åœ¨å¤§é‡çš„ <code>![delegate conformsToProtocol:@protocol(AppDelegateProtocol)]</code> è¿™æ ·çš„åˆ¤æ–­ï¼Œä»…ä»…æ˜¯èµ·åˆ°äº†å®¹é”™ï¼Œä¿è¯ä¸ä¼š crashï¼Œä½†æ˜¯å´ä¸èƒ½å°†é—®é¢˜æš´éœ²åœ¨ç¼–è¯‘é˜¶æ®µã€‚</li><li><code>AppDelegateProtocol</code> æ˜æ˜æ˜¯ä¸€ä¸ªå…¬å…±çš„ï¼Œå¤šä¸ªæ¨¡å—ä½¿ç”¨çš„åè®®ï¼Œå´è¢«å®šä¹‰åˆ°äº† <code>LPDBLoginModule</code></li><li>æ¦‚å¿µé¢ å€’ï¼Œç†æƒ³çŠ¶æ€ä¸‹ï¼Œåº”è¯¥æ˜¯å„ä¸ªå­æ¨¡å—æä¾›åè®®å’Œå®ç°ï¼Œå‘ŠçŸ¥å…¶ä»–æ¨¡å—å¯ä»¥è°ƒç”¨è¯¥æ¨¡å—å“ªäº›åŠŸèƒ½ã€‚è€Œç›®å‰æ˜¯å­æ¨¡å—å‘ŠçŸ¥å…¶ä»–æ¨¡å—éœ€è¦è°ƒç”¨å“ªäº›æ–¹æ³•ï¼Œç”±å…¶ä»–æ¨¡å—å®ç°ã€‚</li></ol><p>é‚£ä¹ˆä¸ºäº†å½»åº•è§£å†³é—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥äº† <a href="https://github.com/Vegetarians/Lotusoot" target="_blank" rel="noopener">Lotusoot â€”â€” ç»„ä»¶é€šä¿¡å’Œå·¥å…·</a>ã€‚</p><h2 id="4-3-å¤„ç†æ¨¡å—è€¦åˆä»£ç -Lotusoot"><a href="#4-3-å¤„ç†æ¨¡å—è€¦åˆä»£ç -Lotusoot" class="headerlink" title="4.3 å¤„ç†æ¨¡å—è€¦åˆä»£ç -Lotusoot"></a>4.3 å¤„ç†æ¨¡å—è€¦åˆä»£ç -Lotusoot</h2><p> <a href="https://github.com/Vegetarians/Lotusoot" target="_blank" rel="noopener">Lotusoot</a> çš„æœ€åˆç›®çš„å°±æ˜¯ä¸ºäº†è§£å†³æ¨¡å—é—´çš„è€¦åˆï¼Œå¹¶ä¸”åŒæ—¶æ”¯æŒ OC å’Œ Swift ä½¿ç”¨ï¼Œä¹Ÿæ˜¯è¿™å‡ ä¸ªæœˆä¸­å»åšçš„ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„ä¸œè¥¿ï¼Œåº“æœ¬èº«å°å·§çµæ´»ï¼ŒåŒ…å«çš„ä¸œè¥¿ä¹Ÿå¾ˆå°‘ï¼Œä½†æ˜¯èµ·åˆ°çš„è§„èŒƒä½œç”¨å´æ˜¯æˆ‘éå¸¸æ»¡æ„çš„ä¸€ç‚¹ã€‚</p><p>Lotusoot è§„èŒƒçš„æ ¸å¿ƒæ€æƒ³ä¸»è¦æ˜¯ä»¥ä¸‹å‡ æ­¥ï¼Œæˆ‘ä»¬åŒæ ·ä½¿ç”¨ä¸Šé¢çš„ <code>LPDBLoginModule ä¸ºä¾‹</code>ï¼š</p><h3 id="4-3-1-å»ºç«‹å…±ç”¨æ¨¡å—â€”â€”LPDBPublicModule"><a href="#4-3-1-å»ºç«‹å…±ç”¨æ¨¡å—â€”â€”LPDBPublicModule" class="headerlink" title="4.3.1 å»ºç«‹å…±ç”¨æ¨¡å—â€”â€”LPDBPublicModule"></a>4.3.1 å»ºç«‹å…±ç”¨æ¨¡å—â€”â€”LPDBPublicModule</h3><p><code>LPDBPublicModule</code>ä¸­å®šä¹‰äº†å„ä¸ªæ¨¡å—å¯ä»¥æä¾›çš„æœåŠ¡ï¼Œåšæˆåè®®ï¼Œç§°ä¸º Lotusï¼Œä¸€ä¸ª Lotus åè®®åŒ…å«äº†ä¸€ä¸ªæ¨¡å—çš„æ‰€æœ‰çš„èƒ½è°ƒç”¨çš„æ–¹æ³•çš„åˆ—è¡¨ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@objc</span> <span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">AppDelegateLotus</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">jumpToHomeVC</span><span class="params">()</span></span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">jumpToSelectShopVC</span><span class="params">(shops: [Any], isNapos: Bool)</span></span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">getCoordinate</span><span class="params">()</span></span> -&gt; <span class="type">CLLocationCoordinate2D</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@objc</span> <span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">MainLotus</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">authLoginSuccess</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3-2-å„ä¸ªæ¨¡å—ä¸­ï¼Œå®ç°-LPDBPublicModule-ä¸­å¯¹åº”çš„-Lotus-åè®®"><a href="#4-3-2-å„ä¸ªæ¨¡å—ä¸­ï¼Œå®ç°-LPDBPublicModule-ä¸­å¯¹åº”çš„-Lotus-åè®®" class="headerlink" title="4.3.2 å„ä¸ªæ¨¡å—ä¸­ï¼Œå®ç° LPDBPublicModule ä¸­å¯¹åº”çš„ Lotus åè®®"></a>4.3.2 å„ä¸ªæ¨¡å—ä¸­ï¼Œå®ç° LPDBPublicModule ä¸­å¯¹åº”çš„ Lotus åè®®</h3><p>å®ç°åè®®çš„ Class ç§°ä¸º Lotusootã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppDelegateLotusoot</span>: <span class="title">NSObject</span>, <span class="title">AppDelegateLotus</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">jumpToHomeVC</span><span class="params">()</span></span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">jumpToSelectShopVC</span><span class="params">(shops: [Any], isNapos: Bool)</span></span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">getCoordinate</span><span class="params">()</span></span> -&gt; <span class="type">CLLocationCoordinate2D</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainLotusoot</span>: <span class="title">NSObject</span>, <span class="title">MainLotus</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">authLoginSuccess</span><span class="params">()</span></span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3-3-æ³¨å†ŒæœåŠ¡"><a href="#4-3-3-æ³¨å†ŒæœåŠ¡" class="headerlink" title="4.3.3 æ³¨å†ŒæœåŠ¡"></a>4.3.3 æ³¨å†ŒæœåŠ¡</h3><p><strong>éœ€è¦ç€é‡è¯´æ˜çš„æ˜¯ï¼Œè¿™ä¸€æ­¥æ˜¯å¯ä»¥çœç•¥çš„ï¼Œé€šè¿‡ Lotusoot æä¾›çš„è„šæœ¬å’Œæ³¨è§£ï¼Œå¯ä»¥è‡ªåŠ¨ä¸ºæ‰€æœ‰çš„è·¯ç”±è¿›è¡Œæ³¨å†Œã€‚è¯·ç§»æ­¥ <a href="https://github.com/Vegetarians/Lotusoot" target="_blank" rel="noopener">Lotusoot</a>å‚è€ƒã€3. æ³¨è§£ä¸è§„èŒƒã€éƒ¨åˆ†ã€‚</strong></p><p><code>didFinishLaunchingWithOptions</code> ä¸­æ³¨å†ŒæœåŠ¡ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[LotusootCoordinator registerWithLotusoot:[AppDelegateLotusoot new] lotusName:<span class="string">@"AppDelegateLotus"</span>];</span><br><span class="line">    [LotusootCoordinator registerWithLotusoot:[MainLotusoot new] lotusName:<span class="string">@"MainLotus"</span>];</span><br></pre></td></tr></table></figure><h3 id="4-3-3-åœ¨å…¶ä»–æ¨¡å—ä¸­è°ƒç”¨æœåŠ¡"><a href="#4-3-3-åœ¨å…¶ä»–æ¨¡å—ä¸­è°ƒç”¨æœåŠ¡" class="headerlink" title="4.3.3 åœ¨å…¶ä»–æ¨¡å—ä¸­è°ƒç”¨æœåŠ¡"></a>4.3.3 åœ¨å…¶ä»–æ¨¡å—ä¸­è°ƒç”¨æœåŠ¡</h3><p>ç°åœ¨åªéœ€è¦ <code>import Lotusoot</code>ã€<code>import ModulePublic</code></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">id</span>&lt;MainLotus&gt; mainModule = [LotusootCoordinator lotusootWithLotus:<span class="string">@"MainLotus"</span>];</span><br><span class="line">[mainModule authLoginSuccess];</span><br></pre></td></tr></table></figure><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœä½¿ç”¨å­—ç¬¦ä¸² @"AppDelegateLotus" æ³¨å†Œï¼Œå»ºè®®å®šä¹‰åœ¨ LPDBPublicModule</span></span><br><span class="line"><span class="comment">// ä¹Ÿå¯ä»¥ä½¿ç”¨ NSStirngFromClass(AppDelegateLotus.class)</span></span><br><span class="line"><span class="keyword">id</span>&lt;AppDelegateLotus&gt; appDelegateLotus = [LotusootCoordinator lotusootWithLotus:<span class="string">@"AppDelegateLotus"</span>];</span><br><span class="line">[appDelegateLotus goToHomeVC];</span><br></pre></td></tr></table></figure><p>æ— è®º OC è¿˜æ˜¯ Swiftï¼Œéƒ½å¯ä»¥é¡ºç•…è°ƒç”¨</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æˆ–è€…ä½¿ç”¨ç±»ä¼¼å­—ç¬¦ä¸² "AccountLotus"ï¼Œä½†éœ€è¦ä½ ç®¡ç†å¥½ kAccountLotusï¼Œå°½é‡ä¸è¦ç¡¬ç¼–ç </span></span><br><span class="line"><span class="keyword">let</span> appDelegateLotus = s(<span class="type">AppDelegateLotus</span>.<span class="keyword">self</span>) </span><br><span class="line"><span class="keyword">let</span> appDelegateLotusoot: <span class="type">AppDelegateLotus</span> = <span class="type">LotusootCoordinator</span>.lotusoot(lotus: appDelegateLotus) <span class="keyword">as</span>! <span class="type">AppDelegateLotus</span></span><br><span class="line">accountModule.goToHomeVC()</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mainLotus = s(<span class="type">MainLotus</span>.<span class="keyword">self</span>) </span><br><span class="line"><span class="keyword">let</span> mainModule: <span class="type">MainLotus</span> = <span class="type">LotusootCoordinator</span>.lotusoot(lotus: mainLotus) <span class="keyword">as</span>! <span class="type">MainLotus</span></span><br><span class="line">mainModule.authLoginSuccess()</span><br></pre></td></tr></table></figure><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œå°±æ¯”è¾ƒå®Œæ•´çš„è§£å†³äº†æ¨¡å—é—´è€¦åˆã€‚æ¸…çˆ½çš„é£æ ¼ç”¨ä¸€å¼ å›¾è¡¨ç¤ºå°±æ˜¯è¿™æ ·ï¼ˆè¿™æ˜¯æˆ‘åœ¨åš Lotusoot è§£è¯´æ—¶å€™ç”¨çš„ä¸€å¼ é…å›¾ï¼‰ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS-Modularization-07.png" alt=""></p><p><code>LPDBPublicModule</code> ä¸­çš„ <code>Lotus</code> åè®®ï¼Œåƒä¸€å¼ æ¸…å•åˆ—å‡ºäº†æ‰€æœ‰æ¨¡å—æä¾›çš„æœåŠ¡å£°æ˜ï¼Œè€Œåœ¨å„ä¸ªæ¨¡å—ä¸­ï¼Œç›´æ¥é€šè¿‡è¿™äº›å…¬å…±åè®®å°±å¯ä»¥è°ƒç”¨æƒ³è¦çš„æœåŠ¡ã€‚å¾ˆå¤šé—®é¢˜éƒ½å¯ä»¥åœ¨ç¼–è¯‘å‰å’Œç¼–è¯‘é˜¶æ®µæ˜¾ç¤ºå‡ºæ¥ï¼ˆå¦‚æœæ¨¡å—ä¸æä¾›æœåŠ¡ï¼Œæ˜¯ä¸èƒ½é€šè¿‡ç¼–è¯‘çš„ï¼›å¦‚æœæ²¡æœ‰ä¸€é¡¹æœåŠ¡æ²¡æœ‰å£°æ˜ï¼Œæ˜¯ä¸èƒ½é€šè¿‡ç¼–è¯‘çš„ï¼‰ã€‚</p><h2 id="4-4-è¯­è¨€è€¦åˆ"><a href="#4-4-è¯­è¨€è€¦åˆ" class="headerlink" title="4.4 è¯­è¨€è€¦åˆ"></a>4.4 è¯­è¨€è€¦åˆ</h2><p>æˆ‘ä»¬æŠ½æ¨¡å—ä¸­ä¸€ä¸ªé‡è¦çš„ç›®çš„å°±æ˜¯ã€åˆ†å‰²ä¸¤ç§è¯­è¨€ã€ï¼Œä½†æ˜¯å®è·µè¿‡ç¨‹ä¸­ï¼Œä¼šå‘ç°ï¼Œåˆ†å‰²è¯­è¨€æ¯”åˆ†å‰²ä¸šåŠ¡è¿˜è¦éš¾ã€‚</p><p>ä¸€ä¸ª Pod åº“ä¸­åªèƒ½åŒ…å«ä¸€ç§è¯­è¨€ï¼Œä½†å¾€å¾€ï¼Œåœ¨æŠ½ç¦»ä»£ç çš„æœ€åï¼Œä¼šå‘ç°æœ‰æ— æ•°çš„<strong>åŸºç¡€ Model è€¦åˆ</strong>ï¼Œå¦‚ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ShopInfo</span> : <span class="title">LPDBModel</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) DeliveryService *workingProduct;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) DeliveryService *preEffectiveProduct;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DeliveryService</span>: <span class="title">BaseModel</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦å°† <code>ShopInfo</code> å’Œ <code>DeliveryService</code> æŠ½å‡ºåˆ°ä¸€ä¸ªæ¨¡å—æ—¶ï¼Œå¿…é¡»è¦ã€æœ‰èˆæœ‰å¾—ã€ï¼Œåœ¨æ¶‰åŠåˆ°åŸºç¡€ Model è¯­è¨€ä¸åŒæ—¶ï¼Œå¯ä»¥é€‚å½“çš„é‡å†™ï¼Œå› ä¸º Model çš„ä»£ç é‡æ˜¯æå°çš„ï¼ŒModel é€šå¸¸ä¹ŸåªåŒ…å«å±æ€§å£°æ˜ï¼Œä½œä¸ºæ•°æ®ä¼ è¾“çš„ä¸­ä»‹ï¼Œå³ä½¿æ›´æ”¹ï¼Œäº§ç”Ÿçš„ä¸å¯é¢„æ”¯é”™è¯¯çš„å¯èƒ½æ€§ä¹Ÿè¾ƒä½ã€‚</p><p>å¦‚æœè¦æŠ½å‡ºçš„æ¨¡å—ä¸»ä½“ä½¿ç”¨ OCï¼Œé‚£ä¹ˆå¯ä»¥å°† <code>DeliveryService</code> é‡æ–°ç”¨ OC ç¼–å†™ã€‚</p><p>ä½†è¦æ³¨æ„ï¼Œè¦å…ˆå°½é‡é€šè¿‡æ‹†åˆ†æ›´åŸºç¡€çš„æœåŠ¡æ¨¡å—ï¼Œåœ¨è€ƒè™‘é‡æ–°ç¼–å†™æ–‡ä»¶ï¼Œä¿è¯é¡¹ç›®çš„ç¨³å®šæ€§ã€‚</p><h2 id="4-5-æ¨¡å—çš„ç§¯æœ¨åŒ–"><a href="#4-5-æ¨¡å—çš„ç§¯æœ¨åŒ–" class="headerlink" title="4.5 æ¨¡å—çš„ç§¯æœ¨åŒ–"></a>4.5 æ¨¡å—çš„ç§¯æœ¨åŒ–</h2><p>æ¨¡å—åŒ–çš„æœ€ç»ˆç›®çš„ï¼Œä¸ä»…ä»…æ˜¯å»è€¦ï¼Œè¿˜åº”å½“è®©æ¯ä¸ªæ¨¡å—åƒç§¯æœ¨ä¸€æ ·ï¼Œéšæ„æ‹¼æ¥ï¼Œæœ€åè¾¾åˆ°ä¸»å·¥ç¨‹å®Œå…¨æ²¡æœ‰ä»£ç ï¼Œé€šè¿‡ Pod é›†æˆå„ä¸ªæ¨¡å—ï¼Œç»„æˆå®Œæ•´çš„åŠŸèƒ½ã€‚è€Œæ¯ä¸ªæ¨¡å—ä¹Ÿåº”å½“å¯ä»¥ç‹¬ç«‹æµ‹è¯•ï¼Œç‹¬ç«‹å¼€å‘ã€‚</p><p>è¿˜æ˜¯ä»¥ <code>LPDBLoginModule</code> å’Œ <code>LPDBNetWort</code> ä¸ºä¾‹ã€‚</p><p>ç™»å½•æ¨¡å—æ˜¯ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„æ¨¡å—ï¼Œæ‰€æœ‰çš„å­æ¨¡å—å¦‚æœæƒ³ç‹¬ç«‹æµ‹è¯•å’Œå¼€å‘ï¼Œä¸€èˆ¬éƒ½éœ€è¦é€šè¿‡ç™»å½•éªŒè¯ï¼Œæ¯”å¦‚è®¢å•æ¨¡å—ï¼Œå¿…é¡»è¦ç™»å½•åï¼Œè¯¥ä¸šåŠ¡æ¨¡å—å†…èƒ½æ‰èƒ½æ­£ç¡®çš„æ‹‰å–è®¢å•ä¿¡æ¯ã€‚</p><p>ç”±äº <code>LPDBLoginModule</code> ä¾èµ–åŸºç¡€åº“ <code>LPDBNetWort</code>ï¼Œ<code>LPDBNetWort</code> éœ€è¦åšçš„æœ‰ï¼š</p><ol><li>åŒ…å« cer æ–‡ä»¶ï¼Œå¯ä»¥æ­£ç¡®çš„æä¾›ç»™å…¶ä»–æ¨¡å—æ­£å¸¸çš„ https æ¥å£è®¿é—®</li><li>ä¾¿åˆ©çš„ç½‘ç»œæœåŠ¡è°ƒç”¨</li></ol><p>è€Œ <code>LPDBLoginModule</code> è‡³å°‘è¦åšçš„äº‹æœ‰ï¼š</p><ol><li>å¯ä»¥æ­£ç¡®çš„ä¿å­˜ç™»å½•ä¿¡æ¯ï¼Œå®Œæˆç™»å½•æ“ä½œ</li><li>æä¾›ç™»å½•çš„ UI ç•Œé¢ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ LoginVC</li></ol><p>åœ¨å…·å¤‡ä»¥ä¸ŠåŠŸèƒ½åï¼Œ<code>LPDBLoginModule</code> å°±å¯ä»¥å¿«é€Ÿçš„é›†æˆè¿›å…¶ä»–æ¨¡å—ï¼Œä¸ºå…¶ä»–æ¨¡å—æä¾›ç‹¬ç«‹å¼€å‘ã€ç‹¬ç«‹æµ‹è¯•çš„åŠŸèƒ½ã€‚</p><h2 id="4-6-èµ„æºæ‰“åŒ…"><a href="#4-6-èµ„æºæ‰“åŒ…" class="headerlink" title="4.6 èµ„æºæ‰“åŒ…"></a>4.6 èµ„æºæ‰“åŒ…</h2><p>ä¸Šä¸€å°ç»“æåˆ°ã€ <code>LPDBLoginModule</code> è¦æä¾›ç™»å½•çš„ UI ç•Œé¢ã€ã€‚å¯¹äº UI ç•Œé¢ï¼Œéœ€è¦åšçš„æ˜¯èµ„æºæ‰“åŒ…ï¼Œåœ¨æ¨¡å—æ‹†åˆ†ä¸­ï¼Œè¦éå¸¸æ³¨æ„èµ„æºåˆ†å‰²ã€‚</p><p><em><strong>å› ä¸ºä¸šåŠ¡æ¨¡å—çš„åˆ’åˆ†ï¼Œä¸ä»…ä»…æ˜¯æ˜¯ä»£ç æŠ½å‡ºï¼Œä¹Ÿæœ‰èµ„æºæŠ½å‡ºã€‚</strong></em></p><p>èµ„æºåº“åŒ…æ‹¬ä½†ä¸ä»…é™äºï¼š</p><ol><li><code>.xib</code> æ–‡ä»¶</li><li>å£°éŸ³èµ„æº</li><li>å›¾ç‰‡èµ„æº</li><li>çº¯æ–‡æœ¬æ–‡ä»¶</li><li>è§†é¢‘èµ„æº</li></ol><p>æ‰€ä»¥ï¼Œæ‰€æœ‰çš„èµ„æºæ–‡ä»¶ï¼Œåº”å½“å•ç‹¬åˆ›ç«‹ <code>Res</code> æ–‡ä»¶å¤¹ï¼Œæ”¾å…¥å…¶ä¸­ï¼Œå¹¶åœ¨ <code>.podspec</code> ä¸­è¡¨æ˜èµ„æºæ–‡ä»¶è·¯å¾„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s.resources  = ["Source/**/*.xib", "Source/Res/*.xcassets"]</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„å›¾ç‰‡èµ„æºï¼Œå¦‚æœæƒ³ä¿ç•™ @2xã€@3xï¼Œæ˜¯å¯ä»¥æŒ‰ç…§ xcassets çš„æ ¼å¼ç›´æ¥ copy è¿‡æ¥çš„ã€‚</p></blockquote><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS-Modularization-08.png" alt=""></p><h1 id="5-ç»“å°¾"><a href="#5-ç»“å°¾" class="headerlink" title="5 ç»“å°¾"></a>5 ç»“å°¾</h1><p>ä»¥ä¸Šæ˜¯æˆ‘åœ¨æ··ç¼–é¡¹ç›®ä¸­è¿›è¡Œ æ¨¡å—åŒ–/ ç»„ä»¶åŒ–çš„ç»éªŒæ€»ç»“ï¼Œå†™æˆäº†æŒ‡å¯¼çš„æ¨¡å¼ï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¯¹èµ°åŒæ ·è·¯çš„äººæœ‰æ‰€å¸®åŠ©ï¼Œå¸Œæœ›ä½ ä»¬ä¼šæœ‰æ‰€æ”¶è·ï¼Œä¹ˆä¹ˆå“’ã€‚</p><hr><p>æœ‰ä»€ä¹ˆé—®é¢˜éƒ½å¯ä»¥åœ¨åšæ–‡åé¢ç•™è¨€ï¼Œæˆ–è€…å¾®åšä¸Šç§ä¿¡æˆ‘ï¼Œæˆ–è€…é‚®ä»¶æˆ‘ <a href="mailto:&#x63;&#111;&#100;&#x65;&#x72;&#x66;&#x69;&#x73;&#x68;&#x40;&#x31;&#x36;&#x33;&#x2e;&#99;&#111;&#x6d;" target="_blank" rel="noopener">&#x63;&#111;&#100;&#x65;&#x72;&#x66;&#x69;&#x73;&#x68;&#x40;&#x31;&#x36;&#x33;&#x2e;&#99;&#111;&#x6d;</a>ã€‚</p><p>åšä¸»æ˜¯ iOS å¦¹å­ä¸€æšã€‚</p><p>å¸Œæœ›å¤§å®¶ä¸€èµ·è¿›æ­¥ã€‚</p><p>æˆ‘çš„å¾®åšï¼š<a href="http://weibo.com/coderfish/" target="_blank" rel="noopener">å°é±¼å‘¨å‡Œå®‡</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;1-å¼€ç¯‡&quot;&gt;&lt;a href=&quot;#1-å¼€ç¯‡&quot; class=&quot;headerlink&quot; title=&quot;1. å¼€ç¯‡&quot;&gt;&lt;/a&gt;1. å¼€ç¯‡&lt;/h1&gt;&lt;p&gt;æœ¬æ–‡çš„åˆè¡·ï¼Œæ˜¯ä¸ºäº†ç»™æ­£åœ¨åšæ··ç¼–æˆ–è€…æ¨¡å—åŒ–çš„åŒå­¦ä»¬ä¸€ä¸ªå»ºè®®å’Œå‚è€ƒã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºæ¥é¥¿å‚ä»¥ååšçš„é¡¹ç›®æ˜¯å…¨å…¬å¸å”¯ä¸€ä¸€ä¸ª Swift/OC æ··ç¼–çš„ iOS é¡¹ç›®ï¼Œæ‰€ä»¥ä¸€è·¯ä¸Šè¸©å‘æ— æ•°ï¼Œç°åœ¨æŠŠä¸€äº›è¸©å‘çš„è¿‡ç¨‹å’Œç»éªŒæ€»ç»“èµ·æ¥ï¼Œä¾›å¤§å®¶å‚è€ƒã€‚&lt;/p&gt;
&lt;p&gt;ç›¸ä¿¡åœ¨æµè§ˆæœ¬æ–‡åï¼Œä¸€å®šä¼šæœ‰æ‰€æ”¶è·ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘æ¥çš„æ—¶å€™é¡¹ç›®å·²ç»å¼€å§‹ Swift æ”¹é€ äº†ï¼Œæ…¢æ…¢çš„æŠŠé¡¹ç›® Swift åŒ–ï¼Œæ–°ä»£ç éƒ½æ˜¯ Swift çš„ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆå…¬å¸ƒä¸ƒä¸ªæœˆæˆæœï¼Œä¸‹å›¾æ˜¯æˆ‘ä»¬æœ€ç»ˆçš„é¡¹ç›®ç»“æ„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS-Modularization-03.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;å¯¹äºæˆ‘ä»¬æ··ç¼–çš„æƒ…å†µï¼Œåœ¨äº”ä¸ªæœˆå‰å¤§å®¶å°±å±•å¼€äº†è®¨è®ºã€‚&lt;/p&gt;
&lt;p&gt;ç»™æˆ‘ä»¬çš„é€‰æ‹©æœ‰ä¸¤ç§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ…¢æ…¢å°† OC ä»£ç æ›¿æ¢æˆ Swift&lt;/li&gt;
&lt;li&gt;å°½å¿«æ¨¡å—åŒ–ï¼Œåˆ†ç¦»ä¸¤ç§è¯­è¨€ä»£ç &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸€å¼€å§‹æˆ‘ä»¬æ˜¯ä» &lt;code&gt;é€‰æ‹©1&lt;/code&gt; å¼€å§‹åšçš„ï¼Œä½†æ˜¯å¾ˆå¿«æˆ‘ä»¬å°±å‘ç°ï¼Œå¯¹äºæˆ‘ä»¬ 74% éƒ½æ˜¯ OC ä»£ç çš„é¡¹ç›®æ¥è¯´ï¼Œå¤ªç—›äº†ï¼Œå¤ªæ¼«é•¿äº†ï¼Œè€Œä¸”æœŸé—´è¿­ä»£çš„è¿‡ç¨‹ä¸­è¿˜åœ¨ä¸æ–­åœ°è¿­ä»£ï¼Œä¸æ–­çš„è€¦åˆã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥åœ¨ç»è¿‡ä¸€ç•ªåˆ©å®³åˆ†æåæˆ‘ä»¬è¿…é€ŸæŠ•å…¥åˆ°äº† &lt;code&gt;é€‰æ‹©2&lt;/code&gt; ä¸­ã€‚ä¸€æ–¹é¢ï¼Œæ¨¡å—åŒ–æœ¬èº«å°±æ˜¯è¶Šæ¥è¶Šè‡ƒè‚¿çš„é¡¹ç›®çš„æœ€ç»ˆå½’å®¿ï¼Œä¸€æ–¹é¢å¯ä»¥æ…¢æ…¢å°†ä¸¤ç§è¯­è¨€å‰¥ç¦»ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://zhoulingyu.com/categories/iOS/"/>
    
      <category term="iOSæ¨¡å—åŒ–" scheme="http://zhoulingyu.com/categories/iOS/iOS%E6%A8%A1%E5%9D%97%E5%8C%96/"/>
    
    
      <category term="iOS" scheme="http://zhoulingyu.com/tags/iOS/"/>
    
      <category term="iOSæ¨¡å—åŒ–" scheme="http://zhoulingyu.com/tags/iOS%E6%A8%A1%E5%9D%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>ã€500 Lines or Lessã€‘-ã€ç¿»è¯‘ç»ƒä¹ ã€‘-ã€chapter 14ã€‘-ã€ç®€å•å¯¹è±¡æ¨¡å‹ã€‘-ã€ç¬¬ä¸‰éƒ¨åˆ†ã€‘</title>
    <link href="http://zhoulingyu.com/2017/11/22/500-Lines-or-Less-14-3/"/>
    <id>http://zhoulingyu.com/2017/11/22/500-Lines-or-Less-14-3/</id>
    <published>2017-11-22T15:27:19.000Z</published>
    <updated>2018-07-10T03:07:31.624Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åŸæ–‡é“¾æ¥ï¼š<a href="http://aosabook.org/en/500L/a-simple-object-model.html" target="_blank" rel="noopener">A Simple Object Model</a><br>ä½œè€…ä¿¡æ¯ï¼š<a href="https://twitter.com/cfbolz" target="_blank" rel="noopener">Carl Friedrich Bolz</a></p></blockquote><hr><blockquote><p><a href="http://zhoulingyu.com/2017/10/31/500-Lines-or-Less-14-2/">ä¸Šä¸€ç¯‡ï¼šã€Šã€500 Lines or Lessã€‘-ã€ç¿»è¯‘ç»ƒä¹ ã€‘-ã€chapter 14ã€‘-ã€ç®€å•å¯¹è±¡æ¨¡å‹ã€‘-ã€ç¬¬äºŒéƒ¨åˆ†ã€‘ã€‹</a><br>è¯‘è€…æ³¨ï¼šä¼‘æ¯ç»“æŸï¼Œæˆ‘ä»¬ç»§ç»­</p></blockquote><h1 id="å®ä¾‹ä¼˜åŒ–"><a href="#å®ä¾‹ä¼˜åŒ–" class="headerlink" title="å®ä¾‹ä¼˜åŒ–"></a>å®ä¾‹ä¼˜åŒ–</h1><p>è™½ç„¶å¯¹è±¡æ¨¡å‹çš„åœ¨ä¹‹å‰çš„å‡ èŠ‚ä¸­å‘ç”Ÿäº†å¾ˆå¤šè¡Œä¸ºå˜åŒ–ï¼Œä½†åœ¨æœ€åä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨æ²¡æœ‰å½±å“ä»»ä½•è¡Œä¸ºçš„æƒ…å†µä¸‹è¿›è¡Œä¼˜åŒ–ã€‚è¿™ç§ä¼˜åŒ–è¢«ç§°ä¸º mapsï¼Œå¹¶åœ¨è‡ªç¼–ç¨‹è¯­è¨€çš„è™šæ‹Ÿæœºä¸­ç‡å…ˆè¢«ä½¿ç”¨ã€‚å¦‚ä»Šï¼Œå®ƒä»ç„¶æ˜¯æœ€é‡è¦çš„å¯¹è±¡æ¨¡å‹ä¼˜åŒ–ä¹‹ä¸€ï¼šå®ƒè¢«ç”¨äº PyPy å’Œæ‰€æœ‰ç°ä»£ JavaScript è™šæ‹Ÿæœºï¼Œå¦‚V8ï¼ˆå…¶ä¸­ä¼˜åŒ–è¢«ç§°ä¸º <em>hidden classes</em>ï¼‰ã€‚</p><p>ç›®å‰çš„è§‚å¯Ÿï¼šåœ¨åˆ°ç›®å‰ä¸ºæ­¢å®ç°çš„å¯¹è±¡æ¨¡å‹ä¸­ï¼Œæ‰€æœ‰å®ä¾‹éƒ½ä½¿ç”¨å®Œæ•´çš„å­—å…¸æ¥å­˜å‚¨å®ƒä»¬çš„å±æ€§ã€‚å­—å…¸æ˜¯ä½¿ç”¨å“ˆå¸Œæ˜ å°„æ¥å®ç°çš„ï¼Œè¿™æ¶ˆè€—å¤§é‡çš„å†…å­˜ã€‚æ­¤å¤–ï¼ŒåŒä¸€ä¸ªç±»çš„å®ä¾‹å°†ä¼šæ‹¥æœ‰åŒæ ·çš„å±æ€§ï¼Œæ¯”å¦‚ï¼Œæœ‰ä¸€ä¸ªç±» <code>Point</code>ï¼Œå®ƒæ‰€æœ‰çš„å®ä¾‹éƒ½åŒ…å«åŒæ ·çš„å±æ€§ <code>x</code>ã€<code>y</code>ã€‚</p><p>maps ä¼˜åŒ–åˆ©ç”¨äº†è¿™ä¸€ç‚¹ã€‚å®ƒæœ‰æ•ˆåœ°å°†æ¯ä¸ªå®ä¾‹çš„å­—å…¸åˆ†æˆä¸¤éƒ¨åˆ†ã€‚ä¸€éƒ¨åˆ†å­˜æ”¾æ‰€æœ‰å®ä¾‹å…±äº«çš„ keysã€‚è€Œå®ä¾‹åªå­˜å‚¨å¯¹å…±äº«æ˜ å°„çš„å¼•ç”¨å’Œåˆ—è¡¨ä¸­çš„å±æ€§å€¼ï¼ˆæ¯”å­—å…¸æ›´æ¶ˆè€—äº†æ›´å°‘çš„å†…å­˜ï¼‰ã€‚</p><p>åšç®€å•æµ‹è¯•ç”¨ä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_maps</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># white box test inspecting the implementation</span></span><br><span class="line">    Point = Class(name=<span class="string">"Point"</span>, base_class=OBJECT, fields=&#123;&#125;, metaclass=TYPE)</span><br><span class="line">    p1 = Instance(Point)</span><br><span class="line">    p1.write_attr(<span class="string">"x"</span>, <span class="number">1</span>)</span><br><span class="line">    p1.write_attr(<span class="string">"y"</span>, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">assert</span> p1.storage == [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">    <span class="keyword">assert</span> p1.map.attrs == &#123;<span class="string">"x"</span>: <span class="number">0</span>, <span class="string">"y"</span>: <span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line">    p2 = Instance(Point)</span><br><span class="line">    p2.write_attr(<span class="string">"x"</span>, <span class="number">5</span>)</span><br><span class="line">    p2.write_attr(<span class="string">"y"</span>, <span class="number">6</span>)</span><br><span class="line">    <span class="keyword">assert</span> p1.map <span class="keyword">is</span> p2.map</span><br><span class="line">    <span class="keyword">assert</span> p2.storage == [<span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line">    p1.write_attr(<span class="string">"x"</span>, <span class="number">-1</span>)</span><br><span class="line">    p1.write_attr(<span class="string">"y"</span>, <span class="number">-2</span>)</span><br><span class="line">    <span class="keyword">assert</span> p1.map <span class="keyword">is</span> p2.map</span><br><span class="line">    <span class="keyword">assert</span> p1.storage == [<span class="number">-1</span>, <span class="number">-2</span>]</span><br><span class="line"></span><br><span class="line">    p3 = Instance(Point)</span><br><span class="line">    p3.write_attr(<span class="string">"x"</span>, <span class="number">100</span>)</span><br><span class="line">    p3.write_attr(<span class="string">"z"</span>, <span class="number">-343</span>)</span><br><span class="line">    <span class="keyword">assert</span> p3.map <span class="keyword">is</span> <span class="keyword">not</span> p1.map</span><br><span class="line">    <span class="keyword">assert</span> p3.map.attrs == &#123;<span class="string">"x"</span>: <span class="number">0</span>, <span class="string">"z"</span>: <span class="number">1</span>&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªæµ‹è¯•ç”¨ä¾‹ä¸åŒäºæˆ‘ä»¬ä¹‹å‰å†™çš„æµ‹è¯•ç”¨ä¾‹ã€‚ä»¥å‰çš„æ‰€æœ‰æµ‹è¯•éƒ½æ˜¯é€šè¿‡å·²çŸ¥çš„æ¥å£æ¥æµ‹è¯•ç±»çš„åŠŸèƒ½ã€‚è€Œæ­¤æµ‹è¯•ç”¨ä¾‹é€šè¿‡è¯»å–å†…éƒ¨å±æ€§å¹¶å°†å…¶ä¸é¢„å®šä¹‰å€¼è¿›è¡Œæ¯”è¾ƒæ¥æ£€æŸ¥ <code>Instance</code> ç±»çš„å®ç°ç»†èŠ‚ã€‚</p><p><code>p1</code> åŒ…å« <code>attrs</code> çš„ <code>map</code> å­˜æ”¾äº† <code>x</code> å’Œ <code>y</code> ä¸¤ä¸ªå±æ€§ï¼Œå…·ä½“åœ¨ <code>p1</code> ä¸­å­˜æ”¾çš„å€¼åˆ†åˆ«ä¸º 0 å’Œ 1ã€‚ååˆ›å»ºçš„ç¬¬äºŒä¸ªå®ä¾‹ <code>p2</code>ï¼ŒåŒæ ·åœ¨ map ä¸­æ·»åŠ åŒæ ·çš„å±æ€§ã€‚ æ¢å¥è¯è¯´ï¼Œå¦‚æœæ·»åŠ äº†ä¸åŒçš„å±æ€§ï¼Œå…¶ map æ˜¯ä¸é€šç”¨çš„ã€‚</p><p><code>Map</code> ç±»ç±»ä¼¼äºä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Map</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, attrs)</span>:</span></span><br><span class="line">        self.attrs = attrs</span><br><span class="line">        self.next_maps = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_index</span><span class="params">(self, fieldname)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.attrs.get(fieldname, <span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">next_map</span><span class="params">(self, fieldname)</span>:</span></span><br><span class="line">        <span class="keyword">assert</span> fieldname <span class="keyword">not</span> <span class="keyword">in</span> self.attrs</span><br><span class="line">        <span class="keyword">if</span> fieldname <span class="keyword">in</span> self.next_maps:</span><br><span class="line">            <span class="keyword">return</span> self.next_maps[fieldname]</span><br><span class="line">        attrs = self.attrs.copy()</span><br><span class="line">        attrs[fieldname] = len(attrs)</span><br><span class="line">        result = self.next_maps[fieldname] = Map(attrs)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">EMPTY_MAP = Map(&#123;&#125;)</span><br></pre></td></tr></table></figure><p>Maps ç±»æ‹¥æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œ<code>get_index</code> å’Œ <code>next_map</code>ã€‚å‰è€…ç”¨äºæŸ¥æ‰¾å¯¹è±¡å­˜å‚¨ä¸­å±æ€§åç§°çš„ç´¢å¼•ã€‚å½“ä¸€ä¸ªæ–°çš„å±æ€§è¢«æ·»åŠ åˆ°ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œåè€…è¢«ä½¿ç”¨ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹è±¡éœ€è¦ä½¿ç”¨ <code>next_map</code> è®¡ç®—ä¸åŒçš„ mapã€‚è¯¥æ–¹æ³•ä½¿ç”¨ <code>next_maps</code> å­—å…¸æ¥ç¼“å­˜å·²ç»åˆ›å»ºçš„ mapã€‚è¿™æ ·ï¼Œå…·æœ‰ç›¸åŒå¸ƒå±€çš„å¯¹è±¡ä¹Ÿæœ€ç»ˆä½¿ç”¨ç›¸åŒçš„ <code>Map</code> å¯¹è±¡ã€‚</p><p><img src="http://aosabook.org/en/500L/objmodel-images/maptransition.png" alt="å›¾ 14.2 Map å…³ç³»"></p><p>ä½¿ç”¨ maps çš„ <code>Instance</code> å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Instance</span><span class="params">(Base)</span>:</span></span><br><span class="line">    <span class="string">"""Instance of a user-defined class. """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, cls)</span>:</span></span><br><span class="line">        <span class="keyword">assert</span> isinstance(cls, Class)</span><br><span class="line">        Base.__init__(self, cls, <span class="keyword">None</span>)</span><br><span class="line">        self.map = EMPTY_MAP</span><br><span class="line">        self.storage = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_read_dict</span><span class="params">(self, fieldname)</span>:</span></span><br><span class="line">        index = self.map.get_index(fieldname)</span><br><span class="line">        <span class="keyword">if</span> index == <span class="number">-1</span>:</span><br><span class="line">            <span class="keyword">return</span> MISSING</span><br><span class="line">        <span class="keyword">return</span> self.storage[index]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_write_dict</span><span class="params">(self, fieldname, value)</span>:</span></span><br><span class="line">        index = self.map.get_index(fieldname)</span><br><span class="line">        <span class="keyword">if</span> index != <span class="number">-1</span>:</span><br><span class="line">            self.storage[index] = value</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            new_map = self.map.next_map(fieldname)</span><br><span class="line">            self.storage.append(value)</span><br><span class="line">            self.map = new_map</span><br></pre></td></tr></table></figure><p>ç›®å‰ <code>Instance</code> ç±»å°†ç»™ <code>Base</code> ç±»ä¼ é€’ <code>None</code> ä½œä¸ºå­—æ®µå­—å…¸ï¼Œå› ä¸º <code>Instance</code> å°†ä¼šä»¥å¦ä¸€ç§æ–¹å¼æ„å»ºå­˜å‚¨å­—å…¸ã€‚å› æ­¤å®ƒéœ€è¦é‡è½½ <code>_read_dict</code> å’Œ <code>_write_dict</code> ã€‚åœ¨å®é™…æ“ä½œä¸­ï¼Œæˆ‘ä»¬å°†é‡æ„ <code>Base</code>ç±»ï¼Œä½¿å…¶ä¸å†è´Ÿè´£å­˜æ”¾å±æ€§å­—å…¸ã€‚ä½†ç›®å‰ï¼Œæˆ‘ä»¬å¯ä»¥ä»…ä»…ä¼ é€’ä¸€ä¸ª <code>None</code> ä½œä¸ºå‚æ•°ã€‚</p><p>åœ¨ä¸€ä¸ªæ–°çš„å®ä¾‹åˆ›å»ºä½¿ç”¨ <code>EMPTY_MAP</code>ï¼Œå…¶ä¸­æ²¡æœ‰å­˜æ”¾ä»»ä½•å¯¹è±¡ã€‚ä¸ºäº†<code>_read_dict</code>ï¼Œ<code>Instance</code> çš„ map è¦æä¾›å±æ€§åç§°çš„ç´¢å¼•ï¼Œç„¶åè¿”å›ç›¸åº”çš„æ¡ç›®ã€‚</p><p>å†™å…¥å±æ€§å­—å…¸æœ‰ä¸¤ç§æƒ…å†µã€‚ç¬¬ä¸€ç§æ˜¯ç°æœ‰å±æ€§å€¼çš„ä¿®æ”¹ï¼Œé‚£ä¹ˆå°±ç®€å•çš„åœ¨ map çš„åˆ—è¡¨ä¸­ä¿®æ”¹å¯¹åº”çš„å€¼å°±å¥½ã€‚è€Œå¦‚æœå¯¹åº”å±æ€§ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆéœ€è¦è¿›è¡Œ map å˜æ¢ï¼ˆå¦‚ä¸Šé¢çš„å›¾æ‰€ç¤ºä¸€æ ·ï¼‰ï¼Œå°†ä¼šè°ƒç”¨ <code>next_map</code> æ–¹æ³•ï¼Œç„¶åå°†æ–°çš„å€¼å­˜æ”¾å…¥å‚¨å­˜åˆ—è¡¨ä¸­ã€‚</p><p>è¿™ä¸ªä¼˜åŒ–åˆ°åº•å®ç°äº†ä»€ä¹ˆï¼Ÿä¸€èˆ¬è€Œè¨€ï¼Œåœ¨å…·æœ‰å¾ˆå¤šç›¸ä¼¼ç»“æ„å®ä¾‹çš„æƒ…å†µä¸‹ä¼˜åŒ–äº†å†…å­˜çš„ä½¿ç”¨ã€‚ä½†è¿™ä¸æ˜¯ä¸€ä¸ªé€šç”¨çš„ä¼˜åŒ–æ‰‹æ®µï¼šæœ‰äº›æ—¶å€™ä»£ç ä¸­å……æ–¥ç€ç»“æ„ä¸åŒçš„å®ä¾‹ä¹‹æ—¶ï¼Œè¿™æ ·ä¼˜åŒ–å¯èƒ½ä¼šè€—è´¹æ›´å¤§çš„ç©ºé—´ã€‚</p><p>åœ¨ä¼˜åŒ–åŠ¨æ€è¯­è¨€æ—¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå¸¸è§é—®é¢˜ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œä¸å¤ªå¯èƒ½æ‰¾åˆ°ä¸€ç§ååˆ†é€šç”¨çš„æ–¹æ³•å»ä¼˜åŒ–ä»£ç ï¼Œæ—¢å…¶æ›´å¿«ï¼ŒåˆèŠ‚çœç©ºé—´ã€‚åœ¨å®è·µä¸­ï¼Œæ‰€é€‰æ‹©çš„ä¼˜åŒ–é€‚ç”¨äºé€šå¸¸ä½¿ç”¨çš„è¯­è¨€ï¼Œè€Œå¯¹äºä½¿ç”¨æå…¶åŠ¨æ€çš„åŠŸèƒ½çš„ç¨‹åºè€Œè¨€ï¼Œå¯èƒ½ä¼šæœ‰ç›¸åçš„ä½œç”¨ã€‚</p><p>maps ä¼˜åŒ–å¦ä¸€ä¸ªæœ‰æ„æ€çš„ç‚¹æ˜¯ï¼Œè™½ç„¶è¿™é‡Œåªä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨ JIT æŠ€æœ¯ çš„ VM ä¸­ï¼Œä¹Ÿèƒ½æé«˜ç¨‹åºçš„æ€§èƒ½ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼ŒJIT æŠ€æœ¯ä½¿ç”¨ maps æ¥æŸ¥æ‰¾å±æ€§åœ¨å­˜å‚¨ç©ºé—´ä¸­çš„åç§»é‡ã€‚ç„¶åå®Œå…¨æ‹œæ‰˜å­—å…¸æŸ¥æ‰¾çš„æ–¹å¼ã€‚</p><h1 id="æ½œåœ¨æ‰©å±•"><a href="#æ½œåœ¨æ‰©å±•" class="headerlink" title="æ½œåœ¨æ‰©å±•"></a>æ½œåœ¨æ‰©å±•</h1><p>æ‰©å±•æˆ‘ä»¬çš„å¯¹è±¡æ¨¡å‹å’Œä½¿ç”¨ä¸åŒè¯­è¨€çš„è®¾è®¡é€‰æ‹©æ˜¯å¾ˆå®¹æ˜“çš„ã€‚è¿™é‡Œç»™å‡ºä¸€äº›å¯èƒ½çš„æ–¹å‘ï¼š</p><ul><li><p>æœ€ç®€å•çš„æ˜¯æ·»åŠ æ›´å¤šçš„ç‰¹æ®Šæ–¹æ³•æ–¹æ³•ï¼Œæ¯”å¦‚ä¸€äº› <code>__init__</code>, <code>__getattribute__</code>, <code>__set__</code> è¿™æ ·å®¹æ˜“å®ç°åˆæœ‰è¶£çš„æ–¹æ³•ã€‚</p></li><li><p>æ‰©å±•æ¨¡å‹æ”¯æŒå¤šé‡ç»§æ‰¿ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæ¯ä¸€ä¸ªç±»éƒ½éœ€è¦ä¸€ä¸ªçˆ¶ç±»åˆ—è¡¨ã€‚ç„¶å <code>Class.method_resolution_order</code> éœ€è¦è¿›è¡Œä¿®æ”¹ï¼Œä»¥ä¾¿æ”¯æŒæ–¹æ³•æŸ¥æ‰¾ã€‚å¯ä»¥ä½¿ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢å’Œåˆ é™¤é‡å¤é¡¹æ¥è®¡ç®—ç®€å•çš„æ–¹æ³•è§£æé¡ºåºã€‚æ›´ä¸ºå¤æ‚çš„å¯ä»¥é‡‡ç”¨ C3 ç®—æ³•, è¿™ç§ç®—æ³•æ‹¥æœ‰æ›´å¥½çš„å¤„ç†è±å½¢ç»§æ‰¿ç»“æ„çš„èƒ½åŠ›ï¼Œå¹¶ä¸”é¿å…äº†ä¸å¯æ„ŸçŸ¥çš„ç»§æ‰¿æ¨¡å¼ã€‚</p></li><li><p>ä¸€ä¸ªæ›´ä¸ºç–¯ç‹‚çš„æƒ³æ³•æ˜¯åˆ‡æ¢åˆ°åŸå‹æ¨¡å¼ï¼Œè¿™éœ€è¦æ¶ˆé™¤ç±»å’Œå®ä¾‹ä¹‹é—´çš„å·®åˆ«ã€‚</p></li></ul><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€è®¾è®¡çš„æ ¸å¿ƒæ˜¯å…¶å¯¹è±¡æ¨¡å‹çš„ç»†èŠ‚ã€‚ç¼–å†™ä¸€äº›ç®€å•çš„å¯¹è±¡æ¨¡å‹åŸå‹å¯ä»¥æ›´å¥½åœ°ç†è§£ç°æœ‰è¯­è¨€çš„å†…éƒ¨å·¥ä½œåŸç†ä»¥åŠæ·±å…¥äº†è§£é¢å‘å¯¹è±¡è¯­è¨€çš„è®¾è®¡ç†å¿µã€‚ç¼–å†™ä¸åŒçš„å¯¹è±¡æ¨¡å‹éªŒè¯ä¸åŒå¯¹è±¡çš„è®¾è®¡æ€è·¯æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ–¹å¼ï¼Œä½ ä¹Ÿå¿…è¯­è¨€å®ç°çš„æ›´æ¯ç‡¥çš„éƒ¨åˆ†ï¼Œæ¯”å¦‚è§£æå’Œæ‰§è¡Œä»£ç ã€‚</p><p>ç¼–å†™å¯¹è±¡æ¨¡å‹åœ¨å®è·µä¸­ä¹Ÿæ˜¯éå¸¸æœ‰ç”¨çš„è€Œä¸ä»…ä»…æ˜¯ç”¨ä½œå®éªŒã€‚é™¤äº†ä½œä¸ºå®éªŒå“ä»¥å¤–ï¼Œå®ƒä»¬è¿˜å¯ä»¥åœ¨ç¼–å†™å…¶ä»–è¯­è¨€ä¸­æ‰€ä½¿ç”¨ã€‚ä¾‹å­æœ‰å¾ˆå¤šï¼šç”¨ C è¯­è¨€ç¼–å†™çš„ GObject æ¨¡å‹ï¼Œç”¨äº GLib å’Œ å…¶ä½™ Gnome åº“ä¸­ï¼Œæˆ–è€… JavaScript å„ç§ç±»ç³»ç»Ÿçš„å®ç°ã€‚</p><hr><p>æœ‰ä»€ä¹ˆé—®é¢˜éƒ½å¯ä»¥åœ¨åšæ–‡åé¢ç•™è¨€ï¼Œæˆ–è€…å¾®åšä¸Šç§ä¿¡æˆ‘ï¼Œæˆ–è€…é‚®ä»¶æˆ‘ <a href="mailto:&#99;&#111;&#100;&#101;&#x72;&#x66;&#105;&#x73;&#104;&#64;&#x31;&#54;&#x33;&#x2e;&#99;&#x6f;&#109;" target="_blank" rel="noopener">&#99;&#111;&#100;&#101;&#x72;&#x66;&#105;&#x73;&#104;&#64;&#x31;&#54;&#x33;&#x2e;&#99;&#x6f;&#109;</a>ã€‚</p><p>åšä¸»æ˜¯ iOS å¦¹å­ä¸€æšã€‚</p><p>å¸Œæœ›å¤§å®¶ä¸€èµ·è¿›æ­¥ã€‚</p><p>æˆ‘çš„å¾®åšï¼š<a href="http://weibo.com/coderfish/" target="_blank" rel="noopener">å°é±¼å‘¨å‡Œå®‡</a></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;åŸæ–‡é“¾æ¥ï¼š&lt;a href=&quot;http://aosabook.org/en/500L/a-simple-object-model.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;A Simple Object Model&lt;/a&gt;&lt;br&gt;ä½œè€…ä¿¡æ¯ï¼š&lt;a href=&quot;https://twitter.com/cfbolz&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Carl Friedrich Bolz&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;http://zhoulingyu.com/2017/10/31/500-Lines-or-Less-14-2/&quot;&gt;ä¸Šä¸€ç¯‡ï¼šã€Šã€500 Lines or Lessã€‘-ã€ç¿»è¯‘ç»ƒä¹ ã€‘-ã€chapter 14ã€‘-ã€ç®€å•å¯¹è±¡æ¨¡å‹ã€‘-ã€ç¬¬äºŒéƒ¨åˆ†ã€‘ã€‹&lt;/a&gt;&lt;br&gt;è¯‘è€…æ³¨ï¼šä¼‘æ¯ç»“æŸï¼Œæˆ‘ä»¬ç»§ç»­&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;å®ä¾‹ä¼˜åŒ–&quot;&gt;&lt;a href=&quot;#å®ä¾‹ä¼˜åŒ–&quot; class=&quot;headerlink&quot; title=&quot;å®ä¾‹ä¼˜åŒ–&quot;&gt;&lt;/a&gt;å®ä¾‹ä¼˜åŒ–&lt;/h1&gt;&lt;p&gt;è™½ç„¶å¯¹è±¡æ¨¡å‹çš„åœ¨ä¹‹å‰çš„å‡ èŠ‚ä¸­å‘ç”Ÿäº†å¾ˆå¤šè¡Œä¸ºå˜åŒ–ï¼Œä½†åœ¨æœ€åä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨æ²¡æœ‰å½±å“ä»»ä½•è¡Œä¸ºçš„æƒ…å†µä¸‹è¿›è¡Œä¼˜åŒ–ã€‚è¿™ç§ä¼˜åŒ–è¢«ç§°ä¸º mapsï¼Œå¹¶åœ¨è‡ªç¼–ç¨‹è¯­è¨€çš„è™šæ‹Ÿæœºä¸­ç‡å…ˆè¢«ä½¿ç”¨ã€‚å¦‚ä»Šï¼Œå®ƒä»ç„¶æ˜¯æœ€é‡è¦çš„å¯¹è±¡æ¨¡å‹ä¼˜åŒ–ä¹‹ä¸€ï¼šå®ƒè¢«ç”¨äº PyPy å’Œæ‰€æœ‰ç°ä»£ JavaScript è™šæ‹Ÿæœºï¼Œå¦‚V8ï¼ˆå…¶ä¸­ä¼˜åŒ–è¢«ç§°ä¸º &lt;em&gt;hidden classes&lt;/em&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰çš„è§‚å¯Ÿï¼šåœ¨åˆ°ç›®å‰ä¸ºæ­¢å®ç°çš„å¯¹è±¡æ¨¡å‹ä¸­ï¼Œæ‰€æœ‰å®ä¾‹éƒ½ä½¿ç”¨å®Œæ•´çš„å­—å…¸æ¥å­˜å‚¨å®ƒä»¬çš„å±æ€§ã€‚å­—å…¸æ˜¯ä½¿ç”¨å“ˆå¸Œæ˜ å°„æ¥å®ç°çš„ï¼Œè¿™æ¶ˆè€—å¤§é‡çš„å†…å­˜ã€‚æ­¤å¤–ï¼ŒåŒä¸€ä¸ªç±»çš„å®ä¾‹å°†ä¼šæ‹¥æœ‰åŒæ ·çš„å±æ€§ï¼Œæ¯”å¦‚ï¼Œæœ‰ä¸€ä¸ªç±» &lt;code&gt;Point&lt;/code&gt;ï¼Œå®ƒæ‰€æœ‰çš„å®ä¾‹éƒ½åŒ…å«åŒæ ·çš„å±æ€§ &lt;code&gt;x&lt;/code&gt;ã€&lt;code&gt;y&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;maps ä¼˜åŒ–åˆ©ç”¨äº†è¿™ä¸€ç‚¹ã€‚å®ƒæœ‰æ•ˆåœ°å°†æ¯ä¸ªå®ä¾‹çš„å­—å…¸åˆ†æˆä¸¤éƒ¨åˆ†ã€‚ä¸€éƒ¨åˆ†å­˜æ”¾æ‰€æœ‰å®ä¾‹å…±äº«çš„ keysã€‚è€Œå®ä¾‹åªå­˜å‚¨å¯¹å…±äº«æ˜ å°„çš„å¼•ç”¨å’Œåˆ—è¡¨ä¸­çš„å±æ€§å€¼ï¼ˆæ¯”å­—å…¸æ›´æ¶ˆè€—äº†æ›´å°‘çš„å†…å­˜ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åšç®€å•æµ‹è¯•ç”¨ä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;test_maps&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# white box test inspecting the implementation&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Point = Class(name=&lt;span class=&quot;string&quot;&gt;&quot;Point&quot;&lt;/span&gt;, base_class=OBJECT, fields=&amp;#123;&amp;#125;, metaclass=TYPE)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    p1 = Instance(Point)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    p1.write_attr(&lt;span class=&quot;string&quot;&gt;&quot;x&quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    p1.write_attr(&lt;span class=&quot;string&quot;&gt;&quot;y&quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;assert&lt;/span&gt; p1.storage == [&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;assert&lt;/span&gt; p1.map.attrs == &amp;#123;&lt;span class=&quot;string&quot;&gt;&quot;x&quot;&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;y&quot;&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    p2 = Instance(Point)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    p2.write_attr(&lt;span class=&quot;string&quot;&gt;&quot;x&quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    p2.write_attr(&lt;span class=&quot;string&quot;&gt;&quot;y&quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;assert&lt;/span&gt; p1.map &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; p2.map&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;assert&lt;/span&gt; p2.storage == [&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    p1.write_attr(&lt;span class=&quot;string&quot;&gt;&quot;x&quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    p1.write_attr(&lt;span class=&quot;string&quot;&gt;&quot;y&quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;-2&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;assert&lt;/span&gt; p1.map &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; p2.map&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;assert&lt;/span&gt; p1.storage == [&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;-2&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    p3 = Instance(Point)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    p3.write_attr(&lt;span class=&quot;string&quot;&gt;&quot;x&quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    p3.write_attr(&lt;span class=&quot;string&quot;&gt;&quot;z&quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;-343&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;assert&lt;/span&gt; p3.map &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; p1.map&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;assert&lt;/span&gt; p3.map.attrs == &amp;#123;&lt;span class=&quot;string&quot;&gt;&quot;x&quot;&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;z&quot;&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Python" scheme="http://zhoulingyu.com/categories/Python/"/>
    
    
      <category term="è¯‘æ–‡" scheme="http://zhoulingyu.com/tags/%E8%AF%91%E6%96%87/"/>
    
      <category term="Python" scheme="http://zhoulingyu.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>ã€500 Lines or Lessã€‘-ã€ç¿»è¯‘ç»ƒä¹ ã€‘-ã€chapter 14ã€‘-ã€ç®€å•å¯¹è±¡æ¨¡å‹ã€‘-ã€ç¬¬äºŒéƒ¨åˆ†ã€‘</title>
    <link href="http://zhoulingyu.com/2017/10/31/500-Lines-or-Less-14-2/"/>
    <id>http://zhoulingyu.com/2017/10/31/500-Lines-or-Less-14-2/</id>
    <published>2017-10-31T12:14:15.000Z</published>
    <updated>2018-07-10T03:07:31.624Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åŸæ–‡é“¾æ¥ï¼š<a href="http://aosabook.org/en/500L/a-simple-object-model.html" target="_blank" rel="noopener">A Simple Object Model</a><br>ä½œè€…ä¿¡æ¯ï¼š<a href="https://twitter.com/cfbolz" target="_blank" rel="noopener">Carl Friedrich Bolz</a></p></blockquote><hr><blockquote><p><a href="http://zhoulingyu.com/2017/10/08/500-Lines-or-Less-14-1/">ä¸Šä¸€ç¯‡ï¼šã€Šã€500 Lines or Lessã€‘-ã€ç¿»è¯‘ç»ƒä¹ ã€‘-ã€chapter 14ã€‘-ã€ç®€å•å¯¹è±¡æ¨¡å‹ã€‘-ã€ç¬¬ä¸€éƒ¨åˆ†ã€‘ã€‹</a><br>è¯‘è€…æ³¨ï¼šä¼‘æ¯ç»“æŸï¼Œæˆ‘ä»¬ç»§ç»­</p></blockquote><hr><h1 id="æ–¹æ³•è°ƒç”¨"><a href="#æ–¹æ³•è°ƒç”¨" class="headerlink" title="æ–¹æ³•è°ƒç”¨"></a>æ–¹æ³•è°ƒç”¨</h1><p>ç°åœ¨æˆ‘ä»¬çš„æ¨¡å‹è¿˜ç¼ºå°‘æ–¹æ³•è°ƒç”¨çš„åŠŸèƒ½ï¼Œæœ¬ç« æˆ‘ä»¬å°†ä¼šå®ç°ä¸€ä¸ªç®€å•çš„ç»§æ‰¿æ¨¡å‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_callmethod_simple</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># Python code</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(self)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> self.x + <span class="number">1</span></span><br><span class="line">    obj = A()</span><br><span class="line">    obj.x = <span class="number">1</span></span><br><span class="line">    <span class="keyword">assert</span> obj.f() == <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    obj = B()</span><br><span class="line">    obj.x = <span class="number">1</span></span><br><span class="line">    <span class="keyword">assert</span> obj.f() == <span class="number">2</span> <span class="comment"># works on subclass too</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Object model code</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f_A</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.read_attr(<span class="string">"x"</span>) + <span class="number">1</span></span><br><span class="line">    A = Class(name=<span class="string">"A"</span>, base_class=OBJECT, fields=&#123;<span class="string">"f"</span>: f_A&#125;, metaclass=TYPE)</span><br><span class="line">    obj = Instance(A)</span><br><span class="line">    obj.write_attr(<span class="string">"x"</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">assert</span> obj.callmethod(<span class="string">"f"</span>) == <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    B = Class(name=<span class="string">"B"</span>, base_class=A, fields=&#123;&#125;, metaclass=TYPE)</span><br><span class="line">    obj = Instance(B)</span><br><span class="line">    obj.write_attr(<span class="string">"x"</span>, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">assert</span> obj.callmethod(<span class="string">"f"</span>) == <span class="number">3</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>ä¸ºäº†æ­£ç¡®çš„å®ç°å¯¹è±¡æ–¹æ³•çš„è°ƒç”¨ï¼Œæˆ‘ä»¬å¼€å§‹å…³æ³¨ç±»çš„æ–¹æ³•è§£æé¡ºåºã€‚åœ¨æ–¹æ³•è§£æé¡ºåºä¸­æ‰¾åˆ°çš„ç±»çš„å­—å…¸ä¸­çš„çš„ç¬¬ä¸€ä¸ªæ–¹æ³•å°†è¢«è°ƒç”¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Class</span><span class="params">(Base)</span>:</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_read_from_class</span><span class="params">(self, methname)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> cls <span class="keyword">in</span> self.method_resolution_order():</span><br><span class="line">            <span class="keyword">if</span> methname <span class="keyword">in</span> cls._fields:</span><br><span class="line">                <span class="keyword">return</span> cls._fields[methname]</span><br><span class="line">        <span class="keyword">return</span> MISSING</span><br></pre></td></tr></table></figure><p>å®Œå–„äº† <code>Base</code> ç±»ä¸­çš„ <code>callmethod</code> æ–¹æ³•ï¼Œæµ‹è¯•ç”¨ä¾‹å°±å¯ä»¥é€šè¿‡äº†ã€‚</p><p>ä¸ºäº†ç¡®ä¿æ–¹æ³•å‚æ•°æ­£ç¡®ä¼ é€’ï¼Œä»¥åŠä¹‹å‰çš„ä»£ç èƒ½å®Œæˆæ–¹æ³•é‡è½½çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬ç¼–å†™ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_callmethod_subclassing_and_arguments</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># Python code</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">g</span><span class="params">(self, arg)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> self.x + arg</span><br><span class="line">    obj = A()</span><br><span class="line">    obj.x = <span class="number">1</span></span><br><span class="line">    <span class="keyword">assert</span> obj.g(<span class="number">4</span>) == <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">g</span><span class="params">(self, arg)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> self.x + arg * <span class="number">2</span></span><br><span class="line">    obj = B()</span><br><span class="line">    obj.x = <span class="number">4</span></span><br><span class="line">    <span class="keyword">assert</span> obj.g(<span class="number">4</span>) == <span class="number">12</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Object model code</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">g_A</span><span class="params">(self, arg)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.read_attr(<span class="string">"x"</span>) + arg</span><br><span class="line">    A = Class(name=<span class="string">"A"</span>, base_class=OBJECT, fields=&#123;<span class="string">"g"</span>: g_A&#125;, metaclass=TYPE)</span><br><span class="line">    obj = Instance(A)</span><br><span class="line">    obj.write_attr(<span class="string">"x"</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">assert</span> obj.callmethod(<span class="string">"g"</span>, <span class="number">4</span>) == <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">g_B</span><span class="params">(self, arg)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.read_attr(<span class="string">"x"</span>) + arg * <span class="number">2</span></span><br><span class="line">    B = Class(name=<span class="string">"B"</span>, base_class=A, fields=&#123;<span class="string">"g"</span>: g_B&#125;, metaclass=TYPE)</span><br><span class="line">    obj = Instance(B)</span><br><span class="line">    obj.write_attr(<span class="string">"x"</span>, <span class="number">4</span>)</span><br><span class="line">    <span class="keyword">assert</span> obj.callmethod(<span class="string">"g"</span>, <span class="number">4</span>) == <span class="number">12</span></span><br></pre></td></tr></table></figure><h1 id="åŸºäºå±æ€§çš„æ¨¡å‹"><a href="#åŸºäºå±æ€§çš„æ¨¡å‹" class="headerlink" title="åŸºäºå±æ€§çš„æ¨¡å‹"></a>åŸºäºå±æ€§çš„æ¨¡å‹</h1><p>ç°åœ¨æœ€ç®€å•ç‰ˆæœ¬çš„å¯¹è±¡æ¨¡å‹å·²ç»å¯ä»¥ç”¨äº†ï¼Œæˆ‘ä»¬å¯ä»¥å¼€ä¼šè€ƒè™‘å®Œå–„å®ƒã€‚è¿™ä¸€èŠ‚æˆ‘ä»¬å°†ä»‹ç» <code>åŸºäºæ–¹æ³•çš„æ¨¡å‹</code> å’Œ <code>åŸºäºå±æ€§çš„æ¨¡å‹</code> ä¹‹é—´çš„å¼‚åŒç‚¹ã€‚å…¶å®è¿™ä¹Ÿæ˜¯ Smalltalk ã€ Ruby ã€ JavaScript ã€ Python å’Œ Lua ä¹‹é—´çš„æ ¸å¿ƒå·®å¼‚ã€‚</p><p><code>åŸºäºæ–¹æ³•çš„æ¨¡å‹</code> å°†æ–¹æ³•è°ƒç”¨ä½œä¸ºç¨‹åºæ‰§è¡Œçš„åŸºæœ¬æ–¹å¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result = obj.f(arg1, arg2)</span><br></pre></td></tr></table></figure><p><code>åŸºäºå±æ€§çš„æ¨¡å‹</code> å°†æ–¹æ³•è°ƒç”¨åˆ†ä¸ºä¸¤æ­¥ï¼šæŸ¥æ‰¾å±æ€§å’Œæ‰§è¡Œè¿”å›ç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">method = obj.f</span><br><span class="line">result = method(arg1, arg2)</span><br></pre></td></tr></table></figure><p>ä¸¤è€…çš„å·®å¼‚å¯ä»¥åœ¨ä¸‹é¢çš„æµ‹è¯•ç”¨ä¾‹ä¸­çœ‹å‡ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_bound_method</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># Python code</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(self, a)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> self.x + a + <span class="number">1</span></span><br><span class="line">    obj = A()</span><br><span class="line">    obj.x = <span class="number">2</span></span><br><span class="line">    m = obj.f</span><br><span class="line">    <span class="keyword">assert</span> m(<span class="number">4</span>) == <span class="number">7</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    obj = B()</span><br><span class="line">    obj.x = <span class="number">1</span></span><br><span class="line">    m = obj.f</span><br><span class="line">    <span class="keyword">assert</span> m(<span class="number">10</span>) == <span class="number">12</span> <span class="comment"># works on subclass too</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Object model code</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f_A</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.read_attr(<span class="string">"x"</span>) + a + <span class="number">1</span></span><br><span class="line">    A = Class(name=<span class="string">"A"</span>, base_class=OBJECT, fields=&#123;<span class="string">"f"</span>: f_A&#125;, metaclass=TYPE)</span><br><span class="line">    obj = Instance(A)</span><br><span class="line">    obj.write_attr(<span class="string">"x"</span>, <span class="number">2</span>)</span><br><span class="line">    m = obj.read_attr(<span class="string">"f"</span>)</span><br><span class="line">    <span class="keyword">assert</span> m(<span class="number">4</span>) == <span class="number">7</span></span><br><span class="line"></span><br><span class="line">    B = Class(name=<span class="string">"B"</span>, base_class=A, fields=&#123;&#125;, metaclass=TYPE)</span><br><span class="line">    obj = Instance(B)</span><br><span class="line">    obj.write_attr(<span class="string">"x"</span>, <span class="number">1</span>)</span><br><span class="line">    m = obj.read_attr(<span class="string">"f"</span>)</span><br><span class="line">    <span class="keyword">assert</span> m(<span class="number">10</span>) == <span class="number">12</span></span><br></pre></td></tr></table></figure><p>è™½ç„¶è®¾ç½®ä¸æ–¹æ³•è°ƒç”¨çš„ç›¸åº”æµ‹è¯•ç›¸åŒï¼Œä½†è°ƒç”¨æ–¹æ³•çš„æ–¹å¼ä¸åŒã€‚é¦–å…ˆï¼Œåœ¨å¯¹è±¡ä¸­æŸ¥æ‰¾ä¸ <code>read_attr</code> æ–¹æ³•ä¼ å…¥å‚æ•°ä¸€è‡´çš„æ–¹æ³•åã€‚<code>read_attr</code> è¿”å›å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å°è£…äº†å¯¹è±¡ä»¥åŠç±»ä¸­æ‰¾åˆ°çš„å¯¹åº”æ–¹æ³•ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±ä½¿ç”¨å®ƒè°ƒç”¨è¯¥æ–¹æ³•ã€‚</p><p>ä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ <code>Base.read_attr</code> çš„å®ç°ã€‚å¦‚æœæŸ¥æ‰¾å±æ€§ä¸åœ¨å®ä¾‹å­—å…¸ä¸­ï¼Œå°±åº”è¯¥å»ç±»çš„å­—å…¸ä¸­æŸ¥æ‰¾ã€‚å¦‚æœåœ¨ç±»çš„å­—å…¸ä¸­æ‰¾åˆ°äº†è¿™ä¸ªå±æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ä¼šè¿”å›è¿™ä¸ªå±æ€§ï¼Œè¿™ä½¿ç”¨å¯ä»¥é—­åŒ…æ¥å®ç°ã€‚é™¤äº†æ›´æ”¹ <code>Base.read_attr</code>ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¿®æ”¹ <code>Base.callmethod</code> æ¥ç¡®ä¿æˆ‘ä¹ˆä½ çš„ä»£ç èƒ½å¤Ÿé€šè¿‡æµ‹è¯•ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span><span class="params">(object)</span>:</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_attr</span><span class="params">(self, fieldname)</span>:</span></span><br><span class="line">        <span class="string">""" read field 'fieldname' out of the object """</span></span><br><span class="line">        result = self._read_dict(fieldname)</span><br><span class="line">        <span class="keyword">if</span> result <span class="keyword">is</span> <span class="keyword">not</span> MISSING:</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        result = self.cls._read_from_class(fieldname)</span><br><span class="line">        <span class="keyword">if</span> _is_bindable(result):</span><br><span class="line">            <span class="keyword">return</span> _make_boundmethod(result, self)</span><br><span class="line">        <span class="keyword">if</span> result <span class="keyword">is</span> <span class="keyword">not</span> MISSING:</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">raise</span> AttributeError(fieldname)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">callmethod</span><span class="params">(self, methname, *args)</span>:</span></span><br><span class="line">        <span class="string">""" call method 'methname' with arguments 'args' on object """</span></span><br><span class="line">        meth = self.read_attr(methname)</span><br><span class="line">        <span class="keyword">return</span> meth(*args)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_is_bindable</span><span class="params">(meth)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> callable(meth)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_make_boundmethod</span><span class="params">(meth, self)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">bound</span><span class="params">(*args)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> meth(self, *args)</span><br><span class="line">    <span class="keyword">return</span> bound</span><br></pre></td></tr></table></figure><p>å…¶ä»–çš„ä»£ç ä¸éœ€è¦åšæ›´æ”¹ã€‚</p><h1 id="å…ƒå¯¹è±¡åè®®"><a href="#å…ƒå¯¹è±¡åè®®" class="headerlink" title="å…ƒå¯¹è±¡åè®®"></a>å…ƒå¯¹è±¡åè®®</h1><p>é™¤äº†å¸¸è§„çš„è°ƒç”¨æ–¹æ³•ï¼Œå¾ˆå¤šåŠ¨æ€è¯­è¨€è¿˜æä¾›äº†ç‰¹æ®Šçš„æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•ä¸æ˜¯ç›´æ¥è°ƒç”¨è€Œæ˜¯é€šè¿‡å¯¹è±¡ç³»ç»Ÿè°ƒç”¨ã€‚åœ¨ Python ä¸­è¿™äº›ç‰¹æ®Šçš„æ–¹æ³•å¾€å¾€ç”¨ä¸¤ä¸ªä¸‹åˆ’çº¿ä½œä¸ºå¼€å¤´å’Œç»“å°¾ï¼Œæ¯”å¦‚ <code>__init__</code>ã€‚å¯è¿™äº›ç‰¹æ®Šçš„æ–¹æ³•å¯ä»¥è¦†ç›–é‡è½½æ™®é€šçš„æ“ä½œï¼Œå¹¶ä¸ºå®ƒä»¬æä¾›è‡ªå®šä¹‰åŠŸèƒ½ã€‚å› æ­¤å®ƒä»¬æ˜¯å¯ä»¥å‘Šè¯‰å¯¹è±¡æ¨¡å‹å¦‚ä½•å¤„ç†ä¸åŒäº‹ç‰©çš„ hookï¼Œå…³äº Python ä¸­çš„ç‰¹æ®Šæ–¹æ³•å¯ä»¥å‚è€ƒ<a href="https://docs.python.org/2/reference/datamodel.html#special-method-names" target="_blank" rel="noopener">è¿™ç¯‡æ–‡æ¡£</a>ã€‚</p><p>å…ƒå¯¹è±¡åè®®æ¦‚å¿µç”± Smalltalk å¼•å…¥ï¼Œä½† Common Lisp è¿™æ ·çš„å¯¹è±¡ç³»ç»Ÿï¼ˆå¦‚CLOSï¼‰ä¹Ÿå¹¿æ³›çš„åœ°ä½¿ç”¨å…ƒå¯¹è±¡åè®®ã€‚</p><p>åœ¨æœ¬ç« æˆ‘ä»¬å°†ç»™æˆ‘ä»¬çš„å¯¹è±¡æ¨¡å‹æ·»åŠ ä¸‰ç§ meta-hookã€‚å®ƒä»¬å°†å¯ä»¥æ”¹å˜è¯»å†™å±æ€§æ“ä½œçš„åŠŸèƒ½ã€‚é¦–å…ˆè¦æ·»åŠ çš„æ–¹æ³•æ˜¯ <code>__getattr__</code> å’Œ <code>__setattr__</code>ï¼ˆçœ‹èµ·æ¥å’Œ Python ä¸­ç±»ä¼¼æ–¹æ³•çš„åå­—å¾ˆç±»ä¼¼ï¼‰ã€‚</p><h2 id="è‡ªå®šä¹‰è¯»å†™å±æ€§æ“ä½œ"><a href="#è‡ªå®šä¹‰è¯»å†™å±æ€§æ“ä½œ" class="headerlink" title="è‡ªå®šä¹‰è¯»å†™å±æ€§æ“ä½œ"></a>è‡ªå®šä¹‰è¯»å†™å±æ€§æ“ä½œ</h2><p><code>__getattr__</code> åœ¨é€šè¿‡å¸¸è§„çš„å±æ€§æŸ¥æ‰¾æ–¹æ³•æ— æ³•æŸ¥æ‰¾åˆ°æ—¶è¢«è°ƒç”¨ï¼ˆåœ¨ç±»å’Œå¯¹è±¡æ–¹æ³•å­—å…¸ä¸­å‡æœªæ‰¾åˆ°ï¼‰ã€‚è¯¥æ–¹æ³•éœ€è¦çš„å‚æ•°æ˜¯ã€éœ€è¦æŸ¥æ‰¾çš„å±æ€§åç§°ã€ã€‚æ—©æœŸçš„ <code>Smalltalk4</code> ä¸­è¢«ç§°ä¸º <code>doesNotUnderstand</code></p><p><code>__setattr__</code> çš„æƒ…å†µæœ‰ç‚¹ä¸åŒã€‚ ç”±äºè®¾ç½®å±æ€§æ€»æ˜¯ä¼šåˆ›å»ºä¸€ä¸ªå±æ€§ï¼Œæ‰€ä»¥åœ¨è®¾ç½®å±æ€§æ—¶æ€»æ˜¯è°ƒç”¨<code>__setattr__</code>ã€‚ä¸ºäº†ç¡®ä¿ <code>__setattr__</code> å­˜åœ¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ <code>OBEJCT</code> ä¸­å®ç° <code>__setattr__</code> æ–¹æ³•ã€‚ä¿è¯æˆ‘ä»¬å¯ä»¥å‘å­—å…¸ä¸­å†™å…¥å±æ€§ã€‚ä¹Ÿå¯ä»¥è®©ç”¨æˆ·å¯ä»¥å°†è‡ªå®šä¹‰çš„ <code>__setattr__</code> å§”æ‰˜ç»™ <code>OBJECT.__setattr__</code>ã€‚</p><p>é’ˆå¯¹è¿™ä¸¤ä¸ªç‰¹æ®Šæ–¹æ³•çš„æµ‹è¯•ç”¨ä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_getattr</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># Python code</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> name == <span class="string">"fahrenheit"</span>:</span><br><span class="line">                <span class="keyword">return</span> self.celsius * <span class="number">9.</span> / <span class="number">5.</span> + <span class="number">32</span></span><br><span class="line">            <span class="keyword">raise</span> AttributeError(name)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__setattr__</span><span class="params">(self, name, value)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> name == <span class="string">"fahrenheit"</span>:</span><br><span class="line">                self.celsius = (value - <span class="number">32</span>) * <span class="number">5.</span> / <span class="number">9.</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># call the base implementation</span></span><br><span class="line">                object.__setattr__(self, name, value)</span><br><span class="line">    obj = A()</span><br><span class="line">    obj.celsius = <span class="number">30</span></span><br><span class="line">    <span class="keyword">assert</span> obj.fahrenheit == <span class="number">86</span> <span class="comment"># test __getattr__</span></span><br><span class="line">    obj.celsius = <span class="number">40</span></span><br><span class="line">    <span class="keyword">assert</span> obj.fahrenheit == <span class="number">104</span></span><br><span class="line"></span><br><span class="line">    obj.fahrenheit = <span class="number">86</span> <span class="comment"># test __setattr__</span></span><br><span class="line">    <span class="keyword">assert</span> obj.celsius == <span class="number">30</span></span><br><span class="line">    <span class="keyword">assert</span> obj.fahrenheit == <span class="number">86</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Object model code</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> name == <span class="string">"fahrenheit"</span>:</span><br><span class="line">            <span class="keyword">return</span> self.read_attr(<span class="string">"celsius"</span>) * <span class="number">9.</span> / <span class="number">5.</span> + <span class="number">32</span></span><br><span class="line">        <span class="keyword">raise</span> AttributeError(name)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setattr__</span><span class="params">(self, name, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> name == <span class="string">"fahrenheit"</span>:</span><br><span class="line">            self.write_attr(<span class="string">"celsius"</span>, (value - <span class="number">32</span>) * <span class="number">5.</span> / <span class="number">9.</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># call the base implementation</span></span><br><span class="line">            OBJECT.read_attr(<span class="string">"__setattr__"</span>)(self, name, value)</span><br><span class="line"></span><br><span class="line">    A = Class(name=<span class="string">"A"</span>, base_class=OBJECT,</span><br><span class="line">              fields=&#123;<span class="string">"__getattr__"</span>: __getattr__, <span class="string">"__setattr__"</span>: __setattr__&#125;,</span><br><span class="line">              metaclass=TYPE)</span><br><span class="line">    obj = Instance(A)</span><br><span class="line">    obj.write_attr(<span class="string">"celsius"</span>, <span class="number">30</span>)</span><br><span class="line">    <span class="keyword">assert</span> obj.read_attr(<span class="string">"fahrenheit"</span>) == <span class="number">86</span> <span class="comment"># test __getattr__</span></span><br><span class="line">    obj.write_attr(<span class="string">"celsius"</span>, <span class="number">40</span>)</span><br><span class="line">    <span class="keyword">assert</span> obj.read_attr(<span class="string">"fahrenheit"</span>) == <span class="number">104</span></span><br><span class="line">    obj.write_attr(<span class="string">"fahrenheit"</span>, <span class="number">86</span>) <span class="comment"># test __setattr__</span></span><br><span class="line">    <span class="keyword">assert</span> obj.read_attr(<span class="string">"celsius"</span>) == <span class="number">30</span></span><br><span class="line">    <span class="keyword">assert</span> obj.read_attr(<span class="string">"fahrenheit"</span>) == <span class="number">86</span></span><br></pre></td></tr></table></figure><p>ä¸ºäº†é€šè¿‡è¿™ä¸ªæµ‹è¯•ï¼Œéœ€è¦å®Œå–„ <code>Base.read_attr</code> å’Œ <code>Base.write_attr</code> æ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span><span class="params">(object)</span>:</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_attr</span><span class="params">(self, fieldname)</span>:</span></span><br><span class="line">        <span class="string">""" read field 'fieldname' out of the object """</span></span><br><span class="line">        result = self._read_dict(fieldname)</span><br><span class="line">        <span class="keyword">if</span> result <span class="keyword">is</span> <span class="keyword">not</span> MISSING:</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        result = self.cls._read_from_class(fieldname)</span><br><span class="line">        <span class="keyword">if</span> _is_bindable(result):</span><br><span class="line">            <span class="keyword">return</span> _make_boundmethod(result, self)</span><br><span class="line">        <span class="keyword">if</span> result <span class="keyword">is</span> <span class="keyword">not</span> MISSING:</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        meth = self.cls._read_from_class(<span class="string">"__getattr__"</span>)</span><br><span class="line">        <span class="keyword">if</span> meth <span class="keyword">is</span> <span class="keyword">not</span> MISSING:</span><br><span class="line">            <span class="keyword">return</span> meth(self, fieldname)</span><br><span class="line">        <span class="keyword">raise</span> AttributeError(fieldname)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write_attr</span><span class="params">(self, fieldname, value)</span>:</span></span><br><span class="line">        <span class="string">""" write field 'fieldname' into the object """</span></span><br><span class="line">        meth = self.cls._read_from_class(<span class="string">"__setattr__"</span>)</span><br><span class="line">        <span class="keyword">return</span> meth(self, fieldname, value)</span><br></pre></td></tr></table></figure><p>é€šè¿‡å±æ€§åä½œä¸ºå‚æ•°ï¼Œå¦‚æœå­—æ®µä¸å­˜åœ¨æŠ›å‡ºé”™è¯¯ã€‚æ³¨æ„ <code>__getattr__</code> åªèƒ½åœ¨ç±»ä¸­è°ƒç”¨ï¼ˆPython ä¸­çš„ç‰¹æ®Šæ–¹æ³•ä¹Ÿæ˜¯ï¼‰ä»¥é¿å…é€’å½’è°ƒç”¨ <code>self.read_attr(&quot;__getattr__&quot;)</code>ã€‚</p><p>å±æ€§çš„å†™æ“ä½œä¹Ÿäº¤ç»™ <code>__setattr__</code> æ–¹æ³•ã€‚ä¸ºäº†å®Œæˆè¿™ä¸ªåŠŸèƒ½ï¼Œ<code>OBEJCT</code> éœ€è¦å®ç° <code>__setattr__</code> çš„åŸºæœ¬åŠŸèƒ½ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">OBJECT__setattr__</span><span class="params">(self, fieldname, value)</span>:</span></span><br><span class="line">    self._write_dict(fieldname, value)</span><br><span class="line">OBJECT = Class(<span class="string">"object"</span>, <span class="keyword">None</span>, &#123;<span class="string">"__setattr__"</span>: OBJECT__setattr__&#125;, <span class="keyword">None</span>)</span><br></pre></td></tr></table></figure><p><code>OBJECT__setattr__</code> çš„è¡Œä¸ºå°±åƒä»¥å‰çš„ <code>write_attr</code>ã€‚ é€šè¿‡è¿™äº›ä¿®æ”¹ï¼Œæµ‹è¯•ç”¨ä¾‹å¯ä»¥é€šè¿‡ã€‚</p><h2 id="æè¿°ç¬¦åè®®"><a href="#æè¿°ç¬¦åè®®" class="headerlink" title="æè¿°ç¬¦åè®®"></a>æè¿°ç¬¦åè®®</h2><p>ä¸Šè¿°æµ‹è¯•ç”¨ä¾‹ä¸­åå¤è½¬æ¢ä¸åŒæ¸©æ ‡ï¼Œååˆ†çš„çƒ¦äººã€‚å› ä¸ºå±æ€§åè¦åœ¨ <code>__getattr__</code> å’Œ <code>__setattr__</code> ä¸­æ˜¾å¼çš„å»æ ¡éªŒã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨ Python ä¸­å¼•å…¥äº†æè¿°ç¬¦åè®®çš„æ¦‚å¿µã€‚</p><p>æˆ‘ä»¬å°†ä» <code>__getattr__</code> å’Œ <code>__setattr__</code> æ–¹æ³•ä¸­è·å–å…·ä½“çš„å±æ€§ï¼Œè€Œæè¿°ç¬¦åè®®æ˜¯åœ¨å±æ€§è°ƒç”¨è¿‡ç¨‹ç»“æŸè¿”å›ç»“æœæ—¶è§¦å‘ä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ³•ã€‚æè¿°ç¬¦åè®®å¯ä»¥è¢«çœ‹ä½œæ˜¯ç»‘å®šæ–¹æ³•å’Œç±»çš„æ“ä½œã€‚é™¤äº†ç»‘å®šæ–¹æ³•å¤–ï¼ŒPythonä¸­æè¿°ç¬¦åè®®æœ€é‡è¦çš„ç”¨ä¾‹æ˜¯ <code>staticmethod</code>ã€<code>classmethod</code> å’Œ <code>property</code>ã€‚</p><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨æè¿°ç¬¦åè®®ç»‘å®šå¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ <strong>get</strong> æ–¹æ³•æ¥è¾¾æˆè¿™ä¸€ç›®æ ‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_get</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># Python code</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">FahrenheitGetter</span><span class="params">(object)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, inst, cls)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> inst.celsius * <span class="number">9.</span> / <span class="number">5.</span> + <span class="number">32</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></span><br><span class="line">        fahrenheit = FahrenheitGetter()</span><br><span class="line">    obj = A()</span><br><span class="line">    obj.celsius = <span class="number">30</span></span><br><span class="line">    <span class="keyword">assert</span> obj.fahrenheit == <span class="number">86</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Object model code</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">FahrenheitGetter</span><span class="params">(object)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, inst, cls)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> inst.read_attr(<span class="string">"celsius"</span>) * <span class="number">9.</span> / <span class="number">5.</span> + <span class="number">32</span></span><br><span class="line"></span><br><span class="line">    A = Class(name=<span class="string">"A"</span>, base_class=OBJECT,</span><br><span class="line">              fields=&#123;<span class="string">"fahrenheit"</span>: FahrenheitGetter()&#125;,</span><br><span class="line">              metaclass=TYPE)</span><br><span class="line">    obj = Instance(A)</span><br><span class="line">    obj.write_attr(<span class="string">"celsius"</span>, <span class="number">30</span>)</span><br><span class="line">    <span class="keyword">assert</span> obj.read_attr(<span class="string">"fahrenheit"</span>) == <span class="number">86</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨æµ‹è¯•ç”¨ä¾‹å¯ä»¥é€šè¿‡äº†ã€‚ä¹‹å‰å…³äºæ–¹æ³•ç»‘å®šçš„æµ‹è¯•ç”¨ä¾‹ä¹Ÿä¾ç„¶é€šè¿‡ï¼Œåœ¨ Python ä¸­ <code>__get__</code> æ–¹æ³•æ‰§è¡Œå®Œäº†å°†ä¼šè¿”å›ä¸€ä¸ªå·²ç»‘å®šæ–¹æ³•å¯¹è±¡ã€‚</p><p>åœ¨å®è·µä¸­ï¼Œæè¿°ç¬¦åè®®è¦æ›´åŠ å¤æ‚ã€‚å®ƒè¿˜æ”¯æŒ <code>__set__</code> æ¥è®¾ç½®å±æ€§ã€‚ä½ ç°åœ¨æ‰€çœ‹åˆ°è¿™é‡Œå®ç°çš„ç‰ˆæœ¬æ˜¯ç»è¿‡ä¸€äº›ç®€åŒ–çš„ã€‚æ³¨æ„ï¼Œå‰é¢ <code>_make_boundmethod</code> æ–¹æ³•è°ƒç”¨ <code>__get__</code> æ˜¯å®ç°çº§çš„æ“ä½œï¼Œè€Œä¸æ˜¯ä½¿ç”¨ <code>meth.read_attr(&#39;__get__&#39;)</code> ã€‚æ„æ€æ˜¯ï¼Œæˆ‘ä»¬çš„å¯¹è±¡æ¨¡å‹æ˜¯åœ¨å€Ÿç”¨ Python çš„å‡½æ•°å’Œæ–¹æ³•ï¼Œè€Œä¸æ˜¯å±•ç¤º Python çš„å¯¹è±¡æ¨¡å‹ã€‚ä¸€ä¸ªæ›´å®Œæ•´çš„å¯¹è±¡æ¨¡å‹å°†ä¸å¾—ä¸è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><hr><h3 id="è¯‘è€…è‘—ï¼šæ–‡ç« æœ‰ç‚¹é•¿ï¼Œæ€•å¤§å®¶çœ‹ç€æ„Ÿè§‰å¤ªå¹²ï¼Œåˆ†æˆäº†çš„ä¸‰ç¯‡æ–‡ç« ï¼Œå¤§å®¶ä¼‘æ¯ä¸€ä¸‹ï¼Œç»§ç»­å§ã€‚"><a href="#è¯‘è€…è‘—ï¼šæ–‡ç« æœ‰ç‚¹é•¿ï¼Œæ€•å¤§å®¶çœ‹ç€æ„Ÿè§‰å¤ªå¹²ï¼Œåˆ†æˆäº†çš„ä¸‰ç¯‡æ–‡ç« ï¼Œå¤§å®¶ä¼‘æ¯ä¸€ä¸‹ï¼Œç»§ç»­å§ã€‚" class="headerlink" title="è¯‘è€…è‘—ï¼šæ–‡ç« æœ‰ç‚¹é•¿ï¼Œæ€•å¤§å®¶çœ‹ç€æ„Ÿè§‰å¤ªå¹²ï¼Œåˆ†æˆäº†çš„ä¸‰ç¯‡æ–‡ç« ï¼Œå¤§å®¶ä¼‘æ¯ä¸€ä¸‹ï¼Œç»§ç»­å§ã€‚"></a>è¯‘è€…è‘—ï¼šæ–‡ç« æœ‰ç‚¹é•¿ï¼Œæ€•å¤§å®¶çœ‹ç€æ„Ÿè§‰å¤ªå¹²ï¼Œåˆ†æˆäº†çš„ä¸‰ç¯‡æ–‡ç« ï¼Œå¤§å®¶ä¼‘æ¯ä¸€ä¸‹ï¼Œç»§ç»­å§ã€‚</h3><h3 id="ä¸‹ä¸€ç¯‡ï¼šã€Šã€500-Lines-or-Lessã€‘-ã€ç¿»è¯‘ç»ƒä¹ ã€‘-ã€chapter-14ã€‘-ã€ç®€å•å¯¹è±¡æ¨¡å‹ã€‘-ã€ç¬¬ä¸‰éƒ¨åˆ†ã€‘ã€‹"><a href="#ä¸‹ä¸€ç¯‡ï¼šã€Šã€500-Lines-or-Lessã€‘-ã€ç¿»è¯‘ç»ƒä¹ ã€‘-ã€chapter-14ã€‘-ã€ç®€å•å¯¹è±¡æ¨¡å‹ã€‘-ã€ç¬¬ä¸‰éƒ¨åˆ†ã€‘ã€‹" class="headerlink" title="ä¸‹ä¸€ç¯‡ï¼šã€Šã€500 Lines or Lessã€‘-ã€ç¿»è¯‘ç»ƒä¹ ã€‘-ã€chapter 14ã€‘-ã€ç®€å•å¯¹è±¡æ¨¡å‹ã€‘-ã€ç¬¬ä¸‰éƒ¨åˆ†ã€‘ã€‹"></a><a href="http://zhoulingyu.com/2017/11/22/500-Lines-or-Less-14-3/">ä¸‹ä¸€ç¯‡ï¼šã€Šã€500 Lines or Lessã€‘-ã€ç¿»è¯‘ç»ƒä¹ ã€‘-ã€chapter 14ã€‘-ã€ç®€å•å¯¹è±¡æ¨¡å‹ã€‘-ã€ç¬¬ä¸‰éƒ¨åˆ†ã€‘ã€‹</a></h3><hr><p>æœ‰ä»€ä¹ˆé—®é¢˜éƒ½å¯ä»¥åœ¨åšæ–‡åé¢ç•™è¨€ï¼Œæˆ–è€…å¾®åšä¸Šç§ä¿¡æˆ‘ï¼Œæˆ–è€…é‚®ä»¶æˆ‘ <a href="mailto:&#x63;&#111;&#x64;&#x65;&#x72;&#102;&#x69;&#x73;&#104;&#x40;&#49;&#x36;&#51;&#x2e;&#99;&#111;&#109;" target="_blank" rel="noopener">&#x63;&#111;&#x64;&#x65;&#x72;&#102;&#x69;&#x73;&#104;&#x40;&#49;&#x36;&#51;&#x2e;&#99;&#111;&#109;</a>ã€‚</p><p>åšä¸»æ˜¯ iOS å¦¹å­ä¸€æšã€‚</p><p>å¸Œæœ›å¤§å®¶ä¸€èµ·è¿›æ­¥ã€‚</p><p>æˆ‘çš„å¾®åšï¼š<a href="http://weibo.com/coderfish/" target="_blank" rel="noopener">å°é±¼å‘¨å‡Œå®‡</a></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;åŸæ–‡é“¾æ¥ï¼š&lt;a href=&quot;http://aosabook.org/en/500L/a-simple-object-model.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;A Simple Object Model&lt;/a&gt;&lt;br&gt;ä½œè€…ä¿¡æ¯ï¼š&lt;a href=&quot;https://twitter.com/cfbolz&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Carl Friedrich Bolz&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;http://zhoulingyu.com/2017/10/08/500-Lines-or-Less-14-1/&quot;&gt;ä¸Šä¸€ç¯‡ï¼šã€Šã€500 Lines or Lessã€‘-ã€ç¿»è¯‘ç»ƒä¹ ã€‘-ã€chapter 14ã€‘-ã€ç®€å•å¯¹è±¡æ¨¡å‹ã€‘-ã€ç¬¬ä¸€éƒ¨åˆ†ã€‘ã€‹&lt;/a&gt;&lt;br&gt;è¯‘è€…æ³¨ï¼šä¼‘æ¯ç»“æŸï¼Œæˆ‘ä»¬ç»§ç»­&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h1 id=&quot;æ–¹æ³•è°ƒç”¨&quot;&gt;&lt;a href=&quot;#æ–¹æ³•è°ƒç”¨&quot; class=&quot;headerlink&quot; title=&quot;æ–¹æ³•è°ƒç”¨&quot;&gt;&lt;/a&gt;æ–¹æ³•è°ƒç”¨&lt;/h1&gt;&lt;p&gt;ç°åœ¨æˆ‘ä»¬çš„æ¨¡å‹è¿˜ç¼ºå°‘æ–¹æ³•è°ƒç”¨çš„åŠŸèƒ½ï¼Œæœ¬ç« æˆ‘ä»¬å°†ä¼šå®ç°ä¸€ä¸ªç®€å•çš„ç»§æ‰¿æ¨¡å‹ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;test_callmethod_simple&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# Python code&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(object)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; self.x + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    obj = A()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    obj.x = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;assert&lt;/span&gt; obj.f() == &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;B&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(A)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;pass&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    obj = B()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    obj.x = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;assert&lt;/span&gt; obj.f() == &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;# works on subclass too&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# Object model code&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;f_A&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; self.read_attr(&lt;span class=&quot;string&quot;&gt;&quot;x&quot;&lt;/span&gt;) + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    A = Class(name=&lt;span class=&quot;string&quot;&gt;&quot;A&quot;&lt;/span&gt;, base_class=OBJECT, fields=&amp;#123;&lt;span class=&quot;string&quot;&gt;&quot;f&quot;&lt;/span&gt;: f_A&amp;#125;, metaclass=TYPE)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    obj = Instance(A)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    obj.write_attr(&lt;span class=&quot;string&quot;&gt;&quot;x&quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;assert&lt;/span&gt; obj.callmethod(&lt;span class=&quot;string&quot;&gt;&quot;f&quot;&lt;/span&gt;) == &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    B = Class(name=&lt;span class=&quot;string&quot;&gt;&quot;B&quot;&lt;/span&gt;, base_class=A, fields=&amp;#123;&amp;#125;, metaclass=TYPE)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    obj = Instance(B)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    obj.write_attr(&lt;span class=&quot;string&quot;&gt;&quot;x&quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;assert&lt;/span&gt; obj.callmethod(&lt;span class=&quot;string&quot;&gt;&quot;f&quot;&lt;/span&gt;) == &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Python" scheme="http://zhoulingyu.com/categories/Python/"/>
    
    
      <category term="è¯‘æ–‡" scheme="http://zhoulingyu.com/tags/%E8%AF%91%E6%96%87/"/>
    
      <category term="Python" scheme="http://zhoulingyu.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>ã€500 Lines or Lessã€‘-ã€ç¿»è¯‘ç»ƒä¹ ã€‘-ã€chapter 14ã€‘-ã€ç®€å•å¯¹è±¡æ¨¡å‹ã€‘-ã€ç¬¬ä¸€éƒ¨åˆ†ã€‘</title>
    <link href="http://zhoulingyu.com/2017/10/08/500-Lines-or-Less-14-1/"/>
    <id>http://zhoulingyu.com/2017/10/08/500-Lines-or-Less-14-1/</id>
    <published>2017-10-08T15:31:46.000Z</published>
    <updated>2018-07-10T03:07:31.624Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åŸæ–‡é“¾æ¥ï¼š<a href="http://aosabook.org/en/500L/a-simple-object-model.html" target="_blank" rel="noopener">A Simple Object Model</a><br>ä½œè€…ä¿¡æ¯ï¼š<a href="https://twitter.com/cfbolz" target="_blank" rel="noopener">Carl Friedrich Bolz</a></p></blockquote><p><a href="https://twitter.com/cfbolz" target="_blank" rel="noopener">Carl Friedrich Bolz</a>æ˜¯ä¼¦æ•¦å›½ç‹å¤§å­¦çš„ç ”ç©¶å‘˜ï¼Œå¯¹åŠ¨æ€è¯­è¨€çš„å®ç°åŠä¼˜åŒ–å…´è¶£æµ“åšã€‚ä»–æ˜¯ PyPy/RPython çš„æ ¸å¿ƒè´¡çŒ®è€…ä¹‹ä¸€ï¼Œå¹¶ä¸º Prolog, Racket, Smalltalk, PHP å’Œ Ruby ç­‰è¯­è¨€è´¡çŒ®ä»£ç ã€‚</p><h1 id="å¼•å­"><a href="#å¼•å­" class="headerlink" title="å¼•å­"></a>å¼•å­</h1><p>é¢å‘å¯¹è±¡å¼€å‘æ˜¯ç°ä»Šæœ€ä¸»æµçš„ç¼–ç¨‹èŒƒå¼ä¹‹ä¸€ï¼Œé¢å‘å¯¹è±¡çš„æ€æƒ³å’Œå˜æˆèŒƒå¼ä¹Ÿè¢«å¤§é‡çš„ç¼–ç¨‹è¯­è¨€æ‰€æ”¯æŒã€‚è™½ç„¶ä¸ç—›è¯­è¨€æä¾›çš„é¢å‘å¯¹è±¡ç¼–ç¨‹æœºåˆ¶è¡¨é¢ä¸Šéå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯ç»†èŠ‚ä¸Šå´å¤§ç›¸å¾„åº­ã€‚å¤§å¤šæ•°è¯­è¨€çš„å…±åŒç‚¹æ˜¯æ‹¥æœ‰å¯¹è±¡å’Œç»§æ‰¿æœºåˆ¶ã€‚è€Œã€ç±»ã€ï¼Œå¹¶ä¸æ˜¯æ¯ä¸€ç§è¯­è¨€éƒ½å¾ˆå¥½çš„æ”¯æŒå®ƒçš„ç§ç§ç‰¹æ€§ã€‚æ¯”å¦‚ï¼Œæ¯”å¦‚å¯¹äº <code>Self</code> æˆ–è€… <code>JavaScript</code> è¿™æ ·çš„åŸå‹ç¨‹åºè®¾è®¡çš„è¯­è¨€æ¥è¯´æ²¡æœ‰ç±»çš„æ¦‚å¿µï¼Œè€Œæ˜¯å¯¹è±¡é—´ç›´æ¥è¿›è¡Œäº†ç»§æ‰¿ã€‚</p><p>äº†è§£ä¸åŒè¯­è¨€çš„å¯¹è±¡æ¨¡å‹çš„ä¸åŒä¹‹å¤„æ˜¯ä¸€ä»¶éå¸¸æœ‰è¶£çš„äº‹ã€‚è¿™èƒ½å¸®åŠ©ä½ å‘ç°ä¸åŒè¯­è¨€çš„å¼‚åŒä¹‹å¤„ã€‚è¿™å°†åœ¨æˆ‘ä»¬å­¦ä¹ æ–°è¯­è¨€æ—¶ï¼Œè¿ç”¨ä»¥å¾€çš„ç¼–ç¨‹è¯­è¨€ç»éªŒï¼Œå¿«é€Ÿçš„å­¦ä¹ ã€‚</p><p>æœ¬ç« å°†æ¢ç´¢å­¦å®ç°ä¸€å¥—ç®€å•çš„å¯¹è±¡æ¨¡å‹ã€‚æˆ‘ä»¬å°†ä»ä¸€ä¸ªç®€å•çš„å®ä¾‹å’Œå®ƒçš„ç±»å¼€å§‹ï¼Œå¹¶è®©å®ƒæ‹¥æœ‰ä¸€äº›æ–¹æ³•å¯ä»¥ç”¨äºè®¿é—®ã€‚è¿™æ˜¯è¢« Simula 67 ã€Smalltalk ç­‰æ—©æœŸ OOï¼ˆé¢å‘å¯¹è±¡ï¼‰ è¯­è¨€æ‰€é‡‡ç”¨çš„ç»å…¸é¢å‘å¯¹è±¡èŒƒä¾‹ã€‚åœ¨æœ¬ç« ä¸­ï¼Œè¿™ä¸ªæ¨¡å‹å°†ä¼šè¢«ä¸€æ­¥æ­¥è¿›è¡Œæ‰©å±•ï¼Œå‰ä¸¤ä¸ªå°èŠ‚æˆ‘ä»¬å°†å±•ç¤ºä¸åŒè¯­è¨€çš„è®¾è®¡æ€è·¯ï¼Œæœ€åä¸€å°èŠ‚å°†è®²è§£å¦‚ä½•æé«˜å¯¹è±¡æ¨¡å‹çš„æ€§èƒ½ã€‚æœ€ç»ˆæˆ‘ä»¬çš„æ¨¡å‹å¹¶ä¸æ˜¯ä»»ä½•ä¸€é—¨è¯­è¨€æ‰€é‡‡ç”¨çš„æ¨¡å‹ï¼Œä¸è¿‡ï¼Œå°†è®¤ä¸ºæ˜¯ä¸€ä¸ªç®€åŒ–çš„ Python å¯¹è±¡æ¨¡å‹ã€‚</p><p>æœ¬ç« ä¸­ä½¿ç”¨çš„ä»£ç èŒƒä¾‹éƒ½ä½¿ç”¨ Python ç¼–å†™ã€‚ä»£ç å¯ä»¥è¿è¡Œåœ¨ Python 2.7 å’Œ 3.4ã€‚ä¸ºäº†æ›´å¥½çš„ç†è§£å¯¹è±¡æ¨¡å‹çš„è®¾è®¡ï¼Œæœ¬ç« ä¹Ÿæä¾›äº†ç›¸åº”çš„å•å…ƒæµ‹è¯•ã€‚æµ‹è¯•ä»£ç å¯ä»¥é€šè¿‡ py.test æˆ–è€… nose æ¥è¿è¡Œã€‚</p><p>ç”¨ Python ä½œä¸ºå®ç°è¯­è¨€å¹¶ä¸æ˜¯æœ€å¥½çš„ï¼Œé€šå¸¸ä¸€ä¸ª VMï¼ˆæˆ–è€…è¯­è¨€è§£é‡Šå™¨ï¼‰æ˜¯ç”±åº•å±‚è¯­è¨€æ¯”å¦‚ C å’Œ C++ å®ç°çš„ï¼Œå¹¶åœ¨å®ç°è¿‡ç¨‹ä¸­å¯¹æ›´åå‘äºæ‰£æ¯ä¸€ä¸ªå®ç°ç»†èŠ‚ä»è€Œæé«˜ä»£ç æ•ˆç‡ã€‚è€Œæ›´ç®€å•çš„è¯­è¨€æ›´è®©æˆ‘ä»¬æ›´å®¹æ˜“å…³æ³¨å®é™…çš„è¡Œä¸ºè¡¨ç°ï¼Œè€Œä¸æ˜¯æ‰£å®ç°ç»†èŠ‚ã€‚</p><a id="more"></a><h1 id="Method-Based-Model"><a href="#Method-Based-Model" class="headerlink" title="Method-Based Model"></a>Method-Based Model</h1><p>æˆ‘ä»¬å°†ä»å®ç° Smalltalk çš„æç®€ç‰ˆæœ¬å¼€å§‹è®²è§£æˆ‘ä¹ˆä½ çš„å¯¹è±¡æ¨¡å‹ã€‚Smalltalk æ˜¯ç”± Xerox PARC çš„Alan Kayâ€™s å°ç»„åœ¨ä¸Šä¸–çºª 70 å¹´ä»£å¼€å‘çš„é¢å‘å¯¹è±¡è¯­è¨€ã€‚å®ƒæ¨å¹¿äº†é¢å‘å¯¹è±¡è¯­è¨€ï¼Œåœ¨ä»Šæ—¶çš„ä¼—å¤šç¼–ç¨‹è¯­è¨€ä¸­ä¹Ÿèƒ½çœ‹åˆ°å®ƒçš„å¾ˆå¤šç‰¹æ€§ã€‚Smalltalk çš„è®¾è®¡å®—æ—¨ä¹‹ä¸€å°±æ˜¯ã€ä¸‡ç‰©çš†å¯¹è±¡ã€ã€‚å¦‚ä»Šï¼ŒSmalltalk çš„æœ€æ¥è¿‘çš„æ€æƒ³ç»§æ‰¿è€…æ˜¯ Rubyï¼ŒRuby çš„è¯­æ³•æ›´åƒ C è¯­è¨€ï¼Œä½†å´ä¿ç•™äº†å¤§éƒ¨åˆ† Smalltalk çš„å¯¹è±¡æ¨¡å‹ã€‚</p><p>æœ¬èŠ‚ä¸­çš„å¯¹è±¡æ¨¡å‹å°†å…·æœ‰å®ƒä»¬çš„ç±»å’Œå®ä¾‹ï¼Œå¯ä»¥è¯»å†™å¯¹è±¡çš„å±æ€§ï¼Œå¯ä»¥è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ï¼Œ<br>åŒæ—¶å…è®¸ç»§æ‰¿ã€‚åœ¨å¼€å§‹ä¹‹å‰è¦è¯´çš„æ˜¯ï¼Œè¿™äº›ç±»çš„å¯¹è±¡éƒ½æ˜¯æœ‰å±æ€§å’Œæ–¹æ³•çš„æ™®é€šç±»ã€‚</p><p>FYI: æœ¬ç« èŠ‚ä¸­æˆ‘ä½¿ç”¨çš„ã€å®ä¾‹ã€ä»£è¡¨ã€å¯¹è±¡ï¼ˆè€Œä¸æ˜¯ç±»ï¼‰ã€ã€‚</p><p>å¼€å§‹çš„ä¸€ä¸ªå¥½æ–¹å¼æ˜¯ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹æ¥æŒ‡å®šã€å°†è¦å®ç°çš„è¡Œä¸ºã€ã€‚æœ¬ç« ä»‹ç»çš„æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹éƒ½ç”±ä¸¤éƒ¨åˆ†ç»„æˆã€‚ç¬¬ä¸€éƒ¨åˆ†ç”± Python å¸¸ç”¨å·¥å…·ç±»çš„å®šä¹‰ã€ä½¿ç”¨ä»¥åŠæ›´é«˜çº§çš„ä¸€äº›ç‰¹æ€§ã€‚ç¬¬äºŒéƒ¨é—¨å°†ä¼šä½¿ç”¨æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„å¯¹è±¡æ¨¡å‹æ¥ä»£æ›¿ Python çš„å¸¸ç”¨å·¥å…·ç±»ã€‚</p><p>æµ‹è¯•ç”¨ä¾‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ç»´æŠ¤ Python çš„å¸¸ç”¨å·¥å…·ç±»å’Œæˆ‘ä»¬è‡ªå·±ç¼–å†™çš„å¯¹è±¡è«è¡Œä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚æ¯”å¦‚ï¼ŒPython ä¸­ä¼šä½¿ç”¨ <code>obj.attribute</code>ï¼Œè€Œæˆ‘ä»¬è‡ªå·±ç¼–å†™çš„å¯¹è±¡æ¨¡å‹çš„ä½¿ç”¨æ˜¯ <code>obj.read_attr(&quot;attribute&quot;)</code>ã€‚è¿™ç§æ˜ å°„åœ¨çœŸæ­£çš„è¯­è¨€å®ç°ä¸­å¯ä»¥ç”±è¯­è¨€çš„è§£é‡Šå™¨æˆ–ç¼–è¯‘å™¨æ¥å®Œæˆã€‚</p><p>æœ¬ç« ä¸­å¯¹æ•´ä½“çš„ä»£ç çš„è¿›è¡Œè¿›ä¸€æ­¥ç®€åŒ–ï¼Œæˆ‘ä»¬æ²¡æœ‰æ˜æ˜¾çš„åŒºåˆ†ã€å®ç°å¯¹è±¡æ¨¡å‹ã€å’Œã€ä½¿ç”¨å¯¹è±¡æ¨¡å‹ã€ã€‚åœ¨ä¸€ä¸ªçœŸæ­£çš„è¯­è¨€ç³»ç»Ÿä¸­ï¼Œè¿™ä¸¤è€…é€šå¸¸ä¼šä»¥ä¸åŒçš„ç¼–ç¨‹è¯­è¨€æ¥å®ç°ã€‚</p><p>æˆ‘ä»¬ä»è¯»å–å’Œå†™å…¥å¯¹è±¡å±æ€§çš„ç®€å•æµ‹è¯•å¼€å§‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_read_write_field</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># Python code</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    obj = A()</span><br><span class="line">    obj.a = <span class="number">1</span></span><br><span class="line">    <span class="keyword">assert</span> obj.a == <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    obj.b = <span class="number">5</span></span><br><span class="line">    <span class="keyword">assert</span> obj.a == <span class="number">1</span></span><br><span class="line">    <span class="keyword">assert</span> obj.b == <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    obj.a = <span class="number">2</span></span><br><span class="line">    <span class="keyword">assert</span> obj.a == <span class="number">2</span></span><br><span class="line">    <span class="keyword">assert</span> obj.b == <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Object model code</span></span><br><span class="line">    A = Class(name=<span class="string">"A"</span>, base_class=OBJECT, fields=&#123;&#125;, metaclass=TYPE)</span><br><span class="line">    obj = Instance(A)</span><br><span class="line">    obj.write_attr(<span class="string">"a"</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">assert</span> obj.read_attr(<span class="string">"a"</span>) == <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    obj.write_attr(<span class="string">"b"</span>, <span class="number">5</span>)</span><br><span class="line">    <span class="keyword">assert</span> obj.read_attr(<span class="string">"a"</span>) == <span class="number">1</span></span><br><span class="line">    <span class="keyword">assert</span> obj.read_attr(<span class="string">"b"</span>) == <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    obj.write_attr(<span class="string">"a"</span>, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">assert</span> obj.read_attr(<span class="string">"a"</span>) == <span class="number">2</span></span><br><span class="line">    <span class="keyword">assert</span> obj.read_attr(<span class="string">"b"</span>) == <span class="number">5</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹ä½¿ç”¨äº†ä¸‰ä¸ªæˆ‘ä»¬å¿…é¡»å®ç°çš„ä¸œè¥¿ã€‚<code>Class</code> ç±»å’Œ <code>Instance</code> ç±»åˆ†åˆ«ä»£è¡¨äº†æˆ‘ä»¬çš„å¯¹è±¡æ¨¡å‹çš„ç±»ä¸å®ä¾‹ã€‚å…¶ä¸­æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„ç±»çš„å®ä¾‹ï¼š<code>OBJECT</code> å’Œ <code>TYPE</code>ï¼Œ<code>OBJECT</code> ä»£è¡¨ Python ä¸­çš„çš„æ ¹ç±»ï¼Œ<code>TYPE</code> ä»£è¡¨ Python ä¸­ç±»çš„ typeã€‚</p><p>ä¸ºäº†ç»™ <code>Class</code> ä»¥åŠ <code>Instance</code> ç±»çš„å®ä¾‹æä¾›é€šç”¨æ“ä½œæ”¯æŒï¼Œä»–ä»¬é€šè¿‡ç»§æ‰¿ä¸€ä¸ªåŸºç±» <code>Base</code> æ¥å®ç°ä¸€ä¸ªå…±äº«æ¥å£ï¼Œè¿™ä¸ªåŸºç±»æš´éœ²äº†å¾ˆå¤šæ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">""" The base class that all of the object model classes inherit from. """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, cls, fields)</span>:</span></span><br><span class="line">        <span class="string">""" Every object has a class. """</span></span><br><span class="line">        self.cls = cls</span><br><span class="line">        self._fields = fields</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_attr</span><span class="params">(self, fieldname)</span>:</span></span><br><span class="line">        <span class="string">""" read field 'fieldname' out of the object """</span></span><br><span class="line">        <span class="keyword">return</span> self._read_dict(fieldname)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write_attr</span><span class="params">(self, fieldname, value)</span>:</span></span><br><span class="line">        <span class="string">""" write field 'fieldname' into the object """</span></span><br><span class="line">        self._write_dict(fieldname, value)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isinstance</span><span class="params">(self, cls)</span>:</span></span><br><span class="line">        <span class="string">""" return True if the object is an instance of class cls """</span></span><br><span class="line">        <span class="keyword">return</span> self.cls.issubclass(cls)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">callmethod</span><span class="params">(self, methname, *args)</span>:</span></span><br><span class="line">        <span class="string">""" call method 'methname' with arguments 'args' on object """</span></span><br><span class="line">        meth = self.cls._read_from_class(methname)</span><br><span class="line">        <span class="keyword">return</span> meth(self, *args)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_read_dict</span><span class="params">(self, fieldname)</span>:</span></span><br><span class="line">        <span class="string">""" read an field 'fieldname' out of the object's dict """</span></span><br><span class="line">        <span class="keyword">return</span> self._fields.get(fieldname, MISSING)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_write_dict</span><span class="params">(self, fieldname, value)</span>:</span></span><br><span class="line">        <span class="string">""" write a field 'fieldname' into the object's dict """</span></span><br><span class="line">        self._fields[fieldname] = value</span><br><span class="line"></span><br><span class="line">MISSING = object()</span><br></pre></td></tr></table></figure><p><code>Base</code> ç±»å®ç°äº†å¯¹è±¡çš„ç±»çš„å­˜å‚¨ï¼Œç”¨ä¸€ä¸ªå­—å…¸ä¿å­˜å¯¹è±¡çš„å±æ€§å’Œå…¶å€¼ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦å»å®ç° <code>Class</code> å’Œ <code>Instance</code> ç±»ã€‚åœ¨ <code>Instance</code> çš„æ„é€ å™¨ä¸­å°†ä¼šå®Œæˆç±»çš„å®ä¾‹åŒ–ä»¥åŠ <code>fields</code> å’Œ <code>dict</code> åˆå§‹åŒ–ã€‘ã€‚ä¹Ÿå°±æ˜¯è¯´ <code>Instance</code> ä»…ä»…æ˜¯ æ²¡æœ‰ä»»ä½•é¢å¤–åŠŸèƒ½çš„ <code>Base</code> çš„ç®€å•å­ç±»ã€‚</p><p><code>Class</code> çš„æ„é€ å™¨å°†ä¼šè·å–ç±»åã€åŸºç±»ã€ç±»çš„å­—å…¸ä»¥åŠå…ƒç±»è¿›è¡Œæ„é€ ã€‚å¯¹äºç±»æ¥è¯´ï¼Œå±æ€§ä¼šåœ¨è•¾å”å®è¯çš„æ—¶å€™ç”±ç”¨æˆ·ä¼ å…¥ç»™æ„é€ å™¨ã€‚æ„é€ å™¨ä¹Ÿä¼šä»åŸºç±»ä¸­è·å–å±æ€§çš„é»˜è®¤å€¼ï¼ˆè¿™é‡Œå°†ä¼šåœ¨ä¸‹ä¸€èŠ‚è®²è§£ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Instance</span><span class="params">(Base)</span>:</span></span><br><span class="line">    <span class="string">"""Instance of a user-defined class. """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, cls)</span>:</span></span><br><span class="line">        <span class="keyword">assert</span> isinstance(cls, Class)</span><br><span class="line">        Base.__init__(self, cls, &#123;&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Class</span><span class="params">(Base)</span>:</span></span><br><span class="line">    <span class="string">""" A User-defined class. """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, base_class, fields, metaclass)</span>:</span></span><br><span class="line">        Base.__init__(self, metaclass, fields)</span><br><span class="line">        self.name = name</span><br><span class="line">        self.base_class = base_class</span><br></pre></td></tr></table></figure><p>ç”±äºç±»ä¹Ÿæ˜¯ä¸€ç§å¯¹è±¡ï¼Œå®ƒä»¬ï¼ˆé—´æ¥ï¼‰ä» <code>Base</code> ç»§æ‰¿ã€‚ å› æ­¤ï¼Œç±»æ˜¯ä¸€ä¸ªç‰¹æ®Šç±»çš„å®ä¾‹ï¼šå…ƒç±»ã€‚</p><p>ç°åœ¨æˆ‘ä»¬åŸºæœ¬é€šè¿‡äº†ç¬¬ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚è¿˜å‰©ä¸‹æ²¡æœ‰è¯¦è§£çš„æ˜¯ <code>Class</code> çš„ä¸¤ä¸ªå®ä¾‹ <code>TYPE</code> å’Œ <code>OBJECT</code>ã€‚è¿™é‡Œæˆ‘ä»¬ä¸ä½¿ç”¨ Smalltalk çš„æ¨¡å‹ï¼Œå› ä¸ºå®ƒè¿‡äºå¤æ‚ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Python å€Ÿé‰´çš„ ObjVlispï¼ˆä¸€ç§å…ƒç¼–ç¨‹è¯­è¨€ï¼Œå¯å‚è€ƒã€ŠMetaclasses are first class: The ObjVlisp Modelã€‹ï¼‰ã€‚</p><p>ObjVlisp æ¨¡å‹ä¸­ï¼Œ<code>OBJECT</code> å’Œ <code>TYPE</code> æ˜¯äº¤ç»‡åœ¨ä¸€èµ·çš„ã€‚<code>OBJECT</code> æ˜¯æ‰€æœ‰ç±»çš„åŸºç±»ï¼Œè¿™æ„å‘³ç€ <code>OBJECT</code> ç±»æ²¡æœ‰åŸºç±»ã€‚<code>TYPE</code> æ˜¯ <code>OBJECT</code> çš„å­ç±»ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæ¯ä¸€ä¸ªç±»éƒ½æ˜¯ <code>TYPE</code> çš„å®ä¾‹ã€‚ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œ<code>TYPE</code> å’Œ <code>OBJECT</code> éƒ½æ˜¯ <code>TYPE</code> çš„å®ä¾‹ã€‚ç„¶è€Œï¼Œç¨‹åºå‘˜å¯ä»¥é€šè¿‡ç»§æ‰¿ <code>TYPE</code> æ¥å®ç°ä¸€ä¸ªæ–°çš„å…ƒç±»ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># set up the base hierarchy as in Python (the ObjVLisp model)</span></span><br><span class="line"><span class="comment"># the ultimate base class is OBJECT</span></span><br><span class="line">OBJECT = Class(name=<span class="string">"object"</span>, base_class=<span class="keyword">None</span>, fields=&#123;&#125;, metaclass=<span class="keyword">None</span>)</span><br><span class="line"><span class="comment"># TYPE is a subclass of OBJECT</span></span><br><span class="line">TYPE = Class(name=<span class="string">"type"</span>, base_class=OBJECT, fields=&#123;&#125;, metaclass=<span class="keyword">None</span>)</span><br><span class="line"><span class="comment"># TYPE is an instance of itself</span></span><br><span class="line">TYPE.cls = TYPE</span><br><span class="line"><span class="comment"># OBJECT is an instance of TYPE</span></span><br><span class="line">OBJECT.cls = TYPE</span><br></pre></td></tr></table></figure><p>ä¸ºäº†å®ç°ä¸€ä¸ªæ–°çš„å…ƒç±»ï¼Œå¯ä»¥ç»§æ‰¿ <code>TYPE</code>ã€‚ç„¶è€Œï¼Œåœ¨æœ¬ç« ä¸­æˆ‘ä»¬ä¸è¿™æ ·å»åšï¼Œæˆ‘ä»¬åªè§å¾—ä½¿ç”¨ <code>TYPE</code> ä½œä¸ºæˆ‘ä»¬æ¯ä¸ªç±»çš„å…ƒç±»ã€‚</p><p><img src="http://aosabook.org/en/500L/objmodel-images/inheritance.png" alt="å›¾ 14.1 - ç»§æ‰¿"></p><p>ç°åœ¨ç¬¬ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹å°±é€šè¿‡äº†ã€‚ç¬¬äºŒä¸ªæµ‹è¯•ç”¨ä¾‹æ ¡éªŒäº†å¯¹è±¡å±æ€§è¯»å†™æ˜¯å¦æ­£å¸¸ã€‚è¿™ååˆ†ç®€å•ï¼Œå¾ˆå¿«å°±èƒ½é€šè¿‡ç”¨ä¾‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_read_write_field_class</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># classes are objects too</span></span><br><span class="line">    <span class="comment"># Python code</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    A.a = <span class="number">1</span></span><br><span class="line">    <span class="keyword">assert</span> A.a == <span class="number">1</span></span><br><span class="line">    A.a = <span class="number">6</span></span><br><span class="line">    <span class="keyword">assert</span> A.a == <span class="number">6</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Object model code</span></span><br><span class="line">    A = Class(name=<span class="string">"A"</span>, base_class=OBJECT, fields=&#123;<span class="string">"a"</span>: <span class="number">1</span>&#125;, metaclass=TYPE)</span><br><span class="line">    <span class="keyword">assert</span> A.read_attr(<span class="string">"a"</span>) == <span class="number">1</span></span><br><span class="line">    A.write_attr(<span class="string">"a"</span>, <span class="number">5</span>)</span><br><span class="line">    <span class="keyword">assert</span> A.read_attr(<span class="string">"a"</span>) == <span class="number">5</span></span><br></pre></td></tr></table></figure><h1 id="isinstance-ï¼ˆå¯¹è±¡æ˜¯å¦æ˜¯è¯¥ç±»å®ä¾‹ï¼‰æ ¡éªŒ"><a href="#isinstance-ï¼ˆå¯¹è±¡æ˜¯å¦æ˜¯è¯¥ç±»å®ä¾‹ï¼‰æ ¡éªŒ" class="headerlink" title="isinstance ï¼ˆå¯¹è±¡æ˜¯å¦æ˜¯è¯¥ç±»å®ä¾‹ï¼‰æ ¡éªŒ"></a><code>isinstance</code> ï¼ˆå¯¹è±¡æ˜¯å¦æ˜¯è¯¥ç±»å®ä¾‹ï¼‰æ ¡éªŒ</h1><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰åˆ©ç”¨ã€å¯¹è±¡å¯¹åº”ç±»ã€çš„ç‰¹æ€§ã€‚ä¸‹ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹å°†æœºæ¢°å®ç° <code>isinstance</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_isinstance</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># Python code</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    b = B()</span><br><span class="line">    <span class="keyword">assert</span> isinstance(b, B)</span><br><span class="line">    <span class="keyword">assert</span> isinstance(b, A)</span><br><span class="line">    <span class="keyword">assert</span> isinstance(b, object)</span><br><span class="line">    <span class="keyword">assert</span> <span class="keyword">not</span> isinstance(b, type)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Object model code</span></span><br><span class="line">    A = Class(name=<span class="string">"A"</span>, base_class=OBJECT, fields=&#123;&#125;, metaclass=TYPE)</span><br><span class="line">    B = Class(name=<span class="string">"B"</span>, base_class=A, fields=&#123;&#125;, metaclass=TYPE)</span><br><span class="line">    b = Instance(B)</span><br><span class="line">    <span class="keyword">assert</span> b.isinstance(B)</span><br><span class="line">    <span class="keyword">assert</span> b.isinstance(A)</span><br><span class="line">    <span class="keyword">assert</span> b.isinstance(OBJECT)</span><br><span class="line">    <span class="keyword">assert</span> <span class="keyword">not</span> b.isinstance(TYPE)</span><br></pre></td></tr></table></figure><p>è¦æ£€æŸ¥ä¸€ä¸ª <code>obj</code> å¯¹è±¡æ˜¯å¦æ˜¯æŸä¸ªç±» <code>cls</code> çš„ä¸€ä¸ªå®ä¾‹ï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥ <code>cls</code> æ˜¯ <code>obj</code> ç±»çš„è¶…ç±»è¿˜æ˜¯ç±»æœ¬èº«ã€‚è¦æ£€æŸ¥ä¸€ä¸ª <code>ç±»X</code> æ˜¯å¦æ˜¯å¦ä¸€ä¸ªç±»çš„è¶…ç±»ï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥è¿™ä¸ªç±»çš„æ˜¯å¦åœ¨ <code>ç±»X</code> çš„ç»§æ‰¿é“¾ä¸Šã€‚å¦‚æœè¿˜æœ‰å…¶ä»–çš„ç±»åœ¨è¿™ä¸ªç»§æ‰¿é“¾ä¸Šï¼Œé‚£ä¹ˆè¿™äº›ç±»ä¹Ÿæ˜¯ <code>ç±»X</code> çš„è¶…ç±»ã€‚åŒ…æ‹¬ <code>ç±»x</code> æœ¬èº«åœ¨å†…çš„ä¸€ä¸ªç»§æ‰¿é“¾ç§°ä¸ºè¯¥ç±»çš„ã€æ–¹æ³•è§£æé¡ºåºã€ã€‚ é€šè¿‡é€’å½’å¾ˆå®¹æ˜“å°†å…¶è®¡ç®—å‡ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Class</span><span class="params">(Base)</span>:</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">method_resolution_order</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">""" compute the method resolution order of the class """</span></span><br><span class="line">        <span class="keyword">if</span> self.base_class <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">return</span> [self]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> [self] + self.base_class.method_resolution_order()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">issubclass</span><span class="params">(self, cls)</span>:</span></span><br><span class="line">        <span class="string">""" is self a subclass of cls? """</span></span><br><span class="line">        <span class="keyword">return</span> cls <span class="keyword">in</span> self.method_resolution_order()</span><br></pre></td></tr></table></figure><p>åŠ ä¸Šè¿™æ®µä»£ç åï¼Œæµ‹è¯•ç”¨ä¾‹å°±å¯ä»¥é¡ºåˆ©é€šè¿‡äº†ã€‚</p><hr><h3 id="è¯‘è€…è‘—ï¼šæ–‡ç« æœ‰ç‚¹é•¿ï¼Œæ€•å¤§å®¶çœ‹ç€æ„Ÿè§‰å¤ªå¹²ï¼Œåˆ†æˆäº†çš„ä¸‰ç¯‡æ–‡ç« ï¼Œå¤§å®¶ä¼‘æ¯ä¸€ä¸‹ï¼Œç»§ç»­å§ã€‚"><a href="#è¯‘è€…è‘—ï¼šæ–‡ç« æœ‰ç‚¹é•¿ï¼Œæ€•å¤§å®¶çœ‹ç€æ„Ÿè§‰å¤ªå¹²ï¼Œåˆ†æˆäº†çš„ä¸‰ç¯‡æ–‡ç« ï¼Œå¤§å®¶ä¼‘æ¯ä¸€ä¸‹ï¼Œç»§ç»­å§ã€‚" class="headerlink" title="è¯‘è€…è‘—ï¼šæ–‡ç« æœ‰ç‚¹é•¿ï¼Œæ€•å¤§å®¶çœ‹ç€æ„Ÿè§‰å¤ªå¹²ï¼Œåˆ†æˆäº†çš„ä¸‰ç¯‡æ–‡ç« ï¼Œå¤§å®¶ä¼‘æ¯ä¸€ä¸‹ï¼Œç»§ç»­å§ã€‚"></a>è¯‘è€…è‘—ï¼šæ–‡ç« æœ‰ç‚¹é•¿ï¼Œæ€•å¤§å®¶çœ‹ç€æ„Ÿè§‰å¤ªå¹²ï¼Œåˆ†æˆäº†çš„ä¸‰ç¯‡æ–‡ç« ï¼Œå¤§å®¶ä¼‘æ¯ä¸€ä¸‹ï¼Œç»§ç»­å§ã€‚</h3><h3 id="ä¸‹ä¸€ç¯‡ï¼šã€Šã€500-Lines-or-Lessã€‘-ã€ç¿»è¯‘ç»ƒä¹ ã€‘-ã€chapter-14ã€‘-ã€ç®€å•å¯¹è±¡æ¨¡å‹ã€‘-ã€ç¬¬äºŒéƒ¨åˆ†ã€‘ã€‹"><a href="#ä¸‹ä¸€ç¯‡ï¼šã€Šã€500-Lines-or-Lessã€‘-ã€ç¿»è¯‘ç»ƒä¹ ã€‘-ã€chapter-14ã€‘-ã€ç®€å•å¯¹è±¡æ¨¡å‹ã€‘-ã€ç¬¬äºŒéƒ¨åˆ†ã€‘ã€‹" class="headerlink" title="ä¸‹ä¸€ç¯‡ï¼šã€Šã€500 Lines or Lessã€‘-ã€ç¿»è¯‘ç»ƒä¹ ã€‘-ã€chapter 14ã€‘-ã€ç®€å•å¯¹è±¡æ¨¡å‹ã€‘-ã€ç¬¬äºŒéƒ¨åˆ†ã€‘ã€‹"></a><a href="http://zhoulingyu.com/2017/10/31/500-Lines-or-Less-14-2/">ä¸‹ä¸€ç¯‡ï¼šã€Šã€500 Lines or Lessã€‘-ã€ç¿»è¯‘ç»ƒä¹ ã€‘-ã€chapter 14ã€‘-ã€ç®€å•å¯¹è±¡æ¨¡å‹ã€‘-ã€ç¬¬äºŒéƒ¨åˆ†ã€‘ã€‹</a></h3><hr><p>æœ‰ä»€ä¹ˆé—®é¢˜éƒ½å¯ä»¥åœ¨åšæ–‡åé¢ç•™è¨€ï¼Œæˆ–è€…å¾®åšä¸Šç§ä¿¡æˆ‘ï¼Œæˆ–è€…é‚®ä»¶æˆ‘ <a href="mailto:&#99;&#111;&#x64;&#101;&#x72;&#x66;&#105;&#x73;&#104;&#x40;&#x31;&#x36;&#51;&#x2e;&#99;&#x6f;&#x6d;" target="_blank" rel="noopener">&#99;&#111;&#x64;&#101;&#x72;&#x66;&#105;&#x73;&#104;&#x40;&#x31;&#x36;&#51;&#x2e;&#99;&#x6f;&#x6d;</a>ã€‚</p><p>åšä¸»æ˜¯ iOS å¦¹å­ä¸€æšã€‚</p><p>å¸Œæœ›å¤§å®¶ä¸€èµ·è¿›æ­¥ã€‚</p><p>æˆ‘çš„å¾®åšï¼š<a href="http://weibo.com/coderfish/" target="_blank" rel="noopener">å°é±¼å‘¨å‡Œå®‡</a></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;åŸæ–‡é“¾æ¥ï¼š&lt;a href=&quot;http://aosabook.org/en/500L/a-simple-object-model.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;A Simple Object Model&lt;/a&gt;&lt;br&gt;ä½œè€…ä¿¡æ¯ï¼š&lt;a href=&quot;https://twitter.com/cfbolz&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Carl Friedrich Bolz&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://twitter.com/cfbolz&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Carl Friedrich Bolz&lt;/a&gt;æ˜¯ä¼¦æ•¦å›½ç‹å¤§å­¦çš„ç ”ç©¶å‘˜ï¼Œå¯¹åŠ¨æ€è¯­è¨€çš„å®ç°åŠä¼˜åŒ–å…´è¶£æµ“åšã€‚ä»–æ˜¯ PyPy/RPython çš„æ ¸å¿ƒè´¡çŒ®è€…ä¹‹ä¸€ï¼Œå¹¶ä¸º Prolog, Racket, Smalltalk, PHP å’Œ Ruby ç­‰è¯­è¨€è´¡çŒ®ä»£ç ã€‚&lt;/p&gt;
&lt;h1 id=&quot;å¼•å­&quot;&gt;&lt;a href=&quot;#å¼•å­&quot; class=&quot;headerlink&quot; title=&quot;å¼•å­&quot;&gt;&lt;/a&gt;å¼•å­&lt;/h1&gt;&lt;p&gt;é¢å‘å¯¹è±¡å¼€å‘æ˜¯ç°ä»Šæœ€ä¸»æµçš„ç¼–ç¨‹èŒƒå¼ä¹‹ä¸€ï¼Œé¢å‘å¯¹è±¡çš„æ€æƒ³å’Œå˜æˆèŒƒå¼ä¹Ÿè¢«å¤§é‡çš„ç¼–ç¨‹è¯­è¨€æ‰€æ”¯æŒã€‚è™½ç„¶ä¸ç—›è¯­è¨€æä¾›çš„é¢å‘å¯¹è±¡ç¼–ç¨‹æœºåˆ¶è¡¨é¢ä¸Šéå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯ç»†èŠ‚ä¸Šå´å¤§ç›¸å¾„åº­ã€‚å¤§å¤šæ•°è¯­è¨€çš„å…±åŒç‚¹æ˜¯æ‹¥æœ‰å¯¹è±¡å’Œç»§æ‰¿æœºåˆ¶ã€‚è€Œã€ç±»ã€ï¼Œå¹¶ä¸æ˜¯æ¯ä¸€ç§è¯­è¨€éƒ½å¾ˆå¥½çš„æ”¯æŒå®ƒçš„ç§ç§ç‰¹æ€§ã€‚æ¯”å¦‚ï¼Œæ¯”å¦‚å¯¹äº &lt;code&gt;Self&lt;/code&gt; æˆ–è€… &lt;code&gt;JavaScript&lt;/code&gt; è¿™æ ·çš„åŸå‹ç¨‹åºè®¾è®¡çš„è¯­è¨€æ¥è¯´æ²¡æœ‰ç±»çš„æ¦‚å¿µï¼Œè€Œæ˜¯å¯¹è±¡é—´ç›´æ¥è¿›è¡Œäº†ç»§æ‰¿ã€‚&lt;/p&gt;
&lt;p&gt;äº†è§£ä¸åŒè¯­è¨€çš„å¯¹è±¡æ¨¡å‹çš„ä¸åŒä¹‹å¤„æ˜¯ä¸€ä»¶éå¸¸æœ‰è¶£çš„äº‹ã€‚è¿™èƒ½å¸®åŠ©ä½ å‘ç°ä¸åŒè¯­è¨€çš„å¼‚åŒä¹‹å¤„ã€‚è¿™å°†åœ¨æˆ‘ä»¬å­¦ä¹ æ–°è¯­è¨€æ—¶ï¼Œè¿ç”¨ä»¥å¾€çš„ç¼–ç¨‹è¯­è¨€ç»éªŒï¼Œå¿«é€Ÿçš„å­¦ä¹ ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ç« å°†æ¢ç´¢å­¦å®ç°ä¸€å¥—ç®€å•çš„å¯¹è±¡æ¨¡å‹ã€‚æˆ‘ä»¬å°†ä»ä¸€ä¸ªç®€å•çš„å®ä¾‹å’Œå®ƒçš„ç±»å¼€å§‹ï¼Œå¹¶è®©å®ƒæ‹¥æœ‰ä¸€äº›æ–¹æ³•å¯ä»¥ç”¨äºè®¿é—®ã€‚è¿™æ˜¯è¢« Simula 67 ã€Smalltalk ç­‰æ—©æœŸ OOï¼ˆé¢å‘å¯¹è±¡ï¼‰ è¯­è¨€æ‰€é‡‡ç”¨çš„ç»å…¸é¢å‘å¯¹è±¡èŒƒä¾‹ã€‚åœ¨æœ¬ç« ä¸­ï¼Œè¿™ä¸ªæ¨¡å‹å°†ä¼šè¢«ä¸€æ­¥æ­¥è¿›è¡Œæ‰©å±•ï¼Œå‰ä¸¤ä¸ªå°èŠ‚æˆ‘ä»¬å°†å±•ç¤ºä¸åŒè¯­è¨€çš„è®¾è®¡æ€è·¯ï¼Œæœ€åä¸€å°èŠ‚å°†è®²è§£å¦‚ä½•æé«˜å¯¹è±¡æ¨¡å‹çš„æ€§èƒ½ã€‚æœ€ç»ˆæˆ‘ä»¬çš„æ¨¡å‹å¹¶ä¸æ˜¯ä»»ä½•ä¸€é—¨è¯­è¨€æ‰€é‡‡ç”¨çš„æ¨¡å‹ï¼Œä¸è¿‡ï¼Œå°†è®¤ä¸ºæ˜¯ä¸€ä¸ªç®€åŒ–çš„ Python å¯¹è±¡æ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ç« ä¸­ä½¿ç”¨çš„ä»£ç èŒƒä¾‹éƒ½ä½¿ç”¨ Python ç¼–å†™ã€‚ä»£ç å¯ä»¥è¿è¡Œåœ¨ Python 2.7 å’Œ 3.4ã€‚ä¸ºäº†æ›´å¥½çš„ç†è§£å¯¹è±¡æ¨¡å‹çš„è®¾è®¡ï¼Œæœ¬ç« ä¹Ÿæä¾›äº†ç›¸åº”çš„å•å…ƒæµ‹è¯•ã€‚æµ‹è¯•ä»£ç å¯ä»¥é€šè¿‡ py.test æˆ–è€… nose æ¥è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;ç”¨ Python ä½œä¸ºå®ç°è¯­è¨€å¹¶ä¸æ˜¯æœ€å¥½çš„ï¼Œé€šå¸¸ä¸€ä¸ª VMï¼ˆæˆ–è€…è¯­è¨€è§£é‡Šå™¨ï¼‰æ˜¯ç”±åº•å±‚è¯­è¨€æ¯”å¦‚ C å’Œ C++ å®ç°çš„ï¼Œå¹¶åœ¨å®ç°è¿‡ç¨‹ä¸­å¯¹æ›´åå‘äºæ‰£æ¯ä¸€ä¸ªå®ç°ç»†èŠ‚ä»è€Œæé«˜ä»£ç æ•ˆç‡ã€‚è€Œæ›´ç®€å•çš„è¯­è¨€æ›´è®©æˆ‘ä»¬æ›´å®¹æ˜“å…³æ³¨å®é™…çš„è¡Œä¸ºè¡¨ç°ï¼Œè€Œä¸æ˜¯æ‰£å®ç°ç»†èŠ‚ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Python" scheme="http://zhoulingyu.com/categories/Python/"/>
    
    
      <category term="è¯‘æ–‡" scheme="http://zhoulingyu.com/tags/%E8%AF%91%E6%96%87/"/>
    
      <category term="Python" scheme="http://zhoulingyu.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>iOSâ€”â€”Swift ä¸­çš„ strongSelfï¼Œä½ ä»¥ä¸ºä¸éœ€è¦äº†ï¼Ÿ</title>
    <link href="http://zhoulingyu.com/2017/08/14/iOS%E2%80%94%E2%80%94swift-strongself/"/>
    <id>http://zhoulingyu.com/2017/08/14/iOSâ€”â€”swift-strongself/</id>
    <published>2017-08-14T15:19:35.000Z</published>
    <updated>2018-07-10T03:07:31.628Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å¼€ç«¯"><a href="#å¼€ç«¯" class="headerlink" title="å¼€ç«¯"></a>å¼€ç«¯</h1><p>Objective-C ä¸­ï¼Œæœ‰ä¸€æ®µé‡å¤å†™åˆ°ä½ ä¸å¾—ä¸åŠ å…¥ <code>snippets</code> çš„ä»£ç å—ã€‚å°±æ˜¯ä¸‹é¢è¿™æ®µ</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">__<span class="keyword">weak</span> __typeof__(<span class="keyword">self</span>) weakSelf = <span class="keyword">self</span>;</span><br><span class="line">[<span class="keyword">self</span>.aButton touchUpInside:^&#123;</span><br><span class="line">    __<span class="keyword">strong</span> __<span class="keyword">typeof</span>(weakSelf)strongSelf = weakSelf;</span><br><span class="line">    <span class="keyword">if</span> (strongSelf) &#123;</span><br><span class="line">        strongSelf.title = <span class="string">@"æŒ‰é’®è¢«ç‚¹å‡»"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬ï¼Œç”±äºé‡å¤å†™çš„æ¬¡æ•°è¿‡å¤šï¼Œå°±åŠ åˆ°äº† <code>snippets</code> å¿«æ·ä»£ç å—ï¼Œä»¥ä¸‹æ˜¯æˆ‘çš„ï¼š</p><a id="more"></a><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_swift-strongself-01.png" alt=""></p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_swift-strongself-02.png" alt=""></p><p>å½“ç„¶ï¼Œå¦‚æœç”¨äº† RACï¼Œä½ å¯ä»¥å†™æˆå¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@weakify(<span class="keyword">self</span>);</span><br><span class="line">[<span class="keyword">self</span>.aButton touchUpInside:^&#123;</span><br><span class="line"> @strongify(<span class="keyword">self</span>);</span><br><span class="line">    <span class="keyword">if</span> (strongSelf) &#123;</span><br><span class="line">        <span class="keyword">self</span> = <span class="string">@"æŒ‰é’®è¢«ç‚¹å‡»"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œå¦‚æœä½ é˜…è¯»è¿‡ RAC å¯¹ <code>@weakify</code> å’Œ <code>@strongify</code> è¯­æ³•ç³–çš„å®ç°ï¼Œä½ ä¼šçŸ¥é“ï¼Œå®ç°æ–¹å¼ä¸è¿‡æ˜¯ç”¨å®ç®€å†™äº† <code>__weak __typeof__(self) weakSelf = self;</code> å’Œ <code>__strong __typeof(weakSelf)strongSelf = weakSelf;</code></p><p>é‡ç‚¹æ˜¯ä¸ºä»€ä¹ˆè¦å†™è¿™ä¸¤å¥ä»£ç ï¼Ÿ</p><p>weakSelf æ˜¯ä¸ºäº†é¿å…å¾ªç¯å¼•ç”¨ï¼ˆå¦‚æœä½ å¯¹å¾ªç¯å¼•ç”¨å’Œå†…å­˜ç®¡ç†ä¸äº†è§£çš„è¯ï¼Œè¯·è°ƒè·³åˆ°ä¸‹æ–¹ <a href="#Other">Other éƒ¨åˆ†</a>ï¼‰ã€‚</p><p>strongSelf æ˜¯ä¸ºäº†é˜²æ­¢ self è¢«æå‰é‡Šæ”¾ã€‚å…·ä½“å¯ä»¥å‚è€ƒ <a href="http://www.jianshu.com/p/701da54bd78c" target="_blank" rel="noopener">æ·±å…¥ç ”ç©¶Blockç”¨weakSelfã€strongSelfã€@weakifyã€@strongifyè§£å†³å¾ªç¯å¼•ç”¨</a>ã€‚</p><h1 id="ä½ ä»¥ä¸º-Swift-ä¸­ä¸éœ€è¦-strongSelf-äº†å—ï¼Ÿ"><a href="#ä½ ä»¥ä¸º-Swift-ä¸­ä¸éœ€è¦-strongSelf-äº†å—ï¼Ÿ" class="headerlink" title="ä½ ä»¥ä¸º Swift ä¸­ä¸éœ€è¦ strongSelf äº†å—ï¼Ÿ"></a>ä½ ä»¥ä¸º Swift ä¸­ä¸éœ€è¦ strongSelf äº†å—ï¼Ÿ</h1><p>Swift ä¸­æœ‰äº† <code>[weak self]</code> è¯­æ³•ç³–åï¼Œå†ä¹Ÿä¸ç”¨è°¢ä¸€é•¿ä¸² <code>__weak __typeof__(self) weakSelf = self;</code>ï¼Œç›¸åº”çš„ï¼Œåœ¨é—­åŒ…ä¸­ä¼šè°ƒç”¨åˆ°å·²ç»è¢«å¼±å¼•ç”¨çš„ <code>self</code>ï¼Œä½†ä½¿ç”¨ <code>self</code> æ—¶éœ€è¦åŠ ä¸Š <code>?</code>ã€‚</p><p>è¿™é‡Œå°±å·²ç»å¯ä»¥åˆè§ç«¯å€ªäº†ï¼Œå’Œ Objective-C ä¸€æ ·ï¼Œweak å¼•ç”¨çš„ <code>self</code> æ˜¯å¯ä»¥è¢«é‡Šæ”¾çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>self</code> å¯ä»¥ä¸º <code>nil</code>ã€‚åœ¨ Objective-C ä¸­ï¼Œæ²¡æœ‰å¯é€‰æ€§æ¦‚å¿µï¼Œæ‰€ä»¥å¯¹æ­¤å¹¶ä¸æ„ŸçŸ¥ï¼Œåœ¨ Swift ä¸­é—®é¢˜å°±å¾ˆå®¹æ˜“æš´éœ²å‡ºæ¥ã€‚å¦‚æœ <code>self</code> è¢«æå‰é‡Šæ”¾äº†ä¼šå¦‚ä½•ï¼Ÿ</p><p>æˆ‘ä»¬åšå¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> anObject: <span class="type">SomeClass</span>? = <span class="type">SomeClass</span>()  <span class="comment">// Optional, so we can set it to nil</span></span><br><span class="line">        anObject?.doClosure()</span><br><span class="line"></span><br><span class="line">        <span class="type">DispatchQueue</span>.global(qos: .userInitiated).async &#123;</span><br><span class="line">            usleep(<span class="number">100</span>)</span><br><span class="line">            anObject = <span class="literal">nil</span>  <span class="comment">// This will dealloc c</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">deinit</span> &#123; <span class="built_in">print</span>(<span class="string">"Destroying C"</span>) &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">log</span><span class="params">(<span class="number">_</span> msg: String)</span></span> &#123; <span class="built_in">print</span>(msg) &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">doClosure</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="type">DispatchQueue</span>.global(qos: .userInitiated).async &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>?.log(<span class="string">"before sleep"</span>)</span><br><span class="line">            usleep(<span class="number">500</span>)</span><br><span class="line">            <span class="keyword">self</span>?.log(<span class="string">"after sleep"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p>è¿™å°±æ˜¯é—®é¢˜æ‰€åœ¨äº†ã€‚ä»£ç ä¸­å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°ï¼Œåœ¨é—­åŒ…ä¸­ä»£ç è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œ<code>anObject</code> è¢«è®¾ç½®æˆäº† <code>nil</code>ï¼Œæ­¤æ—¶æ²¡æœ‰ä»»ä½•å¯¹è±¡å¼ºå¼•ç”¨å®ƒï¼Œè‡ªç„¶è¢«é‡Šæ”¾äº†ï¼Œé‡Šæ”¾åé—­åŒ…ä¸­ä»£ç ç»§ç»­è¿è¡Œï¼Œ<code>self</code> æ­¤æ—¶ä¸º <code>nil</code>ï¼Œä½†ç”±äº Swfit çš„å®‰å…¨æ€§ï¼Œ<code>self?.log(&quot;after sleep&quot;)</code> æ²¡æœ‰è§£åŒ…æˆåŠŸä¾¿ä¸ä¼šæ‰§è¡Œï¼Œæ‰€ä»¥ä¸ä¼šé€ æˆé—ªé€€ã€‚ä½†é—®é¢˜ä¾ç„¶æœ‰ã€‚</p><p>ç”±äºåç»­ä»£ç æ²¡æœ‰æ‰§è¡Œï¼Œé€ æˆçš„å…¶ä»–é€»è¾‘é”™è¯¯æ˜¯å¯æƒ³è€ŒçŸ¥çš„ï¼Œå¦‚æœé—­åŒ…ä¸­æ­£åœ¨æ‰§è¡Œå­˜ç£ç›˜æ“ä½œï¼Œ<code>self</code> è¢«é‡Šæ”¾ï¼Œåç»­è¿˜æœ‰æ›´æ–° UI æ˜¾ç¤ºç­‰ç­‰æ“ä½œï¼Œä¾¿ä¸ä¼šæ‰§è¡Œï¼Œé€ æˆå„ç§å„æ ·çš„é—®é¢˜ã€‚</p><p>æ‰€ä»¥ï¼Œä½ ä»¥ä¸º Swift ä¸­å°±ä¸éœ€è¦ <code>strongSelf</code> äº†ï¼Ÿä¸ï¼Œä»¥åä½ çš„ä»£ç ä»ç„¶éœ€è¦ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DispatchQueue</span>.global(qos: .userInitiated).async &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> strongSelf = <span class="keyword">self</span> &#123;</span><br><span class="line">        strongSelf.log(<span class="string">"before sleep"</span>)</span><br><span class="line">        usleep(<span class="number">500</span>)</span><br><span class="line">        strongSelf.log(<span class="string">"after sleep"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_swift-strongself-05.png-w375" alt=""></p><p>å½“ç„¶ï¼Œä½ å¯ä»¥åŠ åˆ° <code>snippets</code>ï¼Œè¿™æ ·å°±å¯ä»¥å¿«é€Ÿæ’å…¥ä»£ç äº†ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_swift-strongself-04.png" alt=""></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p><strong>Swift å’Œ Objective-C å¤§ä¸åŒï¼Œä½†æ˜¯ iOS å†…å­˜ç®¡ç†ä»ç„¶æ˜¯ iOS å†…å­˜ç®¡ç†ï¼ŒARC ä»ç„¶æ˜¯ ARCï¼Œæ‰€ä»¥ä¸ç®¡è¯­æ³•æ€ä¹ˆå˜ï¼Œå…³äºå†…å­˜å’Œå¼•ç”¨ä¾æ—§è¿˜æ˜¯åŸæ¥çš„æ ·å­ï¼Œ<code>strongSelf</code> ä¹Ÿå¥½ï¼Œå¾ªç¯å¼•ç”¨ä¹Ÿå¥½ï¼Œåƒä¸‡åˆ«å¿˜äº†å»æ³¨æ„ã€‚</strong></p><h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><p>ä»£ç éƒ½åœ¨<a href="https://github.com/summertian4/iOS-Swift/tree/master/StrongSelf" target="_blank" rel="noopener">è¿™é‡Œ</a></p><h1 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h1><p>å¦‚æœä»¥ä¸‹è¿™å¹…å›¾ä¸­çš„ä¸‰ä¸ªé—®é¢˜ï¼Œä½ ä¸èƒ½æ¸…æ™°çš„ç­”å‡ºç­”æ¡ˆå’Œå…¶ç†ç”±ï¼Œå»ºè®®ä½ å»è¯»ä¸€è¯» Objective-C å…³äºå†…å­˜ç®¡ç†çš„æºç å“Ÿã€‚è¿™é‡Œæ˜¯æˆ‘çš„ä¸¤ç¯‡åšæ–‡ï¼Œå¸Œæœ›èƒ½å¸®åˆ°ä½ ï¼š</p><ol><li><a href="http://zhoulingyu.com/2017/02/08/iOS%E8%BF%9B%E9%98%B6%E2%80%94%E2%80%94iOS-Memory-Block/">iOSè¿›é˜¶â€”â€”iOSï¼ˆObjective-Cï¼‰ å†…å­˜ç®¡ç†&amp;Block</a></li><li><a href="http://zhoulingyu.com/2017/02/15/Advanced-iOS-Study-objc-Memory-2/">iOSè¿›é˜¶â€”â€”iOSï¼ˆObjective-Cï¼‰å†…å­˜ç®¡ç†Â·äºŒ</a></li></ol><p>ä»¥ä¸‹æ˜¯ä¸‰ä¸ªé—®é¢˜ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_swift-strongself-03.jpeg" alt=""></p><hr><p>æœ‰ä»€ä¹ˆé—®é¢˜éƒ½å¯ä»¥åœ¨åšæ–‡åé¢ç•™è¨€ï¼Œæˆ–è€…å¾®åšä¸Šç§ä¿¡æˆ‘ï¼Œæˆ–è€…é‚®ä»¶æˆ‘ <a href="mailto:&#x63;&#111;&#100;&#101;&#114;&#x66;&#x69;&#x73;&#104;&#x40;&#49;&#54;&#51;&#46;&#99;&#x6f;&#109;" target="_blank" rel="noopener">&#x63;&#111;&#100;&#101;&#114;&#x66;&#x69;&#x73;&#104;&#x40;&#49;&#54;&#51;&#46;&#99;&#x6f;&#109;</a>ã€‚</p><p>åšä¸»æ˜¯ iOS å¦¹å­ä¸€æšã€‚</p><p>å¸Œæœ›å¤§å®¶ä¸€èµ·è¿›æ­¥ã€‚</p><p>æˆ‘çš„å¾®åšï¼š<a href="http://weibo.com/coderfish/" target="_blank" rel="noopener">å°é±¼å‘¨å‡Œå®‡</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å¼€ç«¯&quot;&gt;&lt;a href=&quot;#å¼€ç«¯&quot; class=&quot;headerlink&quot; title=&quot;å¼€ç«¯&quot;&gt;&lt;/a&gt;å¼€ç«¯&lt;/h1&gt;&lt;p&gt;Objective-C ä¸­ï¼Œæœ‰ä¸€æ®µé‡å¤å†™åˆ°ä½ ä¸å¾—ä¸åŠ å…¥ &lt;code&gt;snippets&lt;/code&gt; çš„ä»£ç å—ã€‚å°±æ˜¯ä¸‹é¢è¿™æ®µ&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;__&lt;span class=&quot;keyword&quot;&gt;weak&lt;/span&gt; __typeof__(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;) weakSelf = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.aButton touchUpInside:^&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    __&lt;span class=&quot;keyword&quot;&gt;strong&lt;/span&gt; __&lt;span class=&quot;keyword&quot;&gt;typeof&lt;/span&gt;(weakSelf)strongSelf = weakSelf;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (strongSelf) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        strongSelf.title = &lt;span class=&quot;string&quot;&gt;@&quot;æŒ‰é’®è¢«ç‚¹å‡»&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¸€èˆ¬ï¼Œç”±äºé‡å¤å†™çš„æ¬¡æ•°è¿‡å¤šï¼Œå°±åŠ åˆ°äº† &lt;code&gt;snippets&lt;/code&gt; å¿«æ·ä»£ç å—ï¼Œä»¥ä¸‹æ˜¯æˆ‘çš„ï¼š&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://zhoulingyu.com/categories/iOS/"/>
    
      <category term="Swift" scheme="http://zhoulingyu.com/categories/iOS/Swift/"/>
    
    
      <category term="iOS" scheme="http://zhoulingyu.com/tags/iOS/"/>
    
      <category term="Swift" scheme="http://zhoulingyu.com/tags/Swift/"/>
    
      <category term="å†…å­˜ä¸å¼•ç”¨" scheme="http://zhoulingyu.com/tags/%E5%86%85%E5%AD%98%E4%B8%8E%E5%BC%95%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>ç®€ä»‹æˆ‘çš„ Git Work Flow</title>
    <link href="http://zhoulingyu.com/2017/05/08/Git-Work-Flow/"/>
    <id>http://zhoulingyu.com/2017/05/08/Git-Work-Flow/</id>
    <published>2017-05-08T15:31:46.000Z</published>
    <updated>2018-07-10T03:07:31.624Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é‡è¦æ€§"><a href="#é‡è¦æ€§" class="headerlink" title="é‡è¦æ€§"></a>é‡è¦æ€§</h1><p>æˆ‘ä»¬ä»é‡è¦æ€§è¯´èµ·ã€‚</p><p>å›¢é˜Ÿå¼€å‘ä¸­è¦é‡è§†æœ‰æ´ç™–çš„äººï¼Œè¿™ç§äººå¾€å¾€å¯¹ç³Ÿç³•çš„å·¥ä½œæµä¸æ–­æå‡ºæ„è§ã€å¯¹ Git çš„ä½¿ç”¨æ–¹å¼æå‡ºè¦æ±‚ã€‚å¦‚æœä½ çš„å›¢é˜Ÿä¸­è¿™ç§äººæ­£åœ¨ä¸æ–­çš„è¢«å¿½è§†ï¼Œé‚£ä¹ˆä½ çš„å›¢é˜Ÿä¸€å®šå‡ºç°äº†ç®¡ç†æ··ä¹±ã€ä»£ç è´¨é‡ä¸é«˜ç­‰ç­‰ç­‰ç­‰é—®é¢˜ã€‚</p><p>ç»Ÿä¸€çš„å·¥ä½œæµç¨‹æ˜¯è‡³å…³é‡è¦çš„ï¼Œä¸ç®¡å¯¹äºå“ªä¸€ä¸ªè¡Œä¸šçš„ä½œä¸šæ¥è¯´éƒ½ä¸€æ ·ã€‚å¯¹äºæˆ‘ä»¬å¼€å‘äººå‘˜ï¼Œå·¥ä½œæµåŒ…å«äº†å¼€å‘æ—¶ Git çš„ä½¿ç”¨è§„èŒƒã€Repo ç®¡ç†çš„è§„èŒƒã€æµ‹è¯•è¿‡ç¨‹çš„è§„èŒƒã€è®¾è®¡äº¤äº’çš„ç®¡ç†è§„èŒƒç­‰ç­‰ã€‚ç”±äºæµ‹è¯•ã€äº¤äº’ç­‰è®¾è®¡åˆ°æ›´å¤šçš„äººå‘˜ï¼Œæœ¬ç¯‡æ–‡ç« æš‚ä¸”ä¸è¡¨ï¼Œé‡ç‚¹è¯´ Git çš„ä½¿ç”¨è§„èŒƒå’Œ repo ç®¡ç†çš„è§„èŒƒã€‚</p><p>æœ¬ç¯‡æ–‡ç« å°†è®²è¿°æˆ‘åœ¨å·¥ä½œä¸­ä¸€ç›´ä½¿ç”¨çš„ Work Flowï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰å¸®åŠ©ã€‚</p><a id="more"></a><h1 id="å¸¸è§-Git-ä½¿ç”¨è§„èŒƒ"><a href="#å¸¸è§-Git-ä½¿ç”¨è§„èŒƒ" class="headerlink" title="å¸¸è§ Git ä½¿ç”¨è§„èŒƒ"></a>å¸¸è§ Git ä½¿ç”¨è§„èŒƒ</h1><p>å…ˆä¸¾ä¸€ä¸ªä¾‹å­ï¼Œæ”¾ä¸Šå‡ å¼  Network çš„å›¾å½¢æˆªå›¾ã€‚ä¸ºäº†ä½ çš„å·¥ç¨‹ä¸å˜æˆä¸‹é¢è¿™ä¸ªæ ·å­ï¼Œè¯·å–„å¾… Git çš„ä½¿ç”¨ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_work-flow-01.png-w375" alt="ç¤ºä¾‹1"></p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_work-flow-02.png-w375" alt="ç¤ºä¾‹2"></p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_work-flow-03.png-w375" alt="ç¤ºä¾‹3"></p><p>è¿™æ ·ä¸€ä¸ªä¹±ç³Ÿç³Ÿçš„ Gitï¼Œä½ ä»¬èƒ½å¿æˆ‘ä¸èƒ½å¿ã€‚</p><p>å…ˆæ¥è¯´è¯´å‡ å¼ å›¾ç§çš„é—®é¢˜ï¼š</p><ol><li>åå‘æ‹‰å– <code>develop</code> åˆ†æ”¯</li><li>ä¸ç»è¿‡ <code>Pull Request</code> çš„åˆå¹¶</li><li>é‡å¤ä½¿ç”¨å·²ç»åˆå¹¶çš„åˆ†æ”¯</li><li>æ²¡æœ‰æ„ä¹‰çš„ <code>Commit Message</code></li></ol><p><strong>å¯¹äºé—®é¢˜ 1</strong>ï¼Œæ•¢é—®è¿™ä½åŒå­¦ï¼Œèƒ½ä¸èƒ½ç”¨ <code>rebase</code>ï¼Ÿå¾ˆå¤šåŒå­¦åœ¨å¼€å‘åˆ†æ”¯è¿‡ç¨‹ä¸­ï¼Œå‘ç° <code>develop</code> æœ‰æ›´æ–°ï¼Œå°±å»æ‹‰å– <code>develop</code> çš„å†…å®¹ Merge è¿›è‡ªå·±å½“å‰åˆ†æ”¯ã€‚å¯¹äº <code>rebase</code> å’Œ <code>merge</code>ï¼Œè¯·å‚è€ƒ <a href="https://github.com/geeeeeeeeek/git-recipes/wiki/5.1-%E4%BB%A3%E7%A0%81%E5%90%88%E5%B9%B6%EF%BC%9AMerge%E3%80%81Rebase%E7%9A%84%E9%80%89%E6%8B%A9" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a> ã€‚å¼•ç”¨é‡Œé¢çš„è¯ï¼š</p><blockquote><p>æ¯æ¬¡åˆå¹¶ä¸Šæ¸¸æ›´æ”¹æ—¶ <code>feature</code> åˆ†æ”¯éƒ½ä¼šå¼•å…¥ä¸€ä¸ªå¤–æ¥çš„åˆå¹¶æäº¤ã€‚å¦‚æœ <code>develop</code> éå¸¸æ´»è·ƒçš„è¯ï¼Œè¿™æˆ–å¤šæˆ–å°‘ä¼šæ±¡æŸ“ä½ çš„åˆ†æ”¯å†å²ã€‚è™½ç„¶é«˜çº§çš„ <code>git log</code> é€‰é¡¹å¯ä»¥å‡è½»è¿™ä¸ªé—®é¢˜ï¼Œä½†å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œ<strong>è¿˜æ˜¯ä¼šå¢åŠ ç†è§£é¡¹ç›®å†å²çš„éš¾åº¦ã€‚</strong></p></blockquote><p><strong>å¯¹äºé—®é¢˜ 2</strong>ï¼Œå®Œå…¨å°±æ˜¯ä¹ æƒ¯é—®é¢˜ï¼Œå¯¹äºæ‰€æœ‰çš„åˆå¹¶ï¼Œå¦‚æœæ˜¯ä½ è‡ªå·±çš„ä¸¤ä¸ªåˆ†æ”¯ä¹‹é—´ï¼Œå¦‚æœéè¦ç›´æ¥ Merge ä¹Ÿä¸æ˜¯ä¸å¯ï¼Œä½†æ˜¯å¦‚æœæ˜¯ä¸¤ä¸ªäººåˆ†åˆ«å¼€å‘çš„åˆ†æ”¯ï¼Œç›´æ¥çš„ Merge æ˜¯ä¸è´Ÿè´£ä»»çš„ã€‚<code>Pull Request</code> æˆ–è€… <code>Merge Request</code> å¯ä»¥æ›´æ—©çš„å¸®ä½ å‘ç°åˆå¹¶å†²çªï¼Œå¹¶ä¸”<strong>å¼ºåˆ¶ä½  review ä»£ç </strong>ï¼Œè¿™åœ¨ä¿è¯ä»£ç è´¨é‡æ–¹é¢èµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚</p><p><strong>å¯¹äºé—®é¢˜ 3</strong>ï¼Œå·²ç»åˆå¹¶å…¥ <code>develop</code> åˆ†æ”¯çš„åˆ†æ”¯ï¼Œæœ€å¥½åœ¨ <code>Pull Request</code> åˆå¹¶æ—¶ç›´æ¥å‹¾é€‰ç§»é™¤åŸåˆ†æ”¯ï¼Œæ›´å®¹æ˜“ä¿æŒå’Œ <code>develop</code> çš„åŒæ­¥ã€‚</p><p><strong>å¯¹äºé—®é¢˜ 4</strong>ï¼Œæ˜¯æœ€æœ€æœ€å¸¸è§çš„é—®é¢˜ï¼Œçœ‹çœ‹è‡ªå·±çš„é¡¹ç›®ï¼Œé‡Œé¢æœ‰å¤šå°‘ä¸ªè¿ç»­çš„ <code>Commit Message</code> æ˜¯ã€bug fixã€ã€ã€updateã€ã€ã€pod addã€ã€ã€ä¿®å¤ã€ç­‰ç­‰è¿™æ ·å®Œå…¨çœ‹ä¸å‡ºå•¥å†…å®¹çš„æè¿°ã€‚æ•¢é—®è¿™æ ·å†™çš„åŒå­¦ï¼Œä½ ä»¬çš„é¡¹ç›® Owner çœ‹åˆ° <code>Network</code> æ—¶å€™æ˜¯ä¸æ˜¯å¿ƒé‡Œå……æ»¡äº† WTFï¼Ÿ<code>Commit Message</code> åº”å½“ç®€çŸ­å¹²ç»ƒçš„æè¿°è¿™ä¸ª <code>commit</code> åšäº†ä»€ä¹ˆã€‚</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_work-flow-17.jpeg" alt=""></p><p>ä¸‹é¢å†çœ‹ä¸€ä¸ªæ­£é¢çš„ç¤ºä¾‹ï¼Œæ— æ¯”æ¸…çˆ½çš„ Networkï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_work-flow-04.png-w375" alt="ç¤ºä¾‹3"></p><p>å…³äºæˆ‘çš„ Work Flowï¼Œæˆ‘ä»¬ä»åŸºæœ¬çš„ Git å¼€å‘æµæ¥ç€ä»‹ç»ã€‚</p><h2 id="Git-Flow"><a href="#Git-Flow" class="headerlink" title="Git Flow"></a>Git Flow</h2><p>å¹¿ä¸ºäººçŸ¥çš„ Git Flow å®šä¹‰äº†ä¸€å¥—æ ‡å‡†çš„ Git å¼€å‘æµã€‚<a href="http://nvie.com/posts/a-successful-git-branching-model/" target="_blank" rel="noopener">è¿™é‡Œæ˜¯ç»å…¸æ–‡ç« </a>ã€‚</p><p>å¤§è‡´çš„æ„æ€ä¸ºï¼š</p><ol><li><code>master</code> æ˜¯é•¿æœŸåˆ†æ”¯ï¼Œä¸€èˆ¬ç”¨äºç®¡ç†å¯¹å¤–å‘å¸ƒç‰ˆæœ¬ï¼Œæ¯ä¸ª commit å¯¹ä¸€ä¸ª tagï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå‘å¸ƒç‰ˆæœ¬</li><li><code>develop</code> æ˜¯é•¿æœŸåˆ†æ”¯ï¼Œä¸€èˆ¬ç”¨äºä½œä¸ºæ—¥å¸¸å¼€å‘æ±‡æ€»ï¼Œå³å¼€å‘ç‰ˆçš„ä»£ç </li><li><code>feature</code> æ˜¯çŸ­æœŸåˆ†æ”¯ï¼Œä¸€èˆ¬ç”¨äºä¸€ä¸ªæ–°åŠŸèƒ½çš„å¼€å‘</li><li><code>hotfix</code> æ˜¯çŸ­æœŸåˆ†æ”¯ ï¼Œä¸€èˆ¬ç”¨äºæ­£å¼å‘å¸ƒä»¥åï¼Œå‡ºç° bugï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œè¿›è¡Œ bug ä¿®è¡¥ã€‚</li><li><code>release</code> æ˜¯çŸ­æœŸåˆ†æ”¯ï¼Œä¸€èˆ¬ç”¨äºå‘å¸ƒæ­£å¼ç‰ˆæœ¬ä¹‹å‰ï¼ˆå³åˆå¹¶åˆ° <code>master</code> åˆ†æ”¯ä¹‹å‰ï¼‰ï¼Œéœ€è¦æœ‰çš„é¢„å‘å¸ƒçš„ç‰ˆæœ¬è¿›è¡Œæµ‹è¯•ã€‚<code>release</code> åˆ†æ”¯åœ¨ç»å†æµ‹è¯•ä¹‹åï¼Œæµ‹è¯•ç¡®è®¤éªŒæ”¶ï¼Œå°†ä¼šè¢«åˆå¹¶çš„ <code>develop</code> å’Œ <code>master</code></li></ol><p>å…·ä½“çš„ä¹Ÿå¯ä»¥å‚è€ƒ <a href="http://www.ruanyifeng.com/blog/2015/12/git-workflow.html" target="_blank" rel="noopener">Git å·¥ä½œæµç¨‹</a>ã€‚</p><h2 id="Github-Flow"><a href="#Github-Flow" class="headerlink" title="Github Flow"></a>Github Flow</h2><p>åœ¨å¼€å‘ä¸­ Git å¾€å¾€æ­é…æŒç»­äº¤ä»˜å¹³å°ï¼ŒGithub ä¹Ÿå¥½ï¼ŒGitLab ä¹Ÿå¥½ï¼Œéƒ½æä¾›äº†å®Œå¤‡çš„æŒç»­äº¤ä»˜ç®¡ç†åŠŸèƒ½ã€‚é…åˆè¿™äº›å°±æœ‰äº† <a href="https://guides.github.com/introduction/flow/index.html" target="_blank" rel="noopener">Github Flow</a></p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_work-flow-05.png" alt="Github Flow"></p><p>å¤§è‡´æ„æ€ä¸ºï¼š</p><ol><li><code>master</code> å¼€å‡ºæ–°åˆ†æ”¯ï¼Œä¸åŒºåˆ†åŠŸèƒ½åˆ†æ”¯æˆ–è¡¥ä¸åˆ†æ”¯ã€‚</li><li>æ–°åˆ†æ”¯å¼€å‘å®Œæˆåï¼Œæˆ–è€…éœ€è¦è®¨è®ºçš„æ—¶å€™ï¼Œå°±å‘ <code>master</code> å‘èµ·ä¸€ä¸ª <code>Pull Request</code>ã€‚</li><li>é¡¹ç›®å†…äººä¸€èµ·è¯„å®¡å’Œè®¨è®ºä½ çš„ä»£ç ã€‚å¯¹è¯è¿‡ç¨‹ä¸­ï¼Œä½ è¿˜å¯ä»¥ä¸æ–­æäº¤ä»£ç ã€‚</li><li><code>Pull Request</code> é€šè¿‡ï¼Œåˆå¹¶è¿› <code>master</code>ï¼ŒåŸåˆ†æ”¯å°±è¢«åˆ é™¤ã€‚</li></ol><p>å¯ä»¥çœ‹å‡º Github Flow æ˜¯ Git Flow çš„ç®€åŒ–ç‰ˆæœ¬ï¼Œä½†æ˜¯åŠ ä¸Šäº†ä¸€äº›åˆä½œå…³èŠ‚çš„æŠŠæ§ã€‚</p><h1 id="æˆ‘çš„-Git-Work-Flow"><a href="#æˆ‘çš„-Git-Work-Flow" class="headerlink" title="æˆ‘çš„ Git Work Flow"></a>æˆ‘çš„ Git Work Flow</h1><p>æˆ‘é€šå¸¸å¸Œæœ›å›¢é˜Ÿä¸­çš„å¼€å‘æµç¨‹ç±»ä¼¼ Git Flowï¼Œä½†æ›´ä¸ºè¯¦ç»†ï¼Œå¤§è‡´ä¸ºï¼š</p><h2 id="ä¸€ã€Git-åˆ†æ”¯éƒ¨åˆ†"><a href="#ä¸€ã€Git-åˆ†æ”¯éƒ¨åˆ†" class="headerlink" title="ä¸€ã€Git åˆ†æ”¯éƒ¨åˆ†"></a>ä¸€ã€Git åˆ†æ”¯éƒ¨åˆ†</h2><h3 id="master"><a href="#master" class="headerlink" title="master"></a>master</h3><p>é•¿æœŸåˆ†æ”¯ï¼Œæ¯ä¸ª <code>commit</code> å¯¹ä¸€ä¸ª <code>tag</code>ï¼ˆä¸€ä¸ªå‘å¸ƒç‰ˆæœ¬ï¼‰</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_work-flow-06.png-w375" alt="master"></p><h3 id="develop"><a href="#develop" class="headerlink" title="develop"></a>develop</h3><p>é•¿æœŸåˆ†æ”¯ï¼Œæ—¥å¸¸å¼€å‘æ±‡æ€»ï¼ˆå¼€å‘ç‰ˆçš„ä»£ç ï¼‰ã€‚</p><p>å¼€å‘ä¸€ä¸ªæ–°çš„ feature ç›´æ¥æ–°åœ¨ <code>develop</code> æ–°å¼€ä¸€ä¸ªä¸´æ—¶çš„ <code>feature</code> åˆ†æ”¯ï¼Œå¼€å‘å®Œæˆå‘ <code>develop</code> æ <code>Pull Request`</code>Pull Request`ã€‚</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_work-flow-07.png-w375" alt="develop"></p><h3 id="release"><a href="#release" class="headerlink" title="release"></a><code>release</code></h3><p>çŸ­æœŸåˆ†æ”¯ï¼Œfeature å¼€å‘å®Œæˆåä» <code>develop</code> æ‹‰å‡ºçš„åˆ†æ”¯ï¼Œç”¨äºæµ‹è¯•é˜¶æ®µï¼ŒæœŸé—´æ·»åŠ çš„ <code>commit</code> åŸºæœ¬éƒ½æ˜¯ bug fixï¼Œå¼€å‘ç»“æŸååŒæ—¶å’Œå¹¶è¿› <code>develop</code> å’Œ <code>master</code>ï¼Œ<code>master</code> æ‰“ä¸Šå‘å¸ƒ tagã€‚</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_work-flow-08.png-w375" alt="release"></p><h3 id="hotfix"><a href="#hotfix" class="headerlink" title="hotfix"></a><code>hotfix</code></h3><p>çŸ­æœŸåˆ†æ”¯ï¼Œæ­£å¼å‘å¸ƒä»¥åï¼Œè¿›è¡Œ bug ä¿®è¡¥</p><h2 id="äºŒã€Git-æ“ä½œéƒ¨åˆ†"><a href="#äºŒã€Git-æ“ä½œéƒ¨åˆ†" class="headerlink" title="äºŒã€Git æ“ä½œéƒ¨åˆ†"></a>äºŒã€Git æ“ä½œéƒ¨åˆ†</h2><h3 id="commit-è§„èŒƒ"><a href="#commit-è§„èŒƒ" class="headerlink" title="commit è§„èŒƒ"></a>commit è§„èŒƒ</h3><ol><li><code>commit message</code> è¨€ç®€æ„èµ…ï¼Œä¸è¦å†™æ— ç”¨ä¿¡æ¯ã€‚ä¸è¦å‡ºç° ã€updateã€ï¼Œã€Bug Fixã€ï¼Œè¿™æ ·è®©åˆ«äººä¸èƒ½é¢†å…¶æ„çš„æè¿°</li><li>æ·»åŠ ä¸€ä¸ªæ–°çš„ <code>Pod</code> åº“æˆ– <code>pod update</code> åï¼Œå•ç‹¬æäº¤ä¸€ä¸ª <code>commit</code>ï¼Œç»Ÿä¸€ <code>commit message</code> ä¸ºã€pod add xxxã€æˆ– ã€pod updateã€</li><li><code>commit</code> ä¹‹é—´ä¿æŒç‹¬ç«‹ï¼Œä¸è¦æœ‰ä¿®æ”¹åŒä¸€ä¸ªæ–‡ä»¶çš„æƒ…å†µã€‚æ¯”å¦‚ä¸€ä¸ª <code>Pull Request</code> ä¸­ commit1 åœ¨ FileA ä¸­æ”¹äº†ä¸€ä¸ªå˜é‡åï¼Œ commit2 æ”¹å›äº†å˜é‡åã€‚åŸå› æ˜¯ï¼š<strong>å®¡æ ¸ä»£ç æ—¶ï¼Œå®¡æ ¸äººé€šå¸¸ä¼šé€ä¸ª <code>commit</code>æŸ¥çœ‹ï¼Œè€Œä¸æ˜¯ç›´æ¥çœ‹ <code>Changes</code>ï¼ˆå¯ä»¥ç›´æ¥å¿½ç•¥æ‰ pod update è¿™æ ·çš„ <code>commit</code> ä¸çœ‹ï¼‰</strong></li></ol><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_work-flow-09.png" alt=""></p><h3 id="rebase"><a href="#rebase" class="headerlink" title="rebase"></a>rebase</h3><p><strong>ä¸è¦å‡ºç°åå‘æ‹‰å–ä»£ç </strong>çš„æƒ…å†µï¼Œå³æ–‡ç« å¼€å¤´ç¬¬ä¸€å¼ ã€ç¬¬äºŒå¼ å›¾ç‰‡ä¸­çš„æƒ…å†µâ€”â€”çœ‹åˆ° <code>develop</code> æœ‰æ›´æ–°ï¼Œå°±å°† <code>develop</code> çš„ä»£ç æ‹‰å– merge è¿›è‡ªå·±çš„åˆ†æ”¯ã€‚</p><p>åŸå› æ˜¯ï¼š</p><ol><li><code>merge</code> ä¼šå¯¼è‡´ä½ çš„åˆ†æ”¯éƒ½ä¼šå¼•å…¥ä¸€ä¸ªå¤–æ¥çš„åˆå¹¶æäº¤ã€‚å¦‚æœ <code>develop</code> éå¸¸æ´»è·ƒçš„è¯ï¼Œæˆ–å¤šæˆ–å°‘ä¼šæ±¡æŸ“ä½ çš„åˆ†æ”¯ã€‚</li><li>ä¸‘ï¼ŒNetwork å¤æ‚ï¼Œå¢åŠ ç†è§£é¡¹ç›®å†å²çš„éš¾åº¦ã€‚</li></ol><p>å¦‚ä½•è§£å†³å½“å‰ <code>develop</code> æœ‰æ›´æ–°çš„æƒ…å†µï¼Ÿ</p><p><strong>è¯·ä½¿ç”¨ <code>rebase</code>ï¼</strong></p><p><code>rebase</code> ç”¨ä¸­æ–‡ç›´è¯‘å°±æ˜¯ <code>å˜åŸº</code>ã€‚ä¸Šå¼ å›¾å¸®åŠ©å¤§å®¶ç†è§£ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_work-flow-10.png" alt="rebase"></p><p><code>rebase</code> åœ¨è¿›è¡Œæ—¶ï¼Œéœ€è¦é€‰æ‹©ä¸€ä¸ª <code>commit</code> ç‚¹ï¼Œå°†å½“å‰åˆ†æ”¯ä»æ ¹åŸºæ•´ä¸ªç§»åˆ°æŒ‡å®š <code>commit</code> ç‚¹ï¼Œåå‰¯å…¶å®â€”â€”<code>å˜åŸº</code>ã€‚</p><p>è¿™æ ·ä½ æ—¢å¯ä»¥å¾—åˆ°ä¸€ä¸ªå¥½çœ‹çš„ <code>Network</code>ï¼Œåˆå¯ä»¥åŠæ—¶æ§åˆ¶å†²çªã€‚ä¸è¿‡åœ¨å¤šäººå¼€å‘ä¸­ä½ éœ€è¦å¤šå¤šå…³æ³¨ <code>develop</code> çš„æƒ…å†µï¼ŒåŠæ—¶ <code>rebase</code>ï¼Œé¿å…é•¿æ—¶é—´ä¸æ›´æ–°ä»£ç çªç„¶ <code>rebase</code> åˆ°æœ€æ–°åå‘ç°äº†å¤§é‡å†²çªã€‚å½“ç„¶ï¼Œæ§åˆ¶å’Œåˆ†é…æ¯”è¾ƒå¥½çš„é¡¹ç›®æœ¬èº«ä¹Ÿå¾ˆå°‘äº§ç”Ÿå†²çªã€‚</p><h2 id="ä¸‰ã€GitLab-ç®¡ç†è§„èŒƒ"><a href="#ä¸‰ã€GitLab-ç®¡ç†è§„èŒƒ" class="headerlink" title="ä¸‰ã€GitLab ç®¡ç†è§„èŒƒ"></a>ä¸‰ã€GitLab ç®¡ç†è§„èŒƒ</h2><h3 id="issue"><a href="#issue" class="headerlink" title="issue"></a>issue</h3><p>æ—¥å¸¸ Github ç©çš„è½¬çš„åŒå­¦éƒ½çŸ¥é“ <code>issue</code> å¯ä»¥åšå¾ˆå¤šäº‹ï¼Œæ¯”å¦‚ï¼šæ„è§ç®¡ç†ã€Bug ç®¡ç†ã€ä»»åŠ¡ç®¡ç†ï¼Œå¯ä»¥åªåšä¸€ç§åŠŸèƒ½ï¼Œä¹Ÿèƒ½é€šè¿‡ä¸åŒçš„ Label åŒæ—¶ä½¿ç”¨æ‰€æœ‰çš„åŠŸèƒ½ã€‚</p><p>æˆ‘çš„ Work Flow ä¸­ï¼Œ<code>issue</code> ç”¨æ¥åšä»»åŠ¡ç®¡ç†ï¼Œå› ä¸º <code>issue</code> å¯ä»¥æ–¹ä¾¿çš„æŒ‡æ´¾ï¼ŒåŠæ—¶æ”¶åˆ°é‚®ä»¶é€šçŸ¥ã€‚</p><p>æ¯æ¬¡æ–°ç‰ˆæœ¬è¿­ä»£å¼€å§‹ï¼ŒPRD å®¡æ ¸é€šè¿‡æ—¶ï¼Œç»„å†…åå•†å¥½ä»»åŠ¡åˆ†é…åå°†ä»»åŠ¡æ‹†æˆæœ€å°å•å…ƒï¼Œç”± Owner åˆ†åˆ«å»ºç«‹ issueï¼Œå¤§å®¶è‡ªè¡Œé¢†å–ã€‚</p><p>å¦‚æœæœ‰å¼€å‘è¿‡ç¨‹ä¸­å‘ç°çš„éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼ŒåŒæ ·å¯ä»¥å»ºç«‹ issueã€‚</p><p>å…³äº Labelï¼Œæˆ‘é€šå¸¸ä¼šåˆ†ä¸ºï¼š<code>optimizing</code>ã€<code>bug fix</code>ã€<code>feature</code></p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_work-flow-11.png" alt="issue ç®¡ç†ä»»åŠ¡"></p><p>ä¸€ä¸ªä»»åŠ¡å®Œæˆæ—¶ï¼Œé€šå¸¸ä¼šæ <code>Pull Request</code>ï¼Œå¦‚æœè¯¥ <code>Pull Request</code> ä¸­å®Œæˆäº†æ‰€æœ‰çš„ä»»åŠ¡ï¼Œ<code>Pull Request</code> çš„ Title åº”å½“ç±»ä¼¼ä»¥ä¸‹æ ¼å¼ï¼š</p><blockquote><p>ã€close #13 é¦–é¡µæ»šåŠ¨æ åˆ‡æ¢æ•ˆæœå®Œå–„ã€</p></blockquote><p>GitLab å’Œ Github éƒ½èƒ½è¯†åˆ« <code>close #{issue id}</code>ï¼Œå¦‚æœåœ¨ Title ä¸­è¿™æ ·å†™ï¼Œåœ¨ <code>Pull Request</code> é€šè¿‡å®¡æ ¸æ—¶ï¼Œç›¸åº”çš„ issue ä¼šè‡ªåŠ¨è¢«å…³é—­ã€‚</p><h3 id="Milestones"><a href="#Milestones" class="headerlink" title="Milestones"></a>Milestones</h3><p><code>Milestones</code> å³é‡Œç¨‹ç¢‘ï¼Œ<code>issue</code> åœ¨å»ºç«‹çš„æ—¶å€™å¯ä»¥é€‰æ‹© <code>Milestones</code>ï¼Œå¦‚æœåˆç†çš„ä½¿ç”¨äº† <code>Milestones</code>ï¼Œåœ¨ Milestones é¡µé¢ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ¸…æ™°çš„é¡¹ç›®è¿›åº¦ã€‚</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_work-flow-12.png" alt="Milestones é¡µé¢"></p><h3 id="Pull-Request"><a href="#Pull-Request" class="headerlink" title="Pull Request"></a>Pull Request</h3><p>æ‰€æœ‰çš„åˆå¹¶éƒ½éœ€è¦æ <code>Pull Request</code>ï¼ŒåŒ…æ‹¬è‡ªå·±çš„åˆ†æ”¯åˆå¹¶åˆ°è‡ªå·±çš„åˆ†æ”¯ï¼Œå¯ä»¥æ›´å¥½çš„å¸®åŠ©å¤§å®¶å…»æˆ Code Review çš„å¥½ä¹ æƒ¯ã€‚</p><p><code>Pull Request</code> çš„æ ‡é¢˜åº”è¯¥ç®€ä»‹çš„ä»‹ç»è¯¥æ¬¡åˆå¹¶æ‰€åšçš„äº‹ã€‚æ›´è¯¦ç»†çš„å†…å®¹åº”å½“åœ¨ <code>Description</code> ä¸­é€æ¡åˆ—å‡ºã€‚å¦‚æœ‰ç›¸å…³æ–‡æ¡£é“¾æ¥ä¹Ÿåº”åˆ—å‡ºã€‚</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_work-flow-13.png" alt="Milestones é¡µé¢"></p><p>æ³¨æ„é€‰æ‹©åˆé€‚çš„ <code>Milestone</code> å’Œ <code>Labels</code>ã€‚é€‰æ‹©ä¸€ä½ Assignee æ¥å®¡æ ¸ï¼Œå¦‚æœè§‰å¾—è¯¥ <code>Pull Request</code> å†…å®¹è¿‡å¤šï¼Œæˆ–æœ‰éœ€è¦å¤§å®¶å…±åŒè®¨è®ºçš„åœ°æ–¹ï¼Œå† <code>Pull Request</code> æäº¤åï¼Œåœ¨ <code>Discussion</code> åŒºåŸŸ <code>@</code> å…¶ä»–äººï¼Œæ‰€æœ‰äººéƒ½ä¼šåŠæ—¶æ”¶åˆ°é‚®ä»¶ã€‚</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_work-flow-14.png" alt="Milestones é¡µé¢"></p><h3 id="Code-Review"><a href="#Code-Review" class="headerlink" title="Code Review"></a>Code Review</h3><p><code>Code Review</code> æ˜¯ä¸€ä¸ªå¾ˆå€¼å¾—è¯´çš„ç‚¹ã€‚å¾ˆå¤šæ—¶å€™å¤§å®¶ä¼šä»¥ä¸º <code>Code Review</code> æ˜¯ä¸€å®šè¦è¯»æ‡‚åˆ«äººçš„ä»£ç ï¼Œç„¶åè¿›è¡Œåˆ†æã€å®¡æ ¸ã€‚å…¶å® <code>Code Review</code> æ›´å¤šçš„æ˜¯æ‰®æ¼”äº†å›¢é˜Ÿå†…ç»éªŒä¼ é€’çš„ä½œç”¨ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œä»£ç è§„èŒƒè¿™æ ·çš„ä¸œè¥¿ï¼Œå°±ç®—æ˜¯ä¸€ä¸ªå›¢é˜Ÿæœ‰äº†å¾ˆè¯¦ç»†çš„æ–‡æ¡£ï¼Œä½†å¤§å®¶ä¹Ÿä¸ä¸€å®šä¼šå»å®Œæ•´è®°ä¸‹ã€‚å¯¹äºæ–°äººï¼Œå®Œæˆäº† feature åæ <code>Pull Request</code>ï¼Œäº¤ç”±å…¶ä»–äºº <code>Code Review</code> æ—¶ï¼Œç”±å…¶ä»–äººå®¡æ ¸ä»£ç è§„èŒƒï¼Œä¸åˆè§„è¦æ±‚ç»§ç»­ä¿®æ­£ï¼Œæ¥å›å››äº”æ¬¡ï¼Œå°±å†åŸºæœ¬ä¸ä¼šæœ‰é—®é¢˜äº†ã€‚</p><p>è¿™ä¹Ÿæ˜¯æˆ‘çš„äº²èº«ç»å†ï¼Œæˆ‘ä¹‹å‰çš„ä¸€ä½ leader å¯¹äº Work Flow ç®¡ç†éå¸¸æœ‰ç»éªŒï¼Œæˆ‘åœ¨æœ€åˆæ—¶æäº†å‡ æ¬¡ <code>Pull Request</code>ï¼Œå¾ˆå¿«å°±ç†Ÿæ‚‰äº†å›¢é˜Ÿå†…çš„ä»£ç è§„èŒƒã€‚</p><p>æ‰€ä»¥ <code>Code Review</code> å®¡æ ¸äººåº”å½“æ£€æŸ¥çš„å†…å®¹ä¸æ˜¯ç¡¬æ€§çš„ï¼Œä½†è‡³å°‘åº”å½“åŒ…æ‹¬ï¼š</p><ol><li>ä»£ç è§„èŒƒ</li><li>åŸºæœ¬è¯­æ³•å’ŒåŸºæœ¬é€»è¾‘é”™è¯¯</li><li>ä¸šåŠ¡é€»è¾‘çš„ä¸€äº›ç»éªŒ</li><li>â€¦</li></ol><p>åœ¨å‘ç°é”™è¯¯æ—¶ï¼Œåº”å½“åŠæ—¶çš„æ·»åŠ  <code>comment</code>ã€‚</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_work-flow-15.png" alt="Milestones é¡µé¢"></p><p>å½“å®¡æ ¸äººå…¨éƒ¨å®¡æ ¸å®Œæ¯•ï¼Œæ·»åŠ å®Œæ‰€æœ‰çš„ <code>comment</code> ä¹‹åéœ€è¦åœ¨ <code>Discussion</code> åŒºåŸŸ <code>@æäº¤äºº review done</code>ï¼Œé€šçŸ¥æäº¤äººã€‚</p><p>åŒæ ·ï¼Œæäº¤äººåœ¨æŒ‰ç…§ <code>comment</code> ä¿®æ”¹å®Œåï¼Œä¹Ÿåº”å½“åœ¨ <code>Discussion</code> åŒºåŸŸ <code>@ç›¸å…³å®¡æ ¸äºº ä¿®æ”¹å®Œæˆï¼Œè¯·é‡æ–°å®¡æ ¸</code>ã€‚</p><p>éœ€è¦ç€é‡è¯´æ˜çš„æ˜¯ï¼šæäº¤äººçš„<strong>æ‰€æœ‰ä¿®æ”¹ï¼Œä¸å…è®¸æ–°æäº¤ <code>commit</code></strong>ï¼Œåº”å½“åœ¨æœ¬åœ°ä¿®æ”¹å®Œæˆåï¼Œ<code>ammend</code> è¿½åŠ åˆ°æœ€å <code>commit</code>ã€‚</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_work-flow-16.png" alt="Milestones é¡µé¢"></p><p>ä½†æ˜¯è¿™ä¸€ç‚¹ï¼Œåªæ˜¯æˆ‘ä¸€ç›´ä½¿ç”¨çš„æ–¹å¼ï¼ŒåŸå› åŒæ ·æ˜¯éµå¾ªã€<code>commit</code> ä¹‹é—´ä¿æŒç‹¬ç«‹ã€ï¼Œå¦‚æœæäº¤æ–°çš„ <code>commit</code> å¯¼è‡´ä¸¤ä¸ª <code>commit</code> ä¿®æ”¹äº†åŒä¸€ä¸ªæ–‡ä»¶ã€‚</p><p>å½“ç„¶ä¹Ÿæœ‰äººè®¤ä¸ºæ–°åŠ  <code>commit</code> å¯ä»¥æ›´æ¸…æ™°çš„çœ‹åˆ°æäº¤è€…çš„æ–°å˜åŠ¨ï¼Œä¹Ÿæ›´ç¬¦åˆ <code>Github Flow</code>ã€‚å…³äºè¿™é‡Œï¼Œå°±æ²¡æœ‰ä»€ä¹ˆå¼ºåˆ¶äº†ï¼Œæ›´å–œæ¬¢ä»€ä¹ˆå°±ä»€ä¹ˆã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ€åï¼Œå¸Œæœ›å¤§å®¶éƒ½æ”¶è·ä¸€ä¸ªæ¸…çˆ½å¦‚é£çš„ Networkã€‚</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_work-flow-04.png-w375" alt="ç¤ºä¾‹3"></p><hr><p>æœ‰ä»€ä¹ˆé—®é¢˜éƒ½å¯ä»¥åœ¨åšæ–‡åé¢ç•™è¨€ï¼Œæˆ–è€…å¾®åšä¸Šç§ä¿¡æˆ‘ï¼Œæˆ–è€…é‚®ä»¶æˆ‘ <a href="mailto:&#x63;&#111;&#x64;&#101;&#114;&#x66;&#105;&#x73;&#104;&#64;&#x31;&#54;&#x33;&#46;&#x63;&#x6f;&#x6d;" target="_blank" rel="noopener">&#x63;&#111;&#x64;&#101;&#114;&#x66;&#105;&#x73;&#104;&#64;&#x31;&#54;&#x33;&#46;&#x63;&#x6f;&#x6d;</a>ã€‚</p><p>åšä¸»æ˜¯ iOS å¦¹å­ä¸€æšã€‚</p><p>å¸Œæœ›å¤§å®¶ä¸€èµ·è¿›æ­¥ã€‚</p><p>æˆ‘çš„å¾®åšï¼š<a href="http://weibo.com/coderfish/" target="_blank" rel="noopener">å°é±¼å‘¨å‡Œå®‡</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;é‡è¦æ€§&quot;&gt;&lt;a href=&quot;#é‡è¦æ€§&quot; class=&quot;headerlink&quot; title=&quot;é‡è¦æ€§&quot;&gt;&lt;/a&gt;é‡è¦æ€§&lt;/h1&gt;&lt;p&gt;æˆ‘ä»¬ä»é‡è¦æ€§è¯´èµ·ã€‚&lt;/p&gt;
&lt;p&gt;å›¢é˜Ÿå¼€å‘ä¸­è¦é‡è§†æœ‰æ´ç™–çš„äººï¼Œè¿™ç§äººå¾€å¾€å¯¹ç³Ÿç³•çš„å·¥ä½œæµä¸æ–­æå‡ºæ„è§ã€å¯¹ Git çš„ä½¿ç”¨æ–¹å¼æå‡ºè¦æ±‚ã€‚å¦‚æœä½ çš„å›¢é˜Ÿä¸­è¿™ç§äººæ­£åœ¨ä¸æ–­çš„è¢«å¿½è§†ï¼Œé‚£ä¹ˆä½ çš„å›¢é˜Ÿä¸€å®šå‡ºç°äº†ç®¡ç†æ··ä¹±ã€ä»£ç è´¨é‡ä¸é«˜ç­‰ç­‰ç­‰ç­‰é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ç»Ÿä¸€çš„å·¥ä½œæµç¨‹æ˜¯è‡³å…³é‡è¦çš„ï¼Œä¸ç®¡å¯¹äºå“ªä¸€ä¸ªè¡Œä¸šçš„ä½œä¸šæ¥è¯´éƒ½ä¸€æ ·ã€‚å¯¹äºæˆ‘ä»¬å¼€å‘äººå‘˜ï¼Œå·¥ä½œæµåŒ…å«äº†å¼€å‘æ—¶ Git çš„ä½¿ç”¨è§„èŒƒã€Repo ç®¡ç†çš„è§„èŒƒã€æµ‹è¯•è¿‡ç¨‹çš„è§„èŒƒã€è®¾è®¡äº¤äº’çš„ç®¡ç†è§„èŒƒç­‰ç­‰ã€‚ç”±äºæµ‹è¯•ã€äº¤äº’ç­‰è®¾è®¡åˆ°æ›´å¤šçš„äººå‘˜ï¼Œæœ¬ç¯‡æ–‡ç« æš‚ä¸”ä¸è¡¨ï¼Œé‡ç‚¹è¯´ Git çš„ä½¿ç”¨è§„èŒƒå’Œ repo ç®¡ç†çš„è§„èŒƒã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ç¯‡æ–‡ç« å°†è®²è¿°æˆ‘åœ¨å·¥ä½œä¸­ä¸€ç›´ä½¿ç”¨çš„ Work Flowï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰å¸®åŠ©ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://zhoulingyu.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://zhoulingyu.com/tags/iOS/"/>
    
      <category term="git" scheme="http://zhoulingyu.com/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>iOSâ€”â€”å†™ä¸€ä¸ªå¿«é€Ÿå®šä½é—®é¢˜çš„è„šæœ¬</title>
    <link href="http://zhoulingyu.com/2017/04/04/iOS%E2%80%94%E2%80%94%E5%86%99%E4%B8%80%E4%B8%AA%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98%E7%9A%84%E8%84%9A%E6%9C%AC/"/>
    <id>http://zhoulingyu.com/2017/04/04/iOSâ€”â€”å†™ä¸€ä¸ªå¿«é€Ÿå®šä½é—®é¢˜çš„è„šæœ¬/</id>
    <published>2017-04-04T11:15:38.000Z</published>
    <updated>2018-07-10T03:07:31.628Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS%E2%80%94%E2%80%94%E5%86%99%E4%B8%80%E4%B8%AA%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98%E7%9A%84%E8%84%9A%E6%9C%AC-12.png" alt=""></p><h1 id="ä½ æ˜¯å¦è§è¿‡ï¼Ÿ"><a href="#ä½ æ˜¯å¦è§è¿‡ï¼Ÿ" class="headerlink" title="ä½ æ˜¯å¦è§è¿‡ï¼Ÿ"></a>ä½ æ˜¯å¦è§è¿‡ï¼Ÿ</h1><ol><li>ä½ æ˜¯å¦è§è¿‡æµ‹è¯•äººå‘˜æˆ–è€…è‡ªå·±åœ¨ CI ä¸Š install äº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œå‘ç°äº† BUG åï¼Œçªç„¶å¿˜äº†è‡ªå·±ä¸‹çš„æ˜¯ CI ä¸Šçš„å“ªä¸€ä¸ª commit çš„åŒ…ï¼Ÿ</li><li>ä½ æ˜¯å¦è§è¿‡ä¸‹é¢è¿™ä¸ªä¸œè¥¿ï¼š</li></ol><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS%E2%80%94%E2%80%94%E5%86%99%E4%B8%80%E4%B8%AA%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98%E7%9A%84%E8%84%9A%E6%9C%AC-01.jpg" alt="blog_iOSâ€”â€”å†™ä¸€ä¸ªå¿«é€Ÿå®šä½é—®é¢˜çš„è„šæœ¬-01"></p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS%E2%80%94%E2%80%94%E5%86%99%E4%B8%80%E4%B8%AA%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98%E7%9A%84%E8%84%9A%E6%9C%AC-02.png" alt="blog_iOSâ€”â€”å†™ä¸€ä¸ªå¿«é€Ÿå®šä½é—®é¢˜çš„è„šæœ¬-02"></p><a id="more"></a><h1 id="å†™ä¸€ä¸ªè¿™æ ·ä¸€ä¸ªè„šæœ¬"><a href="#å†™ä¸€ä¸ªè¿™æ ·ä¸€ä¸ªè„šæœ¬" class="headerlink" title="å†™ä¸€ä¸ªè¿™æ ·ä¸€ä¸ªè„šæœ¬"></a>å†™ä¸€ä¸ªè¿™æ ·ä¸€ä¸ªè„šæœ¬</h1><p>å¯ä»¥å†™è¿™æ ·ä¸€ä¸ªè„šæœ¬ï¼Œå®ƒèƒ½åšåˆ°ï¼š</p><ol><li>åœ¨ Build çš„è¿‡ç¨‹ä¸­åœ¨ App Icon çš„è¡¨é¢è¦†ç›–ä¸Š Build å·ã€åˆ†æ”¯åã€commit version çš„ hash å€¼</li><li>ä¸å½±å“åŸæœ¬çš„ App Icon å›¾æ ‡æºæ–‡ä»¶</li><li>åŒºåˆ† <code>Release</code> å’Œ <code>Debug</code>ï¼Œåªåœ¨ <code>Debug</code> ç¯å¢ƒä¸‹ Build é¡¹ç›®æ—¶æ‰§è¡Œè„šæœ¬</li></ol><h1 id="Do-it"><a href="#Do-it" class="headerlink" title="Do it"></a>Do it</h1><h2 id="ImageMagick"><a href="#ImageMagick" class="headerlink" title="ImageMagick"></a>ImageMagick</h2><p>åšåç«¯çš„åŒå­¦ä»¬ï¼Œå¤§å¤šçŸ¥é“ <a href="http://www.imagemagick.org/script/index.php" target="_blank" rel="noopener">ImageMagick</a>ã€‚</p><blockquote><p>ä½¿ç”¨ ImageMagick å¯ä»¥åˆ›å»ºã€ç¼–è¾‘ã€åˆæˆæˆ–è½¬æ¢å›¾ç‰‡ã€‚å®ƒå¯ä»¥è¯»å’Œå†™å„ç§æ ¼å¼çš„å›¾åƒï¼ˆè¶…è¿‡ 200 ç§æ ¼å¼ï¼‰åŒ…æ‹¬ PNGã€JPEGã€JPEG - 2000ã€GIFã€TIFFã€DPXã€EXRã€WebPã€Postscriptã€PDFã€SVGã€‚ImageMagick å¯ä»¥è°ƒæ•´ã€ç¿»è½¬ã€é•œåƒã€æ—‹è½¬ã€æ‰­æ›²ã€å‰ªåˆ‡å’Œè½¬æ¢å›¾åƒã€å›¾åƒè‰²å½©è°ƒæ•´ï¼Œé€‚ç”¨äºå„ç§ç‰¹æ®Šæ•ˆæœ,æˆ–ç»˜åˆ¶æ–‡æœ¬ã€çº¿ã€å¤šè¾¹å½¢ã€æ¤­åœ†å’Œè´å¡å°”æ›²çº¿ã€‚</p></blockquote><p>é€šè¿‡ shell command å°±å¯ä»¥è½»æ˜“ä½¿ç”¨ä»¥ä¸ŠåŠŸèƒ½ã€‚</p><hr><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›åŸºæœ¬çš„ã€‚è¿™æ˜¯æˆ‘ä»¬å‡†å¤‡å¥½çš„ <code>120*120</code> çš„åŸå›¾ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS%E2%80%94%E2%80%94%E5%86%99%E4%B8%80%E4%B8%AA%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98%E7%9A%84%E8%84%9A%E6%9C%AC-03.png" alt="blog_iOSâ€”â€”å†™ä¸€ä¸ªå¿«é€Ÿå®šä½é—®é¢˜çš„è„šæœ¬-03"></p><p><code>cd</code> åˆ°å›¾ç‰‡æ‰€åœ¨çš„ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç»™å›¾ç‰‡æ·»åŠ é«˜æ–¯æ¨¡ç³Šæ•ˆæœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">convert original.png -blur 10x8 blurred.png</span><br></pre></td></tr></table></figure><p>å®Œæˆå›¾ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS%E2%80%94%E2%80%94%E5%86%99%E4%B8%80%E4%B8%AA%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98%E7%9A%84%E8%84%9A%E6%9C%AC-04.png" alt="blog_iOSâ€”â€”å†™ä¸€ä¸ªå¿«é€Ÿå®šä½é—®é¢˜çš„è„šæœ¬-04"></p><hr><p>ç»§ç»­ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä» åæ ‡ <code>(0,60)</code> å‰ªåˆ‡æˆ <code>120*60</code> çš„å›¾ç‰‡ï¼Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">convert blurred.png -crop 120x60+0+60 cropped-blurred.png</span><br></pre></td></tr></table></figure><p>å®Œæˆå›¾ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS%E2%80%94%E2%80%94%E5%86%99%E4%B8%80%E4%B8%AA%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98%E7%9A%84%E8%84%9A%E6%9C%AC-05.png" alt="blog_iOSâ€”â€”å†™ä¸€ä¸ªå¿«é€Ÿå®šä½é—®é¢˜çš„è„šæœ¬-05"></p><hr><p>ç»§ç»­ï¼Œç»™å›¾ç‰‡æ·»åŠ æ–‡å­—æ°´å°ã€zhoulingyuã€ï¼Œå‚æ•°åŒ…æ‹¬ï¼šèƒŒæ™¯ä¸å¡«å……é¢œè‰²ã€ç™½è‰²å­—ä½“ã€å­—ä½“å¤§å° 12ã€å±…ä¸­æ˜¾ç¤ºæ–‡å­—ã€æ–‡å­—ä¸ºã€zhoulingyuã€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">convert -background none -fill white -pointsize 12 -gravity center caption:<span class="string">"zhoulingyu"</span> cropped-blurred.png +swap -composite label.png</span><br></pre></td></tr></table></figure><p>å®Œæˆå›¾ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS%E2%80%94%E2%80%94%E5%86%99%E4%B8%80%E4%B8%AA%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98%E7%9A%84%E8%84%9A%E6%9C%AC-06.png" alt="blog_iOSâ€”â€”å†™ä¸€ä¸ªå¿«é€Ÿå®šä½é—®é¢˜çš„è„šæœ¬-06"></p><hr><p>ç»§ç»­ï¼Œå°†ä¸Šé¢å¾—åˆ°çš„å‰ªåˆ‡å¥½çš„å¸¦æ°´å°çš„ <code>label.png</code> å’Œ åŸå›¾ <code>original.png</code> åˆæˆåœ¨ä¸€èµ·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composite label.png original.png finished-image.png</span><br></pre></td></tr></table></figure><p>å®Œæˆå›¾ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS%E2%80%94%E2%80%94%E5%86%99%E4%B8%80%E4%B8%AA%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98%E7%9A%84%E8%84%9A%E6%9C%AC-07.png" alt="blog_iOSâ€”â€”å†™ä¸€ä¸ªå¿«é€Ÿå®šä½é—®é¢˜çš„è„šæœ¬-07"></p><p>OKï¼Œæˆ‘ä»¬å¾—åˆ°äº†æƒ³è¦çš„æ•ˆæœå›¾ã€‚</p><h2 id="å‚æ•°å‚è€ƒ"><a href="#å‚æ•°å‚è€ƒ" class="headerlink" title="å‚æ•°å‚è€ƒ"></a>å‚æ•°å‚è€ƒ</h2><p>ç»™å‡ºä¸€äº› ImageMagic çš„å¸¸ç”¨ç”¨æ³•ï¼š</p><ol><li>æŸ¥çœ‹å›¾ç‰‡ä¿¡æ¯</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">identify original.png </span><br><span class="line">original.png PNG 120x120 120x120+0+0 8-bit sRGB 46c 2.58KB 0.010u 0:00.000</span><br></pre></td></tr></table></figure><ol start="2"><li>æ ¼å¼è½¬æ¢</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">convert original.png original.jpg</span><br></pre></td></tr></table></figure><ol start="3"><li>ç¼–è¾‘å›¾ç‰‡å¤§å°</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">convert original.png -resize 200x200 resize-image.png</span><br></pre></td></tr></table></figure><ol start="4"><li>è£å‰ª</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»åæ ‡ (0,0) è£å‰ª 100*100 çš„å›¾åƒ</span></span><br><span class="line">convert original.png -crop 100x100+0+0 crop.png</span><br></pre></td></tr></table></figure><ol start="5"><li>æ—‹è½¬</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">convert original.png -rotate 45 rotate.png</span><br></pre></td></tr></table></figure><ol start="6"><li>åˆå¹¶å›¾åƒ</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»™å›¾ç‰‡æ·»åŠ æ°´å°</span></span><br><span class="line">convert original.png -compose over watermark.png -composite new-image.png</span><br></pre></td></tr></table></figure><ol start="7"><li>é«˜æ–¯æ¨¡ç³Š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">convert -blur 80x5 original.jpg blur.png</span><br></pre></td></tr></table></figure><p>-blur radiusxsigmaï¼Œä¸¤ä¸ªåˆ†åˆ«æ˜¯é«˜æ–¯æ¨¡ç³Šéœ€è¦çš„ä¸¤ä¸ªå‚æ•°ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹ <a href="https://www.imagemagick.org/script/command-line-options.php#blur" target="_blank" rel="noopener">blur å‚æ•°ä½¿ç”¨</a></p><p>ImageMagick å¯ä»¥å®ç° N å¤šæ•ˆæœï¼Œåƒæ²¹ç”»ã€å™ªå£°ã€æ•£å°„ã€æ—‹æ¶¡ï¼Œéƒ½ä¸åœ¨è¯ä¸‹ã€‚</p><p>é™¤äº†åŸºæœ¬çš„æ•ˆæœï¼Œè¿˜æœ‰ä¸€äº›æ¯”è¾ƒå¸¸ç”¨çš„å‚æ•°ï¼š</p><table><thead><tr><th>å‚æ•°å</th><th>ä½¿ç”¨è§„èŒƒ</th><th>è¯´æ˜</th><th>ç”¨ä¾‹</th></tr></thead><tbody><tr><td>-background</td><td>-background color</td><td>è®¾ç½®èƒŒæ™¯è‰²</td><td>-background white</td></tr><tr><td>-pointsize</td><td>-pointsize value</td><td>è®¾ç½®å­—ä½“ç­‰å¤§å°</td><td>-pointsize 12</td></tr><tr><td>-gravity</td><td>-gravity type</td><td>ä¸ºå…¶ä»–å‘½ä»¤é™„åŠ  gravityï¼Œæ¯”å¦‚è®¾ç½®æ–‡å­—æ·»åŠ ä½ç½®å±…ä¸­ã€‚</td><td>-gravity Center</td></tr><tr><td>-geometry</td><td>-geometry geometry</td><td>è®¾ç½®å³å°†å¤„ç†å›¾åƒçš„åæ ‡ä½ç½®</td><td>-geometry +0+60 -geometry Center</td></tr></tbody></table><p>å½“ç„¶è¿™äº›éƒ½å¯ä»¥åœ¨ <a href="https://www.imagemagick.org/script/command-line-options.php" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a> æ‰¾åˆ°ã€‚</p><h2 id="shell-è„šæœ¬"><a href="#shell-è„šæœ¬" class="headerlink" title="shell è„šæœ¬"></a>shell è„šæœ¬</h2><h3 id="1-åŸºæœ¬è®¾ç½®"><a href="#1-åŸºæœ¬è®¾ç½®" class="headerlink" title="1. åŸºæœ¬è®¾ç½®"></a>1. åŸºæœ¬è®¾ç½®</h3><p>çŸ¥é“ ImageMagic å¦‚ä½•ä½¿ç”¨ï¼Œå‰©ä¸‹æ¥å†™è„šæœ¬å°±æ€è·¯æ¸…æ™°å¤šäº†ã€‚</p><p>åœ¨å·¥ç¨‹ <code>Target</code> -&gt; <code>Build Phases</code> ä¸­æ–°å»ºä¸€ä¸ª Run Scriptï¼Œæˆ‘ä»¬å¯ä»¥ç»™å®ƒèµ·å <code>generate auxiliary icon</code>ï¼Œè¿™æ ·ç¨åå®¹æ˜“åœ¨ <code>Report Navigator</code> è§‚å¯Ÿã€‚</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS%E2%80%94%E2%80%94%E5%86%99%E4%B8%80%E4%B8%AA%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98%E7%9A%84%E8%84%9A%E6%9C%AC-08.png" alt="blog_iOSâ€”â€”å†™ä¸€ä¸ªå¿«é€Ÿå®šä½é—®é¢˜çš„è„šæœ¬-08"></p><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹ç¼–å†™æˆ‘ä»¬çš„è„šæœ¬ <code>auxiliary_icon.sh</code></p><h3 id="2-ç†æ€è·¯"><a href="#2-ç†æ€è·¯" class="headerlink" title="2. ç†æ€è·¯"></a>2. ç†æ€è·¯</h3><p>å†™ä¼ªä»£ç é€šå¸¸èƒ½å¤Ÿå¸®åŠ©æˆ‘è‡ªå·±æ›´æ¸…æ™°çš„å†™ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// 1. åˆ¤æ–­æ‰§è¡Œ Build çš„æœºå™¨æ˜¯å¦å®‰è£…äº† ImageMagic</span><br><span class="line">//    |- å¦‚æœæ²¡æœ‰å®‰è£…ï¼šæç¤ºå®‰è£…ï¼Œé€€å‡ºè„šæœ¬</span><br><span class="line">//    |- å¦‚æœå®‰è£…ï¼šç»§ç»­æ‰§è¡Œ</span><br><span class="line">// 2. è·å– commit å· hash å€¼ã€åˆ†æ”¯åã€build å·ï¼Œå¹¶å°†å…¶æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²</span><br><span class="line">// 3. åˆ¤æ–­ç¼–è¯‘ç¯å¢ƒ</span><br><span class="line">//    |- å¦‚æœæ˜¯ Release ç¯å¢ƒï¼šæç¤ºå½“å‰æ˜¯ Release ç¯å¢ƒï¼Œé€€å‡ºè„šæœ¬</span><br><span class="line">//    |- å¦‚æœæ˜¯é Release ç¯å¢ƒï¼šç»§ç»­æ‰§è¡Œ</span><br><span class="line">// 4. è·å– Plist ä¸­ CFBundleIconFiles çš„æ•°é‡</span><br><span class="line">// 5. æ ¹æ®æ•°é‡å¾ªç¯ï¼Œæ‰§è¡Œè°ƒç”¨ã€ç”Ÿæˆè®°å·å›¾æ–¹æ³•ã€</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// ã€ç”Ÿæˆè®°å·å›¾æ–¹æ³•ã€ </span><br><span class="line">// function generateIcon() &#123;</span><br><span class="line">// 1. æ¨¡ç³Šå›¾ç‰‡</span><br><span class="line">// 2. æˆªå–å›¾ç‰‡ä¸‹åŠéƒ¨åˆ†</span><br><span class="line">// 3. æ·»åŠ  commit+brach+build ç»„æˆçš„å­—ç¬¦ä¸²åœ¨æˆªå–å›¾ç‰‡ä¸Š</span><br><span class="line">// 4. åˆæˆæˆªå–å›¾ç‰‡å’ŒåŸå›¾</span><br><span class="line">// 5. æ¸…é™¤å¤šä½™å›¾ç‰‡</span><br><span class="line">// &#125;</span><br></pre></td></tr></table></figure><p>ä¼ªä»£ç å†™å¥½äº†ï¼Œå¼€å§‹ç¼–å†™æ­£å¼ä»£ç ï¼š</p><ol><li>åˆ¤æ–­æ‰§è¡Œ Build çš„æœºå™¨æ˜¯å¦å®‰è£…äº† ImageMagic</li></ol><p>which ä¸€ä¸‹å°±çŸ¥é“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">convertPath=`<span class="built_in">which</span> convert`</span><br><span class="line"><span class="comment"># åˆ¤æ–­ convertPath æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="variable">$&#123;convertPath&#125;</span>]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"==============</span></span><br><span class="line"><span class="string">WARNING: ä½ éœ€è¦å…ˆå®‰è£… ImageMagickï¼ï¼ï¼ï¼:</span></span><br><span class="line"><span class="string">brew install imagemagick</span></span><br><span class="line"><span class="string">=============="</span></span><br><span class="line"><span class="built_in">exit</span> 0;</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><ol start="2"><li>è·å– commit å· hash å€¼ã€åˆ†æ”¯åã€build å·ï¼Œå¹¶å°†å…¶æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²</li></ol><p>PlistBuddy å¯ä»¥ç”¨äºè¯»å– Plist æ–‡ä»¶ï¼Œé€šè¿‡æè¿°è·¯å¾„å°±å¯ä»¥æ‰¾åˆ°ä½ æƒ³çŸ¥é“çš„ Key å¯¹åº”çš„ Valueã€‚<br><code>${INFOPLIST_FILE}</code> æ˜¯ xcodebuild æä¾›çš„å˜é‡ï¼ˆå…·ä½“å¯ä»¥å‚è€ƒ <a href="http://help.apple.com/xcode/mac/8.0/#/itcaec37c2a6" target="_blank" rel="noopener">Build settings reference</a>ï¼‰æä¾›äº†ç¼–è¯‘å <code>info.plist</code> çš„è·¯å¾„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">commit=`git rev-parse --short HEAD`</span><br><span class="line">branch=`git rev-parse --abbrev-ref HEAD`</span><br><span class="line">buildNumber=`/usr/libexec/PlistBuddy -c <span class="string">"Print CFBundleVersion"</span> <span class="string">"<span class="variable">$&#123;INFOPLIST_FILE&#125;</span>"</span>`</span><br><span class="line">caption=<span class="string">"<span class="variable">$&#123;buildNumber&#125;</span> \n<span class="variable">$&#123;branch&#125;</span>\n<span class="variable">$&#123;commit&#125;</span>"</span></span><br></pre></td></tr></table></figure><ol start="3"><li>åˆ¤æ–­ç¼–è¯‘ç¯å¢ƒ</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Release ä¸æ‰§è¡Œ</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Configuration: <span class="variable">$CONFIGURATION</span>"</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$&#123;CONFIGURATION&#125;</span> = <span class="string">"Release"</span> ]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">exit</span> 0;</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><ol start="4"><li>è·å– Plist ä¸­ CFBundleIconFiles çš„æ•°é‡</li></ol><p>åœ¨ç¼–è¯‘åçš„ <code>info.plist</code> ä¸­ï¼Œå¯ä»¥æ‰¾åˆ°å¦‚ä¸‹ç»“æ„ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS%E2%80%94%E2%80%94%E5%86%99%E4%B8%80%E4%B8%AA%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98%E7%9A%84%E8%84%9A%E6%9C%AC-09.png" alt="blog_iOSâ€”â€”å†™ä¸€ä¸ªå¿«é€Ÿå®šä½é—®é¢˜çš„è„šæœ¬-09"></p><p>è¿™é‡Œè®°å½•äº†æ‰€æœ‰çš„ Icon filesã€‚æŸ¥çœ‹ plist çš„åŸæ ¼å¼ï¼Œå¯ä»¥çœ‹åˆ°åŸå§‹çš„ key æ˜¯ä»€ä¹ˆã€‚é€šè¿‡ PlistBuddy å’Œ è·¯å¾„ <code>CFBundleIcons:CFBundlePrimaryIcon:CFBundleIconFiles</code> å¯ä»¥è¾“å‡º valueã€‚</p><p><code>| wc -l</code> å¯ä»¥ç»Ÿè®¡è¾“å‡ºè¡Œæ•°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">icon_count=`/usr/libexec/PlistBuddy -c <span class="string">"Print CFBundleIcons:CFBundlePrimaryIcon:CFBundleIconFiles"</span> <span class="string">"<span class="variable">$&#123;CONFIGURATION_BUILD_DIR&#125;</span>/<span class="variable">$&#123;INFOPLIST_PATH&#125;</span>"</span> | wc -l`</span><br></pre></td></tr></table></figure><p>è¦æ³¨æ„çš„æ˜¯ï¼Œ <code>/usr/libexec/PlistBuddy -c &quot;Print CFBundleIcons:CFBundlePrimaryIcon:CFBundleIconFiles&quot; &quot;${CONFIGURATION_BUILD_DIR}/${INFOPLIST_PATH}&quot;</code> è¾“å‡ºç»“æœæ˜¯è¿™æ ·çš„ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS%E2%80%94%E2%80%94%E5%86%99%E4%B8%80%E4%B8%AA%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98%E7%9A%84%E8%84%9A%E6%9C%AC-10.png" alt="blog_iOSâ€”â€”å†™ä¸€ä¸ªå¿«é€Ÿå®šä½é—®é¢˜çš„è„šæœ¬-10"></p><p>è¾“å‡ºä¸€å…±æ˜¯ <strong>äº”è¡Œ</strong>ï¼Œæ‰€ä»¥è·å¾—çš„ç»“æœæ˜¯ 5ã€‚</p><p>é‚£ä¹ˆçœŸå®çš„ CFBundleIconFiles count å…¶å®æ˜¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">real_icon_index=$((<span class="variable">$&#123;icon_count&#125;</span> - 2))</span><br></pre></td></tr></table></figure><p>åˆšå¼€å§‹ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰æ³¨æ„ã€‚å¯æƒ³è€ŒçŸ¥å¿ƒæƒ…å¦‚ä½• =_=ã€‚</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS%E2%80%94%E2%80%94%E5%86%99%E4%B8%80%E4%B8%AA%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98%E7%9A%84%E8%84%9A%E6%9C%AC-11.JPG" alt="blog_iOSâ€”â€”å†™ä¸€ä¸ªå¿«é€Ÿå®šä½é—®é¢˜çš„è„šæœ¬-11"></p><ol start="5"><li>æ ¹æ®æ•°é‡å¾ªç¯ï¼Œæ‰§è¡Œè°ƒç”¨ã€ç”Ÿæˆè®°å·å›¾æ–¹æ³•ã€</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ((i=0; i&lt;<span class="variable">$real_icon_index</span>; i++)); <span class="keyword">do</span></span><br><span class="line"><span class="comment"># æ‰¾åˆ° icon å</span></span><br><span class="line">icon=`/usr/libexec/PlistBuddy -c <span class="string">"Print CFBundleIcons:CFBundlePrimaryIcon:CFBundleIconFiles:<span class="variable">$i</span>"</span> <span class="string">"<span class="variable">$&#123;CONFIGURATION_BUILD_DIR&#125;</span>/<span class="variable">$&#123;INFOPLIST_PATH&#125;</span>"</span>`</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨ generateIcon æ–¹æ³•ï¼Œä¼ å…¥ icon å</span></span><br><span class="line">generateIcon <span class="string">"<span class="variable">$&#123;icon&#125;</span>@2x.png"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><ol start="6"><li>generateIcon æ–¹æ³•</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">generateIcon</span></span>() &#123;</span><br><span class="line">    originalImg=<span class="variable">$1</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">cd</span> <span class="string">"<span class="variable">$&#123;CONFIGURATION_BUILD_DIR&#125;</span>/<span class="variable">$&#123;UNLOCALIZED_RESOURCES_FOLDER_PATH&#125;</span>"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># éªŒè¯å­˜åœ¨æ€§</span></span><br><span class="line">    <span class="keyword">if</span> [[ ! -f <span class="variable">$&#123;originalImg&#125;</span> || -z <span class="variable">$&#123;originalImg&#125;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">return</span>;</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¿›å…¥ç¼–è¯‘åçš„å·¥ç¨‹ç›®å½•</span></span><br><span class="line">    <span class="built_in">cd</span> <span class="string">"<span class="variable">$&#123;CONFIGURATION_BUILD_DIR&#125;</span>/<span class="variable">$&#123;UNLOCALIZED_RESOURCES_FOLDER_PATH&#125;</span>/"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ·»åŠ é«˜æ–¯æ¨¡ç³Š</span></span><br><span class="line">    convert <span class="variable">$&#123;originalImg&#125;</span> -blur 10x8 blur-original.png</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æˆªå–ä¸‹éƒ¨åˆ†</span></span><br><span class="line">    width=`identify -format %w <span class="variable">$&#123;originalImg&#125;</span>`</span><br><span class="line">    height=`identify -format %h <span class="variable">$&#123;originalImg&#125;</span>`</span><br><span class="line">    height_0=`expr <span class="variable">$&#123;height&#125;</span> / 2`</span><br><span class="line">    height_1=$((<span class="variable">$&#123;height&#125;</span> - <span class="variable">$&#123;height_0&#125;</span>))</span><br><span class="line">    convert blur-original.png -crop <span class="variable">$&#123;width&#125;</span>x<span class="variable">$&#123;height_0&#125;</span>+0+<span class="variable">$&#123;height_1&#125;</span> crop-blur-original.png</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åŠ å­—</span></span><br><span class="line">    point_size=$(((8 * <span class="variable">$height</span>) / 58))</span><br><span class="line"></span><br><span class="line">    convert -background none -fill white -pointsize <span class="variable">$&#123;point_size&#125;</span> -gravity center caption:<span class="string">"<span class="variable">$&#123;caption&#125;</span>"</span> crop-blur-original.png +swap -composite label.png</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆæˆ</span></span><br><span class="line">    composite -geometry +0+<span class="variable">$&#123;height_0&#125;</span> label.png <span class="variable">$&#123;originalImg&#125;</span> <span class="variable">$&#123;originalImg&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ¸…é™¤æ–‡ä»¶</span></span><br><span class="line">    rm blur-original.png</span><br><span class="line">    rm crop-blur-original.png</span><br><span class="line">    rm label.png</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ä»£ç æ¸…å•"><a href="#ä»£ç æ¸…å•" class="headerlink" title="ä»£ç æ¸…å•"></a>ä»£ç æ¸…å•</h1><p>æœ€ç»ˆçš„ä»£ç æ¸…å•æ”¾åœ¨äº† Github ä¸Šï¼š</p><blockquote><p><a href="https://github.com/summertian4/ZLYWatermarkIcon" target="_blank" rel="noopener">ZLYWatermarkIcon</a></p></blockquote><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><blockquote><p><a href="http://www.imagemagick.org/script/convert.php" target="_blank" rel="noopener">Command-line Tools:Convert</a><br><a href="http://blog.topspeedsnail.com/archives/7783" target="_blank" rel="noopener">ä½¿ç”¨ImageMagickæ·»åŠ å›¾ç‰‡æ°´å°ï¼Linux</a><br><a href="https://github.com/krzysztofzablocki/IconOverlaying" target="_blank" rel="noopener">krzysztofzablocki/IconOverlaying</a><br><a href="http://merowing.info/2013/03/overlaying-application-version-on-top-of-your-icon/" target="_blank" rel="noopener">Overlaying application version on top of your icon</a><br><a href="http://www.charry.org/docs/linux/ImageMagick/ImageMagick.html" target="_blank" rel="noopener">æˆ‘çš„ImageMagickä½¿ç”¨å¿ƒå¾—</a><br><a href="http://www.ruanyifeng.com/blog/2012/11/gaussian_blur.html" target="_blank" rel="noopener">é«˜æ–¯æ¨¡ç³Šçš„ç®—æ³•</a><br><a href="http://help.apple.com/xcode/mac/8.0/#/itcaec37c2a6" target="_blank" rel="noopener">Build settings reference</a><br><a href="https://github.com/qinjx/30min_guides/blob/master/shell.md" target="_blank" rel="noopener">Shellè„šæœ¬ç¼–ç¨‹30åˆ†é’Ÿå…¥é—¨</a></p></blockquote><hr><p>æœ‰ä»€ä¹ˆé—®é¢˜éƒ½å¯ä»¥åœ¨åšæ–‡åé¢ç•™è¨€ï¼Œæˆ–è€…å¾®åšä¸Šç§ä¿¡æˆ‘ï¼Œæˆ–è€…é‚®ä»¶æˆ‘ <a href="mailto:&#99;&#x6f;&#x64;&#101;&#114;&#102;&#x69;&#115;&#x68;&#x40;&#x31;&#x36;&#x33;&#46;&#x63;&#111;&#109;" target="_blank" rel="noopener">&#99;&#x6f;&#x64;&#101;&#114;&#102;&#x69;&#115;&#x68;&#x40;&#x31;&#x36;&#x33;&#46;&#x63;&#111;&#109;</a>ã€‚</p><p>åšä¸»æ˜¯ iOS å¦¹å­ä¸€æšã€‚</p><p>å¸Œæœ›å¤§å®¶ä¸€èµ·è¿›æ­¥ã€‚</p><p>æˆ‘çš„å¾®åšï¼š<a href="http://weibo.com/coderfish/" target="_blank" rel="noopener">å°é±¼å‘¨å‡Œå®‡</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS%E2%80%94%E2%80%94%E5%86%99%E4%B8%80%E4%B8%AA%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98%E7%9A%84%E8%84%9A%E6%9C%AC-12.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;ä½ æ˜¯å¦è§è¿‡ï¼Ÿ&quot;&gt;&lt;a href=&quot;#ä½ æ˜¯å¦è§è¿‡ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;ä½ æ˜¯å¦è§è¿‡ï¼Ÿ&quot;&gt;&lt;/a&gt;ä½ æ˜¯å¦è§è¿‡ï¼Ÿ&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;ä½ æ˜¯å¦è§è¿‡æµ‹è¯•äººå‘˜æˆ–è€…è‡ªå·±åœ¨ CI ä¸Š install äº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œå‘ç°äº† BUG åï¼Œçªç„¶å¿˜äº†è‡ªå·±ä¸‹çš„æ˜¯ CI ä¸Šçš„å“ªä¸€ä¸ª commit çš„åŒ…ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä½ æ˜¯å¦è§è¿‡ä¸‹é¢è¿™ä¸ªä¸œè¥¿ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&quot;http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS%E2%80%94%E2%80%94%E5%86%99%E4%B8%80%E4%B8%AA%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98%E7%9A%84%E8%84%9A%E6%9C%AC-01.jpg&quot; alt=&quot;blog_iOSâ€”â€”å†™ä¸€ä¸ªå¿«é€Ÿå®šä½é—®é¢˜çš„è„šæœ¬-01&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS%E2%80%94%E2%80%94%E5%86%99%E4%B8%80%E4%B8%AA%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98%E7%9A%84%E8%84%9A%E6%9C%AC-02.png&quot; alt=&quot;blog_iOSâ€”â€”å†™ä¸€ä¸ªå¿«é€Ÿå®šä½é—®é¢˜çš„è„šæœ¬-02&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://zhoulingyu.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://zhoulingyu.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>ssh-keygen ä¸­ç”Ÿæˆçš„ randomart image æ˜¯ä»€ä¹ˆ</title>
    <link href="http://zhoulingyu.com/2017/03/27/ssh-keygen-%E4%B8%AD%E7%94%9F%E6%88%90%E7%9A%84-randomart-image-%E6%98%AF%E4%BB%80%E4%B9%88/"/>
    <id>http://zhoulingyu.com/2017/03/27/ssh-keygen-ä¸­ç”Ÿæˆçš„-randomart-image-æ˜¯ä»€ä¹ˆ/</id>
    <published>2017-03-27T17:23:40.000Z</published>
    <updated>2018-07-10T03:07:31.632Z</updated>
    
    <content type="html"><![CDATA[<h1 id="randomart-image-å‡ºç°åœ¨å“ªé‡Œ"><a href="#randomart-image-å‡ºç°åœ¨å“ªé‡Œ" class="headerlink" title="randomart image å‡ºç°åœ¨å“ªé‡Œ"></a>randomart image å‡ºç°åœ¨å“ªé‡Œ</h1><p>é€šå¸¸æˆ‘ä»¬åœ¨ç”Ÿæˆ SSH Key çš„æ—¶å€™ä¼šç”¨åˆ° <code>ssh-keygen</code> å‘½ä»¤ï¼Œåœ¨ç”Ÿæˆç»“æŸåï¼Œä¼šè¾“å‡ºç±»ä¼¼å¦‚ä¸‹çš„å†…å®¹ï¼Œè¿™ä¸ª randomart image æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">The key&apos;s randomart image is:</span><br><span class="line">+--[ RSA 2048]----+</span><br><span class="line">|       o=.       |</span><br><span class="line">|    o  o++E      |</span><br><span class="line">|   + . Ooo.      |</span><br><span class="line">|    + O B..      |</span><br><span class="line">|     = *S.       |</span><br><span class="line">|      o          |</span><br><span class="line">|                 |</span><br><span class="line">|                 |</span><br><span class="line">|                 |</span><br><span class="line">+-----------------+</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="ä¸ºä»€ä¹ˆä¼šæœ‰-randomart-image"><a href="#ä¸ºä»€ä¹ˆä¼šæœ‰-randomart-image" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šæœ‰ randomart image"></a>ä¸ºä»€ä¹ˆä¼šæœ‰ randomart image</h1><p>ç›¸æ¯”è¶…é•¿å­—ç¬¦ä¸²ï¼Œäººä»¬æ›´å®¹æ˜“æ¥å—å›¾å½¢ã€‚è®©æˆ‘ä»¬å¯¹æ¯”ä¸¤å¹…å›¾ç‰‡çš„å·®å¼‚æ¯”å¯¹æ¯”ä¸¤ä¸ªè¶…é•¿å­—ç¬¦ä¸²ä¹Ÿè¦å®¹æ˜“çš„å¤šã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç°åœ¨å¤§å®¶ä½¿ç”¨äºŒç»´ç ï¼Œè€Œä¸æ˜¯å¤åˆ¶ç²˜è´´ URL çš„åŸå› ã€‚</p><p>Randomart image é€šè¿‡å°† Key è½¬æ¢æˆæœ‰è§„å¾‹çš„å›¾ç‰‡ï¼Œè®©äººå¯ä»¥æ›´åŠ å®¹æ˜“çš„ã€å¿«é€Ÿçš„å¯¹æ¯” Key çš„å¼‚åŒã€‚</p><h1 id="è¶£é—»"><a href="#è¶£é—»" class="headerlink" title="è¶£é—»"></a>è¶£é—»</h1><p>åœ¨<a href="http://aarontoponce.org/drunken_bishop.pdf" target="_blank" rel="noopener">ã€ŠThe drunken bishop: An analysis of the OpenSSH<br>fingerprint visualization algorithmã€‹</a>ä¸­ï¼Œä½œè€…é€šè¿‡ä¸€æ®µæœ‰è¶£çš„æ•…äº‹æ¥è¡¨è¾¾ randomart image ç”Ÿæˆçš„è¿‡ç¨‹ï¼š</p><blockquote><p>Peter ä¸»æ•™å‘ç°è‡ªå·±åœ¨ä¸€ä¸ªå°é—­çš„çŸ©å½¢æˆ¿é—´å†…ï¼Œå››é¢éƒ½æ˜¯å¢™å£ï¼Œè€Œåœ°æ¿ä¸Šåˆé“ºæ»¡äº†é»‘ç™½äº¤æ›¿çŸ©å½¢çš„ç“·ç –ã€‚Peter ä¸»æ•™çªç„¶å¼€å§‹å¤´ç–¼â€”â€”å¤§æ¦‚åº”ä¸ºä¹‹å‰å–äº†å¤ªå¤šçš„é…’â€”â€”äºæ˜¯å¼€å§‹éšæ„çš„èµ°åŠ¨èµ·æ¥ã€‚å‡†ç¡®çš„è¯´ï¼Œä»–æ˜¯æŒ‰ç…§å¯¹è§’èµ°ä½çš„æ–¹å¼ï¼Œå°±å¥½åƒå›½é™…è±¡æ£‹ä¸Šçš„ä¸»æ•™ä¸€æ ·ã€‚å½“ä»–é‡åˆ°å¢™å£çš„æ—¶å€™ï¼Œå¦‚æœä»–è¸©ç€é»‘ç“·ç –ï¼Œå°±èµ°å‘ç™½ç“·ç –ï¼Œå¦‚æœè¸©ç€ç™½ç“·ç –å°±èµ°å‘é»‘ç“·ç –ã€‚æ¯æ¬¡åŠ¨ä½œä¹‹åï¼Œä»–éƒ½ä¼šåœ¨ç“·ç –ä¸Šæ”¾ç½®ä¸€ä¸ªç¡¬å¸ï¼Œè®°å½•ä»–è¸©è¿‡è¿™é‡Œä¸€æ¬¡ã€‚èµ°äº† 64 æ­¥ä¹‹åï¼Œç”¨å®Œäº†æ‰€æœ‰çš„ç¡¬å¸ï¼ŒPeter çªç„¶é†’äº†è¿‡æ¥ã€‚å¤šä¹ˆå¥‡æ€ªçš„æ¢¦ï¼</p></blockquote><h1 id="å¦‚ä½•ç”Ÿæˆ"><a href="#å¦‚ä½•ç”Ÿæˆ" class="headerlink" title="å¦‚ä½•ç”Ÿæˆ"></a>å¦‚ä½•ç”Ÿæˆ</h1><p>çœ‹äº†ä¸Šé¢çš„æ•…äº‹ï¼Œæ¥è¯´ä¸€è¯´ randomart image å…·ä½“æ˜¯å¦‚ä½•ç”Ÿæˆçš„ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ OpenSSH Key çš„æŒ‡çº¹æ˜¯ä¸€ä¸ª MD5 æ ¡éªŒå’Œï¼ŒåŒäº‹å¯ä»¥ç”¨ 16 è¿›åˆ¶è¡¨ç¤ºå‡ºæ¥ï¼Œç±»ä¼¼è¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fc:94:b0:c1:e5:b0:98:7c:58:43:99:76:97:ee:9f:b7</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ç”¨äºŒè¿›åˆ¶æ¥è¡¨ç¤ºã€‚</p><p>äºæ˜¯æŒ‰ç…§ Peter çš„èµ°è·¯æ–¹å¼ï¼Œæˆ‘ä»¬å®šä¹‰å¦‚ä¸‹èµ°ä½ï¼š</p><ol><li>â€œ00â€ è¡¨ç¤ºå‘è¥¿åŒ—ï¼ˆå·¦ä¸Šï¼‰ç§»åŠ¨</li><li>â€œ01â€ è¡¨ç¤ºå‘ä¸œåŒ—ï¼ˆå³ä¸Šï¼‰ç§»åŠ¨</li><li>â€œ10â€ è¡¨ç¤ºå‘è¥¿å—ï¼ˆå³ä¸‹ï¼‰ç§»åŠ¨</li><li>â€œ11â€ è¡¨ç¤ºå‘ä¸œå—ï¼ˆåä¸‹ï¼‰ç§»åŠ¨</li></ol><p>å°±åƒè¿™æ ·ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_ssh-keygen%20%E4%B8%AD%E7%94%9F%E6%88%90%E7%9A%84%20randomart%20image%20%E6%98%AF%E4%BB%80%E4%B9%88-01.jpg" alt=""></p><p>æˆ‘ä»¬æ¥ç”»ä¸ªå›¾ï¼Œç”¨äºè¡¨ç¤ºé»‘ç™½ç›¸é—´çš„ç“·ç –æˆ¿ï¼Œå¹¶æ¯ä¸ªæ ¼å­ä¸Šéƒ½ç¼–å·ï¼Œä¸€å¼€å§‹çš„æ—¶å€™ï¼ŒPeter åœ¨æˆ¿é—´çš„ä¸­é—´ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_ssh-keygen%20%E4%B8%AD%E7%94%9F%E6%88%90%E7%9A%84%20randomart%20image%20%E6%98%AF%E4%BB%80%E4%B9%88-02.jpg" alt=""></p><p>ä¸­é—´çš„ 76 å·å°±æ˜¯ Peter æœ€åˆçš„ä½ç½®ã€‚æˆ‘ä»¬å¯ä»¥æŠŠ Peter æ‰€åœ¨çš„æ ¼å­è¡¨ç¤ºä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// ç”¨åæ ‡ç³»è¡¨ç¤º</span><br><span class="line">P = x + 17y</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œä» 76 å·å‘å››ä¸ªæ–¹å‘ç§»åŠ¨ P å€¼å˜åŒ–ï¼š</p><ol><li>â€œ00â€ è¿›å…¥ 58 å·æ ¼å­ï¼Œæ•°å€¼ -18</li><li>â€œ01â€ è¿›å…¥ 60 å·æ ¼å­ï¼Œæ•°å€¼ -16</li><li>â€œ10â€ è¿›å…¥ 92 å·æ ¼å­ï¼Œæ•°å€¼ +16</li><li>â€œ11â€ è¿›å…¥ 94 å·æ ¼å­ï¼Œæ•°å€¼ +18</li></ol><p>å¯¹äºç¢°å¢™çš„æƒ…å†µï¼Œåšå¦‚ä¸‹è§„åˆ™ï¼š</p><p>å°†æˆ¿é—´çš„æ¯ä¸ªæ ¼å­åšåˆ†ç±»ï¼Œå››ä¸ªè§’åˆ†åˆ«ä¸º aã€bã€cã€dï¼Œé ç€å››é¢å¢™çš„åˆ†åˆ«ä¸º Tã€Rã€Bã€Lï¼Œå…¶ä½™éƒ¨åˆ†ä¸º Mã€‚</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_ssh-keygen%20%E4%B8%AD%E7%94%9F%E6%88%90%E7%9A%84%20randomart%20image%20%E6%98%AF%E4%BB%80%E4%B9%88-03.jpg" alt=""></p><p>å¯¹äºæ¯ä¸€ç§æƒ…å†µï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_ssh-keygen%20%E4%B8%AD%E7%94%9F%E6%88%90%E7%9A%84%20randomart%20image%20%E6%98%AF%E4%BB%80%E4%B9%88-04.jpg" alt=""></p><p>è§£é‡Šä¸€ä¸‹ä¸Šå›¾ï¼Œä»¥ a æ ä¸ºä¾‹ï¼Œå¦‚æœä¸‹ä¸€æ­¥åƒå·¦ä¸Šç§»åŠ¨ï¼Œä½†æ˜¯ç»§ç»­èµ°å°±æ’å¢™äº†ï¼Œæ‰€ä»¥å®é™…ç§»åŠ¨ä¸º <code>ä¸ç§»åŠ¨</code>ï¼›å¦‚æœå‘å³ä¸Šç§»åŠ¨ï¼Œå®é™…ç§»åŠ¨ä¸º <code>å‘å³ç§»åŠ¨</code>ï¼›å¦‚æœå‘å·¦ä¸‹ç§»åŠ¨ï¼Œå®é™…ç§»åŠ¨ä¸º <code>å‘ä¸‹ç§»åŠ¨</code>ï¼›å¦‚æœåƒå³ä¸‹ç§»åŠ¨ï¼Œå®é™…ç§»åŠ¨å°±æ˜¯ <code>å‘ä¸‹ç§»åŠ¨</code>ã€‚</p><p>é‚£ä¹ˆ Peter æŠ•æ·ç¡¬å¸æ˜¯æ€æ ·ä½“ç°çš„ï¼Ÿå®é™…ä¸Šï¼Œæ˜¯åšå¦‚ä¸‹ç»Ÿè®¡ï¼Œæ¯ä¸ªæ ¼å­ï¼Œå¦‚æœæ²¡æœ‰è¢«è¸©è¿‡ï¼Œåˆ™ä¸åšè¡¨ç¤ºï¼›å¦‚æœè¢«è¸©è¿‡ä¸€æ¬¡ï¼Œè®°å½•ä¸º <code>.</code>ï¼›å¦‚æœè¢«è¸©äº†ä¸¤æ¬¡ï¼Œè®°å½•ä¸º <code>o</code>â€¦å…·ä½“å¦‚ä¸‹ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_ssh-keygen%20%E4%B8%AD%E7%94%9F%E6%88%90%E7%9A%84%20randomart%20image%20%E6%98%AF%E4%BB%80%E4%B9%88-05.jpg" alt=""></p><p>æ¯”è¾ƒç‰¹åˆ«çš„æ˜¯ <code>S</code> å’Œ <code>E</code>ï¼Œ<code>S</code> å’Œ <code>E</code> åˆ†åˆ«æ ‡è®°èµ·å§‹å’Œç»ˆæ­¢ä½ç½®ï¼ˆæ‰€ä»¥ 76 å·æ ¼å­æ°¸è¿œæ˜¯ Sï¼‰ã€‚</p><p>å®é™…æ“ä½œä¸€ä¸‹ï¼Œå¯¹äº <code>fc:94:b0:c1:e5:b0:98:7c:58:43:99:76:97:ee:9f:b7</code>ï¼Œæˆ‘ä»¬å°†å…¶è½¬æ¢æˆäºŒè¿›åˆ¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">11010100:11010100:11111101:11001010:...:00111011:11100100:10111010:11101001</span><br></pre></td></tr></table></figure><p>å°†äºŒè¿›åˆ¶äºŒä½ä¸€ç»„ï¼ŒæŒ‰ç…§ä¸‹è¡¨åšå¥½èµ°è·¯çš„é¡ºåºï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_ssh-keygen%20%E4%B8%AD%E7%94%9F%E6%88%90%E7%9A%84%20randomart%20image%20%E6%98%AF%E4%BB%80%E4%B9%88-06.jpg" alt=""></p><p>æŒ‰ç…§ä¸Šé¢çš„é¡ºåºï¼Œè¸©åˆ°æ ¼å­çš„é¡ºåºå¦‚ä¸‹ã€‚</p><p>76, 58, 76, 94, 112, 94, 78, 62, 78, 60, 42, 60, 76, 60, 42, 24, 42, 26, 10, 26, 44, 26, 8, 26, 42, 24, 40, 24, 40, 22, 40, 58, 42, 24, 40, 24, 8, 26, 8, 7, 8, 9, 25, 9, 25, 41, 25, 43, 27, 45, 29, 13, 29, 45, 63, 79, 97, 115, 133, 117, 133, 151, 135, 152, 151</p><p>æœ€ååšæˆç»Ÿè®¡ï¼Œå¡«å¥½å›¾ï¼Œæˆå“å°±å¦‚ä¸‹ã€‚æ˜¯ä¸æ˜¯å°±å’Œæˆ‘ä»¬å¹³å¸¸åœ¨æ§åˆ¶å°å¾—åˆ°çš„è¾“å‡ºä¸€è‡´ï¼Ÿ</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_ssh-keygen%20%E4%B8%AD%E7%94%9F%E6%88%90%E7%9A%84%20randomart%20image%20%E6%98%AF%E4%BB%80%E4%B9%88-07.jpg" alt=""></p><h1 id="ç›¸å…³"><a href="#ç›¸å…³" class="headerlink" title="ç›¸å…³"></a>ç›¸å…³</h1><blockquote><p><a href="https://superuser.com/questions/22535/what-is-randomart-produced-by-ssh-keygen" target="_blank" rel="noopener">What is randomart produced by ssh-keygen?</a><br><a href="https://pthree.org/2013/05/30/openssh-keys-and-the-drunken-bishop/" target="_blank" rel="noopener">OpenSSH Keys and The Drunken Bishop</a><br><a href="http://aarontoponce.org/drunken_bishop.pdf" target="_blank" rel="noopener">The drunken bishop: An analysis of the OpenSSH<br>fingerprint visualization algorithm</a></p></blockquote><p><em>æœ€åä¸€ç‚¹è¯´æ˜ï¼šå…¶ä¸»è¦åŸç†éƒ½å‘è¡¨åœ¨ <a href="http://aarontoponce.org/drunken_bishop.pdf" target="_blank" rel="noopener">The drunken bishop: An analysis of the OpenSSH<br>fingerprint visualization algorithm</a></em></p><hr><p>æœ‰ä»€ä¹ˆé—®é¢˜éƒ½å¯ä»¥åœ¨åšæ–‡åé¢ç•™è¨€ï¼Œæˆ–è€…å¾®åšä¸Šç§ä¿¡æˆ‘ï¼Œæˆ–è€…é‚®ä»¶æˆ‘ <a href="mailto:&#x63;&#x6f;&#x64;&#x65;&#x72;&#x66;&#105;&#115;&#x68;&#64;&#49;&#54;&#51;&#x2e;&#99;&#x6f;&#109;" target="_blank" rel="noopener">&#x63;&#x6f;&#x64;&#x65;&#x72;&#x66;&#105;&#115;&#x68;&#64;&#49;&#54;&#51;&#x2e;&#99;&#x6f;&#109;</a>ã€‚</p><p>åšä¸»æ˜¯ iOS å¦¹å­ä¸€æšã€‚</p><p>å¸Œæœ›å¤§å®¶ä¸€èµ·è¿›æ­¥ã€‚</p><p>æˆ‘çš„å¾®åšï¼š<a href="http://weibo.com/coderfish/" target="_blank" rel="noopener">å°é±¼å‘¨å‡Œå®‡</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;randomart-image-å‡ºç°åœ¨å“ªé‡Œ&quot;&gt;&lt;a href=&quot;#randomart-image-å‡ºç°åœ¨å“ªé‡Œ&quot; class=&quot;headerlink&quot; title=&quot;randomart image å‡ºç°åœ¨å“ªé‡Œ&quot;&gt;&lt;/a&gt;randomart image å‡ºç°åœ¨å“ªé‡Œ&lt;/h1&gt;&lt;p&gt;é€šå¸¸æˆ‘ä»¬åœ¨ç”Ÿæˆ SSH Key çš„æ—¶å€™ä¼šç”¨åˆ° &lt;code&gt;ssh-keygen&lt;/code&gt; å‘½ä»¤ï¼Œåœ¨ç”Ÿæˆç»“æŸåï¼Œä¼šè¾“å‡ºç±»ä¼¼å¦‚ä¸‹çš„å†…å®¹ï¼Œè¿™ä¸ª randomart image æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;The key&amp;apos;s randomart image is:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+--[ RSA 2048]----+&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|       o=.       |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|    o  o++E      |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|   + . Ooo.      |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|    + O B..      |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|     = *S.       |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|      o          |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|                 |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|                 |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|                 |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+-----------------+&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="å†·çŸ¥è¯†" scheme="http://zhoulingyu.com/categories/%E5%86%B7%E7%9F%A5%E8%AF%86/"/>
    
      <category term="Other" scheme="http://zhoulingyu.com/categories/%E5%86%B7%E7%9F%A5%E8%AF%86/Other/"/>
    
    
      <category term="å†·çŸ¥è¯†" scheme="http://zhoulingyu.com/tags/%E5%86%B7%E7%9F%A5%E8%AF%86/"/>
    
      <category term="Other" scheme="http://zhoulingyu.com/tags/Other/"/>
    
  </entry>
  
  <entry>
    <title>iOSè¿›é˜¶â€”â€”iOSï¼ˆObjective-Cï¼‰å†…å­˜ç®¡ç†Â·äºŒ</title>
    <link href="http://zhoulingyu.com/2017/02/15/Advanced-iOS-Study-objc-Memory-2/"/>
    <id>http://zhoulingyu.com/2017/02/15/Advanced-iOS-Study-objc-Memory-2/</id>
    <published>2017-02-15T11:59:33.000Z</published>
    <updated>2018-07-10T03:07:31.624Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨å†™ ã€<a href="http://zhoulingyu.com/2017/02/08/iOSè¿›é˜¶â€”â€”iOS-Memory-Block/">iOSï¼ˆObjective-Cï¼‰ å†…å­˜ç®¡ç†&amp;Block</a>ã€ ä¸€æ–‡æ—¶ï¼Œæˆ‘å¹¶æ²¡æœ‰å‘ç° NSObject çš„ä»£ç å·²ç»è¢«å¼€æºäº†ï¼Œæ‰€ä»¥åˆ†æçš„ä¸»è¦æ˜¯ GNUStep çš„æºç ï¼Œå¯¹ Apple çš„éƒ¨åˆ†åªæ˜¯é€šè¿‡çŒœæµ‹ã€‚</p><p>å®è´¨ä¸Šï¼ŒNSObject çš„å®ç°å†…å®¹å·²ç»å¼€æºåœ¨ <a href="https://opensource.apple.com/tarballs/objc4/" target="_blank" rel="noopener">objc4-706</a> ä¸­ã€‚äºæ˜¯æˆ‘ä¾¿å¼€å§‹å­¦ä¹  objc4 ä¸­çš„å†…å®¹ã€‚</p><p>ä¸‹é¢å°±å’Œå¤§å®¶æ‰’ä¸€æ‰’ Apple çš„ NSObject å†…å­˜ç®¡ç†çš„ä¸€äº›å†…å®¹ã€‚</p><h1 id="SideTable"><a href="#SideTable" class="headerlink" title="SideTable"></a>SideTable</h1><p>æ‰¾åˆ° NSObject.mmï¼Œé¦–å…ˆæ¥ä¸€äº›éå¸¸é‡è¦çš„ä¿¡æ¯ï¼Œä»¥ä¾¿åé¢çš„ç†è§£ã€‚</p><p><strong>objc4-706 NSObject.mm SideTable:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> SideTable &#123;</span><br><span class="line">    <span class="comment">// ä¿è¯åŸå­æ“ä½œçš„è‡ªæ—‹é”</span></span><br><span class="line">    spinlock_t slock;</span><br><span class="line">    <span class="comment">// å¼•ç”¨è®¡æ•°çš„ hash è¡¨</span></span><br><span class="line">    RefcountMap refcnts;</span><br><span class="line">    <span class="comment">// weak å¼•ç”¨å…¨å±€ hash è¡¨</span></span><br><span class="line">    weak_table_t weak_table;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><a id="more"></a><p>SideTable ç»“æ„ä½“é‡å®šäº†å‡ ä¸ªéå¸¸é‡è¦çš„å˜é‡ã€‚</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The order of these bits is important.</span></span><br><span class="line"><span class="meta">#define SIDE_TABLE_WEAKLY_REFERENCED (1UL<span class="meta-string">&lt;&lt;0)</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#define SIDE_TABLE_DEALLOCATING      (1UL&lt;&lt;1)  // MSB-ward of weak bit</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#define SIDE_TABLE_RC_ONE            (1UL&lt;&lt;2)  // MSB-ward of deallocating bit</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#define SIDE_TABLE_RC_PINNED         (1UL&lt;&lt;(WORD_BITS-1))</span></span></span><br><span class="line"><span class="meta"><span class="meta-string"></span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#define SIDE_TABLE_RC_SHIFT 2</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#define SIDE_TABLE_FLAG_MASK (SIDE_TABLE_RC_ONE-1)</span></span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå®šä¹‰çš„æ˜¯å‡ ä¸ªé‡è¦åç§»é‡ã€‚å¼•ç”¨è®¡æ•° retainCount æ˜¯ä¿å­˜åœ¨ä¸€ä¸ªæ— ç¬¦å·æ•´å½¢ä¸­ï¼Œä¹Ÿå°±æ˜¯æœ‰ 8 ä¸ªå­—èŠ‚ã€‚å…¶ç»“æ„å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_Advanced-iOS-Study-objc-Memory-2-01.png" alt=""></p><ol><li><code>SIDE_TABLE_WEAKLY_REFERENCED (1UL&lt;&lt;0)</code>ï¼ˆè¡¨ç¤ºå¯¹è±¡æ‰€åœ¨å†…å­˜çš„ç¬¬ 1 ä½ï¼‰ï¼Œæ ‡è¯†è¯¥å¯¹è±¡æ˜¯å¦æœ‰è¿‡ weak å¯¹è±¡ï¼›</li><li><code>SIDE_TABLE_DEALLOCATING (1UL&lt;&lt;1)</code>ï¼ˆè¡¨ç¤ºå¯¹è±¡æ‰€åœ¨å†…å­˜çš„ç¬¬ 2 ä½ï¼‰ï¼Œæ ‡è¯†è¯¥å¯¹è±¡æ˜¯å¦æ­£åœ¨ deallocï¼ˆææ„ï¼‰ã€‚</li><li><code>SIDE_TABLE_RC_ONE (1UL&lt;&lt;2)</code> ï¼ˆè¡¨ç¤ºå¯¹è±¡æ‰€åœ¨å†…å­˜çš„ç¬¬ 3 ä½ï¼‰ï¼Œå­˜æ”¾å¼•ç”¨è®¡æ•°æ•°å€¼ï¼ˆå…¶å®ç¬¬ä¸‰ä½ä¹‹åéƒ½ç”¨æ¥å­˜æ”¾å¼•ç”¨è®¡æ•°æ•°å€¼ï¼‰ã€‚</li></ol><h1 id="retainCount"><a href="#retainCount" class="headerlink" title="retainCount"></a>retainCount</h1><p>æ‰¾åˆ° retainCount çš„å®ç°ï¼Œä¸€å±‚ä¸€å±‚å‘ä¸‹çœ‹ã€‚</p><p><strong>objc4 NSObject.mm retainCount:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSUInteger</span>)retainCount &#123;</span><br><span class="line">    <span class="keyword">return</span> ((<span class="keyword">id</span>)<span class="keyword">self</span>)-&gt;rootRetainCount();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>objc4 objc-object.h rootRetainCount:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> uintptr_t </span><br><span class="line">objc_object::rootRetainCount()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (isTaggedPointer()) <span class="keyword">return</span> (uintptr_t)<span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">return</span> sidetable_retainCount();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>objc4 NSObject.mm sidetable_retainCount:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">uintptr_t</span><br><span class="line">objc_object::sidetable_retainCount()</span><br><span class="line">&#123;</span><br><span class="line">    SideTable&amp; table = SideTables()[<span class="keyword">this</span>];</span><br><span class="line"></span><br><span class="line">    size_t refcnt_result = <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    table.lock();</span><br><span class="line">    RefcountMap::iterator it = table.refcnts.find(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">if</span> (it != table.refcnts.end()) &#123;</span><br><span class="line">        <span class="comment">// this is valid for SIDE_TABLE_RC_PINNED too</span></span><br><span class="line">        refcnt_result += it-&gt;second &gt;&gt; SIDE_TABLE_RC_SHIFT;</span><br><span class="line">    &#125;</span><br><span class="line">    table.unlock();</span><br><span class="line">    <span class="keyword">return</span> refcnt_result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>it-&gt;second æŒ‡å‘çš„å°±æ˜¯å­˜æ”¾å¼•ç”¨è®¡æ•°ç›¸å…³çš„é‚£ä¸ª 8 ä½çš„æ— ç¬¦å·æ•´å‹ã€‚</p><p>ä¸Šé¢ä»‹ç»è¿‡ Sidetable ä¸­çš„å‡ ä¸ªé‡è¦åç§»é‡ï¼Œé€šè¿‡ä½ç§» SIDE_TABLE_RC_SHIFT å¯ä»¥è·å–çœŸå®çš„å¼•ç”¨è®¡æ•°ã€‚</p><p>æ‰€ä»¥ï¼Œ<code>sidetable_retainCount()</code> ä¸­çš„ä¸»è¦å†…å®¹å°±æ˜¯éå†å¼•ç”¨è®¡æ•°è¡¨ï¼ŒæŸ¥æ‰¾å¯¹è±¡è·å–å¼•ç”¨è®¡æ•° +1 å¹¶å°†ç»“æœè¿”å›ã€‚</p><h1 id="retain"><a href="#retain" class="headerlink" title="retain"></a>retain</h1><p>æ‰¾åˆ° retain çš„å®ç°ã€‚</p><p><strong>objc4 NSObject.mm retain:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>)<span class="keyword">retain</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ((<span class="keyword">id</span>)<span class="keyword">self</span>)-&gt;rootRetain();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>objc4 objc-objc.h rootRetain:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Base retain implementation, ignoring overrides.</span></span><br><span class="line"><span class="comment">// This does not check isa.fast_rr; if there is an RR override then </span></span><br><span class="line"><span class="comment">// it was already called and it chose to call [super retain].</span></span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">id</span> </span><br><span class="line">objc_object::rootRetain()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (isTaggedPointer()) <span class="keyword">return</span> (<span class="keyword">id</span>)<span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">return</span> sidetable_retain();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>objc4 NSObject.mm sidetable_retain:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">id</span></span><br><span class="line">objc_object::sidetable_retain()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#if SUPPORT_NONPOINTER_ISA</span></span><br><span class="line">    assert(!isa.nonpointer);</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line">    SideTable&amp; table = SideTables()[<span class="keyword">this</span>];</span><br><span class="line">    </span><br><span class="line">    table.lock();</span><br><span class="line">    size_t&amp; refcntStorage = table.refcnts[<span class="keyword">this</span>];</span><br><span class="line">    <span class="keyword">if</span> (! (refcntStorage &amp; SIDE_TABLE_RC_PINNED)) &#123;</span><br><span class="line">        refcntStorage += SIDE_TABLE_RC_ONE;</span><br><span class="line">    &#125;</span><br><span class="line">    table.unlock();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">id</span>)<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>refcntStorage += SIDE_TABLE_RC_ONE</code> è®©äººè´¹è§£ï¼Œå®é™…æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿæˆ‘ä»¬é€šè¿‡è·ç¦»è¯´æ˜ï¼š</p><p>å¦‚æœ obj çš„å¼•ç”¨è®¡æ•°æ•°å€¼ä¸º 1ï¼ˆäºŒè¿›åˆ¶ 00000100ï¼Œå› ä¸ºç¬¬ä¸€ä½ï¼Œç¬¬äºŒä½ç”¨æ¥æ ‡è¯†å…¶ä»–å†…å®¹ï¼‰ï¼Œç°åœ¨å¦‚æœè¿›è¡Œ retainï¼Œéœ€è¦å¯¹å¼•ç”¨è®¡æ•°æ•°å€¼å¢åŠ  1ï¼Œé‚£ä¹ˆéœ€è¦ç”± 00000100 =&gt; 00001000ã€‚æ‰€ä»¥å®é™…ä¸Šï¼Œä»æ•´å‹çš„è§’åº¦ï¼Œæ˜¯ <code>retainCount + 4</code>ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬ç†è§£çš„ +1ã€‚</p><p>SIDE_TABLE_RC_ONE å®šä¹‰æ˜¯çš„ 1UL&lt;&lt;2ï¼Œä¹Ÿå°±æ˜¯4ï¼Œæ‰€ä»¥è¿™é‡Œ <code>refcntStorage += SIDE_TABLE_RC_ONE;</code>ã€‚</p><h1 id="release"><a href="#release" class="headerlink" title="release"></a>release</h1><p><strong>objc4-706 NSObject.mm release:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">oneway</span> <span class="keyword">void</span>)release &#123;</span><br><span class="line">    ((<span class="keyword">id</span>)<span class="keyword">self</span>)-&gt;rootRelease();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>objc4-706 objc-object.h rootRelease:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="keyword">bool</span> </span><br><span class="line">objc_object::rootRelease()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (isTaggedPointer()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> sidetable_release(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>objc4-706 NSObject.mm sidetable_release:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rdar://20206767</span></span><br><span class="line"><span class="comment">// return uintptr_t instead of bool so that the various raw-isa </span></span><br><span class="line"><span class="comment">// -release paths all return zero in eax</span></span><br><span class="line">uintptr_t</span><br><span class="line">objc_object::sidetable_release(<span class="keyword">bool</span> performDealloc)</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#if SUPPORT_NONPOINTER_ISA</span></span><br><span class="line">    assert(!isa.nonpointer);</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line">    SideTable&amp; table = SideTables()[<span class="keyword">this</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> do_dealloc = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    table.lock();</span><br><span class="line">    RefcountMap::iterator it = table.refcnts.find(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">if</span> (it == table.refcnts.end()) &#123;</span><br><span class="line">        do_dealloc = <span class="literal">true</span>;</span><br><span class="line">        table.refcnts[<span class="keyword">this</span>] = SIDE_TABLE_DEALLOCATING;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (it-&gt;second &lt; SIDE_TABLE_DEALLOCATING) &#123;</span><br><span class="line">        <span class="comment">// SIDE_TABLE_WEAKLY_REFERENCED may be set. Don't change it.</span></span><br><span class="line">        do_dealloc = <span class="literal">true</span>;</span><br><span class="line">        it-&gt;second |= SIDE_TABLE_DEALLOCATING;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (! (it-&gt;second &amp; SIDE_TABLE_RC_PINNED)) &#123;</span><br><span class="line">        it-&gt;second -= SIDE_TABLE_RC_ONE;</span><br><span class="line">    &#125;</span><br><span class="line">    table.unlock();</span><br><span class="line">    <span class="keyword">if</span> (do_dealloc  &amp;&amp;  performDealloc) &#123;</span><br><span class="line">        ((<span class="keyword">void</span>(*)(objc_object *, SEL))objc_msgSend)(<span class="keyword">this</span>, SEL_dealloc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> do_dealloc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹åé¢å‡ ä¸ªåˆ¤æ–­ã€‚</p><ol><li>å¦‚æœå¯¹è±¡è®°å½•åœ¨å¼•ç”¨è®¡æ•°è¡¨çš„æœ€åä¸€ä¸ªï¼š<code>do_dealloc</code> è®¾ç½®ä¸º trueï¼Œå¼•ç”¨è®¡æ•°æ•°å€¼è®¾ç½®ä¸º SIDE_TABLE_DEALLOCATINGï¼ˆäºŒè¿›åˆ¶ 00000010ï¼‰ã€‚</li><li>å¦‚æœ 8 ä½çš„å¼•ç”¨è®¡æ•°å°äº SIDE_TABLE_DEALLOCATINGï¼ˆäºŒè¿›åˆ¶ 00000010ï¼‰ï¼Œä¹Ÿå°±å¦‚æœæ˜¯ 00000001 æˆ– 00000000ï¼š<code>do_dealloc</code> è®¾ç½®ä¸º trueï¼Œå¹¶æ·»åŠ  deallocating æ ‡è¯†ä½ã€‚ï¼ˆä½†è‡³äºæœ‰ä»€ä¹ˆç”¨ä¸å¤ªç†è§£ï¼Œå¸Œæœ›å“ªä½å¤§ç¥æŒ‡ç‚¹ä¸€ä¸‹ï¼‰ã€‚</li><li>å¦‚æœå·²ç» <code>8 ä½å¼•ç”¨è®¡æ•° &amp; SIDE_TABLE_RC_PINNED</code> ï¼Œå³å¯¹è±¡ä¸åœ¨ deallocatingï¼Œä¸”æ²¡æœ‰è¢«å¼±å¼•ç”¨ï¼Œä¸” 8 ä½æ²¡æœ‰æº¢å‡ºï¼š8 ä½å¼•ç”¨è®¡æ•°å‡å°‘ 4ï¼Œå³çœŸå®å¼•ç”¨è®¡æ•°æ•°å€¼ -1ã€‚</li><li>æœ€åï¼Œå¦‚æœ <code>do_dealloc</code> å’Œ <code>performDealloc</code>ï¼ˆä¼ å…¥æ—¶å°±å·²ç»ä¸º trueï¼‰éƒ½ä¸º tureï¼Œæ‰§è¡Œ SEL_dealloc é‡Šæ”¾å¯¹è±¡ã€‚</li><li>æ–¹æ³•è¿”å› do_deallocã€‚</li></ol><hr><p>å¦‚æœä½ åªæƒ³çŸ¥é“ ARC å¼•ç”¨è®¡æ•°ç›¸å…³ï¼Œé‚£ä¹ˆåªéœ€è¦çœ‹ä¸Šé¢çš„ä»£ç å°±å¯ä»¥äº†ã€‚alloc å’Œ dealloc ä¸»è¦æ˜¯å¯¹å¯¹è±¡çš„ä¸€äº›å†…å­˜åˆ†é…ã€‚</p><hr><h1 id="alloc"><a href="#alloc" class="headerlink" title="alloc"></a>alloc</h1><p>æŸ¥çœ‹ alloc ç›¸å…³ä»£ç ã€‚</p><p><strong>objc4-706 NSObject.mm alloc:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">id</span>)alloc &#123;</span><br><span class="line">    <span class="keyword">return</span> _objc_rootAlloc(<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>objc4-706 NSObject.mm _objc_rootAlloc:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">id</span></span><br><span class="line">_objc_rootAlloc(Class cls)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> callAlloc(cls, <span class="literal">false</span><span class="comment">/*checkNil*/</span>, <span class="literal">true</span><span class="comment">/*allocWithZone*/</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>objc4-706 NSObject.mm callAlloc:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Call [cls alloc] or [cls allocWithZone:nil], with appropriate </span></span><br><span class="line"><span class="comment">// shortcutting optimizations.</span></span><br><span class="line"><span class="keyword">static</span> ALWAYS_INLINE <span class="keyword">id</span></span><br><span class="line">callAlloc(Class cls, <span class="keyword">bool</span> checkNil, <span class="keyword">bool</span> allocWithZone=<span class="literal">false</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (slowpath(checkNil &amp;&amp; !cls)) <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#if __OBJC2__</span></span><br><span class="line">    <span class="keyword">if</span> (fastpath(!cls-&gt;ISA()-&gt;hasCustomAWZ())) &#123;</span><br><span class="line">        <span class="comment">// No alloc/allocWithZone implementation. Go straight to the allocator.</span></span><br><span class="line">        <span class="comment">// fixme store hasCustomAWZ in the non-meta class and </span></span><br><span class="line">        <span class="comment">// add it to canAllocFast's summary</span></span><br><span class="line">        <span class="keyword">if</span> (fastpath(cls-&gt;canAllocFast())) &#123;</span><br><span class="line">            <span class="comment">// No ctors, raw isa, etc. Go straight to the metal.</span></span><br><span class="line">            <span class="keyword">bool</span> dtor = cls-&gt;hasCxxDtor();</span><br><span class="line">            <span class="keyword">id</span> obj = (<span class="keyword">id</span>)calloc(<span class="number">1</span>, cls-&gt;bits.fastInstanceSize());</span><br><span class="line">            <span class="keyword">if</span> (slowpath(!obj)) <span class="keyword">return</span> callBadAllocHandler(cls);</span><br><span class="line">            obj-&gt;initInstanceIsa(cls, dtor);</span><br><span class="line">            <span class="keyword">return</span> obj;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Has ctor or raw isa or something. Use the slower path.</span></span><br><span class="line">            <span class="keyword">id</span> obj = class_createInstance(cls, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (slowpath(!obj)) <span class="keyword">return</span> callBadAllocHandler(cls);</span><br><span class="line">            <span class="keyword">return</span> obj;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// No shortcuts available.</span></span><br><span class="line">    <span class="keyword">if</span> (allocWithZone) <span class="keyword">return</span> [cls allocWithZone:<span class="literal">nil</span>];</span><br><span class="line">    <span class="keyword">return</span> [cls alloc];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿›å…¥æ–¹æ³•åå…ˆè¿›è¡Œ <code>if (slowpath(checkNil &amp;&amp; !cls)) return nil;</code> åˆ¤æ–­ã€‚</p><p><strong>objc4-706 objc-os.h slowpath:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#define fastpath(x) (__builtin_expect(bool(x), 1))</span></span><br><span class="line"><span class="meta">#define slowpath(x) (__builtin_expect(bool(x), 0))</span></span><br></pre></td></tr></table></figure><p><code>__builtin_expect(exp, n)</code> æ–¹æ³•è¡¨ç¤º exp å¾ˆæœ‰å¯èƒ½ä¸º 0ï¼Œè¿”å›å€¼ä¸º expã€‚ä½ å¯ä»¥å°† <code>fastpath(x)</code> ç†è§£æˆçœŸå€¼åˆ¤æ–­ï¼Œ<code>slowpath(x)</code> ç†è§£æˆå‡å€¼åˆ¤æ–­ã€‚</p><p>æ‰€ä»¥ï¼Œæ ¹æ®ä¼ å…¥å€¼ï¼Œ<code>checkNil</code> ä¸º falseï¼Œ<code>checkNil &amp;&amp; !cls</code> ä¹Ÿä¸º falseã€‚é‚£ä¹ˆè¿™é‡Œä¸ä¼šè¿”å› nilã€‚ç»§ç»­å‘ä¸‹é˜…è¯»ã€‚</p><p>å…¶åæ˜¯ä¸€ä¸ª Objective-C 2.0 çš„æ¡ä»¶ç¼–è¯‘æŒ‡ä»¤ã€‚å½“ç„¶æˆ‘ä»¬ç°åœ¨ç”¨çš„éƒ½å±äº Objctive-C 2.0ï¼Œä¼šæ‰§è¡Œå…¶ä¸­ä»£ç ã€‚é¦–å…ˆè¿›è¡Œä¸€ä¸ªåˆ¤æ–­ <code>if (fastpath(!cls-&gt;ISA()-&gt;hasCustomAWZ()))... else ...</code>ï¼Œè¿™æ˜¯åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯å¦æœ‰è‡ªå®šä¹‰çš„ <code>+allocWithZone</code> å®ç°ã€‚</p><p>å¦‚æœæ²¡æœ‰è‡ªå®šä¹‰çš„ <code>+allocWithZone</code> å®ç°ã€‚è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œåˆæ˜¯ä¸€ä¸ªåˆ¤æ–­ï¼š<code>if (fastpath(cls-&gt;canAllocFast()))... else ...</code>ï¼Œè¿™é‡Œåªæœ‰å¯¹è±¡ä¸å­˜åœ¨ã€æ²¡æœ‰ isa ç­‰æƒ…å†µæ‰ä¼šä¸ºçœŸå€¼ã€‚æ‰€ä»¥ä¹‹é—´çœ‹ else å†…å®¹ã€‚</p><p>else ä»£ç å—ä¸­è°ƒç”¨äº† <code>id obj = class_createInstance(cls, 0);</code>ã€‚æŸ¥çœ‹å†…å®¹æ—¶æ³¨æ„æŸ¥çœ‹ <code>objc-runtime-new.h</code> ä¸­çš„å†…å®¹è€Œä¸æ˜¯ <code>objc-runtime-old.mm</code> ä¸­çš„å†…å®¹ï¼ˆä½ å¯ä»¥æ³¨æ„åˆ° <code>objc-runtime-new.h</code> é¡¶éƒ¨çš„ Coptyright æ˜¯ Copyright (c) 2005-2007 Apple Inc.  All Rights Reserved.ï¼‰</p><p>åœ¨ <code>objc-runtime-new.mm</code> ä¸­ <code>canAllocFast()</code> å®šä¹‰å¦‚ä¸‹ï¼š</p><p><strong>objc4-706 objc-runtime-new.h canAllocFast:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#if FAST_ALLOC</span></span><br><span class="line">    <span class="keyword">bool</span> canAllocFast() &#123;</span><br><span class="line">        <span class="keyword">return</span> bits &amp; FAST_ALLOC;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#else</span></span><br><span class="line">    <span class="keyword">bool</span> canAllocFast() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#endif</span></span><br></pre></td></tr></table></figure><p>å†çœ‹ FAST_ALLOC å®šä¹‰ï¼Œè§‚å¯Ÿä¸‹å›¾ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_Advanced-iOS-Study-objc-Memory-2-02.png" alt="FAST_ALLOC"></p><p>å‘ç°ï¼Œ<code>#elif 1</code> ç›´æ¥æ‹¦æˆªäº†ä¸‹é¢çš„ defineï¼Œæ‰€ä»¥ <code>#if FAST_ALLOC</code> ä¸èµ·ä½œç”¨ï¼ˆè¿™é‡Œæˆ‘ä¹Ÿä¸æ˜¯å¾ˆç¡®å®šï¼Œå“ªä½å¤§ç¥æŒ‡ç‚¹ä¸€ä¸‹ï¼‰ã€‚æ‰€ä»¥ï¼Œ<code>canAllocFast()</code> è¿”å› falseï¼Œ<code>fastpath(cls-&gt;canAllocFast())</code> åˆ¤æ–­ä¸ºå‡ã€‚</p><p>æ‰§è¡Œ</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Has ctor or raw isa or something. Use the slower path.</span></span><br><span class="line"><span class="keyword">id</span> obj = class_createInstance(cls, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (slowpath(!obj)) <span class="keyword">return</span> callBadAllocHandler(cls);</span><br><span class="line"><span class="keyword">return</span> obj;</span><br></pre></td></tr></table></figure><p><strong>objc4 objc-runtime-new.mm class_createInstance:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">id</span> </span><br><span class="line">class_createInstance(Class cls, size_t extraBytes)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _class_createInstanceFromZone(cls, extraBytes, <span class="literal">nil</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>objc4 objc-runtime-new.mm _class_createInstanceFromZone:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">id</span> </span><br><span class="line">_class_createInstanceFromZone(Class cls, size_t extraBytes, <span class="keyword">void</span> *zone)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">void</span> *bytes;</span><br><span class="line">    size_t size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Can't create something for nothing</span></span><br><span class="line">    <span class="keyword">if</span> (!cls) <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Allocate and initialize</span></span><br><span class="line">    size = cls-&gt;alignedInstanceSize() + extraBytes;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// CF requires all objects be at least 16 bytes.</span></span><br><span class="line">    <span class="keyword">if</span> (size &lt; <span class="number">16</span>) size = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (zone) &#123;</span><br><span class="line">        bytes = malloc_zone_calloc((malloc_zone_t *)zone, <span class="number">1</span>, size);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        bytes = calloc(<span class="number">1</span>, size);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> objc_constructInstance(cls, bytes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼ å…¥çš„ <code>extraBytes</code> ä¸º0ï¼Œ<code>zone</code> ä¸º nilï¼Œé‚£ä¹ˆä¸»è¦æ‰§è¡Œçš„è¯­å¥æ˜¯ <code>bytes = calloc(1, size);</code> å’Œ <code>return objc_constructInstance(cls, bytes);</code>ã€‚bytes æ˜¯å¯¹è±¡æ‰€éœ€å†…å­˜ç©ºé—´ã€‚</p><blockquote><p><strong>FYI:</strong><br><code>calloc(size_t __count, size_t __size)</code> æ˜¯ C è¯­è¨€ä¸­çš„æ–¹æ³•ï¼Œç”¨æ¥åœ¨å†…å­˜çš„åŠ¨æ€å­˜å‚¨åŒºä¸­åˆ†é… n ä¸ªé•¿åº¦ä¸ºsizeçš„è¿ç»­ç©ºé—´ï¼Œå‡½æ•°è¿”å›ä¸€ä¸ªæŒ‡å‘åˆ†é…èµ·å§‹åœ°å€çš„æŒ‡é’ˆã€‚å¦‚æœåˆ†é…ä¸æˆåŠŸï¼Œè¿”å›NULLã€‚</p></blockquote><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">objc_constructInstance(Class cls, <span class="keyword">void</span> *bytes) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!cls  ||  !bytes) <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">id</span> obj = (<span class="keyword">id</span>)bytes;</span><br><span class="line"></span><br><span class="line">    obj-&gt;initIsa(cls);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (cls-&gt;hasCxxCtor()) &#123;</span><br><span class="line">        <span class="keyword">return</span> object_cxxConstructFromClass(obj, cls);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>objc_constructInstance</code> æ–¹æ³•ä¸­ï¼Œå°† <code>bytes</code>ï¼ˆæŒ‡å‘åˆ†å¯¹è±¡çš„æŒ‡é’ˆï¼‰å®šä¹‰ä¸º <code>obj</code>ï¼Œå¹¶å°† <code>obj</code> çš„ isa èµ‹å€¼ä¸ºä¼ å…¥çš„ clsã€‚æœ€åè¿”å› objã€‚</p><blockquote><p><strong>FYI:</strong><br>hasCxxCtor() æ˜¯åˆ¤æ–­å½“å‰ class æˆ–è€… superclass æ˜¯å¦æœ‰ .cxx_construct æ„é€ æ–¹æ³•çš„å®ç°ã€‚<br>hasCxxDtor() æ˜¯åˆ¤æ–­åˆ¤æ–­å½“å‰ class æˆ–è€… superclass æ˜¯å¦æœ‰ .cxx_destruct ææ„æ–¹æ³•çš„å®ç°ã€‚<br>å‚è€ƒï¼š<a href="http://ios.jobbole.com/90310/" target="_blank" rel="noopener">Objc å¯¹è±¡çš„ä»Šç”Ÿä»Šä¸–</a></p></blockquote><h1 id="dealloc"><a href="#dealloc" class="headerlink" title="dealloc"></a>dealloc</h1><p>æ‰¾åˆ° dealloc çš„å®ç°ã€‚</p><p><strong>objc4 NSObject.mm dealloc:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">    _objc_rootDealloc(<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>objc4 NSObject.mm _objc_rootDealloc:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span></span><br><span class="line">_objc_rootDealloc(<span class="keyword">id</span> obj)</span><br><span class="line">&#123;</span><br><span class="line">    assert(obj);</span><br><span class="line"></span><br><span class="line">    obj-&gt;rootDealloc();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>objc4 NSObject.mm _objc_rootDealloc:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="keyword">void</span></span><br><span class="line">objc_object::rootDealloc()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (isTaggedPointer()) <span class="keyword">return</span>;</span><br><span class="line">    object_dispose((<span class="keyword">id</span>)<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>FYI:</strong><br><a href="http://blog.devtang.com/2014/05/30/understand-tagged-pointer/" target="_blank" rel="noopener">æ·±å…¥ç†è§£Tagged Pointer</a></p></blockquote><p><strong>objc4 objc-runtime-new.mm object_dispose:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">id</span> </span><br><span class="line">object_dispose(<span class="keyword">id</span> obj)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!obj) <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line"></span><br><span class="line">    objc_destructInstance(obj);    </span><br><span class="line">    free(obj);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>objc4 objc-runtime-new.mm objc_destructInstance:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***********************************************************************</span></span><br><span class="line"><span class="comment">* objc_destructInstance</span></span><br><span class="line"><span class="comment">* Destroys an instance without freeing memory. </span></span><br><span class="line"><span class="comment">* Calls C++ destructors.</span></span><br><span class="line"><span class="comment">* Calls ARC ivar cleanup.</span></span><br><span class="line"><span class="comment">* Removes associative references.</span></span><br><span class="line"><span class="comment">* Returns `obj`. Does nothing if `obj` is nil.</span></span><br><span class="line"><span class="comment">**********************************************************************/</span></span><br><span class="line"><span class="keyword">void</span> *objc_destructInstance(<span class="keyword">id</span> obj) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (obj) &#123;</span><br><span class="line">        <span class="comment">// Read all of the flags at once for performance.</span></span><br><span class="line">        <span class="keyword">bool</span> cxx = obj-&gt;hasCxxDtor();</span><br><span class="line">        <span class="keyword">bool</span> assoc = obj-&gt;hasAssociatedObjects();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// This order is important.</span></span><br><span class="line">        <span class="keyword">if</span> (cxx) object_cxxDestruct(obj);</span><br><span class="line">        <span class="keyword">if</span> (assoc) _object_remove_assocations(obj);</span><br><span class="line">        obj-&gt;clearDeallocating();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>objc4 objc-object.h clearDeallocating:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="keyword">void</span> </span><br><span class="line">objc_object::clearDeallocating()</span><br><span class="line">&#123;</span><br><span class="line">    sidetable_clearDeallocating();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>objc4 NSObject.mm sidetable_clearDeallocating:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> </span><br><span class="line">objc_object::sidetable_clearDeallocating()</span><br><span class="line">&#123;</span><br><span class="line">    SideTable&amp; table = SideTables()[<span class="keyword">this</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// clear any weak table items</span></span><br><span class="line">    <span class="comment">// clear extra retain count and deallocating bit</span></span><br><span class="line">    <span class="comment">// (fixme warn or abort if extra retain count == 0 ?)</span></span><br><span class="line">    table.lock();</span><br><span class="line">    RefcountMap::iterator it = table.refcnts.find(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">if</span> (it != table.refcnts.end()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (it-&gt;second &amp; SIDE_TABLE_WEAKLY_REFERENCED) &#123;</span><br><span class="line">            weak_clear_no_lock(&amp;table.weak_table, (<span class="keyword">id</span>)<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        table.refcnts.erase(it);</span><br><span class="line">    &#125;</span><br><span class="line">    table.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œ<code>objc_destructInstance(obj);</code> ä¸­è¿›è¡Œäº†é”€æ¯å®ä¾‹ä½†ä¸é‡Šæ”¾å†…å­˜ï¼Œè°ƒç”¨äº† C++ çš„ææ„å‡½æ•°ï¼ˆå¦‚æœå¯¹è±¡æœ‰ï¼‰ï¼Œå¤„ç†å…ˆå…³çš„å¯¹è±¡ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œæœ€åè°ƒç”¨ <code>obj-&gt;clearDeallocating();</code> æ¸…é™¤ weak å¼•ç”¨ã€æ¸…é™¤å¤šä½™çš„ retain countã€‚<code>objc_destructInstance(obj);</code> ä¹‹åæ˜¯ <code>free(obj);</code> é‡Šæ”¾ obj å ç”¨çš„å†…å­˜ç©ºé—´ã€‚</p><p>#Other</p><p>ï¼ˆåœ¨å†™è¿™è¾¹æ–‡ç« çš„æ—¶å€™ï¼Œæˆ‘æ€ä¹ˆæ„Ÿè§‰æˆ‘æœ€å¤§çš„æ„Ÿè§¦æ˜¯ï¼ŒC++ ä¸æ‡‚ã€‚ã€‚ï¼‰</p><p>å†™æœ¬ç¯‡åšæ–‡æ—¶å‚è€ƒçš„æ‰€æœ‰èµ„æ–™ï¼š</p><blockquote><p><a href="http://blog.tracyone.com/2015/06/14/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAARC-%E4%B8%8A/" target="_blank" rel="noopener">Tracy Wang-æ·±å…¥æµ…å‡ºARC(ä¸Š)</a></p><p><a href="http://www.jianshu.com/p/ff8a7c458c96" target="_blank" rel="noopener">åŸæ¥æˆ‘éä¸å¿«ä¹-æˆ‘ä»¬çš„å¯¹è±¡ä¼šç»å†ä»€ä¹ˆ</a></p><p><a href="http://www.desgard.com/weak/" target="_blank" rel="noopener">desgard-weak å¼±å¼•ç”¨çš„å®ç°æ–¹å¼</a></p><p><a href="http://ios.jobbole.com/90310/" target="_blank" rel="noopener">Objc å¯¹è±¡çš„ä»Šç”Ÿä»Šä¸–</a></p><p><a href="http://yulingtianxia.com/blog/2015/12/06/The-Principle-of-Refenrence-Counting/" target="_blank" rel="noopener">ç‰ä»¤å¤©ä¸‹-Objective-C å¼•ç”¨è®¡æ•°åŸç†</a></p><p><a href="http://www.jianshu.com/p/9d649ce6d0b8" target="_blank" rel="noopener">ä¸€ç¼•æ®‡æµåŒ–éšåŠè¾¹å†°éœœ-ç¥ç»ç—…é™¢Objective-C Runtimeå…¥é™¢ç¬¬ä¸€å¤©â€”â€”isaå’ŒClass</a></p><p><a href="http://sindrilin.com/runtime/2016/12/23/é—²èŠå†…å­˜ç®¡ç†" target="_blank" rel="noopener">sindrilin-é—²èŠå†…å­˜ç®¡ç†</a></p></blockquote><hr><p>æœ‰ä»€ä¹ˆé—®é¢˜éƒ½å¯ä»¥åœ¨åšæ–‡åé¢ç•™è¨€ï¼Œæˆ–è€…å¾®åšä¸Šç§ä¿¡æˆ‘ï¼Œæˆ–è€…é‚®ä»¶æˆ‘ <a href="mailto:&#x63;&#111;&#100;&#x65;&#x72;&#102;&#x69;&#x73;&#x68;&#64;&#49;&#54;&#x33;&#x2e;&#99;&#x6f;&#x6d;" target="_blank" rel="noopener">&#x63;&#111;&#100;&#x65;&#x72;&#102;&#x69;&#x73;&#x68;&#64;&#49;&#54;&#x33;&#x2e;&#99;&#x6f;&#x6d;</a>ã€‚</p><p>åšä¸»æ˜¯ iOS å¦¹å­ä¸€æšã€‚</p><p>å¸Œæœ›å¤§å®¶ä¸€èµ·è¿›æ­¥ã€‚</p><p>æˆ‘çš„å¾®åšï¼š<a href="http://weibo.com/coderfish/" target="_blank" rel="noopener">å°é±¼å‘¨å‡Œå®‡</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨å†™ ã€&lt;a href=&quot;http://zhoulingyu.com/2017/02/08/iOSè¿›é˜¶â€”â€”iOS-Memory-Block/&quot;&gt;iOSï¼ˆObjective-Cï¼‰ å†…å­˜ç®¡ç†&amp;amp;Block&lt;/a&gt;ã€ ä¸€æ–‡æ—¶ï¼Œæˆ‘å¹¶æ²¡æœ‰å‘ç° NSObject çš„ä»£ç å·²ç»è¢«å¼€æºäº†ï¼Œæ‰€ä»¥åˆ†æçš„ä¸»è¦æ˜¯ GNUStep çš„æºç ï¼Œå¯¹ Apple çš„éƒ¨åˆ†åªæ˜¯é€šè¿‡çŒœæµ‹ã€‚&lt;/p&gt;
&lt;p&gt;å®è´¨ä¸Šï¼ŒNSObject çš„å®ç°å†…å®¹å·²ç»å¼€æºåœ¨ &lt;a href=&quot;https://opensource.apple.com/tarballs/objc4/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;objc4-706&lt;/a&gt; ä¸­ã€‚äºæ˜¯æˆ‘ä¾¿å¼€å§‹å­¦ä¹  objc4 ä¸­çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢å°±å’Œå¤§å®¶æ‰’ä¸€æ‰’ Apple çš„ NSObject å†…å­˜ç®¡ç†çš„ä¸€äº›å†…å®¹ã€‚&lt;/p&gt;
&lt;h1 id=&quot;SideTable&quot;&gt;&lt;a href=&quot;#SideTable&quot; class=&quot;headerlink&quot; title=&quot;SideTable&quot;&gt;&lt;/a&gt;SideTable&lt;/h1&gt;&lt;p&gt;æ‰¾åˆ° NSObject.mmï¼Œé¦–å…ˆæ¥ä¸€äº›éå¸¸é‡è¦çš„ä¿¡æ¯ï¼Œä»¥ä¾¿åé¢çš„ç†è§£ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;objc4-706 NSObject.mm SideTable:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; SideTable &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// ä¿è¯åŸå­æ“ä½œçš„è‡ªæ—‹é”&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    spinlock_t slock;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å¼•ç”¨è®¡æ•°çš„ hash è¡¨&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RefcountMap refcnts;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// weak å¼•ç”¨å…¨å±€ hash è¡¨&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    weak_table_t weak_table;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://zhoulingyu.com/categories/iOS/"/>
    
      <category term="iOSè¿›é˜¶" scheme="http://zhoulingyu.com/categories/iOS/iOS%E8%BF%9B%E9%98%B6/"/>
    
    
      <category term="iOS" scheme="http://zhoulingyu.com/tags/iOS/"/>
    
      <category term="å†…å­˜ä¸å¼•ç”¨" scheme="http://zhoulingyu.com/tags/%E5%86%85%E5%AD%98%E4%B8%8E%E5%BC%95%E7%94%A8/"/>
    
      <category term="iOSè¿›é˜¶" scheme="http://zhoulingyu.com/tags/iOS%E8%BF%9B%E9%98%B6/"/>
    
  </entry>
  
  <entry>
    <title>iOSè¿›é˜¶â€”â€”iOSï¼ˆObjective-Cï¼‰ å†…å­˜ç®¡ç†&amp;Block</title>
    <link href="http://zhoulingyu.com/2017/02/08/iOS%E8%BF%9B%E9%98%B6%E2%80%94%E2%80%94iOS-Memory-Block/"/>
    <id>http://zhoulingyu.com/2017/02/08/iOSè¿›é˜¶â€”â€”iOS-Memory-Block/</id>
    <published>2017-02-08T15:33:40.000Z</published>
    <updated>2018-07-10T03:07:31.628Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬ä¸€ç¯‡-iOS-å†…å­˜ç®¡ç†"><a href="#ç¬¬ä¸€ç¯‡-iOS-å†…å­˜ç®¡ç†" class="headerlink" title="ç¬¬ä¸€ç¯‡ iOS å†…å­˜ç®¡ç†"></a>ç¬¬ä¸€ç¯‡ iOS å†…å­˜ç®¡ç†</h1><h2 id="1-ä¼¼ä¹æ¯ä¸ªäººåœ¨å­¦ä¹ -iOS-è¿‡ç¨‹ä¸­éƒ½è€ƒè™‘è¿‡çš„é—®é¢˜"><a href="#1-ä¼¼ä¹æ¯ä¸ªäººåœ¨å­¦ä¹ -iOS-è¿‡ç¨‹ä¸­éƒ½è€ƒè™‘è¿‡çš„é—®é¢˜" class="headerlink" title="1 ä¼¼ä¹æ¯ä¸ªäººåœ¨å­¦ä¹  iOS è¿‡ç¨‹ä¸­éƒ½è€ƒè™‘è¿‡çš„é—®é¢˜"></a>1 ä¼¼ä¹æ¯ä¸ªäººåœ¨å­¦ä¹  iOS è¿‡ç¨‹ä¸­éƒ½è€ƒè™‘è¿‡çš„é—®é¢˜</h2><ol><li>alloc retain release delloc åšäº†ä»€ä¹ˆï¼Ÿ</li><li>autoreleasepool æ˜¯æ€æ ·å®ç°çš„ï¼Ÿ</li><li>__unsafe_unretained æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>Block æ˜¯æ€æ ·å®ç°çš„</li><li>ä»€ä¹ˆæ—¶å€™ä¼šå¼•èµ·å¾ªç¯å¼•ç”¨ï¼Œä»€ä¹ˆæ—¶å€™ä¸ä¼šå¼•èµ·å¾ªç¯å¼•ç”¨ï¼Ÿ</li></ol><p>æ‰€ä»¥æˆ‘å°†åœ¨æœ¬ç¯‡åšæ–‡ä¸­è¯¦ç»†çš„ä» ARC è§£é‡Šåˆ° iOS çš„å†…å­˜ç®¡ç†ï¼Œä»¥åŠ Block ç›¸å…³çš„åŸç†ã€æºç ã€‚</p><h2 id="2-ä»-ARC-è¯´èµ·"><a href="#2-ä»-ARC-è¯´èµ·" class="headerlink" title="2 ä» ARC è¯´èµ·"></a>2 ä» ARC è¯´èµ·</h2><p>è¯´ iOS çš„å†…å­˜ç®¡ç†ï¼Œå°±ä¸å¾—ä¸ä» ARCï¼ˆAutomatic Reference Counting / è‡ªåŠ¨å¼•ç”¨è®¡æ•°ï¼‰ è¯´èµ·ï¼Œ ARC æ˜¯ WWDC2011 å’Œ iOS5 å¼•å…¥çš„å˜åŒ–ã€‚ARC æ˜¯ LLVM 3.0 ç¼–è¯‘å™¨çš„ç‰¹æ€§ï¼Œç”¨æ¥è‡ªåŠ¨ç®¡ç†å†…å­˜ã€‚</p><p>ä¸ Java ä¸­ GC ä¸åŒï¼ŒARC æ˜¯ç¼–è¯‘å™¨ç‰¹æ€§ï¼Œè€Œä¸æ˜¯åŸºäºè¿è¡Œæ—¶çš„ï¼Œæ‰€ä»¥ ARC å…¶å®æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µè‡ªåŠ¨å¸®å¼€å‘è€…æ’å…¥äº†ç®¡ç†å†…å­˜çš„ä»£ç ï¼Œè€Œä¸æ˜¯å®æ—¶ç›‘æ§ä¸å›æ”¶å†…å­˜ã€‚</p><a id="more"></a><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS%E8%BF%9B%E9%98%B6%E2%80%94%E2%80%94iOS%20%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86&amp;Block-01.png" alt="ARC ç®¡ç†å†…å­˜"></p><p>ARC çš„å†…å­˜ç®¡ç†è§„åˆ™å¯ä»¥ç®€è¿°ä¸ºï¼š</p><blockquote><ol><li>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªã€è¢«å¼•ç”¨è®¡æ•°ã€</li><li>å¯¹è±¡è¢«æŒæœ‰ï¼Œã€è¢«å¼•ç”¨è®¡æ•°ã€+1</li><li>å¯¹è±¡è¢«æ”¾å¼ƒæŒæœ‰ï¼Œã€è¢«å¼•ç”¨è®¡æ•°ã€-1</li><li>ã€å¼•ç”¨è®¡æ•°ã€=0ï¼Œé‡Šæ”¾å¯¹è±¡</li></ol></blockquote><h2 id="3-ä½ éœ€è¦çŸ¥é“"><a href="#3-ä½ éœ€è¦çŸ¥é“" class="headerlink" title="3 ä½ éœ€è¦çŸ¥é“"></a>3 ä½ éœ€è¦çŸ¥é“</h2><p><del>1. åŒ…å« NSObject ç±»çš„ Foundation æ¡†æ¶å¹¶æ²¡æœ‰å…¬å¼€</del><br>ï¼ˆæ­¤å¤„é”™è¯¯ï¼Œæ„Ÿè°¢ <a href="http://www.jianshu.com/u/486bf26e8dce" target="_blank" rel="noopener">é…·é…·çš„å“€æ®¿</a> çš„æŒ‡å‡ºï¼‰</p><ol><li>Foundation æ¡†æ¶æ˜¯éå¼€æºçš„ï¼Œä½†æ˜¯ NSObject è¢«åŒ…å«åœ¨ <a href="https://opensource.apple.com/source/objc4/objc4-706/runtime/NSObject.mm" target="_blank" rel="noopener">obj4</a> ä¸­ï¼Œè¯¥åº“å·²å¼€æºã€‚</li><li>Core Foundation æ¡†æ¶æºä»£ç ï¼Œä»¥åŠé€šè¿‡ NSObject è¿›è¡Œå†…å­˜ç®¡ç†çš„éƒ¨åˆ†æºä»£ç æ˜¯å…¬å¼€çš„ã€‚</li><li>GNUstep æ˜¯ Foundation æ¡†æ¶çš„äº’æ¢æ¡†æ¶</li></ol><blockquote><p>GNUstep ä¹Ÿæ˜¯ GNU è®¡åˆ’ä¹‹ä¸€ã€‚å°† Cocoa Objective-C è½¯ä»¶åº“ä»¥è‡ªç”±è½¯ä»¶æ–¹å¼é‡æ–°å®ç°<br>æŸç§æ„ä¹‰ä¸Šï¼ŒGNUstep å’Œ Foundation æ¡†æ¶çš„å®ç°æ˜¯ç›¸ä¼¼çš„<br>é€šè¿‡ GNUstep çš„æºç æ¥åˆ†æ Foundation çš„å†…å­˜ç®¡ç†</p></blockquote><h2 id="4-alloc-retain-release-dealloc-çš„å®ç°"><a href="#4-alloc-retain-release-dealloc-çš„å®ç°" class="headerlink" title="4 alloc retain release dealloc çš„å®ç°"></a>4 alloc retain release dealloc çš„å®ç°</h2><h3 id="4-1-GNU-alloc"><a href="#4-1-GNU-alloc" class="headerlink" title="4.1 GNU - alloc"></a>4.1 GNU - alloc</h3><p>æŸ¥çœ‹ GNUStep ä¸­çš„ alloc å‡½æ•°ã€‚</p><p><strong>GNUstep/modules/core/base/Source/NSObject.m alloc:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">id</span>) alloc</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> [<span class="keyword">self</span> allocWithZone: <span class="built_in">NSDefaultMallocZone</span>()];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">id</span>) allocWithZone: (<span class="built_in">NSZone</span>*)z</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">NSAllocateObject</span> (<span class="keyword">self</span>, <span class="number">0</span>, z);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>GNUstep/modules/core/base/Source/NSObject.m NSAllocateObject:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> obj_layout &#123;</span><br><span class="line">    <span class="built_in">NSUInteger</span> retained;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSAllocateObject</span>(Class aClass, <span class="built_in">NSUInteger</span> extraBytes, <span class="built_in">NSZone</span> *zone)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span>size = è®¡ç®—å®¹çº³å¯¹è±¡æ‰€éœ€å†…å­˜å¤§å°;</span><br><span class="line">    <span class="keyword">id</span>new = <span class="built_in">NSZoneCalloc</span>(zone, <span class="number">1</span>, size);</span><br><span class="line">    memset (new, <span class="number">0</span>, size);</span><br><span class="line">    new = (<span class="keyword">id</span>)&amp;((obj)new)[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>NSAllocateObject</code> å‡½æ•°é€šè¿‡è°ƒç”¨ <code>NSZoneCalloc</code> å‡½æ•°æ¥åˆ†é…å­˜æ”¾å¯¹è±¡æ‰€éœ€çš„ç©ºé—´ï¼Œä¹‹åå°†è¯¥å†…å­˜ç©ºé—´ç½®ä¸º nilï¼Œæœ€åè¿”å›ä½œä¸ºå¯¹è±¡è€Œä½¿ç”¨çš„æŒ‡é’ˆã€‚</p><p>æˆ‘ä»¬å°†ä¸Šé¢çš„ä»£ç åšç®€åŒ–æ•´ç†ï¼š</p><p><strong>GNUstep/modules/core/base/Source/NSObject.m alloc ç®€åŒ–ç‰ˆæœ¬:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> obj_layout &#123;</span><br><span class="line">    <span class="built_in">NSUInteger</span> retained;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">id</span>) alloc</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> size = <span class="keyword">sizeof</span>(<span class="keyword">struct</span> obj_layout) + å¯¹è±¡å¤§å°;</span><br><span class="line">    <span class="keyword">struct</span> obj_layout *p = (<span class="keyword">struct</span> obj_layout *)calloc(<span class="number">1</span>, size);</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">id</span>)(p+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> allocWithZone: <span class="built_in">NSDefaultMallocZone</span>()];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>alloc ç±»æ–¹æ³•ç”¨ struct obj_layout ä¸­çš„ <code>retained</code> æ•´æ•°æ¥ä¿å­˜å¼•ç”¨è®¡æ•°ï¼Œå¹¶å°†å…¶å†™å…¥å¯¹è±¡çš„å†…å­˜å¤´éƒ¨ï¼Œè¯¥å¯¹è±¡å†…å­˜å—å…¨éƒ¨ç½®ä¸º 0 åè¿”å›ã€‚</p><p>ä¸€ä¸ªå¯¹è±¡çš„è¡¨ç¤ºä¾¿å¦‚ä¸‹å›¾ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS%E8%BF%9B%E9%98%B6%E2%80%94%E2%80%94iOS%20%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86&amp;Block-02.png" alt="GNU ä¸­çš„å¯¹è±¡å­˜å‚¨ç©ºé—´"></p><h3 id="4-2-GNU-retain"><a href="#4-2-GNU-retain" class="headerlink" title="4.2 GNU - retain"></a>4.2 GNU - retain</h3><p><strong>GNUstep/modules/core/base/Source/NSObject.m retainCount:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSUInteger</span>) retainCount</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">NSExtraRefCount</span>(<span class="keyword">self</span>) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="built_in">NSUInteger</span></span><br><span class="line"><span class="built_in">NSExtraRefCount</span>(<span class="keyword">id</span> anObject)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> ((obj_layout)anObject)[<span class="number">-1</span>].retained;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>GNUstep/modules/core/base/Source/NSObject.m retain:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>) <span class="keyword">retain</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">NSIncrementExtraRefCount</span>(<span class="keyword">self</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">void</span></span><br><span class="line"><span class="built_in">NSIncrementExtraRefCount</span>(<span class="keyword">id</span> anObject)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (((obj)anObject)[<span class="number">-1</span>].retained == <span class="built_in">UINT_MAX</span> - <span class="number">1</span>)</span><br><span class="line">    [<span class="built_in">NSException</span> raise: <span class="built_in">NSInternalInconsistencyException</span></span><br><span class="line">      format: <span class="string">@"NSIncrementExtraRefCount() asked to increment too farâ€];</span></span><br><span class="line"><span class="string">  ((obj_layout)anObject)[-1].retained++;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç ä¸­ï¼Œ <code>NSIncrementExtraRefCount</code> æ–¹æ³•é¦–å…ˆå†™å…¥äº†å½“ <code>retained</code> å˜é‡è¶…å‡ºæœ€å¤§å€¼æ—¶å‘ç”Ÿå¼‚å¸¸çš„ä»£ç ï¼ˆå› ä¸º <code>retained</code> æ˜¯ NSUInteger å˜é‡ï¼‰ï¼Œç„¶åè¿›è¡Œ <code>retain ++</code> ä»£ç ã€‚</p><h3 id="4-3-GNU-release"><a href="#4-3-GNU-release" class="headerlink" title="4.3 GNU - release"></a>4.3 GNU - release</h3><p>å’Œ retain ç›¸åº”çš„ï¼Œrelease æ–¹æ³•åšçš„å°±æ˜¯ <code>retain --</code>ã€‚</p><p><strong>GNUstep/modules/core/base/Source/NSObject.m release</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">oneway</span> <span class="keyword">void</span>) release</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">NSDecrementExtraRefCountWasZero</span>(<span class="keyword">self</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      [<span class="keyword">self</span> dealloc];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">BOOL</span></span><br><span class="line"><span class="built_in">NSDecrementExtraRefCountWasZero</span>(<span class="keyword">id</span> anObject)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (((obj)anObject)[<span class="number">-1</span>].retained == <span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line">  ((obj)anObject)[<span class="number">-1</span>].retained--;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-4-GNU-dealloc"><a href="#4-4-GNU-dealloc" class="headerlink" title="4.4 GNU - dealloc"></a>4.4 GNU - dealloc</h3><p>dealloc å°†ä¼šå¯¹å¯¹è±¡è¿›è¡Œé‡Šæ”¾ã€‚</p><p><strong>GNUstep/modules/core/base/Source/NSObject.m dealloc:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>) dealloc</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">NSDeallocateObject</span> (<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">void</span></span><br><span class="line"><span class="built_in">NSDeallocateObject</span>(<span class="keyword">id</span> anObject)</span><br><span class="line">&#123;</span><br><span class="line">  obj_layout o = &amp;((obj_layout)anObject)[<span class="number">-1</span>];</span><br><span class="line">  free(o);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-5-Apple-å®ç°"><a href="#4-5-Apple-å®ç°" class="headerlink" title="4.5 Apple å®ç°"></a>4.5 Apple å®ç°</h3><p>åœ¨ Xcode ä¸­ è®¾ç½® <code>Debug</code> -&gt; <code>Debug Workflow</code> -&gt; <code>Always Show Disassenbly</code> æ‰“å¼€ã€‚è¿™æ ·åœ¨æ‰“æ–­ç‚¹åï¼Œå¯ä»¥çœ‹åˆ°æ›´è¯¦ç»†çš„æ–¹æ³•è°ƒç”¨ã€‚</p><p>é€šè¿‡åœ¨ NSObject ç±»çš„ alloc ç­‰æ–¹æ³•ä¸Šè®¾ç½®æ–­ç‚¹è¿½è¸ªå¯ä»¥çœ‹åˆ°å‡ ä¸ªæ–¹æ³•å†…éƒ¨åˆ†åˆ«è°ƒç”¨äº†ï¼š</p><p><strong>retainCount</strong></p><blockquote><p>__CFdoExternRefOperation<br>CFBasicHashGetCountOfKey</p></blockquote><p><strong>retain</strong></p><blockquote><p>__CFdoExternRefOperation<br>CFBasicHashAddValue</p></blockquote><p><strong>release</strong></p><blockquote><p>__CFdoExternRefOperation<br>CFBasicHashRemoveValue</p></blockquote><p>å¯ä»¥çœ‹åˆ°ä»–ä»¬éƒ½è°ƒç”¨äº†ä¸€ä¸ªå…±åŒçš„ <code>__CFdoExternRefOperation</code> æ–¹æ³•ã€‚</p><p>è¯¥æ–¹æ³•ä»å‰ç¼€å¯ä»¥çœ‹åˆ°æ˜¯åŒ…å«åœ¨ Core Foundationï¼Œåœ¨ CFRuntime.c ä¸­å¯ä»¥æ‰¾åˆ°ï¼Œåšç®€åŒ–ååˆ—å‡ºæºç ï¼š</p><p><strong>CFRuntime.c __CFDoExternRefOperation:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __CFDoExternRefOperation(uintptr_t op, <span class="keyword">id</span> obj) &#123;</span><br><span class="line">    <span class="built_in">CFBasicHashRef</span> table = å–å¾—å¯¹è±¡çš„æ•£åˆ—è¡¨(obj);</span><br><span class="line">    <span class="keyword">int</span> count;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">switch</span> (op) &#123;</span><br><span class="line">        <span class="keyword">case</span> OPERATION_retainCount:</span><br><span class="line">        count = <span class="built_in">CFBasicHashGetCountOfKey</span>(table, obj);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> OPERATION_retain:</span><br><span class="line">        count = <span class="built_in">CFBasicHashAddValue</span>(table, obj);</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">        <span class="keyword">case</span> OPERATION_release:</span><br><span class="line">        count = <span class="built_in">CFBasicHashRemoveValue</span>(table, obj);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> == count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ <code>__CFDoExternRefOperation</code> æ˜¯é’ˆå¯¹ä¸åŒçš„æ“ä½œï¼Œè¿›è¡Œå…·ä½“çš„æ–¹æ³•è°ƒç”¨ï¼Œå¦‚æœ op æ˜¯ <code>OPERATION_retain</code>ï¼Œå°±å»æ‰ç”¨å…·ä½“å®ç° retain çš„æ–¹æ³•ã€‚</p><p>ä» <code>BasicHash</code> è¿™æ ·çš„æ–¹æ³•åå¯ä»¥çœ‹å‡ºï¼Œå…¶å®å¼•ç”¨è®¡æ•°è¡¨å°±æ˜¯æ•£åˆ—è¡¨ã€‚</p><p>key ä¸º hash(å¯¹è±¡çš„åœ°å€) value ä¸º å¼•ç”¨è®¡æ•°ã€‚</p><p>ä¸‹å›¾æ˜¯ Apple å’Œ GNU çš„å®ç°å¯¹æ¯”ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS%E8%BF%9B%E9%98%B6%E2%80%94%E2%80%94iOS%20%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86&amp;Block-03.png" alt="Apple å’Œ GNU å†…å­˜ç®¡ç†çš„å®ç°å¯¹æ¯”"></p><h2 id="5-autorelease-å’Œ-autorelaesepool"><a href="#5-autorelease-å’Œ-autorelaesepool" class="headerlink" title="5 autorelease å’Œ autorelaesepool"></a>5 autorelease å’Œ autorelaesepool</h2><p>åœ¨è‹¹æœå¯¹äº NSAutoreleasePool çš„<a href="https://developer.apple.com/reference/foundation/nsautoreleasepool" target="_blank" rel="noopener">æ–‡æ¡£</a>ä¸­è¡¨ç¤ºï¼š</p><blockquote><p>æ¯ä¸ªçº¿ç¨‹ï¼ˆåŒ…æ‹¬ä¸»çº¿ç¨‹ï¼‰ï¼Œéƒ½ç»´æŠ¤äº†ä¸€ä¸ªç®¡ç† NSAutoreleasePool çš„æ ˆã€‚å½“åˆ›å…ˆæ–°çš„ Pool æ—¶ï¼Œä»–ä»¬ä¼šè¢«æ·»åŠ åˆ°æ ˆé¡¶ã€‚å½“ Pool è¢«é”€æ¯æ—¶ï¼Œä»–ä»¬ä¼šè¢«ä»æ ˆä¸­ç§»é™¤ã€‚<br>autorelease çš„å¯¹è±¡ä¼šè¢«æ·»åŠ åˆ°å½“å‰çº¿ç¨‹çš„æ ˆé¡¶çš„ Pool ä¸­ã€‚å½“ Pool è¢«é”€æ¯ï¼Œå…¶ä¸­çš„å¯¹è±¡ä¹Ÿä¼šè¢«é‡Šæ”¾ã€‚<br>å½“çº¿ç¨‹ç»“æŸæ—¶ï¼Œæ‰€æœ‰çš„ Pool è¢«é”€æ¯é‡Šæ”¾ã€‚</p></blockquote><p>å¯¹ NSAutoreleasePool ç±»æ–¹æ³•å’Œ autorelease æ–¹æ³•æ‰“æ–­ç‚¹ï¼ŒæŸ¥çœ‹å…¶è¿è¡Œè¿‡ç¨‹ï¼Œå¯ä»¥çœ‹åˆ°è°ƒç”¨äº†ä»¥ä¸‹å‡½æ•°ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSAutoreleasePool</span> *pool = [[<span class="built_in">NSAutoreleasePool</span> alloc] init];</span><br><span class="line"><span class="comment">// ç­‰åŒäº objc_autoreleasePoolPush</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">id</span> obj = [[<span class="built_in">NSObject</span> alloc] init];</span><br><span class="line">[obj autorelease];</span><br><span class="line"><span class="comment">//  ç­‰åŒäº objc_autorelease(obj)</span></span><br><span class="line">    </span><br><span class="line">[<span class="built_in">NSAutoreleasePool</span> showPools];</span><br><span class="line"><span class="comment">// æŸ¥çœ‹ NSAutoreleasePool çŠ¶å†µ</span></span><br><span class="line">    </span><br><span class="line">[pool drain];</span><br><span class="line"><span class="comment">// ç­‰åŒäº objc_autoreleasePoolPop(pool)</span></span><br></pre></td></tr></table></figure><p><code>[NSAutoreleasePool showPools]</code> å¯ä»¥çœ‹åˆ°å½“å‰çº¿ç¨‹æ‰€æœ‰ pool çš„æƒ…å†µï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">objc[21536]: ##############</span><br><span class="line">objc[21536]: AUTORELEASE POOLS for thread 0x10011e3c0</span><br><span class="line">objc[21536]: 2 releases pending.</span><br><span class="line">objc[21536]: [0x101802000]  ................  PAGE  (hot) (cold)</span><br><span class="line">objc[21536]: [0x101802038]  ################  POOL 0x101802038</span><br><span class="line">objc[21536]: [0x101802040]       0x1003062e0  NSObject</span><br><span class="line">objc[21536]: ##############</span><br><span class="line">Program ended with exit code: 0</span><br></pre></td></tr></table></figure><p>åœ¨ <a href="https://github.com/opensource-apple/objc4" target="_blank" rel="noopener">objc4</a> ä¸­å¯ä»¥æŸ¥çœ‹åˆ° AutoreleasePoolPageï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">objc4/<span class="built_in">NSObject</span>.mm AutoreleasePoolPage</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> AutoreleasePoolPage </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> *push() </span><br><span class="line">    &#123;</span><br><span class="line">        ç”Ÿæˆæˆ–è€…æŒæœ‰ <span class="built_in">NSAutoreleasePool</span> ç±»å¯¹è±¡</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> pop(<span class="keyword">void</span> *token) </span><br><span class="line">    &#123;</span><br><span class="line">        åºŸå¼ƒ <span class="built_in">NSAutoreleasePool</span> ç±»å¯¹è±¡</span><br><span class="line">        releaseAll();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">id</span> autorelease(<span class="keyword">id</span> obj)</span><br><span class="line">    &#123;</span><br><span class="line">        ç›¸å½“äº <span class="built_in">NSAutoreleasePool</span> ç±»çš„ addObject ç±»æ–¹æ³•</span><br><span class="line">        AutoreleasePoolPage *page = å–å¾—æ­£åœ¨ä½¿ç”¨çš„ AutoreleasePoolPage å®ä¾‹;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">id</span> *add(<span class="keyword">id</span> obj)</span><br><span class="line">    &#123;</span><br><span class="line">        å°†å¯¹è±¡è¿½åŠ åˆ°å†…éƒ¨æ•°ç»„</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> releaseAll() </span><br><span class="line">    &#123;</span><br><span class="line">        è°ƒç”¨å†…éƒ¨æ•°ç»„ä¸­å¯¹è±¡çš„ release æ–¹æ³•</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> *</span><br><span class="line">objc_autoreleasePoolPush(<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (UseGC) <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">return</span> AutoreleasePoolPage::push();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">objc_autoreleasePoolPop(<span class="keyword">void</span> *ctxt)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (UseGC) <span class="keyword">return</span>;</span><br><span class="line">    AutoreleasePoolPage::pop(ctxt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>AutoreleasePoolPage ä»¥åŒå‘é“¾è¡¨çš„å½¢å¼ç»„åˆè€Œæˆï¼ˆåˆ†åˆ«å¯¹åº”ç»“æ„ä¸­çš„ parent æŒ‡é’ˆå’Œ child æŒ‡é’ˆï¼‰ã€‚<br>thread æŒ‡é’ˆæŒ‡å‘å½“å‰çº¿ç¨‹ã€‚<br>æ¯ä¸ª AutoreleasePoolPage å¯¹è±¡ä¼šå¼€è¾Ÿ4096å­—èŠ‚å†…å­˜ï¼ˆä¹Ÿå°±æ˜¯è™šæ‹Ÿå†…å­˜ä¸€é¡µçš„å¤§å°ï¼‰ï¼Œé™¤äº†ä¸Šé¢çš„å®ä¾‹å˜é‡æ‰€å ç©ºé—´ï¼Œå‰©ä¸‹çš„ç©ºé—´å…¨éƒ¨ç”¨æ¥å‚¨å­˜autoreleaseå¯¹è±¡çš„åœ°å€ã€‚<br>next æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ª add è¿›æ¥çš„ autorelease çš„å¯¹è±¡å³å°†å­˜æ”¾çš„ä½ç½®ã€‚<br>ä¸€ä¸ª Page çš„ç©ºé—´è¢«å æ»¡æ—¶ï¼Œä¼šæ–°å»ºä¸€ä¸ª AutoreleasePoolPage å¯¹è±¡ï¼Œè¿æ¥é“¾è¡¨ã€‚</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS%E8%BF%9B%E9%98%B6%E2%80%94%E2%80%94iOS%20%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86&amp;Block-04.png" alt="AutoreleasePoolPage"></p><h2 id="6-unsafe-unretained"><a href="#6-unsafe-unretained" class="headerlink" title="6 __unsafe_unretained"></a>6 __unsafe_unretained</h2><p>æœ‰æ—¶å€™æˆ‘ä»¬é™¤äº† <code>__weak</code> å’Œ <code>__strong</code> ä¹‹å¤–ä¹Ÿä¼šç”¨åˆ° <code>__unsafe_unretained</code> è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯¹ <code>__unsafe_unretained</code> äº†è§£å¤šå°‘ï¼Ÿ</p><p><code>__unsafe_unretained</code> æ˜¯ä¸å®‰å…¨çš„æ‰€æœ‰æƒä¿®é¥°ç¬¦ï¼Œå°½ç®¡ ARC çš„å†…å­˜ç®¡ç†æ˜¯ç¼–è¯‘å™¨çš„å·¥ä½œï¼Œä½†é™„æœ‰ <code>__unsafe_unretained</code> ä¿®é¥°ç¬¦çš„å˜é‡ä¸å±äºç¼–è¯‘å™¨çš„å†…å­˜ç®¡ç†å¯¹è±¡ã€‚<strong>èµ‹å€¼æ—¶å³ä¸è·å¾—å¼ºå¼•ç”¨ä¹Ÿä¸è·å¾—å¼±å¼•ç”¨</strong>ã€‚</p><p>æ¥è¿è¡Œä¸€æ®µä»£ç ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">id</span> __<span class="keyword">unsafe_unretained</span> obj1 = <span class="literal">nil</span>;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">id</span> __<span class="keyword">strong</span> obj0 = [[<span class="built_in">NSObject</span> alloc] init];</span><br><span class="line">            </span><br><span class="line">    obj1 = obj0;</span><br><span class="line">            </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"A: %@"</span>, obj1);</span><br><span class="line">&#125;</span><br><span class="line">        </span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"B: %@"</span>, obj1);</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2017-01-12 19:24:47.245220 __unsafe_unretained[55726:4408416] A: &lt;NSObject: 0x100304800&gt;</span><br><span class="line">2017-01-12 19:24:47.246670 __unsafe_unretained[55726:4408416] B: &lt;NSObject: 0x100304800&gt;</span><br><span class="line">Program ended with exit code: 0</span><br></pre></td></tr></table></figure><p>å¯¹ä»£ç è¿›è¡Œè¯¦ç»†åˆ†æï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">id</span> __<span class="keyword">unsafe_unretained</span> obj1 = <span class="literal">nil</span>;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// è‡ªå·±ç”Ÿæˆå¹¶æŒæœ‰å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">id</span> __<span class="keyword">strong</span> obj0 = [[<span class="built_in">NSObject</span> alloc] init];</span><br><span class="line">            </span><br><span class="line">    <span class="comment">// å› ä¸º obj0 å˜é‡ä¸ºå¼ºå¼•ç”¨ï¼Œ</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥è‡ªå·±æŒæœ‰å¯¹è±¡</span></span><br><span class="line">    obj1 = obj0;</span><br><span class="line">            </span><br><span class="line">    <span class="comment">// è™½ç„¶ obj0 å˜é‡èµ‹å€¼ç»™ obj1</span></span><br><span class="line">    <span class="comment">// ä½†æ˜¯ obj1 å˜é‡æ—¢ä¸æŒæœ‰å¯¹è±¡çš„å¼ºå¼•ç”¨ï¼Œä¹Ÿä¸æŒæœ‰å¯¹è±¡çš„å¼±å¼•ç”¨</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"A: %@"</span>, obj1);</span><br><span class="line">    <span class="comment">// è¾“å‡º obj1 å˜é‡æ‰€è¡¨ç¤ºçš„å¯¹è±¡</span></span><br><span class="line">&#125;</span><br><span class="line">        </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"B: %@"</span>, obj1);</span><br><span class="line">    <span class="comment">// è¾“å‡º obj1 å˜é‡æ‰€è¡¨ç¤ºçš„å¯¹è±¡</span></span><br><span class="line">    <span class="comment">// obj1 å˜é‡è¡¨ç¤ºçš„å¯¹è±¡å·²ç»è¢«åºŸå¼ƒ</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥æ­¤æ—¶è·å¾—çš„æ˜¯æ‚¬å‚æŒ‡é’ˆ</span></span><br><span class="line">    <span class="comment">// é”™è¯¯è®¿é—®</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œæœ€åçš„ NSLog åªæ˜¯ç¢°å·§æ­£å¸¸è¿è¡Œï¼Œå¦‚æœé”™è¯¯è®¿é—®ï¼Œä¼šé€ æˆ crash<br>åœ¨ä½¿ç”¨ <code>__unsafe_unretained</code> ä¿®é¥°ç¬¦æ—¶ï¼Œèµ‹å€¼ç»™é™„æœ‰ <code>__strong</code> ä¿®é¥°ç¬¦å˜é‡æ—¶ï¼Œè¦ç¡®ä¿å¯¹è±¡ç¡®å®å­˜åœ¨</p><h1 id="ç¬¬äºŒç¯‡-Block"><a href="#ç¬¬äºŒç¯‡-Block" class="headerlink" title="ç¬¬äºŒç¯‡ Block"></a>ç¬¬äºŒç¯‡ Block</h1><p>èŠ±å‡ åˆ†é’Ÿæ—¶é—´çœ‹ä¸‹é¢ä¸‰ä¸ªå°é¢˜ç›®ï¼Œå†™ä¸‹ä½ çš„ç­”æ¡ˆã€‚</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS%E8%BF%9B%E9%98%B6%E2%80%94%E2%80%94iOS%20%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86&amp;Block-05.png" alt="Block çš„ä¸‰é“æµ‹è¯•é¢˜"></p><p>è¿™ä¸ªä¸‰ä¸ªå°é¢˜ç›®ï¼Œæˆ‘åœ¨æ•´ç†æ­¤ç‰‡åšæ–‡ä¹‹å‰ç»™äº†ä¸‰ä½æœ‹å‹å»è§£ç­”ï¼Œæœ€åçš„ç»“æœï¼Œé™¤äº†ä¸€ä½æœ‹å‹ 3 é¢˜å…¨éƒ¨æ­£ç¡®ï¼Œå…¶ä»–ä¸¤ä¸ªæœ‹å‹å‡åªç­”ä¸­ 1 é¢˜ã€‚</p><p>è¯´æ˜è¿˜æ˜¯æœ‰å¾ˆå¤š iOS çš„æœ‹å‹å¯¹äº Block å¹¶æ²¡æœ‰é€å½»ç†è§£ã€‚æœ¬ç¯‡åšæ–‡ä¼šå¯¹ Block è¿›è¡Œè¯¦ç»†çš„è§£è¯´ã€‚</p><h2 id="1-Block-ä½¿ç”¨çš„ç®€å•è§„åˆ™"><a href="#1-Block-ä½¿ç”¨çš„ç®€å•è§„åˆ™" class="headerlink" title="1 Block ä½¿ç”¨çš„ç®€å•è§„åˆ™"></a>1 Block ä½¿ç”¨çš„ç®€å•è§„åˆ™</h2><p>å…ˆäº†è§£ç®€å•è§„åˆ™ï¼Œå†å»åˆ†æåŸç†å’Œå®ç°ï¼š</p><blockquote><p>Block ä¸­ï¼ŒBlock <strong>è¡¨è¾¾å¼æˆªè·</strong>æ‰€ä½¿ç”¨çš„è‡ªåŠ¨å˜é‡çš„å€¼ï¼Œå³ä¿å­˜è¯¥è‡ªåŠ¨å˜é‡çš„<strong>ç¬é—´å€¼</strong>ã€‚<br>ä¿®é¥°ä¸º <code>__block</code> çš„å˜é‡ï¼Œåœ¨æ•è·æ—¶ï¼Œè·å–çš„<strong>ä¸å†æ˜¯ç¬é—´å€¼</strong>ã€‚</p></blockquote><p>è‡³äº Whyï¼Œåé¢å°†ä¼šç»§ç»­è¯´ã€‚</p><h2 id="2-Block-çš„å®ç°"><a href="#2-Block-çš„å®ç°" class="headerlink" title="2 Block çš„å®ç°"></a>2 Block çš„å®ç°</h2><p>Block æ˜¯å¸¦æœ‰è‡ªåŠ¨å˜é‡ï¼ˆå±€éƒ¨å˜é‡ï¼‰çš„åŒ¿åå‡½æ•°ã€‚<br>Block è¡¨è¾¾å¼å¾ˆç®€å•ï¼Œæ€»ä½“å¯ä»¥æè¿°ä¸ºï¼šã€<code>^ è¿”å›å€¼ç±»å‹ å‚æ•°åˆ—è¡¨ è¡¨è¾¾å¼</code>ã€ã€‚<br>ä½†æ˜¯ Block å¹¶ä¸æ˜¯ Objective-C ä¸­æ‰æœ‰çš„è¯­æ³•ï¼Œè¿™æ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Ÿ</p><p>clang ç¼–è¯‘å™¨æä¾›ç»™ç¨‹åºå‘˜äº†è§£ Objective-C èƒŒåæœºåˆ¶çš„æ–¹æ³•ï¼Œé€šè¿‡ clang çš„è½¬æ¢å¯ä»¥çœ‹åˆ° Block çš„å®ç°åŸç†ã€‚</p><p>é€šè¿‡ <code>clang -rewrite-objc yourfile.m</code> clang å°†ä¼šæŠŠ Objective-C çš„ä»£ç è½¬æ¢æˆ C è¯­è¨€çš„ä»£ç ã€‚</p><h3 id="2-1-Block-åŸºæœ¬å®ç°å‰–æ"><a href="#2-1-Block-åŸºæœ¬å®ç°å‰–æ" class="headerlink" title="2.1 Block åŸºæœ¬å®ç°å‰–æ"></a>2.1 Block åŸºæœ¬å®ç°å‰–æ</h3><p>ç”¨ Xcode åˆ›å»º Command Line é¡¹ç›®ï¼Œå†™å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">void</span> (^blk)(<span class="keyword">void</span>) = ^&#123;<span class="built_in">NSLog</span>(<span class="string">@"Block"</span>)&#125;;</span><br><span class="line">    blk();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨ clang è½¬æ¢ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS%E8%BF%9B%E9%98%B6%E2%80%94%E2%80%94iOS%20%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86&amp;Block-06.png" alt=""></p><p>ä»¥ä¸Šæ˜¯è½¬æ¢åçš„ä»£ç ï¼Œä¸è¦æ–¹ï¼Œä¸€æ®µä¸€æ®µçœ‹ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼ŒBlock çš„å®ç°å†…å®¹ï¼Œ<strong>è¢«è½¬æ¢æˆäº†ä¸€ä¸ªæ™®é€šçš„é™æ€å‡½æ•° <code>__main_func_0</code></strong>ã€‚</p><p>å†çœ‹å…¶ä»–éƒ¨åˆ†ï¼š</p><p><strong>main.cpp __block_impl:</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">block_impl</span> &#123;</span></span><br><span class="line">    <span class="keyword">void</span> *isa;</span><br><span class="line">    <span class="keyword">int</span> Flags;</span><br><span class="line">    <span class="keyword">int</span> Reserved;</span><br><span class="line">    <span class="keyword">void</span> *FuncPtr;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>__block_impl</code> ç»“æ„ä½“åŒ…æ‹¬äº†ä¸€äº›æ ‡å¿—ã€ä»Šåç‰ˆæœ¬å‡çº§<strong>é¢„ç•™çš„å˜é‡</strong>ã€<strong>å‡½æ•°æŒ‡é’ˆ</strong>ã€‚</p><hr><p><strong>main.cpp __main_block_desc_0:</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> __<span class="title">main_block_desc_0</span> &#123;</span></span><br><span class="line">  <span class="keyword">size_t</span> reserved;</span><br><span class="line">  <span class="keyword">size_t</span> Block_size;</span><br><span class="line">&#125; __main_block_desc_0_DATA = &#123; <span class="number">0</span>, <span class="keyword">sizeof</span>(struct __main_block_impl_0)&#125;;</span><br></pre></td></tr></table></figure><p><code>__main_block_desc_0</code> ç»“æ„ä½“åŒ…æ‹¬äº†ä»Šåç‰ˆæœ¬å‡çº§é¢„ç•™çš„å˜é‡ã€block å¤§å°ã€‚</p><hr><p><strong>main.cpp __main_block_impl_0:</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">main_block_impl_0</span> &#123;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> __<span class="title">block_impl</span> <span class="title">impl</span>;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> __<span class="title">main_block_desc_0</span>* <span class="title">Desc</span>;</span></span><br><span class="line"></span><br><span class="line">  __main_block_impl_0(<span class="keyword">void</span> *fp, struct __main_block_desc_0 *desc, <span class="keyword">int</span> flags=<span class="number">0</span>) &#123;</span><br><span class="line">    impl.isa = &amp;_NSConcreteStackBlock;</span><br><span class="line">    impl.Flags = flags;</span><br><span class="line">    impl.FuncPtr = fp;</span><br><span class="line">    Desc = desc;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>__main_block_impl_0</code> ç»“æ„ä½“å«æœ‰ä¸¤ä¸ªæˆå‘˜å˜é‡ï¼Œåˆ†åˆ«æ˜¯ <code>__block_impl</code> å’Œ <code>__main_block_desc_0</code>å®ä¾‹å˜é‡ã€‚</p><p>æ­¤å¤–ï¼Œè¿˜å«æœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•ã€‚è¯¥æ„é€ æ–¹æ³•åœ¨ main å‡½æ•°ä¸­è¢«å¦‚ä¸‹è°ƒç”¨ï¼š</p><p><strong>main.cpp __main_block_impl_0 æ„é€ å‡½æ•°çš„è°ƒç”¨:</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> (*blk)(<span class="keyword">void</span>) = ((<span class="keyword">void</span> (*)())&amp;__main_block_impl_0((<span class="keyword">void</span> *)__main_block_func_0,</span><br><span class="line">                                              &amp;__main_block_desc_0_DATA));</span><br></pre></td></tr></table></figure><p>å»æ‰å„ç§å¼ºåˆ¶è½¬æ¢ï¼Œåšç®€åŒ–ï¼š</p><p><strong>main.cpp __main_block_impl_0 æ„é€ å‡½æ•°çš„è°ƒç”¨ ç®€åŒ–:</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">main_block_impl_0</span> <span class="title">tmp</span> = __<span class="title">main_block_impl_0</span>(__<span class="title">main_block_func_0</span>, &amp;__<span class="title">main_block_desc_0_DATA</span>);</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">main_block_impl_0</span> *<span class="title">blk</span> = &amp;<span class="title">tmp</span>;</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç å³ï¼šå°† <code>__main_block_impl_0</code> ç»“æ„ä½“å®ä¾‹çš„æŒ‡é’ˆï¼Œèµ‹å€¼ç»™ <code>__main_block_impl_0</code> ç»“æ„ä½“æŒ‡é’ˆç±»å‹çš„å˜é‡ <code>blk</code>ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬æœ€åˆçš„ç»“æ„ä½“å®šä¹‰ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> (^blk)(<span class="keyword">void</span>) = ^&#123;<span class="built_in">NSLog</span>(<span class="string">@"Block"</span>);&#125;;</span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œmain å‡½æ•°ä¸­è¿˜æœ‰å¦å¤–ä¸€æ®µï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((<span class="keyword">void</span> (*)(__block_impl *))((__block_impl *)blk)-&gt;FuncPtr)((__block_impl *)blk);</span><br></pre></td></tr></table></figure><p>å»æ‰å„ç§è½¬æ¢ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(*blk-&gt;impl.FuncPtr)(blk);</span><br></pre></td></tr></table></figure><p>å®é™…å°±æ˜¯æœ€åˆçš„ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blk();</span><br></pre></td></tr></table></figure><blockquote><p>æœ¬èŠ‚æ‰€æœ‰ä»£ç åœ¨ <a href="https://github.com/summertian4/iOS-ObjectiveC/tree/master/ObjcMemory/ObjcMemory-Test-Code/block_implementation" target="_blank" rel="noopener">block_implementation</a> ä¸­</p></blockquote><h3 id="2-2-Block-æˆªè·å¤–éƒ¨å˜é‡ç¬é—´å€¼çš„å®ç°å‰–æ"><a href="#2-2-Block-æˆªè·å¤–éƒ¨å˜é‡ç¬é—´å€¼çš„å®ç°å‰–æ" class="headerlink" title="2.2 Block æˆªè·å¤–éƒ¨å˜é‡ç¬é—´å€¼çš„å®ç°å‰–æ"></a>2.2 Block æˆªè·å¤–éƒ¨å˜é‡ç¬é—´å€¼çš„å®ç°å‰–æ</h3><p>2.1 ä¸­å¯¹æœ€ç®€å•çš„ <em>æ— å‚æ•° Block å£°æ˜ã€è°ƒç”¨</em> è¿›è¡Œäº† clang è½¬æ¢ã€‚æ¥ä¸‹æ¥å†çœ‹ä¸€æ®µã€æˆªè·è‡ªåŠ¨å˜é‡ã€çš„ä»£ç (å¯ä»¥ä½¿ç”¨å‘½ä»¤ <code>clang -rewrite-objc -fobjc-arc -fobjc-runtime=macosx-10.7 main.m</code>)ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> val = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *fmt = <span class="string">"val = %d\n"</span>;</span><br><span class="line">    <span class="keyword">void</span> (^blk)(<span class="keyword">void</span>) = ^&#123;printf(fmt, val);&#125;;</span><br><span class="line">    </span><br><span class="line">    val = <span class="number">2</span>;</span><br><span class="line">    fmt = <span class="string">"These values were changed, val = %d\n"</span>;</span><br><span class="line">    </span><br><span class="line">    blk();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>clang è½¬æ¢ä¹‹åï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS%E8%BF%9B%E9%98%B6%E2%80%94%E2%80%94iOS%20%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86&amp;Block-07.png" alt=""></p><p>å’Œ 2.1 èŠ‚ä¸­çš„è½¬æ¢ä»£ç å¯¹æ¯”ï¼Œå¯ä»¥å‘ç°å¤šäº†ä¸€äº›ä»£ç ã€‚</p><p>é¦–å…ˆï¼Œ<code>__main_block_impl_0</code> å¤šäº†ä¸€ä¸ªå˜é‡ <code>val</code>ï¼Œå¹¶åœ¨æ„é€ å‡½æ•°çš„å‚æ•°ä¸­åŠ å…¥äº† <code>val</code> çš„èµ‹å€¼ï¼š</p><p><strong>main.cpp __main_block_impl_0:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> __main_block_impl_0 &#123;</span><br><span class="line">  <span class="keyword">struct</span> __block_impl impl;</span><br><span class="line">  <span class="keyword">struct</span> __main_block_desc_0* Desc;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *fmt;</span><br><span class="line">  <span class="keyword">int</span> val;</span><br><span class="line">  __main_block_impl_0(<span class="keyword">void</span> *fp, <span class="keyword">struct</span> __main_block_desc_0 *desc, <span class="keyword">const</span> <span class="keyword">char</span> *_fmt, <span class="keyword">int</span> _val, <span class="keyword">int</span> flags=<span class="number">0</span>) : fmt(_fmt), val(_val) &#123;</span><br><span class="line">    impl.isa = &amp;_NSConcreteStackBlock;</span><br><span class="line">    impl.Flags = flags;</span><br><span class="line">    impl.FuncPtr = fp;</span><br><span class="line">    Desc = desc;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è€Œåœ¨ main å‡½æ•°ä¸­ï¼Œå¯¹ Block çš„å£°æ˜å˜ä¸ºæ­¤å¥ï¼š</p><p><strong>main.cpp __main_block_impl_0 æ„é€ å‡½æ•°çš„è°ƒç”¨:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> (*blk)(<span class="keyword">void</span>) = ((<span class="keyword">void</span> (*)())&amp;__main_block_impl_0((<span class="keyword">void</span> *)__main_block_func_0, &amp;__main_block_desc_0_DATA, fmt, val));</span><br></pre></td></tr></table></figure><p>å»æ‰è½¬æ¢ï¼š</p><p><strong>main.cpp __main_block_impl_0 æ„é€ å‡½æ•°çš„è°ƒç”¨ ç®€åŒ–:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> __main_block_impl_0 tmp = __main_block_impl_0(__main_block_func_0, &amp;__main_block_desc_0_DATA, val);</span><br><span class="line">    <span class="keyword">struct</span> __main_block_impl_0 *blk = &amp;tmp;</span><br></pre></td></tr></table></figure><p>_<strong>æ‰€ä»¥ï¼Œåœ¨ Block è¢«å£°æ˜æ—¶ï¼ŒBlock å·²ç»å°† <code>val</code> ä½œä¸º <code>__main_block_impl_0</code> çš„å†…éƒ¨å˜é‡ä¿å­˜ä¸‹æ¥äº†ã€‚æ— è®ºåœ¨åœ¨å£°æ˜ä¹‹åæ€æ ·æ›´æ”¹ val çš„å€¼ï¼Œéƒ½ä¸ä¼šå½±å“ï¼ŒBlock è°ƒç”¨æ—¶è®¿é—®çš„å†…éƒ¨ val å€¼ã€‚è¿™å°±æ˜¯ Block æ•è·å˜é‡ç¬é—´å€¼çš„åŸç†ã€‚</strong>_</p><blockquote><p>æœ¬èŠ‚æ‰€æœ‰ä»£ç åœ¨ <a href="https://github.com/summertian4/iOS-ObjectiveC/tree/master/ObjcMemory/ObjcMemory-Test-Code/EX05" target="_blank" rel="noopener">EX05</a> ä¸­</p></blockquote><h3 id="2-3-block-å˜é‡çš„è®¿é—®å®ç°å‰–æ"><a href="#2-3-block-å˜é‡çš„è®¿é—®å®ç°å‰–æ" class="headerlink" title="2.3 __block å˜é‡çš„è®¿é—®å®ç°å‰–æ"></a>2.3 __block å˜é‡çš„è®¿é—®å®ç°å‰–æ</h3><p>æˆ‘ä»¬çŸ¥é“ï¼ŒBlock ä¸­èƒ½å¤Ÿè¯»å–ï¼Œä½†æ˜¯ä¸èƒ½æ›´æ”¹ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œå¦‚æœå»æ›´æ”¹ï¼ŒXcode ä¼šæç¤ºä½ æ— æ³•åœ¨ Block å†…éƒ¨æ›´æ”¹å˜é‡ã€‚</p><p>Block å†…éƒ¨åªæ˜¯å¯¹å±€éƒ¨å˜é‡åªè¯»ï¼Œä½†æ˜¯ Block èƒ½è¯»å†™ä»¥ä¸‹å‡ ç§å˜é‡ï¼š</p><ol><li>é™æ€å˜é‡</li><li>é™æ€å…¨å±€å˜é‡</li><li>å…¨å±€å˜é‡</li></ol><p>ä¹Ÿå°±æ˜¯è¯´ä»¥ä¸‹ä»£ç æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">int global_val = 1;</span><br><span class="line">static int static_global_val = 2;</span><br><span class="line"></span><br><span class="line">int main(int argc, const char * argv[]) &#123;</span><br><span class="line">    static int static_val = 3;</span><br><span class="line">    </span><br><span class="line">    void (^blk)(void) = ^ &#123;</span><br><span class="line">        global_val = 1 * 2;</span><br><span class="line">        static_global_val = 2 * 2;</span><br><span class="line">        static_val = 3 * 2;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæƒ³åœ¨ Block å†…éƒ¨å†™å±€éƒ¨å˜é‡ï¼Œéœ€è¦å¯¹è®¿é—®çš„å±€éƒ¨å˜é‡å¢åŠ  __block ä¿®é¥°ã€‚</p><p>__block ä¿®é¥°ç¬¦å…¶å®ç±»ä¼¼äº C è¯­è¨€ä¸­ staticã€autoã€register ä¿®é¥°ç¬¦ã€‚ç”¨äºæŒ‡å®šå°†å˜é‡å€¼è®¾ç½®åˆ°å“ªä¸ªå­˜å‚¨åŸŸä¸­ã€‚</p><p>å…·ä½“ __block ä¹‹åç©¶ç«Ÿåšäº†å“ªäº›å˜åŒ–æˆ‘ä»¬å¯ä»¥å†™ä»£ç æµ‹è¯•ï¼š</p><p><strong>EX07:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">int main(int argc, const char * argv[]) &#123;</span><br><span class="line">    </span><br><span class="line">    __block int val = 10;</span><br><span class="line">    void (^blk)(void) = ^&#123;val = 1;&#125;;</span><br><span class="line">    </span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>clang è½¬æ¢ä¹‹åï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_blog_iOS%E8%BF%9B%E9%98%B6%E2%80%94%E2%80%94iOS%20%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86&amp;Block-08.png" alt=""></p><p>è·Ÿ 2.2 å¯¹æ¯”ï¼Œä¼¼ä¹åˆåŠ äº†éå¸¸ä»£ç ã€‚å‘ç°å¤šäº†ä¸¤ä¸ªç»“æ„ä½“ã€‚</p><p><strong>main.cpp __Block_byref_val_0:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> __Block_byref_val_0 &#123;</span><br><span class="line">  <span class="keyword">void</span> *__isa;</span><br><span class="line">__Block_byref_val_0 *__forwarding;</span><br><span class="line"> <span class="keyword">int</span> __flags;</span><br><span class="line"> <span class="keyword">int</span> __size;</span><br><span class="line"> <span class="keyword">int</span> val;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¾ˆæƒŠå¥‡çš„å‘ç°ï¼Œ<strong>block ç±»å‹çš„ <code>val</code> å˜æˆäº†ç»“æ„ä½“ `</strong>Block_byref_val_0<code>çš„å®ä¾‹ã€‚è¿™ä¸ªå®ä¾‹å†…ï¼ŒåŒ…å«äº†</code><strong>isa<code>æŒ‡é’ˆã€ä¸€ä¸ªæ ‡å¿—ä½</code></strong>flags<code>ã€ä¸€ä¸ªè®°å½•å¤§å°çš„</code><strong>size<code>ã€‚æœ€æœ€é‡è¦çš„ï¼Œå¤šäº†ä¸€ä¸ª</code></strong>forwarding<code>æŒ‡é’ˆå’Œ</code>val` å˜é‡ã€‚è¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ</p><p>åœ¨ main å‡½æ•°éƒ¨åˆ†ï¼Œå®ä¾‹åŒ–äº†è¯¥ç»“æ„ä½“ï¼š</p><p><strong>main.cpp main.m éƒ¨åˆ†:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__Block_byref_val_0 val = &#123;(void*)0,</span><br><span class="line">                            (__Block_byref_val_0 *)&amp;val,</span><br><span class="line">                            0,</span><br><span class="line">                            sizeof(__Block_byref_val_0),</span><br><span class="line">                            10&#125;;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºè¯¥ç»“æ„ä½“å¯¹è±¡åˆå§‹åŒ–æ—¶ï¼š</p><ol><li><strong>__forwarding æŒ‡å‘äº†ç»“æ„ä½“å®ä¾‹æœ¬èº«åœ¨å†…å­˜ä¸­çš„åœ°å€</strong></li><li>val = 10</li></ol><p>è€Œåœ¨ main å‡½æ•°ä¸­ï¼Œ<code>val = 1</code> è¿™å¥èµ‹å€¼è¯­å¥å˜æˆäº†ï¼š</p><p><strong>main.cpp <code>val = 1;</code> å¯¹åº”çš„å‡½æ•°:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(val-&gt;__forwarding-&gt;val) = 1;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±å¯ä»¥çœ‹å‡ºå…¶ç²¾é«“ï¼Œval = 1ï¼Œå®é™…ä¸Šæ›´æ”¹çš„æ˜¯ <code>__Block_byref_val_0</code> ç»“æ„ä½“å®ä¾‹ val ä¸­çš„ <code>__forwarding</code> æŒ‡é’ˆï¼ˆä¹Ÿå°±æ˜¯æœ¬èº«ï¼‰æŒ‡å‘çš„ <code>val</code> å˜é‡ã€‚</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_blog_iOS%E8%BF%9B%E9%98%B6%E2%80%94%E2%80%94iOS%20%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86&amp;Block-12.png" alt="__Block_byref_val_0 å®ä¾‹ç¤ºæ„å›¾"></p><p>è€Œå¯¹ <code>val</code> è®¿é—®ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä½ å¯ä»¥ç†è§£ä¸ºé€šè¿‡å–åœ°å€æ”¹å˜å˜é‡çš„å€¼ï¼Œè¿™å’Œ C è¯­è¨€ä¸­å–åœ°å€æ”¹å˜å˜é‡ç±»ä¼¼ã€‚</p><p>æ‰€ä»¥ï¼Œå£°æ˜ <strong>block çš„å˜é‡å¯ä»¥è¢«æ”¹å˜ã€‚è‡³äº `</strong>forwarding` çš„å…¶ä»–å·¨å¤§ä½œç”¨ï¼Œä¼šç»§ç»­åˆ†æã€‚</p><blockquote><p>æœ¬èŠ‚ä»£ç åœ¨ <a href="https://github.com/summertian4/iOS-ObjectiveC/tree/master/ObjcMemory/ObjcMemory-Test-Code/EX07" target="_blank" rel="noopener">EX05</a> ä¸­</p></blockquote><h2 id="3-Block-çš„å­˜å‚¨åŸŸ"><a href="#3-Block-çš„å­˜å‚¨åŸŸ" class="headerlink" title="3 Block çš„å­˜å‚¨åŸŸ"></a>3 Block çš„å­˜å‚¨åŸŸ</h2><p>Block æœ‰ä¸‰ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><blockquote><ol><li>__NSConcreteStackBlock         â€”â€”â€”â€”â€”â€”â€”â€”æ ˆä¸­</li><li>__NSConcreteGlobalBlock        â€”â€”â€”â€”â€”â€”â€”â€”æ•°æ®åŒºåŸŸä¸­</li><li>__NSConcreteMallocBlock        â€”â€”â€”â€”â€”â€”â€”â€”å †ä¸­</li></ol></blockquote><p><strong>__NSConcreteGlobalBlock å‡ºç°çš„åœ°æ–¹æœ‰ï¼š</strong></p><ol><li>è®¾ç½®å…¨å±€å˜é‡çš„åœ°æ–¹æœ‰ Block è¯­æ³•æ—¶</li><li>Block è¯­æ³•çš„è¡¨è¾¾å¼ä¸­ä¸ä½¿ç”¨ä»»ä½•å¤–éƒ¨å˜é‡æ—¶</li></ol><p>è®¾ç½®åœ¨æ ˆä¸Šçš„ Blockï¼Œå¦‚æœæ‰€å±çš„å˜é‡ä½œç”¨åŸŸç»“æŸï¼ŒBlock å°±ä¼šè¢«åºŸå¼ƒã€‚å¦‚æœå…¶ä¸­ç”¨åˆ°äº† <strong>blockï¼Œ</strong>block æ‰€å±çš„å˜é‡ä½œç”¨åŸŸç»“æŸä¹Ÿä¼šè¢«åºŸå¼ƒã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒBlock åœ¨å¿…è¦çš„æ—¶å€™å°±éœ€è¦ä»æ ˆä¸­ç§»åˆ°å †ä¸­ã€‚ARC æœ‰æ•ˆæ—¶ï¼Œå¾ˆå¤šæƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä¼šå¸®åŠ©å®Œæˆ Block çš„ copyï¼Œä½†å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ copy Blockã€‚</p><p>å¯¹ä¸åŒå­˜å‚¨åŸŸçš„ Block copy æ—¶ï¼Œå½±å“å¦‚ä¸‹ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_blog_iOS%E8%BF%9B%E9%98%B6%E2%80%94%E2%80%94iOS%20%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86&amp;Block-09.png" alt="å¯¹ä¸åŒå­˜å‚¨åŸŸçš„ Block copy å½±å“"></p><p>copy æ—¶ï¼Œå¯¹è®¿é—®åˆ°çš„ __block ç±»å‹å¯¹è±¡å½±å“å¦‚ä¸‹ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_blog_iOS%E8%BF%9B%E9%98%B6%E2%80%94%E2%80%94iOS%20%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86&amp;Block-10.png" alt="Block copy æ—¶å¯¹ __block å¯¹è±¡çš„å½±å“"></p><blockquote><p>æ­¤æ—¶å¯ä»¥çœ‹å‡º <code>__forwarding</code> çš„å·¨å¤§ä½œç”¨â€”â€”æ— è®º Block æ­¤æ—¶åœ¨å †ä¸­è¿˜æ˜¯åœ¨æ ˆä¸­ï¼Œç”±äº <code>__forwarding</code> æŒ‡å‘å±€éƒ¨å˜é‡è½¬æ¢æˆçš„ç»“æ„ä½“å®ä¾‹çš„çœŸæ˜¯åœ°å€ï¼Œæ‰€ä»¥éƒ½èƒ½ç¡®ä¿æ­£ç¡®çš„è®¿é—®ã€‚</p></blockquote><p>å…·ä½“çš„æ¥è¯´ï¼š</p><ol><li>å½“ <strong>block å˜é‡è¢«ä¸€ä¸ª Block ä½¿ç”¨æ—¶ï¼ŒBlock ä»æ ˆå¤åˆ¶åˆ°å †ï¼Œ</strong>block å˜é‡ä¹Ÿä¼šè¢«å¤åˆ¶åˆ°ï¼Œå¹¶è¢«è¯¥ Block æŒæœ‰ã€‚</li><li>åœ¨ <strong>block å˜é‡è¢«å¤šä¸ª Block ä½¿ç”¨æ—¶ï¼Œåœ¨ä»»ä½•ä¸€ä¸ª Block ä»æ ˆå¤åˆ¶åˆ°å †æ—¶ï¼Œ </strong>block å˜é‡ä¹Ÿä¼šè¢«å¤åˆ¶åˆ°å †ï¼Œå¹¶è¢«è¯¥ Block æŒæœ‰ã€‚ä½†ç”±äº <code>__forwarding</code> æŒ‡é’ˆçš„å­˜åœ¨ï¼Œæ— è®º <strong>block å˜é‡å’Œ Block åœ¨ä¸åœ¨åŒä¸€ä¸ªå­˜å‚¨åŸŸï¼Œéƒ½å¯ä»¥æ­£ç¡®çš„è®¿é—® </strong>block å˜é‡ã€‚</li><li>å¦‚æœå †ä¸Šçš„ Block è¢«åºŸå¼ƒï¼Œé‚£ä¹ˆå®ƒæ‰€ä½¿ç”¨çš„ __block å˜é‡ä¹Ÿä¼šè¢«é‡Šæ”¾ã€‚</li></ol><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_blog_iOS%E8%BF%9B%E9%98%B6%E2%80%94%E2%80%94iOS%20%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86&amp;Block-11.png" alt=""></p><p>å‰é¢è¯´åˆ°ç¼–è¯‘å™¨ä¼šå¸®åŠ©å®Œæˆä¸€äº› Block çš„ copyï¼Œä¹Ÿæœ‰æ‰‹åŠ¨ copy Blockã€‚é‚£ä¹ˆ Block è¢«å¤åˆ¶åˆ°å †ä¸Šçš„æƒ…å†µæœ‰ï¼ˆæ­¤æ®µæ‘˜è‡ªäºã€Objective-Cé«˜çº§ç¼–ç¨‹ iOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€ï¼‰ï¼š</p><ol><li>è°ƒç”¨ Block çš„ copy æ–¹æ³•æ—¶</li><li>Block ä½œä¸ºè¿”å›å€¼æ—¶</li><li>å°† Block èµ‹å€¼ç»™é™„æœ‰ <code>__strong</code> ä¿®é¥°ç¬¦çš„æˆå‘˜å˜é‡æ—¶ï¼ˆidç±»å‹æˆ– Block ç±»å‹ï¼‰æ—¶</li><li>åœ¨æ–¹æ³•åä¸­å«æœ‰ <code>usingBlock</code> çš„ Cocoa æ¡†æ¶æ–¹æ³•æˆ– GCD çš„ API ä¸­ä¼ é€’ Block æ—¶</li></ol><h2 id="4-Block-å¾ªç¯å¼•ç”¨"><a href="#4-Block-å¾ªç¯å¼•ç”¨" class="headerlink" title="4 Block å¾ªç¯å¼•ç”¨"></a>4 Block å¾ªç¯å¼•ç”¨</h2><p>Block å¾ªç¯å¼•ç”¨ï¼Œæ˜¯åœ¨ç¼–ç¨‹ä¸­éå¸¸å¸¸è§çš„é—®é¢˜ï¼Œç”šè‡³å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“å‘ç”Ÿäº†å¾ªç¯å¼•ç”¨ï¼Œç›´åˆ°æˆ‘ä»¬çªç„¶æŸä¸€å¤©å‘ç°ã€æ€ä¹ˆè¿™ä¸ªå¯¹è±¡æ²¡æœ‰è°ƒç”¨ dellocã€ï¼Œæ‰æ„è¯†åˆ°æœ‰é—®é¢˜å­˜åœ¨ã€‚</p><p>åœ¨ã€Block å­˜å‚¨åŸŸã€ä¸­ä¹Ÿè¯´æ˜äº† Block åœ¨ copy åå¯¹ __block å¯¹è±¡ä¼š retain ä¸€æ¬¡ã€‚</p><p>é‚£ä¹ˆå¯¹äºå¦‚ä¸‹æƒ…å†µå°±ä¼šå‘ç”Ÿå¾ªç¯å¼•ç”¨ï¼š</p><p><strong>block_retain_cycle:</strong></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyObject</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) blk_t blk;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSObject</span> *obj;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyObject</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    _blk = ^&#123;<span class="built_in">NSLog</span>(<span class="string">@"self = %@"</span>, <span class="keyword">self</span>);&#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ dealloc"</span>, <span class="keyword">self</span>.class);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">id</span> myobj = [[MyObject alloc] init];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, myobj);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äº self -&gt; blkï¼Œblk -&gt; selfï¼ŒåŒæ–¹éƒ½æ— æ³•é‡Šæ”¾ã€‚</p><p>ä½†è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºä»¥ä¸‹æƒ…å†µï¼ŒåŒæ ·ä¼šå‘ç”Ÿå¾ªç¯å¼•ç”¨ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">block_retain_cycle</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyObject</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) blk_t blk;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸‹é¢æ˜¯å¤šåŠ çš„ä¸€å¥</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSObject</span> *obj;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyObject</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¸‹é¢æ˜¯å¤šåŠ çš„ä¸€å¥</span></span><br><span class="line">    _blk = ^&#123;<span class="built_in">NSLog</span>(<span class="string">@"self = %@"</span>, _obj);&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ dealloc"</span>, <span class="keyword">self</span>.class);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">id</span> myobj = [[MyObject alloc] init];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, myobj);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ç”±äº self -&gt; objï¼Œself -&gt; blkï¼Œblk -&gt; objã€‚è¿™ç§æƒ…å†µæ˜¯éå¸¸å®¹æ˜“è¢«å¿½è§†çš„ã€‚</p><h2 id="5-é‡å®¡é—®é¢˜"><a href="#5-é‡å®¡é—®é¢˜" class="headerlink" title="5 é‡å®¡é—®é¢˜"></a>5 é‡å®¡é—®é¢˜</h2><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹æœ€åˆçš„å‡ ä¸ªå°é¢˜ç›®ï¼š</p><p><img src="http://7xt4xp.com1.z0.glb.clouddn.com/blog_iOS%E8%BF%9B%E9%98%B6%E2%80%94%E2%80%94iOS%20%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86&amp;Block-05.png" alt="Block çš„ä¸‰é“æµ‹è¯•é¢˜"></p><ol><li><p>ç¬¬ä¸€é¢˜ï¼š</p><p>ç”±äº Block æ•è·ç¬é—´å€¼ï¼Œæ‰€ä»¥è¾“å‡ºä¸º <code>in block val = 0</code></p></li><li><p>ç¬¬äºŒé¢˜ï¼š</p><p>ç”±äº <code>val</code> ä¸º __blockï¼Œå¤–éƒ¨æ›´æ”¹ä¼šå½±å“åˆ°å†…éƒ¨è®¿é—®ï¼Œæ‰€ä»¥è¾“å‡ºä¸º <code>in block val = 1</code></p></li><li><p>ç¬¬ä¸‰é¢˜ï¼š</p><p>å’Œç¬¬äºŒé¢˜ç±»ä¼¼ï¼Œ<code>val = 1</code> èƒ½å½±å“åˆ° Block å†…éƒ¨è®¿é—®ï¼Œæ‰€ä»¥å…ˆè¾“å‡º <code>in block val = 1</code>ï¼Œä¹‹ååœ¨     Block å†…éƒ¨æ›´æ”¹ <code>val</code> å€¼ï¼Œå†æ¬¡è®¿é—®æ—¶è¾“å‡º <code>after block val = 2</code>ã€‚</p></li></ol><h1 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h1><p>æˆ‘å†™è¿™ç¯‡æ–‡ç« æ˜¯åœ¨æˆ‘é˜…è¯»äº†ã€Objective-Cé«˜çº§ç¼–ç¨‹ iOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€ä¸€ä¹¦ä¹‹åï¼Œåšæ–‡ä¸­ä¹Ÿæœ‰å¾ˆå†…å®¹æºäºã€Objective-Cé«˜çº§ç¼–ç¨‹ iOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€ã€‚</p><p>éå¸¸å‘å¤§å®¶æ¨èæ­¤ä¹¦ã€‚è¿™æœ¬ä¹¦é‡Œè®°å½•äº†å…³äº iOS å†…å­˜ç®¡ç†çš„æ·±å…¥å†…å®¹ã€‚ä½†è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤ä¹¦ä¸­çš„å¤šå¤„çŸ¥è¯†ç‚¹å¹¶ä¸æ˜¯å¾ˆè¯¦ç»†ï¼Œéœ€è¦ä½ ä»¥æ‹“å±•çš„å¿ƒæ€å»å­¦ä¹ ã€‚åœ¨æœ‰è§£é‡Šä¸è¯¦ç»†çš„åœ°æ–¹ï¼Œè‡ªå·±ä¸»åŠ¨å»æ¢ç´¢ï¼Œå»æ‹“å±•ï¼Œæ‰¾æ›´å¤šçš„èµ„æ–™ï¼Œæœ€åï¼Œä½ ä¼šå‘ç°ä½ å¯¹ iOS å†…å­˜ç®¡ç†æœ‰äº†æ›´å¤šçš„æ·±å…¥çš„ç†è§£ã€‚</p><p>å¯¹äºæ–‡ç« ä¸­çš„æµ‹è¯•ä»£ç ï¼Œå…¨éƒ¨åœ¨<a href="https://github.com/summertian4/iOS-ObjectiveC/tree/master/ObjcMemory" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚</p><hr><p>æœ‰ä»€ä¹ˆé—®é¢˜éƒ½å¯ä»¥åœ¨åšæ–‡åé¢ç•™è¨€ï¼Œæˆ–è€…å¾®åšä¸Šç§ä¿¡æˆ‘ï¼Œæˆ–è€…é‚®ä»¶æˆ‘ <a href="mailto:&#99;&#x6f;&#x64;&#101;&#x72;&#x66;&#105;&#115;&#104;&#64;&#x31;&#54;&#51;&#x2e;&#x63;&#111;&#x6d;" target="_blank" rel="noopener">&#99;&#x6f;&#x64;&#101;&#x72;&#x66;&#105;&#115;&#104;&#64;&#x31;&#54;&#51;&#x2e;&#x63;&#111;&#x6d;</a>ã€‚</p><p>åšä¸»æ˜¯ iOS å¦¹å­ä¸€æšã€‚</p><p>å¸Œæœ›å¤§å®¶ä¸€èµ·è¿›æ­¥ã€‚</p><p>æˆ‘çš„å¾®åšï¼š<a href="http://weibo.com/coderfish/" target="_blank" rel="noopener">å°é±¼å‘¨å‡Œå®‡</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;ç¬¬ä¸€ç¯‡-iOS-å†…å­˜ç®¡ç†&quot;&gt;&lt;a href=&quot;#ç¬¬ä¸€ç¯‡-iOS-å†…å­˜ç®¡ç†&quot; class=&quot;headerlink&quot; title=&quot;ç¬¬ä¸€ç¯‡ iOS å†…å­˜ç®¡ç†&quot;&gt;&lt;/a&gt;ç¬¬ä¸€ç¯‡ iOS å†…å­˜ç®¡ç†&lt;/h1&gt;&lt;h2 id=&quot;1-ä¼¼ä¹æ¯ä¸ªäººåœ¨å­¦ä¹ -iOS-è¿‡ç¨‹ä¸­éƒ½è€ƒè™‘è¿‡çš„é—®é¢˜&quot;&gt;&lt;a href=&quot;#1-ä¼¼ä¹æ¯ä¸ªäººåœ¨å­¦ä¹ -iOS-è¿‡ç¨‹ä¸­éƒ½è€ƒè™‘è¿‡çš„é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;1 ä¼¼ä¹æ¯ä¸ªäººåœ¨å­¦ä¹  iOS è¿‡ç¨‹ä¸­éƒ½è€ƒè™‘è¿‡çš„é—®é¢˜&quot;&gt;&lt;/a&gt;1 ä¼¼ä¹æ¯ä¸ªäººåœ¨å­¦ä¹  iOS è¿‡ç¨‹ä¸­éƒ½è€ƒè™‘è¿‡çš„é—®é¢˜&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;alloc retain release delloc åšäº†ä»€ä¹ˆï¼Ÿ&lt;/li&gt;
&lt;li&gt;autoreleasepool æ˜¯æ€æ ·å®ç°çš„ï¼Ÿ&lt;/li&gt;
&lt;li&gt;__unsafe_unretained æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/li&gt;
&lt;li&gt;Block æ˜¯æ€æ ·å®ç°çš„&lt;/li&gt;
&lt;li&gt;ä»€ä¹ˆæ—¶å€™ä¼šå¼•èµ·å¾ªç¯å¼•ç”¨ï¼Œä»€ä¹ˆæ—¶å€™ä¸ä¼šå¼•èµ·å¾ªç¯å¼•ç”¨ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ‰€ä»¥æˆ‘å°†åœ¨æœ¬ç¯‡åšæ–‡ä¸­è¯¦ç»†çš„ä» ARC è§£é‡Šåˆ° iOS çš„å†…å­˜ç®¡ç†ï¼Œä»¥åŠ Block ç›¸å…³çš„åŸç†ã€æºç ã€‚&lt;/p&gt;
&lt;h2 id=&quot;2-ä»-ARC-è¯´èµ·&quot;&gt;&lt;a href=&quot;#2-ä»-ARC-è¯´èµ·&quot; class=&quot;headerlink&quot; title=&quot;2 ä» ARC è¯´èµ·&quot;&gt;&lt;/a&gt;2 ä» ARC è¯´èµ·&lt;/h2&gt;&lt;p&gt;è¯´ iOS çš„å†…å­˜ç®¡ç†ï¼Œå°±ä¸å¾—ä¸ä» ARCï¼ˆAutomatic Reference Counting / è‡ªåŠ¨å¼•ç”¨è®¡æ•°ï¼‰ è¯´èµ·ï¼Œ ARC æ˜¯ WWDC2011 å’Œ iOS5 å¼•å…¥çš„å˜åŒ–ã€‚ARC æ˜¯ LLVM 3.0 ç¼–è¯‘å™¨çš„ç‰¹æ€§ï¼Œç”¨æ¥è‡ªåŠ¨ç®¡ç†å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ Java ä¸­ GC ä¸åŒï¼ŒARC æ˜¯ç¼–è¯‘å™¨ç‰¹æ€§ï¼Œè€Œä¸æ˜¯åŸºäºè¿è¡Œæ—¶çš„ï¼Œæ‰€ä»¥ ARC å…¶å®æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µè‡ªåŠ¨å¸®å¼€å‘è€…æ’å…¥äº†ç®¡ç†å†…å­˜çš„ä»£ç ï¼Œè€Œä¸æ˜¯å®æ—¶ç›‘æ§ä¸å›æ”¶å†…å­˜ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://zhoulingyu.com/categories/iOS/"/>
    
      <category term="iOSè¿›é˜¶" scheme="http://zhoulingyu.com/categories/iOS/iOS%E8%BF%9B%E9%98%B6/"/>
    
    
      <category term="iOS" scheme="http://zhoulingyu.com/tags/iOS/"/>
    
      <category term="å†…å­˜ä¸å¼•ç”¨" scheme="http://zhoulingyu.com/tags/%E5%86%85%E5%AD%98%E4%B8%8E%E5%BC%95%E7%94%A8/"/>
    
      <category term="iOSè¿›é˜¶" scheme="http://zhoulingyu.com/tags/iOS%E8%BF%9B%E9%98%B6/"/>
    
  </entry>
  
  <entry>
    <title>æ‰¾å›ä¸¢å¤±çš„ Githubï¼ˆè°¨æ…ä¿ç®¡ 2FA éªŒè¯ï¼‰</title>
    <link href="http://zhoulingyu.com/2017/02/07/%E6%89%BE%E5%9B%9E%E4%B8%A2%E5%A4%B1%E7%9A%84-Github-%E8%A1%80%E6%B3%AA%E5%8F%B2%EF%BC%88%E8%B0%A8%E6%85%8E%E4%BF%9D%E7%AE%A1-2FA-%E9%AA%8C%E8%AF%81%EF%BC%89/"/>
    <id>http://zhoulingyu.com/2017/02/07/æ‰¾å›ä¸¢å¤±çš„-Github-è¡€æ³ªå²ï¼ˆè°¨æ…ä¿ç®¡-2FA-éªŒè¯ï¼‰/</id>
    <published>2017-02-07T14:53:14.000Z</published>
    <updated>2018-07-10T03:07:31.632Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Why-æˆ‘ä¸¢å¤±äº†-Github-è´¦å·"><a href="#Why-æˆ‘ä¸¢å¤±äº†-Github-è´¦å·" class="headerlink" title="Why æˆ‘ä¸¢å¤±äº† Github è´¦å·"></a>Why æˆ‘ä¸¢å¤±äº† Github è´¦å·</h1><p>ä»å‰å¤©ï¼Œç»è¿‡äº†ä¸¤å¤©æ—¶é—´ä¸ Github å®¢æœå¯¹è¯ï¼Œç»ˆäºæ‰¾å›äº†æˆ‘çš„ Githubã€‚</p><p>æœ‹å‹åœ¨é—®æˆ‘ä¸ºä»€ä¹ˆç™»é™†ä¸äº† Github çš„æ—¶å€™è¡¨ç¤ºä¸å¤ªç†è§£ã€‚</p><p>åŸå› å¾ˆç®€å•ï¼Œå› ä¸ºæˆ‘ä¸¢å¤±äº†ä¸¤æ­¥éªŒè¯çš„ appï¼Œä¹Ÿä¸¢å¤±äº† recovery codeã€‚</p><a id="more"></a><h1 id="2FA-å’ŒåŸºäºæ—¶é—´æˆ³çš„å®æ—¶éªŒè¯ç "><a href="#2FA-å’ŒåŸºäºæ—¶é—´æˆ³çš„å®æ—¶éªŒè¯ç " class="headerlink" title="2FA å’ŒåŸºäºæ—¶é—´æˆ³çš„å®æ—¶éªŒè¯ç "></a>2FA å’ŒåŸºäºæ—¶é—´æˆ³çš„å®æ—¶éªŒè¯ç </h1><p>å…¶å®ï¼Œæ˜¯è¿™æ ·çš„ã€‚Github ä¹Ÿæœ‰ä¸¤æ­¥éªŒè¯ï¼ˆ2FAï¼‰ï¼Œæä¾›äº†ä¸¤ç§å¯é€‰æ–¹å¼ï¼š</p><ol><li>ä½¿ç”¨æ‰‹æœºæ¥æ”¶çŸ­ä¿¡</li><li>ä½¿ç”¨ç”±æ—¶é—´æˆ³ç”Ÿæˆçš„ 2FA å®æ—¶éªŒè¯ç ç”Ÿæˆ</li></ol><p>ç”±äºæ–¹æ³• 1 æ— æ³•æ”¯æŒå›½å†…çš„æ‰‹æœºå·ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨æ–¹æ³• 2ã€‚</p><p>æ–¹æ³•äºŒçš„åŸç†æ˜¯ï¼ŒGithub ä¼šæä¾›ä¸€ä¸ªç§˜é’¥ï¼Œé€šå¸¸ä»¥äºŒç»´ç çš„æ–¹å¼æ˜¾ç¤ºï¼Œç”¨ä¸‰æ–¹è½¯ä»¶æ¯”å¦‚ Autenticatorã€1passwordï¼ˆå½“æ—¶æˆ‘ä¸çŸ¥é“ 1password ä¹Ÿå¯ä»¥ï¼‰ åœ¨æ‰«ç ä¹‹åï¼Œå°†ç§˜é’¥ä¿å­˜åˆ°å®¢æˆ·ç«¯ã€‚</p><p>åœ¨ç”¨æˆ·ç™»é™†çš„æ—¶å€™ï¼Œapp ä¼šä»¥ç§˜é’¥å’Œæ—¶é—´æˆ³ä¸ºå‚æ•°ï¼Œé€šè¿‡å›ºå®šç®—æ³•ç”Ÿæˆä¸€ä¸ª 6 ä½æ•°å­—çš„ä¸€æ¬¡éªŒè¯ç ã€‚</p><p>æœåŠ¡ç«¯é€šè¿‡åŒæ ·çš„ç®—æ³•ä¹Ÿä¼šç”Ÿæˆä¸€ä¸ªåŒæ ·çš„ä¸€æ¬¡æ€§éªŒè¯ç ï¼Œä¸¤è€…å¯¹æ¯”ä¸€è‡´ï¼Œåˆ™é€šè¿‡éªŒè¯ã€‚å’Œæ‰‹æœºçŸ­ä¿¡æ¥æ”¶éªŒè¯ç å¾ˆç±»ä¼¼ã€‚</p><p>Github åœ¨å¼€å¯ 2FA çš„åŒæ—¶ï¼Œä¼šæä¾›ç»™ä½ ä¸€ä»½ recovery codeï¼Œå¦‚æœä½ æ— æ³•æ‹¿åˆ°ä¸€æ¬¡éªŒè¯ç ï¼Œå°±ä½¿ç”¨ recovery code æš‚æ—¶é€šè¿‡éªŒè¯ã€‚recovery code åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œä½¿ç”¨è¿‡ä¸€æ¬¡ä»¥åï¼Œå°±ä¼šè¢«æ›´æ–°ï¼Œä½ éœ€è¦ä¿å­˜æ–°çš„ recovery codeã€‚</p><p>å½“æ—¶æˆ‘é€‰æ‹©éªŒè¯ç ç”Ÿæˆ app æ˜¯ Google çš„ Autenticatorã€‚å°±æ˜¯è¿™ä¸ª app å‘äº†æˆ‘ã€‚è¿™ä¸ª app ä¸éœ€è¦ç™»é™†ï¼Œæˆ‘ç›´æ¥æ‰«ç å°±è®°å½•äº†ï¼Œä½†æ˜¯æˆ‘å½“æ—¶ç”¨çš„ iPhone 6ï¼Œåœ¨æ›´æ¢äº† iPhone 7 ä¹‹åï¼ŒiPhone 6 å€Ÿç»™ä»–äººä½¿ç”¨å‰åšäº†æŠ¹é™¤ï¼ŒSoï¼Œæˆ‘æ²¡æœ‰äº† appï¼Œåªèƒ½é€šè¿‡ recovery code æ¢å¤ï¼Œä½†æ˜¯å¥‡æ€ªçš„äº‹ï¼Œæˆ‘ä½¿ç”¨ä¸‰ä¸ªæœˆå†…æˆ‘å°è±¡é‡Œæœ€æ–°çš„ recovery code å»éªŒè¯ï¼Œä½†æ˜¯å¤±è´¥äº†ã€‚</p><p>åœ¨å½»åº•æŠ˜è…¾ä¸€ç•ªå‘ç°æ²¡åŠæ³•åï¼Œå»è”ç³»äº† Github å®¢æœã€‚</p><h1 id="Github-å®¢æœ"><a href="#Github-å®¢æœ" class="headerlink" title="Github å®¢æœ"></a>Github å®¢æœ</h1><p>å½“ä½ æ²¡æœ‰ 2FA appï¼Œä¹Ÿä¸¢å¤±äº† recovery code ä¹‹åï¼Œä½ å¿…é¡»å»è”ç³»å®¢æœï¼Œè¯·æ±‚å¸®åŠ©ä½ å…³é—­ 2FAã€‚</p><p>è¿™æ—¶å€™å®¢æœä¼šè¦æ±‚ä½ è¿è¡Œä¸€æ®µ commandï¼Œä»¥è¯æ˜çš„ç”µè„‘ä½¿ç”¨è¿‡æ­¤è´¦å·çš„å…¬é’¥ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com verify</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘æ€æ ·ä¹Ÿå¾—ä¸åˆ°ç»“æœï¼Œè¦ä¹ˆæç¤º DNS åŠ«æŒï¼ˆå’Œå…¬å¸çš„ç½‘ç»œç¿»å¢™äº†æœ‰å…³ï¼‰ï¼Œè¦ä¹ˆå…¶ä»–çš„ç§ç§é—®é¢˜ã€‚</p><p>åœ¨å’Œ Github å®¢æœä¸€ç•ªå¯¹è¯åï¼Œå¯¹æ–¹è¡¨ç¤ºéªŒè¯çš„ ssh å…¬é’¥æ˜¯åº”ç”± Github Destop è½¯ä»¶ç”Ÿæˆäº†ã€‚å½“æ—¶å¾ˆæ‡µé€¼ï¼Œé—®å¯¹æ–¹ã€éš¾é“æˆ‘è‡ªå·±ç”Ÿæˆçš„ç§˜é’¥å°±ä¸æ˜¯ç§˜é’¥äº†ï¼Ÿéš¾é“ä¸èƒ½è¯æ˜æˆ‘ç”µè„‘ç”Ÿæˆçš„è¿™ä¸ªå…¬é’¥ï¼Ÿã€ã€‚ç„¶åå®¢æœå°±è¯´ã€ä½  2015 å¹´ç”¨ä¸€å° Macbook Pro ç”Ÿæˆäº†ä¸€ä¸ªå…¬é’¥ï¼Œè¿™æ˜¯ä½ çš„ç”µè„‘å—ï¼Ÿã€ï¼Œç„¶å run ä¸€ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -i ~/.ssh/github_rsa -T git@github.com verify</span><br></pre></td></tr></table></figure><p>ç„¶å run ä¹‹åï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Enter passphrase for key &apos;/Users/zhoulingyu/.ssh/github_rsa&apos;:</span><br></pre></td></tr></table></figure><p>å½“æ—¶æˆ‘æƒ³äº†ä¸€ä¸‹ï¼Œå‚»å‚»çš„è¾“å…¥äº† Github å¯†ç ï¼Œç„¶è€Œä¸å¯¹ã€‚ç„¶åæˆ‘è®©å‡ ä¸ªæœ‹å‹ run äº†ä¸€ä¸‹ï¼Œå‡æ˜¯ç›´æ¥æ˜¾ç¤ºå‡ºäº† verification tokenã€‚æˆ‘å¾ˆå¥‡æ€ªï¼Œäºæ˜¯æƒ³äº†ä¸€ä¸‹ï¼Œå‘ç°è¿™é‡Œè¦æ±‚è¾“å…¥çš„å¯†ç åº”è¯¥æ˜¯å½“åˆç”Ÿæˆå…¬é’¥çš„æ—¶å€™è®¾ç½®çš„å¯†ç ï¼Œé€šå¸¸å¾ˆå¤šäººéƒ½ä¼šé€‰æ‹©ä¸è®¾ç½®å¯†ç ï¼Œä½†æ˜¯æˆ‘æ˜¾ç„¶å½“åˆè®¾ç½®äº†ï¼Œç„¶è€Œæˆ‘è®°ä¸èµ·æ¥ã€‚</p><p>ä¸€ç•ªæœç´¢ä¹‹åï¼Œå¾—åˆ°äº†ä¸€ä¸ª happy çš„ç»“æœï¼Œå¦‚æœä½ æ˜¯ windowsï¼Œé‚£æ´—æ´—ç¡å§ï¼Œå¦‚æœæ˜¯ Macï¼Œè¿™ä¸ªå¯†ç å¯ä»¥åœ¨ keychain ä¸­æ‰¾åˆ°ï¼Œå…·ä½“æ–¹æ³•åœ¨<a href="https://help.github.com/articles/recovering-your-ssh-key-passphrase/" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚</p><p>æˆ‘ä» keychain ä¸­ç²˜å‡ºå¯†ç åæˆ‘å°±æƒŠå‘†äº†ï¼Œæ˜¯ä¸€ä¸ª 40 å¤šä½çš„å¯†ç ã€‚æ˜¾ç„¶æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„é«˜å¤æ‚åº¦å¯†ç ã€‚æˆ‘å½“æ—¶ä¸€å®šæ˜¯å¿˜äº†ä¿å­˜ã€‚</p><p>SOï¼Œæ‹¿åˆ° verification token ä¹‹åï¼ŒGithub å®¢æœå°±å¸®æˆ‘å…³æ‰äº† 2FAã€‚</p><p>éšåï¼Œæˆ‘å‘ç° 1password æ˜¯å¯ä»¥ç”Ÿæˆä¸€æ¬¡æ€§éªŒè¯ç çš„ï¼Œäºæ˜¯ä½¿ç”¨ 1password ä¿å­˜ï¼Œä¸åœ¨ä½¿ç”¨ Google çš„ appã€‚</p><h1 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h1><p>è¿™ç¯‡æ–‡ç« å°±æ˜¯åšä¸€ä¸ªè®°å½•ï¼Œè‡ªå·±å¼„äº†ä¸¤å¤©ï¼Œéƒ½å»æŒ‰ç…§å®¢æœæ„è§æ–°å»ºäº† Gihub è´¦å· Fork äº†åŸæ¥æ‰€æœ‰çš„é¡¹ç›®ã€‚æœ€ç»ˆæ‰¾åˆ°çš„æ—¶å€™ä¹Ÿæ˜¯å–œå‡ºæœ›å¤–ã€‚</p><p>ä¹Ÿå¸Œæœ›è¿™ç¯‡è®°å½•èƒ½å¸®åˆ°å…¶ä»–äººã€‚</p><hr><p>æœ‰ä»€ä¹ˆé—®é¢˜éƒ½å¯ä»¥åœ¨åšæ–‡åé¢ç•™è¨€ï¼Œæˆ–è€…å¾®åšä¸Šç§ä¿¡æˆ‘ï¼Œæˆ–è€…é‚®ä»¶æˆ‘ <a href="mailto:&#x63;&#x6f;&#100;&#101;&#114;&#x66;&#x69;&#x73;&#x68;&#x40;&#49;&#54;&#x33;&#46;&#99;&#x6f;&#109;" target="_blank" rel="noopener">&#x63;&#x6f;&#100;&#101;&#114;&#x66;&#x69;&#x73;&#x68;&#x40;&#49;&#54;&#x33;&#46;&#99;&#x6f;&#109;</a>ã€‚</p><p>åšä¸»æ˜¯ iOS å¦¹å­ä¸€æšã€‚</p><p>å¸Œæœ›å¤§å®¶ä¸€èµ·è¿›æ­¥ã€‚</p><p>æˆ‘çš„å¾®åšï¼š<a href="http://weibo.com/coderfish/" target="_blank" rel="noopener">å°é±¼å‘¨å‡Œå®‡</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Why-æˆ‘ä¸¢å¤±äº†-Github-è´¦å·&quot;&gt;&lt;a href=&quot;#Why-æˆ‘ä¸¢å¤±äº†-Github-è´¦å·&quot; class=&quot;headerlink&quot; title=&quot;Why æˆ‘ä¸¢å¤±äº† Github è´¦å·&quot;&gt;&lt;/a&gt;Why æˆ‘ä¸¢å¤±äº† Github è´¦å·&lt;/h1&gt;&lt;p&gt;ä»å‰å¤©ï¼Œç»è¿‡äº†ä¸¤å¤©æ—¶é—´ä¸ Github å®¢æœå¯¹è¯ï¼Œç»ˆäºæ‰¾å›äº†æˆ‘çš„ Githubã€‚&lt;/p&gt;
&lt;p&gt;æœ‹å‹åœ¨é—®æˆ‘ä¸ºä»€ä¹ˆç™»é™†ä¸äº† Github çš„æ—¶å€™è¡¨ç¤ºä¸å¤ªç†è§£ã€‚&lt;/p&gt;
&lt;p&gt;åŸå› å¾ˆç®€å•ï¼Œå› ä¸ºæˆ‘ä¸¢å¤±äº†ä¸¤æ­¥éªŒè¯çš„ appï¼Œä¹Ÿä¸¢å¤±äº† recovery codeã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Other" scheme="http://zhoulingyu.com/categories/Other/"/>
    
      <category term="Github" scheme="http://zhoulingyu.com/categories/Other/Github/"/>
    
    
      <category term="Other" scheme="http://zhoulingyu.com/tags/Other/"/>
    
      <category term="Github" scheme="http://zhoulingyu.com/tags/Github/"/>
    
  </entry>
  
  <entry>
    <title>iOSâ€”â€”å…³äº-Taptic-Engine-éœ‡åŠ¨åé¦ˆ</title>
    <link href="http://zhoulingyu.com/2017/01/16/iOS%E2%80%94%E2%80%94%E5%85%B3%E4%BA%8E-Taptic-Engine-%E9%9C%87%E5%8A%A8%E5%8F%8D%E9%A6%88/"/>
    <id>http://zhoulingyu.com/2017/01/16/iOSâ€”â€”å…³äº-Taptic-Engine-éœ‡åŠ¨åé¦ˆ/</id>
    <published>2017-01-16T10:30:17.000Z</published>
    <updated>2018-07-10T03:07:31.628Z</updated>
    
    <content type="html"><![CDATA[<h1 id="What-has-Happenedï¼Ÿ"><a href="#What-has-Happenedï¼Ÿ" class="headerlink" title="What has Happenedï¼Ÿ"></a>What has Happenedï¼Ÿ</h1><p>ä¸Šå‘¨ï¼Œleader æ‹¿ç€ iPhone 7 æ‰“å¼€äº†ç½‘æ˜“æ–°é—»ï¼Œé—®æˆ‘ï¼šã€ä½ çœ‹ï¼Œä½ è¿™é‡Œçš„ä¸‹æ‹‰åˆ·æ–°æ˜¯<code>çŸ­éœ‡åŠ¨</code>ï¼Œæˆ‘ä»¬çš„æ‰‹æœºæ•°å‘¨é¥æ§ç”µè§†çš„æ—¶å€™åªæœ‰<code>é•¿éœ‡åŠ¨</code>ï¼Œäº§å“é‚£è¾¹é—®èƒ½ä¸èƒ½ç”¨çŸ­éœ‡åŠ¨ã€ã€‚</p><p>ç„¶ååšä¸»å°±å»æŸ¥çœ‹äº†ä¸€ä¸‹å…³äºçŸ­éœ‡åŠ¨çš„æ–¹å¼ï¼Œæ•´ä¸ªè¿‡ç¨‹å¯ä»¥æè¿°ä¸ºâ€”â€”ã€èµ„æ–™çœŸå°‘ï¼ã€ã€‚</p><p>ä¸è¿‡æœ€åé€šè¿‡ä¸€ä¸‹åˆçš„æœé›†ï¼Œæœ€ç»ˆè¿˜æ˜¯æ€»ç»“æ•´ç†å‡ºæ¥äº†è¿™ä»½æ–‡æ¡£ï¼Œä¹Ÿè¡¥å……äº†è‡ªå·±å¯¹ iPhone 6s ä¹‹åå¯¹ Taptic Engine çš„äº†è§£ã€‚</p><a id="more"></a><h1 id="Taptic-Engine"><a href="#Taptic-Engine" class="headerlink" title="Taptic Engine"></a>Taptic Engine</h1><p>å…ˆäº†è§£ä¸€ä¸ªæ¦‚å¿µâ€”â€”Taptic Engine</p><p>Taptic Engine æ˜¯è‹¹æœäº§å“ä¸Šæ¨å‡ºçš„å…¨æ–°éœ‡åŠ¨æ¨¡å—ï¼Œè¯¥å…ƒä»¶æœ€æ—©å‡ºç°åœ¨ Apple Watch ä¸­ã€‚iPhone 6s å’Œ iPhone 6s Plus ä¸­ï¼Œä¹ŸåŒæ ·å†…ç½®äº†Taptic Engineï¼Œåœ¨è®¾è®¡ä¸Šæœ‰æ‰€å‡çº§ã€‚</p><p>Taptic Engine æŒ¯åŠ¨æ¨¡å—ä¸º Apple Watch ä»¥åŠ iPhone 6sã€iPhone 7 æä¾›äº† Force Touch ä»¥åŠ 3D Touchï¼Œä¸åŒçš„å±å¹•æ“ä½œï¼Œå¯ä»¥æ„Ÿå—åˆ°ä¸åŒçš„æŒ¯åŠ¨è§¦è§‰æ•ˆæœï¼Œå¸¦æ¥æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚</p><h1 id="çŸ­éœ‡æ–¹æ³•ä¸€-AudioServicesPlaySystemSound"><a href="#çŸ­éœ‡æ–¹æ³•ä¸€-AudioServicesPlaySystemSound" class="headerlink" title="çŸ­éœ‡æ–¹æ³•ä¸€ AudioServicesPlaySystemSound"></a>çŸ­éœ‡æ–¹æ³•ä¸€ AudioServicesPlaySystemSound</h1><p>å¸¸ç”¨è°ƒç”¨ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AudioServicesPlaySystemSound(kSystemSoundID_Vibrate);</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç åœ¨å„ä¸ªå‹å·æ‰‹æœºä¸­ååº”ä¸ºé•¿éœ‡</p><p>API ç³»ç»Ÿç‰ˆæœ¬æ”¯æŒï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__OSX_AVAILABLE_STARTING(__MAC_10_5,__IPHONE_2_0);</span><br></pre></td></tr></table></figure><p>APPLE å…¬å¼€çš„ <code>SystemSoundID</code> æœ‰ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CF_ENUM</span>(SystemSoundID)</span><br><span class="line">&#123;</span><br><span class="line">    kSystemSoundID_UserPreferredAlert   = <span class="number">0x00001000</span>,</span><br><span class="line">    kSystemSoundID_FlashScreen          = <span class="number">0x00000FFE</span>,</span><br><span class="line">        <span class="comment">// this has been renamed to be consistent</span></span><br><span class="line">    kUserPreferredAlert     = kSystemSoundID_UserPreferredAlert</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">CF_ENUM</span>(SystemSoundID)</span><br><span class="line">&#123;</span><br><span class="line">    kSystemSoundID_Vibrate              = <span class="number">0x00000FFF</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šç±»å‹ <em><strong>æ²¡æœ‰çŸ­éœ‡åŠ¨</strong></em> ã€‚</p><p>ä½†é€šè¿‡ä»¥ä¸‹ä»£ç ï¼Œå¯ä»¥å¾—åˆ°æ›´å¤šç±»å‹çš„éœ‡åŠ¨ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ™®é€šçŸ­éœ‡ï¼Œ3D Touch ä¸­ Peek éœ‡åŠ¨åé¦ˆ</span></span><br><span class="line">AudioServicesPlaySystemSound(<span class="number">1519</span>);</span><br></pre></td></tr></table></figure><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ™®é€šçŸ­éœ‡ï¼Œ3D Touch ä¸­ Pop éœ‡åŠ¨åé¦ˆ</span></span><br><span class="line">AudioServicesPlaySystemSound(<span class="number">1520</span>);</span><br></pre></td></tr></table></figure><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿ç»­ä¸‰æ¬¡çŸ­éœ‡</span></span><br><span class="line">AudioServicesPlaySystemSound(<span class="number">1521</span>);</span><br></pre></td></tr></table></figure><p>ä½†ä»¥ä¸Š ID å‡æœªåœ¨ Apple çš„ Documents ä¸­æè¿°ã€‚æ˜¾ç„¶ï¼Œ<em><strong>è¿™æ˜¯è°ƒç”¨äº†ä¸€äº›ç§æœ‰ä¸€äº›å±æ€§ </strong></em> ã€‚</p><p>å…³äºæ˜¯å¦è°ƒç”¨äº†ç§æœ‰ APIï¼Œä¹Ÿæœ‰ä¸€äº›è®¨è®ºï¼Œå¯ä»¥æŸ¥çœ‹<a href="https://forums.developer.apple.com/thread/45628" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚</p><h1 id="çŸ­éœ‡æ–¹æ³•äºŒ-è·å–-tapticEngine"><a href="#çŸ­éœ‡æ–¹æ³•äºŒ-è·å–-tapticEngine" class="headerlink" title="çŸ­éœ‡æ–¹æ³•äºŒ è·å– _tapticEngine"></a>çŸ­éœ‡æ–¹æ³•äºŒ è·å– _tapticEngine</h1><p>è¿™ç§æ–¹æ³•æ˜¯ä»<a href="https://unifiedsense.com/development/using-taptic-engine-on-ios.html" target="_blank" rel="noopener">è¿™é‡Œ</a>æœé›†åˆ°çš„ã€‚</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">id</span> tapticEngine = [[<span class="built_in">UIDevice</span> currentDevice] performSelector: <span class="built_in">NSSelectorFromString</span>(<span class="string">@"_tapticEngine"</span>)</span><br><span class="line">                                                     withObject:<span class="literal">nil</span>];</span><br><span class="line">[tapticEngine performSelector: <span class="built_in">NSSelectorFromString</span>(<span class="string">@"actuateFeedback:"</span>)</span><br><span class="line">                       withObject:@(<span class="number">0</span>)];</span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">id</span> tapticEngine = [[<span class="built_in">UIDevice</span> currentDevice] performSelector: <span class="built_in">NSSelectorFromString</span>(<span class="string">@"_tapticEngine"</span>)</span><br><span class="line">                                                     withObject:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">SEL selector = <span class="built_in">NSSelectorFromString</span>(<span class="string">@"actuateFeedback:"</span>);</span><br><span class="line">int32_t arg = <span class="number">1001</span>;</span><br><span class="line">    </span><br><span class="line"><span class="built_in">NSInvocation</span> *inv = [<span class="built_in">NSInvocation</span> invocationWithMethodSignature:[tapticEngine methodSignatureForSelector:selector]];</span><br><span class="line">[inv setTarget:tapticEngine];</span><br><span class="line">[inv setSelector:selector];</span><br><span class="line">[inv setArgument:&amp;arg atIndex:<span class="number">2</span>];</span><br><span class="line">[inv invoke];</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶ï¼Œ <em><strong>è¿™æ˜¯è°ƒç”¨äº†ç§æœ‰ API</strong></em> ã€‚</p><p>è¿™äº›æ–¹æ³•ï¼Œåœ¨å®é™…æµ‹è¯•çš„æ—¶å€™å‘ç°ï¼Œåœ¨ iPhone 7 ä¸Šè°ƒç”¨æ²¡æœ‰éœ‡åŠ¨åé¦ˆï¼Œåœ¨ iPhone 6S Plus ä¸Šè°ƒç”¨æœ‰éœ‡åŠ¨åé¦ˆï¼Œåœ¨ iPhone 6 ä¸Šè°ƒç”¨ æ— åé¦ˆã€‚</p><h1 id="çŸ­éœ‡æ–¹æ³•ä¸‰-UIImpactFeedbackGenerator"><a href="#çŸ­éœ‡æ–¹æ³•ä¸‰-UIImpactFeedbackGenerator" class="headerlink" title="çŸ­éœ‡æ–¹æ³•ä¸‰ UIImpactFeedbackGenerator"></a>çŸ­éœ‡æ–¹æ³•ä¸‰ UIImpactFeedbackGenerator</h1><p>iOS10 å¼•å…¥äº†ä¸€ç§æ–°çš„ã€äº§ç”Ÿè§¦è§‰åé¦ˆçš„æ–¹å¼ï¼Œ <em><strong>å¸®åŠ©ç”¨æˆ·è®¤è¯†åˆ°ä¸åŒçš„éœ‡åŠ¨åé¦ˆæœ‰ä¸åŒçš„å«ä¹‰</strong></em> ã€‚è¿™ä¸ªåŠŸèƒ½çš„æ ¸å¿ƒå°±æ˜¯ç”± <code>UIFeedbackGenerator</code> æä¾›ã€‚Apple å¯¹äº <code>UIImpactFeedbackGenerator</code> æœ‰ä¸€ç¯‡<a href="https://developer.apple.com/reference/uikit/uifeedbackgenerator#2555399" target="_blank" rel="noopener">ä»‹ç»æ–‡æ¡£</a>ã€‚</p><p>UIFeedbackGenerator å¯ä»¥å¸®åŠ©ä½ å®ç° haptic feedbackã€‚å®ƒçš„è¦æ±‚æ˜¯ï¼š</p><ol><li>æ”¯æŒ Taptic Engine æœºå‹ (iPhone 7 ä»¥åŠ iPhone 7 Plus).</li><li>app éœ€è¦åœ¨å‰å°è¿è¡Œ</li><li>ç³»ç»Ÿ Haptics setting éœ€è¦å¼€å¯</li></ol><p>Apple æ›¾è¡¨ç¤ºå…¬å¼€äº† Taptic Engine çš„ APIï¼Œä½†æ˜¯é²œæœ‰æ–‡æ¡£ã€‚åœ¨æœç½—äº†å„ç§èµ„æ–™åï¼Œå¯ä»¥è®¤ä¸º <code>UIImpactFeedbackGenerator</code> å³ Taptic Engine çš„ å…¬å¼€ APIã€‚</p><p>å®ƒçš„è°ƒç”¨æ–¹å¼æ˜¯ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIImpactFeedbackGenerator</span> *generator = [[<span class="built_in">UIImpactFeedbackGenerator</span> alloc] initWithStyle: <span class="built_in">UIImpactFeedbackStyleLight</span>];</span><br><span class="line">[generator prepare];</span><br><span class="line">[generator impactOccurred];</span><br></pre></td></tr></table></figure><h1 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h1><p>è§‚å¯Ÿ <code>UIImpactFeedbackGenerator</code> ä½ ä¼šå‘ç°å®ƒç»§æ‰¿äº <code>UIFeedbackGenerator</code>ã€‚é™¤äº† <code>UIImpactFeedbackGenerator</code> è¿˜æœ‰ä¸‰ç§ FeedbackGeneratorï¼š</p><ol><li>UIImpactFeedbackGenerator</li><li>UISelectionFeedbackGenerator</li><li>UINotificationFeedbackGenerator</li></ol><p>è¯¦æƒ…å¯å‚è€ƒ Apple çš„ <a href="https://developer.apple.com/reference/uikit/uifeedbackgenerator?language=objc" target="_blank" rel="noopener">è¿™ç¯‡ Reference</a> ã€‚</p><p>å¯¹äºéœ‡åŠ¨åé¦ˆçš„åº”ç”¨ï¼ŒApple ä¹Ÿç»™å‡ºäº†ç¤ºä¾‹åœºæ™¯ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">IBAction</span>)gestureHandler:(<span class="built_in">UIPanGestureRecognizer</span> *)sender &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">switch</span> (sender.state) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">UIGestureRecognizerStateBegan</span>:</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Instantiate a new generator.</span></span><br><span class="line">            <span class="keyword">self</span>.feedbackGenerator = [[<span class="built_in">UISelectionFeedbackGenerator</span> alloc] init];</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Prepare the generator when the gesture begins.</span></span><br><span class="line">            [<span class="keyword">self</span>.feedbackGenerator prepare];</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">UIGestureRecognizerStateChanged</span>:</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Check to see if the selection has changed...</span></span><br><span class="line">            <span class="keyword">if</span> ([<span class="keyword">self</span> myCustomHasSelectionChangedMethodWithTranslation:[sender translationInView: <span class="keyword">self</span>.view]]) &#123;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// Trigger selection feedback.</span></span><br><span class="line">                [<span class="keyword">self</span>.feedbackGenerator selectionChanged];</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// Keep the generator in a prepared state.</span></span><br><span class="line">                [<span class="keyword">self</span>.feedbackGenerator prepare];</span><br><span class="line">    </span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">UIGestureRecognizerStateCancelled</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">UIGestureRecognizerStateEnded</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">UIGestureRecognizerStateFailed</span>:</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Release the current generator.</span></span><br><span class="line">            <span class="keyword">self</span>.feedbackGenerator = <span class="literal">nil</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Do nothing.</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ä¸‰ç§æ–¹æ³•åœ¨æµ‹è¯•æœºä¸Šä¸åŒçš„åé¦ˆç»“æœ"><a href="#ä¸‰ç§æ–¹æ³•åœ¨æµ‹è¯•æœºä¸Šä¸åŒçš„åé¦ˆç»“æœ" class="headerlink" title="ä¸‰ç§æ–¹æ³•åœ¨æµ‹è¯•æœºä¸Šä¸åŒçš„åé¦ˆç»“æœ"></a>ä¸‰ç§æ–¹æ³•åœ¨æµ‹è¯•æœºä¸Šä¸åŒçš„åé¦ˆç»“æœ</h1><table><thead><tr><th>AudioServicesPlaySystemSound</th><th>1519</th><th>1520</th><th>1521</th></tr></thead><tbody><tr><td>iPhone 7ï¼ˆiOS 10ï¼‰</td><td>peek è§¦æ„Ÿ</td><td>pop è§¦æ„Ÿ</td><td>ä¸‰æ¬¡è¿ç»­çŸ­æŒ¯</td></tr><tr><td>iPhone 6s Pulsï¼ˆiOS 9ï¼‰</td><td>peek è§¦æ„Ÿ</td><td>pop è§¦æ„Ÿ</td><td>ä¸‰æ¬¡è¿ç»­çŸ­æŒ¯</td></tr><tr><td>iPhone 6ï¼ˆiOS 10ï¼‰</td><td>æ— æŒ¯åŠ¨</td><td>æ— æŒ¯åŠ¨</td><td>æ— æŒ¯åŠ¨</td></tr></tbody></table><table><thead><tr><th>è·å– _tapticEngine</th><th></th></tr></thead><tbody><tr><td>iPhone 7ï¼ˆiOS 10ï¼‰</td><td>æ— æŒ¯åŠ¨</td></tr><tr><td>iPhone 6s Pulsï¼ˆiOS 9ï¼‰</td><td>é•¿æŒ¯</td></tr><tr><td>iPhone 6ï¼ˆiOS 10ï¼‰</td><td>æ— æŒ¯åŠ¨</td></tr></tbody></table><table><thead><tr><th>UIImpactFeedbackGenerator</th><th>.Light</th><th>.Medium</th><th>.Heavy</th></tr></thead><tbody><tr><td>iPhone 7ï¼ˆiOS 10ï¼‰</td><td>å¾®å¼±çŸ­æŒ¯</td><td>ä¸­ç­‰çŸ­æŒ¯</td><td>æ˜æ˜¾çŸ­æŒ¯</td></tr><tr><td>iPhone 6s Pulsï¼ˆiOS 9ï¼‰</td><td>é•¿æŒ¯</td><td>é•¿æŒ¯</td><td>é•¿æŒ¯</td></tr><tr><td>iPhone 6ï¼ˆiOS 10ï¼‰</td><td>æ— æŒ¯åŠ¨</td><td>æ— æŒ¯åŠ¨</td><td>æ— æŒ¯åŠ¨</td></tr></tbody></table><p>æ€»ç»“ä¸€ä¸‹ï¼Œå¸Œæœ›åŒæ ·çš„ä»£ç èƒ½åœ¨æ›´å¤šçš„æœºå‹ä¸Šå®ç°çŸ­æŒ¯ï¼Œå»ºè®®ä½¿ç”¨ AudioServicesPlaySystemSound(1519)ã€‚ä¸è¿‡å¯èƒ½ä¼šæ¶‰åŠåˆ°è°ƒç”¨ç§æœ‰ APIã€‚å®‰å…¨èµ·è§ï¼Œå¯ä»¥ä½¿ç”¨ <code>UIImpactFeedbackGenerator</code>ã€‚</p><h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><p>æµ‹è¯•ä»£ç åœ¨<a href="https://github.com/summertian4/iOS-ObjectiveC/tree/master/iPhoneShakeDemo" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚</p><hr><p>æœ‰ä»€ä¹ˆé—®é¢˜éƒ½å¯ä»¥åœ¨åšæ–‡åé¢ç•™è¨€ï¼Œæˆ–è€…å¾®åšä¸Šç§ä¿¡æˆ‘ï¼Œæˆ–è€…é‚®ä»¶æˆ‘ <a href="mailto:&#x63;&#111;&#x64;&#x65;&#114;&#102;&#105;&#x73;&#x68;&#64;&#49;&#x36;&#51;&#46;&#x63;&#111;&#109;" target="_blank" rel="noopener">&#x63;&#111;&#x64;&#x65;&#114;&#102;&#105;&#x73;&#x68;&#64;&#49;&#x36;&#51;&#46;&#x63;&#111;&#109;</a>ã€‚</p><p>åšä¸»æ˜¯ iOS å¦¹å­ä¸€æšã€‚</p><p>å¸Œæœ›å¤§å®¶ä¸€èµ·è¿›æ­¥ã€‚</p><p>æˆ‘çš„å¾®åšï¼š<a href="http://weibo.com/coderfish/" target="_blank" rel="noopener">å°é±¼å‘¨å‡Œå®‡</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;What-has-Happenedï¼Ÿ&quot;&gt;&lt;a href=&quot;#What-has-Happenedï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;What has Happenedï¼Ÿ&quot;&gt;&lt;/a&gt;What has Happenedï¼Ÿ&lt;/h1&gt;&lt;p&gt;ä¸Šå‘¨ï¼Œleader æ‹¿ç€ iPhone 7 æ‰“å¼€äº†ç½‘æ˜“æ–°é—»ï¼Œé—®æˆ‘ï¼šã€ä½ çœ‹ï¼Œä½ è¿™é‡Œçš„ä¸‹æ‹‰åˆ·æ–°æ˜¯&lt;code&gt;çŸ­éœ‡åŠ¨&lt;/code&gt;ï¼Œæˆ‘ä»¬çš„æ‰‹æœºæ•°å‘¨é¥æ§ç”µè§†çš„æ—¶å€™åªæœ‰&lt;code&gt;é•¿éœ‡åŠ¨&lt;/code&gt;ï¼Œäº§å“é‚£è¾¹é—®èƒ½ä¸èƒ½ç”¨çŸ­éœ‡åŠ¨ã€ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶ååšä¸»å°±å»æŸ¥çœ‹äº†ä¸€ä¸‹å…³äºçŸ­éœ‡åŠ¨çš„æ–¹å¼ï¼Œæ•´ä¸ªè¿‡ç¨‹å¯ä»¥æè¿°ä¸ºâ€”â€”ã€èµ„æ–™çœŸå°‘ï¼ã€ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡æœ€åé€šè¿‡ä¸€ä¸‹åˆçš„æœé›†ï¼Œæœ€ç»ˆè¿˜æ˜¯æ€»ç»“æ•´ç†å‡ºæ¥äº†è¿™ä»½æ–‡æ¡£ï¼Œä¹Ÿè¡¥å……äº†è‡ªå·±å¯¹ iPhone 6s ä¹‹åå¯¹ Taptic Engine çš„äº†è§£ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://zhoulingyu.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://zhoulingyu.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€å‘¨é˜…è¯»åˆ—è¡¨-2017</title>
    <link href="http://zhoulingyu.com/2017/01/03/%E4%B8%80%E5%91%A8%E9%98%85%E8%AF%BB%E5%88%97%E8%A1%A8-2017/"/>
    <id>http://zhoulingyu.com/2017/01/03/ä¸€å‘¨é˜…è¯»åˆ—è¡¨-2017/</id>
    <published>2017-01-03T15:05:00.000Z</published>
    <updated>2018-07-10T03:07:31.632Z</updated>
    
    <content type="html"><![CDATA[<h1 id="2016-å¹´-1-æœˆ-1-æ—¥"><a href="#2016-å¹´-1-æœˆ-1-æ—¥" class="headerlink" title="2016 å¹´ 1 æœˆ 1 æ—¥ +"></a>2016 å¹´ 1 æœˆ 1 æ—¥ +</h1><p>æœ‰å…³ objc_autoreleasereturnvalue</p><p><del><a href="http://www.voidcn.com/blog/li15809284891/article/p-6244162.html" target="_blank" rel="noopener">iOS è‡ªåŠ¨é‡Šæ”¾æ± ARCä¸MRC</a></del></p><p><del><a href="http://blog.sunnyxx.com/2014/10/15/behind-autorelease/" target="_blank" rel="noopener">é»‘å¹•èƒŒåçš„Autorelease</a></del></p><p><del><a href="http://clang.llvm.org/docs/AutomaticReferenceCounting.html#arc-runtime-objc-autoreleasereturnvalue" target="_blank" rel="noopener">Clang 4.0 documentation</a></del></p><a id="more"></a><p><a href="http://daily.zhihu.com/story/9121798" target="_blank" rel="noopener">å¦‚ä½•åšä¸€æ¬¡æœ‰æ•ˆçš„ç»©æ•ˆè€ƒæ ¸é¢è°ˆï¼Ÿ</a></p><p><del><a href="https://github.com/izzyleung/ZhihuDailyPurify/wiki/%E7%9F%A5%E4%B9%8E%E6%97%A5%E6%8A%A5-API-%E5%88%86%E6%9E%90" target="_blank" rel="noopener">çŸ¥ä¹æ—¥æŠ¥ API åˆ†æ</a></del></p><p><a href="http://www.cocoachina.com/swift/20150918/13499.html" target="_blank" rel="noopener">Swift é¢è¯•é¢˜åŠå…¶ç­”æ¡ˆ</a></p><p><a href="http://mp.weixin.qq.com/s/JUx98M2U_K55aurFQcQlgw" target="_blank" rel="noopener">2016ç§»åŠ¨å¼€å‘æŠ€æœ¯å·¡ç¤¼</a></p><p><a href="http://web.jobbole.com/89568/" target="_blank" rel="noopener">å‰ç«¯ç²¾é€‰ 20 ä¸ªä¼˜è´¨çš„åŠ è½½åŠ¨ç”»</a></p><p><strong> æœ‰å…³ iOS10 æ–°ç‰¹æ€§ </strong></p><p><del>1. <a href="https://onevcat.com/2016/06/ios-10-sdk/" target="_blank" rel="noopener">å¼€å‘è€…æ‰€éœ€è¦çŸ¥é“çš„ iOS 10 SDK æ–°ç‰¹æ€§</a></del></p><p><del>2. <a href="http://blog.fir.im/fir_im_weekly160617/" target="_blank" rel="noopener">fir.im Weekly - ä» iOS 10 SDK æ–°ç‰¹æ€§è¯´èµ·</a></del></p><p><del>3. <a href="https://developer.apple.com/ios/" target="_blank" rel="noopener">iOS + Apps</a></del></p><p><del>4. <a href="https://developer.apple.com/library/content/releasenotes/General/WhatsNewIniOS/Articles/iOS10.html" target="_blank" rel="noopener">Whatâ€™s New in iOS10</a></del></p><p><del>5. <a href="http://www.jianshu.com/p/0cc7aad638d9" target="_blank" rel="noopener">å…¼å®¹iOS 10 èµ„æ–™æ•´ç†ç¬”è®°</a></del></p><p><a href="https://github.com/MoZhouqi/KMNavigationBarTransition" target="_blank" rel="noopener">KMNavigationBarTransition</a></p><p><a href="https://developer.apple.com/library/content/releasenotes/ObjectiveC/RN-TransitioningToARC/Introduction/Introduction.html" target="_blank" rel="noopener">Apple Transitioning to ARC Release Notes</a></p><p><del><a href="http://coolshell.cn/articles/222.html" target="_blank" rel="noopener">ä¼˜ç§€ç¨‹åºå‘˜çš„åä¸ªä¹ æƒ¯</a></del></p><p><del><a href="http://www.jianshu.com/p/d75a9a8d13b5?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io" target="_blank" rel="noopener">33 ä¸ª 2017 å¹´å¿…é¡»äº†è§£çš„ iOS å¼€æºåº“</a></del></p><p><del><a href="https://isux.tencent.com/qq-mobile-off-duty.html" target="_blank" rel="noopener">QQæ‰‹æœºç‰ˆ 5.0â€œä¸€é”®ä¸‹ç­â€è®¾è®¡å°ç»“</a></del></p><h1 id="2016-å¹´-2-æœˆ-1-æ—¥"><a href="#2016-å¹´-2-æœˆ-1-æ—¥" class="headerlink" title="2016 å¹´ 2 æœˆ 1 æ—¥ +"></a>2016 å¹´ 2 æœˆ 1 æ—¥ +</h1><p><a href="http://www.jianshu.com/p/b3225d7de6bf" target="_blank" rel="noopener">æµ…æUIApplicationç”Ÿå‘½å‘¨æœŸçš„ä¸€äº›delegateæ–¹æ³•</a></p><p><a href="http://www.jianshu.com/p/2dbb360886a8" target="_blank" rel="noopener">iOSå³æ—¶é€šè®¯ï¼Œä»å…¥é—¨åˆ°â€œæ”¾å¼ƒâ€ï¼Ÿ</a></p><p><a href="http://mp.weixin.qq.com/s/GFt7uqrKw7m3R3KrV43zIQ" target="_blank" rel="noopener">Baymaxï¼šç½‘æ˜“iOS Appè¿è¡Œæ—¶Crashè‡ªåŠ¨é˜²æŠ¤å®è·µ</a></p><p><a href="http://casatwy.com/iosying-yong-jia-gou-tan-ben-di-chi-jiu-hua-fang-an-ji-dong-tai-bu-shu.html" target="_blank" rel="noopener">iOSåº”ç”¨æ¶æ„è°ˆ æœ¬åœ°æŒä¹…åŒ–æ–¹æ¡ˆåŠåŠ¨æ€éƒ¨ç½²</a></p><p><a href="http://www.voidcn.com/blog/u012881779/article/p-4112998.html" target="_blank" rel="noopener">[IOS]åœ¨ä¸€ä¸ªå·¥ç¨‹ç®¡ç†å¤šä¸ªåº”ç”¨</a></p><p><a href="https://github.com/Draveness/iOS-Source-Code-Analyze/tree/master/contents/objc" target="_blank" rel="noopener">iOS-Source-Code-Analyze</a></p><p><a href="http://colin1994.github.io/2016/10/21/Core-Image-OverView/" target="_blank" rel="noopener">Core Image ä½ éœ€è¦äº†è§£çš„é‚£äº›äº‹~</a></p><p><a href="http://colin1994.github.io/2016/10/21/Core-Image-Custom-Filter/" target="_blank" rel="noopener">Core Image ä¹‹è‡ªå®šä¹‰ Filter~</a></p><p><a href="http://blog.imwcl.com/2017/02/16/iOSåŠ¨ç”»è¿›é˜¶-æ‰‹æ‘¸æ‰‹æ•™ä½ å†™ShineButtonåŠ¨ç”»/" target="_blank" rel="noopener">iOSåŠ¨ç”»è¿›é˜¶ - æ‰‹æ‘¸æ‰‹æ•™ä½ å†™ShineButtonåŠ¨ç”»</a></p><p><a href="http://yulingtianxia.com/blog/2017/01/16/DIY-a-simple-tow-way-list/" target="_blank" rel="noopener">DIY åŒå‘æ»‘åŠ¨åˆ—è¡¨</a></p><p><del><a href="http://www.jianshu.com/p/51d04b7639f1" target="_blank" rel="noopener">BlockæŠ€å·§ä¸åº•å±‚è§£æ</a></del></p><p><del><a href="http://www.cnblogs.com/debmzhang/p/5013540.html" target="_blank" rel="noopener">mysql çš„å¯†ç </a></del></p><p><del><a href="http://stackoverflow.com/questions/1559955/host-xxx-xx-xxx-xxx-is-not-allowed-to-connect-to-this-mysql-server" target="_blank" rel="noopener">github è¿œç¨‹è®¿é—®æƒé™</a></del></p><p><del><a href="http://www.jianshu.com/p/74124aee3c8f" target="_blank" rel="noopener">2017ï¼Œæˆ‘çš„iOSè¿›é˜¶è§„åˆ’</a></del></p><h1 id="2016-å¹´-3-æœˆ-1-æ—¥"><a href="#2016-å¹´-3-æœˆ-1-æ—¥" class="headerlink" title="2016 å¹´ 3 æœˆ 1 æ—¥ +"></a>2016 å¹´ 3 æœˆ 1 æ—¥ +</h1><p><a href="http://cache.xiaomiquan.com/d6a58b9cee9b67c871ca8c0fb24a62ca4637610269df037c5756ce11f3c7c507/" target="_blank" rel="noopener">æŠ€æœ¯å¾€äº‹ï¼šæ”¹å˜ä¸–ç•Œçš„TCP/IPåè®®ï¼ˆçè´µå¤šå›¾ã€æ‰‹æœºæ…ç‚¹ï¼‰</a></p><p><del><a href="http://amztion.com/2016/12/03/uiviewcontroller-lifecycle/" target="_blank" rel="noopener">UIViewController ç›¸å…³ç”Ÿå‘½å‘¨æœŸæ€»ç»“</a></del></p><p><del><a href="http://www.cocoachina.com/ios/20160113/14896.html" target="_blank" rel="noopener">iOSå¼€å‘ - äº‹ä»¶ä¼ é€’å“åº”é“¾</a></del></p><p><del><a href="https://git-scm.com/" target="_blank" rel="noopener">git</a></del></p><p><a href="http://www.jianshu.com/p/d7d951a99db8" target="_blank" rel="noopener">ReactiveCocoa ä¸­ RACSignal æ˜¯å¦‚ä½•å‘é€ä¿¡å·çš„</a></p><p><del><a href="http://ios.skyfox.org/route.html" target="_blank" rel="noopener">iOS å­¦ä¹ è·¯çº¿</a></del></p><p><del><a href="http://urouge.github.io/migrate-to-disqus/" target="_blank" rel="noopener">å¤šè¯´è¯„è®ºè¿ç§»è‡³Disqus</a></del></p><p><del><a href="http://yulingtianxia.com/blog/2015/11/01/More-than-you-want-to-know-about-synchronized/" target="_blank" rel="noopener">å…³äº @synchronizedï¼Œè¿™å„¿æ¯”ä½ æƒ³çŸ¥é“çš„è¿˜è¦å¤š</a></del></p><p><a href="http://www.jianshu.com/p/ddbe44064ca4" target="_blank" rel="noopener">iOS å¸¸è§çŸ¥è¯†ç‚¹ï¼ˆä¸‰ï¼‰ï¼šLock</a></p><h1 id="2016-å¹´-4-æœˆ-1-æ—¥"><a href="#2016-å¹´-4-æœˆ-1-æ—¥" class="headerlink" title="2016 å¹´ 4 æœˆ 1 æ—¥ +"></a>2016 å¹´ 4 æœˆ 1 æ—¥ +</h1><p><del><a href="http://merowing.info/2013/03/overlaying-application-version-on-top-of-your-icon/" target="_blank" rel="noopener">Overlaying application version on top of your icon</a></del></p><p><del><a href="https://my.oschina.net/leejun2005/blog/202376" target="_blank" rel="noopener">bash/shell è§£æå‘½ä»¤è¡Œå‚æ•°å·¥å…·ï¼šgetopts/getopt</a></del></p><p><del><a href="http://liam0205.me/2016/07/30/release-your-own-app-in-Homebrew/" target="_blank" rel="noopener">åœ¨ Homebrew ä¸Šå‘å¸ƒè‡ªå·±çš„ App</a></del></p><p><a href="https://mp.weixin.qq.com/s?__biz=MjM5MDE0Mjc4MA==&amp;mid=2650995856&amp;idx=1&amp;sn=7c62704384405868ce9f28359c7306ea&amp;chksm=bdbf04c38ac88dd5f967d020546e881ab301f7951458ad7d89bd44679133e7459bf27d6a0253&amp;mpshare=1&amp;scene=1&amp;srcid=0414Rx8W3W2yfoCQqgmTnGFH&amp;key=2a91529dae94444b304cab6ecab61d94479bfd3b891b378a875d1eab3f49c7b444f4c608405217ef464212c23e9c0c3b57b43b1c231f5e0f4c501c63927cbd8812163d7b3748a222f63581ed2d96b078&amp;ascene=0&amp;uin=MjIyOTk0ODU0MQ%3D%3D&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.12.4+build(16E195" target="_blank" rel="noopener">å·¦è€³æœµè€—å­ï¼šæ‹–ç´¯å¼€å‘å›¢é˜Ÿæ•ˆç‡çš„å›°å±€ä¸è§£å†³ä¹‹é“</a>&amp;version=12020110&amp;nettype=WIFI&amp;fontScale=100&amp;pass_ticket=bavrh4luffwXtPNqc9c46%2Fsos7wDPNF15zzHV8kiC6imiFomM3lu8kQ9H3AY1%2BWJ)</p><p><a href="http://tech.meituan.com/SharkSDK.html" target="_blank" rel="noopener">ç¾å›¢ç‚¹è¯„ç§»åŠ¨ç½‘ç»œä¼˜åŒ–å®è·µ</a></p><p><a href="http://www.cnblogs.com/Jenaral/p/5530383.html?from=groupmessage&amp;isappinstalled=1" target="_blank" rel="noopener">é™æ€åº“ä¸åŠ¨æ€åº“çš„åŒºåˆ«</a></p><p><del><a href="https://mp.weixin.qq.com/s?__biz=MzA3ODg4MDk0Ng==&amp;mid=2651113202&amp;idx=1&amp;sn=61bdbf35b49168d2373547887286a097&amp;chksm=844c6f2fb33be6399cbc05e679322ffc0ee89268f458f7bf47ab67e5561dd1f82b06849a2c81&amp;mpshare=1&amp;scene=23&amp;srcid=0417YjEuAcWp0SxCLrrxnyBU#rd" target="_blank" rel="noopener">åŸºäºReSwiftå’ŒApp Coordinatorçš„iOSæ¶æ„</a></del></p><p><del><a href="http://www.jianshu.com/p/67a6004f6930" target="_blank" rel="noopener">ç»„ä»¶åŒ–æ¶æ„æ¼«è°ˆ</a></del></p><p><del><a href="http://blog.cnbang.net/tech/3080/" target="_blank" rel="noopener">iOS ç»„ä»¶åŒ–æ–¹æ¡ˆæ¢ç´¢</a></del></p><p><del><a href="https://casatwy.com/iOS-Modulization.html" target="_blank" rel="noopener">iOSåº”ç”¨æ¶æ„è°ˆ ç»„ä»¶åŒ–æ–¹æ¡ˆ</a></del></p><p><del><a href="https://github.com/meili/MGJRouter" target="_blank" rel="noopener">MGJRouter</a></del></p><p><del><a href="http://mrpeak.cn/blog/module/" target="_blank" rel="noopener">iOSç»„ä»¶åŒ–æ–¹æ¡ˆ</a></del></p><p><strong> Swift ç¼–è¯‘é€Ÿåº¦ </strong></p><ol><li><p><del><a href="http://www.jianshu.com/p/36cc0af43258" target="_blank" rel="noopener">Swift build time</a></del></p></li><li><p><del><a href="http://www.cnblogs.com/YungMing/p/5160346.html" target="_blank" rel="noopener">åˆ†æSwifté¡¹ç›®çš„ç¼–è¯‘æ—¶é—´</a></del></p></li><li><p><del><a href="http://www.jianshu.com/p/9825749efa8b" target="_blank" rel="noopener">è°ƒæ•´ä»£ç , åŠ é€Ÿswiftç¼–è¯‘</a></del></p></li><li><p><del><a href="http://www.neroblog.com/?p=19" target="_blank" rel="noopener">å…³äºSwiftç¼–è¯‘æ…¢å¹¶æ²¡ä»€ä¹ˆåµç”¨çš„è§£å†³åŠæ³•</a></del></p></li><li><p><del><a href="https://github.com/RobertGummesson/BuildTimeAnalyzer-for-Xcode" target="_blank" rel="noopener">BuildTimeAnalyzer-for-Xcode</a></del></p></li></ol><p><del><a href="http://mobilists.eleme.io/" target="_blank" rel="noopener">Eleme Mobilists</a></del></p><p><a href="https://news.realm.io/cn/news/nate-cook-tryswift-tokyo-unsafe-swift-and-pointer-types/?from=groupmessage&amp;isappinstalled=1" target="_blank" rel="noopener">Swift çš‡å† ä¸Šçš„æ˜ç ï¼šä¸å®‰å…¨çš„ Swift å’ŒæŒ‡é’ˆç±»å‹</a></p><p><a href="http://www.jianshu.com/p/b8eae0e4de43#" target="_blank" rel="noopener">å†™ä¸€ä¸ªå¸¦æœ‰â€œä¸¤çº§ç¼“å­˜â€çš„ç½‘ç»œè¯·æ±‚åº“</a></p><p><del><a href="http://www.jianshu.com/p/965df0f28014" target="_blank" rel="noopener">GPUImageè¯¦ç»†è§£æï¼ˆä¸ƒï¼‰æ–‡å­—æ°´å°å’ŒåŠ¨æ€å›¾åƒæ°´å°</a></del></p><p><del><a href="https://www.eyrefree.org/2017/05/01/2017-05-01-GitHub-Badge-Introduction/" target="_blank" rel="noopener">GitHub é¡¹ç›®å¾½ç« çš„æ·»åŠ å’Œè®¾ç½®</a></del></p><h1 id="2017-å¹´-5-æœˆ-1-æ—¥"><a href="#2017-å¹´-5-æœˆ-1-æ—¥" class="headerlink" title="2017 å¹´ 5 æœˆ 1 æ—¥ +"></a>2017 å¹´ 5 æœˆ 1 æ—¥ +</h1><p><del><a href="http://www.hudongdong.com/ios/530.html" target="_blank" rel="noopener">GPUImageå½•åƒçš„ä¸€äº›å¤‡å¿˜</a></del></p><p><del><a href="https://juejin.im/post/5905b9058d6d810058d49f0d" target="_blank" rel="noopener">ä¼˜åŒ– Swift ç¼–è¯‘é€Ÿåº¦</a></del></p><p><del><a href="https://medium.com/@pvzig/building-slack-bots-in-swift-b99e243e444c" target="_blank" rel="noopener">Building Slack Bots In Swift</a></del></p><p><a href="http://www.jianshu.com/p/5c3f19c78f25" target="_blank" rel="noopener">ç¨‹åºå‘˜æ‹¿ä»€ä¹ˆæ¥å­¦è‹±è¯­</a></p><p><a href="http://ios.jobbole.com/93179/" target="_blank" rel="noopener">Xcode è‡ªå®šä¹‰æ¨¡æ¿å®è·µ</a></p><p><a href="http://cjting.me/misc/how-git-generate-diff/" target="_blank" rel="noopener">Gitæ˜¯æ€æ ·ç”Ÿæˆdiffçš„ï¼šMyersç®—æ³•</a></p><h1 id="2017-å¹´-7-æœˆ-1-æ—¥"><a href="#2017-å¹´-7-æœˆ-1-æ—¥" class="headerlink" title="2017 å¹´ 7 æœˆ 1 æ—¥ +"></a>2017 å¹´ 7 æœˆ 1 æ—¥ +</h1><p><a href="https://onevcat.com/2017/07/state-based-viewcontroller/" target="_blank" rel="noopener">å•å‘æ•°æ®æµåŠ¨çš„å‡½æ•°å¼ View Controller</a></p><p><a href="http://swifter.tips/random-number/" target="_blank" rel="noopener">éšæœºæ•°ç”Ÿæˆ</a></p><h1 id="2017-å¹´-8-æœˆ-1-æ—¥"><a href="#2017-å¹´-8-æœˆ-1-æ—¥" class="headerlink" title="2017 å¹´ 8 æœˆ 1 æ—¥ +"></a>2017 å¹´ 8 æœˆ 1 æ—¥ +</h1><p><a href="https://segmentfault.com/a/1190000010600318" target="_blank" rel="noopener">SegmentFault æŠ€æœ¯å‘¨åˆŠ Vol.31 - ç å†œä¹Ÿè¦å­¦ç®—æ³•</a></p><p><del><a href="https://zhuanlan.zhihu.com/p/28488946?utm_medium=social" target="_blank" rel="noopener">AIå¯èƒ½çœŸçš„è¦ä»£æ›¿æ’ç”»å¸ˆäº†</a></del></p><p><a href="http://www.jianshu.com/p/29051908c74b" target="_blank" rel="noopener">iOS Crash æ•è·åŠå †æ ˆç¬¦å·åŒ–æ€è·¯å‰–æ</a></p><p><a href="https://github.com/Draveness/Analyze/blob/master/contents/CocoaPods/CocoaPods%20%E9%83%BD%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88%EF%BC%9F.md" target="_blank" rel="noopener">CocoaPods éƒ½åšäº†ä»€ä¹ˆï¼Ÿ</a></p><h1 id="2017-å¹´-9-æœˆ-1-æ—¥"><a href="#2017-å¹´-9-æœˆ-1-æ—¥" class="headerlink" title="2017 å¹´ 9 æœˆ 1 æ—¥ +"></a>2017 å¹´ 9 æœˆ 1 æ—¥ +</h1><p><del><a href="http://einverne.github.io/post/2017/04/pyenv.html" target="_blank" rel="noopener">ä½¿ç”¨ pyenv ç®¡ç† Python ç‰ˆæœ¬</a></del></p><p><a href="http://blog.startry.com/2015/10/28/Somthing-about-Podfile-lock/" target="_blank" rel="noopener">Podfile.lockèƒŒåçš„é‚£ç‚¹äº‹</a></p><p><a href="https://sspai.com/post/32979" target="_blank" rel="noopener">ä»é›¶å¼€å§‹å­¦ä¹  Alfredï¼šåŸºç¡€åŠŸèƒ½åŠè®¾ç½®</a></p><h1 id="2017-å¹´-11-æœˆ-1-æ—¥"><a href="#2017-å¹´-11-æœˆ-1-æ—¥" class="headerlink" title="2017 å¹´ 11 æœˆ 1 æ—¥ +"></a>2017 å¹´ 11 æœˆ 1 æ—¥ +</h1><p><a href="https://coolshell.cn/articles/4758.html" target="_blank" rel="noopener">å¦‚ä½•å†™å‡ºæ— æ³•ç»´æŠ¤çš„ä»£ç </a></p><h1 id="2017-å¹´-12-æœˆ-1-æ—¥"><a href="#2017-å¹´-12-æœˆ-1-æ—¥" class="headerlink" title="2017 å¹´ 12 æœˆ 1 æ—¥+"></a>2017 å¹´ 12 æœˆ 1 æ—¥+</h1><p><a href="http://liuyanwei.jumppo.com/index.html" target="_blank" rel="noopener">åˆ˜å½¦ç®çš„æŠ€æœ¯åšå®¢</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;2016-å¹´-1-æœˆ-1-æ—¥&quot;&gt;&lt;a href=&quot;#2016-å¹´-1-æœˆ-1-æ—¥&quot; class=&quot;headerlink&quot; title=&quot;2016 å¹´ 1 æœˆ 1 æ—¥ +&quot;&gt;&lt;/a&gt;2016 å¹´ 1 æœˆ 1 æ—¥ +&lt;/h1&gt;&lt;p&gt;æœ‰å…³ objc_autoreleasereturnvalue&lt;/p&gt;
&lt;p&gt;&lt;del&gt;&lt;a href=&quot;http://www.voidcn.com/blog/li15809284891/article/p-6244162.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;iOS è‡ªåŠ¨é‡Šæ”¾æ± ARCä¸MRC&lt;/a&gt;&lt;/del&gt;&lt;/p&gt;
&lt;p&gt;&lt;del&gt;&lt;a href=&quot;http://blog.sunnyxx.com/2014/10/15/behind-autorelease/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;é»‘å¹•èƒŒåçš„Autorelease&lt;/a&gt;&lt;/del&gt;&lt;/p&gt;
&lt;p&gt;&lt;del&gt;&lt;a href=&quot;http://clang.llvm.org/docs/AutomaticReferenceCounting.html#arc-runtime-objc-autoreleasereturnvalue&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Clang 4.0 documentation&lt;/a&gt;&lt;/del&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Other" scheme="http://zhoulingyu.com/categories/Other/"/>
    
      <category term="é˜…è¯»åˆ—è¡¨" scheme="http://zhoulingyu.com/categories/Other/%E9%98%85%E8%AF%BB%E5%88%97%E8%A1%A8/"/>
    
    
      <category term="Other" scheme="http://zhoulingyu.com/tags/Other/"/>
    
      <category term="ReadList" scheme="http://zhoulingyu.com/tags/ReadList/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºå¾®ä¿¡è‡ªåŠ¨æŠ¢çº¢åŒ…éª—å±€</title>
    <link href="http://zhoulingyu.com/2016/11/21/%E5%85%B3%E4%BA%8E%E5%BE%AE%E4%BF%A1%E8%87%AA%E5%8A%A8%E6%8A%A2%E7%BA%A2%E5%8C%85%E9%AA%97%E5%B1%80/"/>
    <id>http://zhoulingyu.com/2016/11/21/å…³äºå¾®ä¿¡è‡ªåŠ¨æŠ¢çº¢åŒ…éª—å±€/</id>
    <published>2016-11-21T17:16:03.000Z</published>
    <updated>2018-07-10T03:07:31.632Z</updated>
    
    <content type="html"><![CDATA[<h1 id="äº‹å‡ºèµ·å› "><a href="#äº‹å‡ºèµ·å› " class="headerlink" title="äº‹å‡ºèµ·å› "></a>äº‹å‡ºèµ·å› </h1><p>å‰å‡ å¤©ï¼Œå¤§å­¦åŒå­¦å‘ç»™æˆ‘ä¸€ä¸ª<a href="https://a.meipian.cn/8kbmkn5" target="_blank" rel="noopener">é“¾æ¥</a>ï¼Œé‡Œé¢æ˜¯ä¸€ä¸ªå¾®ä¿¡æŠ¢çº¢åŒ…æ’ä»¶çš„ä»‹ç»ã€‚å¤§è‡´çš„æ ·å­åœ¨æ–‡æœ«ç»™å‡ºã€‚å¤§è‡´æ˜¯ä¹°ä»–ä»¬çš„æ’ä»¶å¯ä»¥é€šè¿‡ä»–ä»¬çš„å¹³å°ç»‘å®šå¾®ä¿¡å·ï¼Œè®¾å®šè‡ªåŠ¨æŠ¢çº¢åŒ…å¹¶ä¸”è®¾å®šæŠ¢çº¢åŒ…çš„å»¶è¿Ÿï¼ˆæ¯”å¦‚ 100 msï¼‰ä»€ä¹ˆçš„ã€‚</p><p>ä¹‹å‰æˆ‘åœ¨ç ”ç©¶ iOS æ”»é˜²çš„æ—¶å€™ç ”ç©¶è¿‡å¾®ä¿¡çš„çº¢åŒ…æ’ä»¶ã€‚ä½†æ˜¯ä»åŸç†ä¸Šæ¥è¯´ï¼Œæ˜¯é€šè¿‡åŠ¨æ€é“¾æ¥åº“ä¸ºå¾®ä¿¡æ’å…¥äº†è‡ªå·±åŠ å…¥çš„ä»£ç ï¼ˆåœ¨æ”¶åˆ°çº¢åŒ…ç±»å‹ä¿¡æ¯æ—¶ï¼Œè°ƒç”¨æ‹†å¼€çº¢åŒ…æ–¹æ³•ï¼‰å†é€šè¿‡é‡ç­¾åè¿›è¡Œæ‰“åŒ…ã€‚ä»é“å¾·ä¸Šï¼Œä¹Ÿæ˜¯ä¸ºäº†ç ”ç©¶ iOS çš„æ”»é˜²çš„ä¸€äº›çŸ¥è¯†ã€‚å½“æˆ‘æ”¶åˆ°åŒå­¦çš„é“¾æ¥æ—¶ï¼Œç¬¬ä¸€ä¸ªååº”æ˜¯ï¼Œå±…ç„¶æœ‰äººå–è¿™ä¸ªï¼Œç®€ç›´ä¸åˆæƒ…ç†ã€‚</p><a id="more"></a><h1 id="å¾®ä¿¡è‡ªåŠ¨æŠ¢çº¢åŒ…çš„åŸç†"><a href="#å¾®ä¿¡è‡ªåŠ¨æŠ¢çº¢åŒ…çš„åŸç†" class="headerlink" title="å¾®ä¿¡è‡ªåŠ¨æŠ¢çº¢åŒ…çš„åŸç†"></a>å¾®ä¿¡è‡ªåŠ¨æŠ¢çº¢åŒ…çš„åŸç†</h1><p>ä»”ç»†è§‚çœ‹äº†<a href="https://a.meipian.cn/8kbmkn5" target="_blank" rel="noopener">é“¾æ¥</a>æ–‡ç« å†…çš„ä»‹ç»ï¼Œæ„Ÿè§‰éå¸¸çš„ä¸å¯æ€è®®ï¼Œ å¤§å®¶ä¹Ÿå¯ä»¥åœ¨æ–‡æœ«æˆ–è€…é“¾æ¥ä¸­æŸ¥çœ‹ã€‚æ–‡ç« ä¸­ä»‹ç»åˆ°ï¼Œåœ¨ä»–ä»¬çš„å¹³å°æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œè®©åå†å¡«å†™å¾®ä¿¡å·ç å’Œä»ä»–ä»¬å®¢æœé‚£é‡Œä¹°æ¥çš„æ¿€æ´»ç ï¼Œå°±ä¼šæˆåŠŸæ³¨å†Œå¹¶è¿”å›ç»™ä½ ä¸€å¼ äºŒç»´ç ï¼Œåªè¦ä½ æ‰«æäº†äºŒç»´ç å°±å¯ä»¥è‡ªåŠ¨æŠ¢çº¢åŒ…äº†ã€‚å¹¶ä¸”æ˜¯ 24 å°æ—¶å…³æœºçŠ¶æ€éƒ½å¯ä»¥æŠ¢çº¢åŒ…ã€‚</p><p>åœ¨ä¸€å¼€å§‹ï¼Œæˆ‘è§‰å¾—éå¸¸ä¸å¯æ„æ€ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä¹‹å‰æ¥è§¦åˆ°çš„çº¢åŒ…æ’ä»¶ï¼Œå®è´¨ä¸Šæ˜¯å¯¹å¾®ä¿¡ app ä»£ç çš„æ”¹å˜ã€‚å¦‚æœæ˜¯é€šè¿‡ç¬¬ä¸‰æ–¹å¹³å°å¯ä»¥å®ç°æŠ¢çº¢åŒ…çš„è¯ï¼Œé¦–å…ˆï¼š</p><ol><li>æ‹¥æœ‰æŠ¢çº¢åŒ…çš„ api</li><li>æ‹¿åˆ°ç”¨æˆ·çš„ç™»é™†çŠ¶æ€ã€‚</li></ol><p>ä¸ä»…å¦‚æ­¤ï¼ŒåŠæ—¶è¿™ä¸¤ç‚¹éƒ½èƒ½åšåˆ°ï¼Œè¿˜å¿…é¡»è¦èƒ½æ‹¦æˆªåˆ°çº¢åŒ…æ¶ˆæ¯ï¼Œä½†æ˜¯å¾®ä¿¡çš„ IM åè®®åº”è¯¥æ˜¯ HTTP çš„åè®®æ‰©å±•ï¼Œå»ºç«‹çš„æ˜¯é•¿è¿æ¥ã€‚åœ¨åº”ç”¨å¤„äºå‰å°æ—¶ï¼Œé€šè¿‡ HTTP æ‰©å±•åè®®è·å–ä¿¡æ¯ï¼Œåœ¨åå°æ—¶ï¼Œé€šè¿‡è‹¹æœ APNS åè®®è·å–ä¿¡æ¯ã€‚åˆ°åº•æ˜¯æ€ä¹ˆæ ·åšåˆ°ä¿¡æ¯æ‹¦æˆªçš„å‘¢ã€‚</p><p>åœ¨å’ŒåŒäº‹åˆä»”ç»†æŸ¥é˜…ä¸€ç•ªåï¼Œ<a href="http://www.jianshu.com/users/86344ec5bfe7/latest_articles" target="_blank" rel="noopener">èµµé²œå</a>åŒå­¦é¦–å…ˆå‘ç°äº†é—®é¢˜çš„å…³é”®æ‰€åœ¨ã€‚å°±æ˜¯ä¸‹å›¾ï¼š</p><p><img src="http://static2.ivwen.com/users/6206370/c88810a066354895a60fb3bdea77190e.jpg-mobile" alt=""></p><p>è¿™å¼ å›¾ç‰‡ç»™å‡ºçš„äºŒç»´ç ï¼Œåœ¨é²œååŒå­¦æ‰«æè¿‡åå‘ç°æ˜¯ç”µè„‘ç™»é™†å¾®ä¿¡æ—¶ï¼Œå¾®ä¿¡ç»™å‡ºçš„ã€æ‰‹æœºæ‰«ä¸€æ‰«ç™»é™†äºŒç»´ç ã€ã€‚å¹¶ä¸”å›¾ç‰‡ä¸­ä¹ŸæŒ‡å‡ºéœ€è¦ã€ç”¨å¾®ä¿¡è¯†åˆ«äºŒç»´ç ç™»é™†å³å¯ã€ã€‚</p><p>é‚£ä¹ˆç°åœ¨çœŸç›¸æ˜¾è€Œæ˜“è§ã€‚<strong>å®è´¨ä¸Šï¼Œæ˜¯é€šè¿‡ä»–äººç™»é™†ä½ çš„å¾®ä¿¡ï¼Œç„¶ååœ¨ PC ç«¯åšä¸€äº›æ‰‹è„šï¼Œå®ç°è‡ªåŠ¨æŠ¢çº¢åŒ…ã€‚</strong></p><p>è¿™ç§è‡ªåŠ¨æŠ¢çº¢åŒ…çš„å®ç°æ–¹æ¡ˆï¼Œ<strong>ä¸ä»…ä¼šè®©ä½ çš„çº¢åŒ…æ¶ˆæ¯æ³„éœ²ï¼Œä¹Ÿä¼šè®©ä½ çš„æ‰€æœ‰èŠå¤©ä¿¡æ¯å…¨éƒ¨è¢«æš´éœ²</strong>ã€‚æ¯•ç«Ÿä½ æ˜¯åœ¨ä»–äººç”µè„‘ä¸Šç›´æ¥ç™»é™†äº†å¾®ä¿¡ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ ¹æ®æˆ‘å¤§å­¦åŒå­¦çš„æè¿°ï¼Œè¿™ç§çº¢åŒ…æ’ä»¶åœ¨æ·˜å®ä¸Šå”®å‡ºï¼Œæœ‰äººè¯„ä»·ã€ç”¨å‡ æ¬¡å°±ä¸èƒ½ç”¨äº†ã€ã€‚è¯´åˆ°åº•ï¼Œä¹Ÿè®¸å¯¹æ–¹æ ¹æœ¬ä¸æ˜¯æƒ³èµšä½ çš„æ’ä»¶é’±ï¼Œä¹Ÿè®¸å°±æ˜¯æƒ³è·å–ä»–äººçš„éšç§ä¿¡æ¯ã€‚</p><p>æ‰€ä»¥å¯¹äºè¿™ç§éª—å±€ï¼Œæœ¬äººè¡¨ç¤ºä¸èƒ½å®¹å¿ï¼Œç‰¹å†™è¯æ–‡ç« åˆ†äº«ï¼Œå¸Œæœ›å¤§å®¶ä¸è¦ä¸Šå½“å—éª—ã€‚</p><p>å¦‚æœæƒ³ç ”ç©¶ iOS çš„æ”»é˜²ï¼Œå¸Œæœ›ä½ ä¹Ÿåªç”¨äºç ”ç©¶å­¦ä¹ ã€‚</p><h1 id="ç›¸å…³å›¾ç‰‡"><a href="#ç›¸å…³å›¾ç‰‡" class="headerlink" title="ç›¸å…³å›¾ç‰‡"></a>ç›¸å…³å›¾ç‰‡</h1><p><img src="http://static2.ivwen.com/users/6206370/2cf8d283f6eb4deaa0a2be90dc3e500c.jpg-mobile" alt=""></p><p><img src="http://static2.ivwen.com/users/6206370/b0e3afc444c94b879bf6f08d0219444c.jpg-mobile" alt=""></p><p><img src="http://static2.ivwen.com/users/6206370/f0260abf60c740b89763ca0245354536.jpg-mobile" alt=""></p><hr><p>æœ‰ä»€ä¹ˆé—®é¢˜éƒ½å¯ä»¥åœ¨åšæ–‡åé¢ç•™è¨€ï¼Œæˆ–è€…å¾®åšä¸Šç§ä¿¡æˆ‘ï¼Œæˆ–è€…é‚®ä»¶æˆ‘ <a href="mailto:&#99;&#111;&#100;&#x65;&#x72;&#102;&#105;&#115;&#x68;&#64;&#49;&#x36;&#51;&#x2e;&#99;&#111;&#109;" target="_blank" rel="noopener">&#99;&#111;&#100;&#x65;&#x72;&#102;&#105;&#115;&#x68;&#64;&#49;&#x36;&#51;&#x2e;&#99;&#111;&#109;</a>ã€‚</p><p>åšä¸»æ˜¯ iOS å¦¹å­ä¸€æšã€‚</p><p>å¸Œæœ›å¤§å®¶ä¸€èµ·è¿›æ­¥ã€‚</p><p>æˆ‘çš„å¾®åšï¼š<a href="http://weibo.com/coderfish/" target="_blank" rel="noopener">å°é±¼å‘¨å‡Œå®‡</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;äº‹å‡ºèµ·å› &quot;&gt;&lt;a href=&quot;#äº‹å‡ºèµ·å› &quot; class=&quot;headerlink&quot; title=&quot;äº‹å‡ºèµ·å› &quot;&gt;&lt;/a&gt;äº‹å‡ºèµ·å› &lt;/h1&gt;&lt;p&gt;å‰å‡ å¤©ï¼Œå¤§å­¦åŒå­¦å‘ç»™æˆ‘ä¸€ä¸ª&lt;a href=&quot;https://a.meipian.cn/8kbmkn5&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;é“¾æ¥&lt;/a&gt;ï¼Œé‡Œé¢æ˜¯ä¸€ä¸ªå¾®ä¿¡æŠ¢çº¢åŒ…æ’ä»¶çš„ä»‹ç»ã€‚å¤§è‡´çš„æ ·å­åœ¨æ–‡æœ«ç»™å‡ºã€‚å¤§è‡´æ˜¯ä¹°ä»–ä»¬çš„æ’ä»¶å¯ä»¥é€šè¿‡ä»–ä»¬çš„å¹³å°ç»‘å®šå¾®ä¿¡å·ï¼Œè®¾å®šè‡ªåŠ¨æŠ¢çº¢åŒ…å¹¶ä¸”è®¾å®šæŠ¢çº¢åŒ…çš„å»¶è¿Ÿï¼ˆæ¯”å¦‚ 100 msï¼‰ä»€ä¹ˆçš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¹‹å‰æˆ‘åœ¨ç ”ç©¶ iOS æ”»é˜²çš„æ—¶å€™ç ”ç©¶è¿‡å¾®ä¿¡çš„çº¢åŒ…æ’ä»¶ã€‚ä½†æ˜¯ä»åŸç†ä¸Šæ¥è¯´ï¼Œæ˜¯é€šè¿‡åŠ¨æ€é“¾æ¥åº“ä¸ºå¾®ä¿¡æ’å…¥äº†è‡ªå·±åŠ å…¥çš„ä»£ç ï¼ˆåœ¨æ”¶åˆ°çº¢åŒ…ç±»å‹ä¿¡æ¯æ—¶ï¼Œè°ƒç”¨æ‹†å¼€çº¢åŒ…æ–¹æ³•ï¼‰å†é€šè¿‡é‡ç­¾åè¿›è¡Œæ‰“åŒ…ã€‚ä»é“å¾·ä¸Šï¼Œä¹Ÿæ˜¯ä¸ºäº†ç ”ç©¶ iOS çš„æ”»é˜²çš„ä¸€äº›çŸ¥è¯†ã€‚å½“æˆ‘æ”¶åˆ°åŒå­¦çš„é“¾æ¥æ—¶ï¼Œç¬¬ä¸€ä¸ªååº”æ˜¯ï¼Œå±…ç„¶æœ‰äººå–è¿™ä¸ªï¼Œç®€ç›´ä¸åˆæƒ…ç†ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="éšç¬”" scheme="http://zhoulingyu.com/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="éšç¬”" scheme="http://zhoulingyu.com/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
</feed>
